
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../cellects_threads/">
      
      
        <link rel="next" href="../one_image_analysis/">
      
      
        
      
      
      <link rel="icon" href="../../../../static/icon-128.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>motion_analysis - Cellects Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../static/extra.css">
    
      <link rel="stylesheet" href="../../../../static/notebooks.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cellectscoremotion_analysis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Cellects Documentation" class="md-header__button md-logo" aria-label="Cellects Documentation" data-md-component="logo">
      
  <img src="../../../../static/icon-256.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cellects Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              motion_analysis
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Aurele-B/Cellects" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../getting-started/" class="md-tabs__link">
          
  
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../first-analysis/" class="md-tabs__link">
          
  
  
  User guide

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../use-cases/" class="md-tabs__link">
        
  
  
    
  
  Use cases

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../license/" class="md-tabs__link">
        
  
  
    
  
  License & Citation

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Cellects Documentation" class="md-nav__button md-logo" aria-label="Cellects Documentation" data-md-component="logo">
      
  <img src="../../../../static/icon-256.png" alt="logo">

    </a>
    Cellects Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Aurele-B/Cellects" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../what-is-cellects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is Cellects?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Setting up a first analysis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Setting up a first analysis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/data-localisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data localisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/image-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/video-tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Video tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Improving the analysis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Improving the analysis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced parameters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/outputs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Required outputs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/multiple-folders/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multiple folders
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../use-cases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use cases
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    cellects
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    cellects
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    core
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_1" id="__nav_5_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cellects_paths/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cellects_paths
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cellects_threads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cellects_threads
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    motion_analysis
  

    
  </span>
  
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../one_image_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    one_image_analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../program_organizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    program_organizer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../script_based_run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    script_based_run
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../gui/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    gui
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_2" id="__nav_5_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    gui
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/advanced_parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    advanced_parameters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/cellects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cellects
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/custom_widgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    custom_widgets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/first_window/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    first_window
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/if_several_folders_window/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    if_several_folders_window
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/image_analysis_window/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    image_analysis_window
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/required_output/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    required_output
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/ui_strings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ui_strings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/video_analysis_window/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    video_analysis_window
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../image_analysis/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    image_analysis
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_3" id="__nav_5_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    image_analysis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../image_analysis/cell_leaving_detection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cell_leaving_detection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../image_analysis/image_segmentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    image_segmentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../image_analysis/morphological_operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    morphological_operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../image_analysis/network_functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    network_functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../image_analysis/one_image_analysis_threads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    one_image_analysis_threads
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../image_analysis/oscillations_functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    oscillations_functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../image_analysis/progressively_add_distant_shapes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    progressively_add_distant_shapes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../image_analysis/shape_descriptors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    shape_descriptors
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    utils
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_4" id="__nav_5_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    utils
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/decorators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    decorators
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/formulas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    formulas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/load_display_save/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    load_display_save
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/utilitarian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    utilitarian
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License & Citation
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="cellectscoremotion_analysis"><code>cellects.core.motion_analysis</code></h1>


<div class="doc doc-object doc-module">



<h1 id="cellects.core.motion_analysis" class="doc doc-heading">
            <code>cellects.core.motion_analysis</code>


</h1>

    <div class="doc doc-contents first">

        <p>Module for analyzing motion, growth patterns, and structural properties of biological specimens in video data.</p>
<p>This module provides comprehensive tools to analyze videos of biological samples (e.g., cell colonies) by:
1. Loading and converting RGB videos to grayscale using configurable color space combinations
2. Performing multi-strategy segmentation (frame-by-frame, intensity thresholding, derivative-based detection)
3. Applying post-processing steps including error correction algorithms for shape continuity
4. Computing morphological descriptors over time (area, perimeter, fractal dimension, etc.)
5. Detecting network structures and oscillatory behavior in dynamic biological systems</p>


<p><span class="doc-section-title">Classes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.MotionAnalysis : Processes video data to analyze specimen motion, growth patterns, and structural properties.">MotionAnalysis : Processes video data to analyze specimen motion, growth patterns, and structural properties.</span></code></td>
            <td>
              <div class="doc-md-description">
                <p>Provides methods for loading videos, performing segmentation using multiple algorithms,
post-processing results with error correction, extracting morphological descriptors,
detecting network structures, analyzing oscillations, and saving processed outputs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><span title="cellects.core.motion_analysis.load_images_and_videos : Loads and converts video files to appropriate format for analysis.">load_images_and_videos : Loads and converts video files to appropriate format for analysis.</span></code></td>
              <td>
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="cellects.core.motion_analysis.get_converted_video : Converts RGB video to grayscale based on specified color space parameters.">get_converted_video : Converts RGB video to grayscale based on specified color space parameters.</span></code></td>
              <td>
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="cellects.core.motion_analysis.detection : Performs multi-strategy segmentation of the specimen across all frames.">detection : Performs multi-strategy segmentation of the specimen across all frames.</span></code></td>
              <td>
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="cellects.core.motion_analysis.update_shape : Updates segmented shape with post-processing steps like noise filtering and hole filling.">update_shape : Updates segmented shape with post-processing steps like noise filtering and hole filling.</span></code></td>
              <td>
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="cellects.core.motion_analysis.save_results : Saves processed data, efficiency tests, and annotated videos.">save_results : Saves processed data, efficiency tests, and annotated videos.</span></code></td>
              <td>
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The features of this module include:
- Processes large video datasets with memory optimization strategies including typed arrays (NumPy)
  and progressive processing techniques.
- The module supports both single-specimen and multi-specimen analysis through configurable parameters.
- Segmentation strategies include intensity-based thresholding, gradient detection, and combinations thereof.
- Post-processing includes morphological operations to refine segmented regions and error correction for specific use cases (e.g., Physarum polycephalum).
- Biological network detection and graph extraction is available to represent network structures as vertex-edge tables.
- Biological oscillatory pattern detection
- Fractal dimension calculation</p>
</details>









<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="cellects.core.motion_analysis.CompareNeighborsWithValue" class="doc doc-heading">
            <code>CompareNeighborsWithValue</code>


</h2>


    <div class="doc doc-contents ">



        <p>CompareNeighborsWithValue class to summarize each pixel by comparing its neighbors to a value.</p>
<p>This class analyzes pixels in a 2D array, comparing each pixel's neighbors
to a specified value. The comparison can be equality, superiority,
or inferiority, and neighbors can be the 4 or 8 nearest pixels based on
the connectivity parameter.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/cellects/image_analysis/morphological_operations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="k">class</span><span class="w"> </span><span class="nc">CompareNeighborsWithValue</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    CompareNeighborsWithValue class to summarize each pixel by comparing its neighbors to a value.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    This class analyzes pixels in a 2D array, comparing each pixel&#39;s neighbors</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    to a specified value. The comparison can be equality, superiority,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    or inferiority, and neighbors can be the 4 or 8 nearest pixels based on</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    the connectivity parameter.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">):</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Initialize a class for array connectivity processing.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        This class processes arrays based on given connectivities, creating</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        windows around the original data for both 1D and 2D arrays. Depending on</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        the connectivity value (4 or 8), it creates different windows with borders.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        array : ndarray</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            Input array to process, can be 1D or 2D.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        connectivity : int, optional</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            Connectivity type for processing (4 or 8), by default None.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        data_type : dtype, optional</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            Data type for the array elements, by default np.int8.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        Attributes</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        array : ndarray</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            The processed array based on the given data type.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        connectivity : int</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            Connectivity value used for processing.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        on_the_right : ndarray</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            Array with shifted elements to the right.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        on_the_left : ndarray</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            Array with shifted elements to the left.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        on_the_bot : ndarray, optional</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            Array with shifted elements to the bottom (for 2D arrays).</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        on_the_top : ndarray, optional</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            Array with shifted elements to the top (for 2D arrays).</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        on_the_topleft : ndarray, optional</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            Array with shifted elements to the top left (for 2D arrays).</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        on_the_topright : ndarray, optional</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            Array with shifted elements to the top right (for 2D arrays).</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        on_the_botleft : ndarray, optional</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            Array with shifted elements to the bottom left (for 2D arrays).</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        on_the_botright : ndarray, optional</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">            Array with shifted elements to the bottom right (for 2D arrays).</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">connectivity</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">array</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="c1"># Build 4 window of the original array, each missing one of the four borders</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="c1"># Grow each window with a copy of the last border at the opposite of the side a border have been deleted</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">array</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">array</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:],</span> <span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">array</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">))</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">))</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">))</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">))</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">and_itself</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        Check equality of neighboring values in an array.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        This method compares the neighbors of each element in `self.array` to a given value.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Depending on the dimensionality and connectivity settings, it checks different neighboring</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        elements.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        value : int or float</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">            The value to check equality with neighboring elements.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        and_itself : bool, optional</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">            If True, also check equality with the element itself. Defaults to False.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">        -------</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        None</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        Attributes (not standard Qt properties)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        --------------------------------------</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        equal_neighbor_nb : ndarray of uint8</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">            Array that holds the number of equal neighbors for each element.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        --------</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        &gt;&gt;&gt; matrix = np.array([[9, 0, 4, 6], [4, 9, 1, 3], [7, 2, 1, 4], [9, 0, 8, 5]], dtype=np.int8)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        &gt;&gt;&gt; compare = CompareNeighborsWithValue(matrix, connectivity=4)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        &gt;&gt;&gt; compare.is_equal(1)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        &gt;&gt;&gt; print(compare.equal_neighbor_nb)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        [[0 0 1 0]</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        [0 1 1 1]</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        [0 1 1 1]</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        [0 0 1 0]]</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span><span class="p">,</span> <span class="n">value</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                                                 <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span><span class="p">,</span> <span class="n">value</span><span class="p">)))</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                     <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                     <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                     <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">,</span> <span class="n">value</span><span class="p">)))</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                     <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">,</span> <span class="n">value</span><span class="p">)))</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="k">if</span> <span class="n">and_itself</span><span class="p">:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_sup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        Determine if pixels have more neighbors with higher values than a given threshold.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        This method computes the number of neighboring pixels that have values greater</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        than a specified `value` for each pixel in the array. Optionally, it can exclude</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        the pixel itself if its value is less than or equal to `value`.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        value : int</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">            The threshold value used to determine if a neighboring pixel&#39;s value is greater.</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        and_itself : bool, optional</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">            If True, exclude the pixel itself if its value is less than or equal to `value`.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">            Defaults to False.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        --------</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        &gt;&gt;&gt; matrix = np.array([[9, 0, 4, 6], [4, 9, 1, 3], [7, 2, 1, 4], [9, 0, 8, 5]], dtype=np.int8)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        &gt;&gt;&gt; compare = CompareNeighborsWithValue(matrix, connectivity=4)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        &gt;&gt;&gt; compare.is_sup(1)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        &gt;&gt;&gt; print(compare.sup_neighbor_nb)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        [[3 3 2 4]</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">         [4 2 3 3]</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">         [4 2 3 3]</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">         [3 3 2 4]]</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>                                               <span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                                               <span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                                               <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                                               <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                                               <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">if</span> <span class="n">and_itself</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">less_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_inf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        is_inf(value and_itself=False)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        Determine the number of neighbors that are infinitely small relative to a given value,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        considering optional connectivity and exclusion of the element itself.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        value : numeric</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">            The value to compare neighbor elements against.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">        and_itself : bool, optional</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">            If True, excludes the element itself from being counted. Default is False.</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        --------</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        &gt;&gt;&gt; matrix = np.array([[9, 0, 4, 6], [4, 9, 1, 3], [7, 2, 1, 4], [9, 0, 8, 5]], dtype=np.int8)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">        &gt;&gt;&gt; compare = CompareNeighborsWithValue(matrix, connectivity=4)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        &gt;&gt;&gt; compare.is_inf(1)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        &gt;&gt;&gt; print(compare.inf_neighbor_nb)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        [[1 1 1 0]</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">         [0 1 0 0]</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">         [0 1 0 0]</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">         [1 1 1 0]]</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                                               <span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                                               <span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                                               <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                                               <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                                               <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="k">if</span> <span class="n">and_itself</span><span class="p">:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.CompareNeighborsWithValue.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize a class for array connectivity processing.</p>
<p>This class processes arrays based on given connectivities, creating
windows around the original data for both 1D and 2D arrays. Depending on
the connectivity value (4 or 8), it creates different windows with borders.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input array to process, can be 1D or 2D.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>connectivity</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Connectivity type for processing (4 or 8), by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_type</code>
            </td>
            <td>
                  <code><span title="dtype">dtype</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data type for the array elements, by default np.int8.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.int8">int8</span></code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.CompareNeighborsWithValue.__init__.array">array</span></code></td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The processed array based on the given data type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.CompareNeighborsWithValue.__init__.connectivity">connectivity</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Connectivity value used for processing.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.CompareNeighborsWithValue.__init__.on_the_right">on_the_right</span></code></td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array with shifted elements to the right.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.CompareNeighborsWithValue.__init__.on_the_left">on_the_left</span></code></td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array with shifted elements to the left.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.CompareNeighborsWithValue.__init__.on_the_bot">on_the_bot</span></code></td>
            <td>
                  <code>(<span title="ndarray">ndarray</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array with shifted elements to the bottom (for 2D arrays).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.CompareNeighborsWithValue.__init__.on_the_top">on_the_top</span></code></td>
            <td>
                  <code>(<span title="ndarray">ndarray</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array with shifted elements to the top (for 2D arrays).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.CompareNeighborsWithValue.__init__.on_the_topleft">on_the_topleft</span></code></td>
            <td>
                  <code>(<span title="ndarray">ndarray</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array with shifted elements to the top left (for 2D arrays).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.CompareNeighborsWithValue.__init__.on_the_topright">on_the_topright</span></code></td>
            <td>
                  <code>(<span title="ndarray">ndarray</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array with shifted elements to the top right (for 2D arrays).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.CompareNeighborsWithValue.__init__.on_the_botleft">on_the_botleft</span></code></td>
            <td>
                  <code>(<span title="ndarray">ndarray</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array with shifted elements to the bottom left (for 2D arrays).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.CompareNeighborsWithValue.__init__.on_the_botright">on_the_botright</span></code></td>
            <td>
                  <code>(<span title="ndarray">ndarray</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array with shifted elements to the bottom right (for 2D arrays).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/morphological_operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">):</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Initialize a class for array connectivity processing.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    This class processes arrays based on given connectivities, creating</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    windows around the original data for both 1D and 2D arrays. Depending on</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    the connectivity value (4 or 8), it creates different windows with borders.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    array : ndarray</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        Input array to process, can be 1D or 2D.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    connectivity : int, optional</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Connectivity type for processing (4 or 8), by default None.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    data_type : dtype, optional</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        Data type for the array elements, by default np.int8.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    array : ndarray</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        The processed array based on the given data type.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    connectivity : int</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        Connectivity value used for processing.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    on_the_right : ndarray</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        Array with shifted elements to the right.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    on_the_left : ndarray</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        Array with shifted elements to the left.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    on_the_bot : ndarray, optional</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        Array with shifted elements to the bottom (for 2D arrays).</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    on_the_top : ndarray, optional</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        Array with shifted elements to the top (for 2D arrays).</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    on_the_topleft : ndarray, optional</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        Array with shifted elements to the top left (for 2D arrays).</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    on_the_topright : ndarray, optional</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        Array with shifted elements to the top right (for 2D arrays).</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    on_the_botleft : ndarray, optional</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        Array with shifted elements to the bottom left (for 2D arrays).</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    on_the_botright : ndarray, optional</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        Array with shifted elements to the bottom right (for 2D arrays).</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">connectivity</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">array</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="c1"># Build 4 window of the original array, each missing one of the four borders</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="c1"># Grow each window with a copy of the last border at the opposite of the side a border have been deleted</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">array</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">array</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:],</span> <span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">array</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">))</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">))</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">))</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">))</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.CompareNeighborsWithValue.is_equal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_equal</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check equality of neighboring values in an array.</p>
<p>This method compares the neighbors of each element in <code>self.array</code> to a given value.
Depending on the dimensionality and connectivity settings, it checks different neighboring
elements.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value to check equality with neighboring elements.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>and_itself</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, also check equality with the element itself. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="attributes-(not-standard-qt-properties)" open>
  <summary>Attributes (not standard Qt properties)</summary>
  <p>equal_neighbor_nb : ndarray of uint8
    Array that holds the number of equal neighbors for each element.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">compare</span><span class="o">.</span><span class="n">equal_neighbor_nb</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">[[0 0 1 0]</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">[0 1 1 1]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go">[0 1 1 1]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">[0 0 1 0]]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/morphological_operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">and_itself</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    Check equality of neighboring values in an array.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    This method compares the neighbors of each element in `self.array` to a given value.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    Depending on the dimensionality and connectivity settings, it checks different neighboring</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    elements.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    value : int or float</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        The value to check equality with neighboring elements.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    and_itself : bool, optional</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        If True, also check equality with the element itself. Defaults to False.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    -------</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    None</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    Attributes (not standard Qt properties)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">    --------------------------------------</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    equal_neighbor_nb : ndarray of uint8</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        Array that holds the number of equal neighbors for each element.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    --------</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    &gt;&gt;&gt; matrix = np.array([[9, 0, 4, 6], [4, 9, 1, 3], [7, 2, 1, 4], [9, 0, 8, 5]], dtype=np.int8)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    &gt;&gt;&gt; compare = CompareNeighborsWithValue(matrix, connectivity=4)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    &gt;&gt;&gt; compare.is_equal(1)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    &gt;&gt;&gt; print(compare.equal_neighbor_nb)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    [[0 0 1 0]</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    [0 1 1 1]</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    [0 1 1 1]</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    [0 0 1 0]]</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span><span class="p">,</span> <span class="n">value</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                                             <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span><span class="p">,</span> <span class="n">value</span><span class="p">)))</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                 <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                 <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                 <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">,</span> <span class="n">value</span><span class="p">)))</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                 <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span><span class="p">,</span> <span class="n">value</span><span class="p">)))</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">if</span> <span class="n">and_itself</span><span class="p">:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">equal_neighbor_nb</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.CompareNeighborsWithValue.is_inf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_inf</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>is_inf(value and_itself=False)</p>
<p>Determine the number of neighbors that are infinitely small relative to a given value,
considering optional connectivity and exclusion of the element itself.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="numeric">numeric</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value to compare neighbor elements against.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>and_itself</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, excludes the element itself from being counted. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="o">.</span><span class="n">is_inf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">compare</span><span class="o">.</span><span class="n">inf_neighbor_nb</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">[[1 1 1 0]</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go"> [0 1 0 0]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go"> [0 1 0 0]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go"> [1 1 1 0]]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/morphological_operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_inf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    is_inf(value and_itself=False)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    Determine the number of neighbors that are infinitely small relative to a given value,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    considering optional connectivity and exclusion of the element itself.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    value : numeric</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        The value to compare neighbor elements against.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">    and_itself : bool, optional</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">        If True, excludes the element itself from being counted. Default is False.</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    --------</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">    &gt;&gt;&gt; matrix = np.array([[9, 0, 4, 6], [4, 9, 1, 3], [7, 2, 1, 4], [9, 0, 8, 5]], dtype=np.int8)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">    &gt;&gt;&gt; compare = CompareNeighborsWithValue(matrix, connectivity=4)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    &gt;&gt;&gt; compare.is_inf(1)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    &gt;&gt;&gt; print(compare.inf_neighbor_nb)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    [[1 1 1 0]</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">     [0 1 0 0]</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">     [0 1 0 0]</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">     [1 1 1 0]]</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                                           <span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                                           <span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                                           <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                                           <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                                           <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="k">if</span> <span class="n">and_itself</span><span class="p">:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inf_neighbor_nb</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.CompareNeighborsWithValue.is_sup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_sup</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine if pixels have more neighbors with higher values than a given threshold.</p>
<p>This method computes the number of neighboring pixels that have values greater
than a specified <code>value</code> for each pixel in the array. Optionally, it can exclude
the pixel itself if its value is less than or equal to <code>value</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The threshold value used to determine if a neighboring pixel's value is greater.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>and_itself</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, exclude the pixel itself if its value is less than or equal to <code>value</code>.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">compare</span><span class="o">.</span><span class="n">is_sup</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">compare</span><span class="o">.</span><span class="n">sup_neighbor_nb</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">[[3 3 2 4]</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go"> [4 2 3 3]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go"> [4 2 3 3]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go"> [3 3 2 4]]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/morphological_operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_sup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    Determine if pixels have more neighbors with higher values than a given threshold.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    This method computes the number of neighboring pixels that have values greater</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    than a specified `value` for each pixel in the array. Optionally, it can exclude</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    the pixel itself if its value is less than or equal to `value`.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    value : int</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        The threshold value used to determine if a neighboring pixel&#39;s value is greater.</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    and_itself : bool, optional</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        If True, exclude the pixel itself if its value is less than or equal to `value`.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        Defaults to False.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    --------</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    &gt;&gt;&gt; matrix = np.array([[9, 0, 4, 6], [4, 9, 1, 3], [7, 2, 1, 4], [9, 0, 8, 5]], dtype=np.int8)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">    &gt;&gt;&gt; compare = CompareNeighborsWithValue(matrix, connectivity=4)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    &gt;&gt;&gt; compare.is_sup(1)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    &gt;&gt;&gt; print(compare.sup_neighbor_nb)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    [[3 3 2 4]</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">     [4 2 3 3]</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">     [4 2 3 3]</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">     [3 3 2 4]]</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>                                           <span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_right</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_left</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                                           <span class="bp">self</span><span class="o">.</span><span class="n">on_the_bot</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_top</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                                           <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                                           <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">on_the_topleft</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_topright</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                                           <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botleft</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_the_botright</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="k">if</span> <span class="n">and_itself</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sup_neighbor_nb</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">less_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cellects.core.motion_analysis.EdgeIdentification" class="doc doc-heading">
            <code>EdgeIdentification</code>


</h2>


    <div class="doc doc-contents ">



        <p>Initialize the class with skeleton and distance arrays.</p>
<p>This class is used to identify edges within a skeleton structure based on
provided skeleton and distance arrays. It performs various operations to
refine and label edges, ultimately producing a fully identified network.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="k">class</span><span class="w"> </span><span class="nc">EdgeIdentification</span><span class="p">:</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the class with skeleton and distance arrays.</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><span class="sd">    This class is used to identify edges within a skeleton structure based on</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a><span class="sd">    provided skeleton and distance arrays. It performs various operations to</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a><span class="sd">    refine and label edges, ultimately producing a fully identified network.</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad_skeleton</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">pad_distances</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a><span class="sd">        Initialize the class with skeleton and distance arrays.</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a><span class="sd">        pad_skeleton : ndarray of uint8</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a><span class="sd">            Array representing the skeleton to pad.</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a><span class="sd">        pad_distances : ndarray of float64</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="sd">            Array representing distances corresponding to the skeleton.</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="sd">        Attributes</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="sd">        remaining_vertices : None</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">            Remaining vertices. Initialized as `None`.</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="sd">        vertices : None</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">            Vertices. Initialized as `None`.</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="sd">        growing_vertices : None</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><span class="sd">            Growing vertices. Initialized as `None`.</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">        im_shape : tuple of ints</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">            Shape of the skeleton array.</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span> <span class="o">=</span> <span class="n">pad_skeleton</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_distances</span> <span class="o">=</span> <span class="n">pad_distances</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remaining_vertices</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">growing_vertices</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">im_shape</span> <span class="o">=</span> <span class="n">pad_skeleton</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_edge_identification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">        Run the edge identification process.</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="sd">        This method orchestrates a series of steps to identify and label edges</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">        within the graph structure. Each step handles a specific aspect of edge</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">        identification, ultimately leading to a clearer and more refined edge network.</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">        Steps involved:</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">        1. Get vertices and tips coordinates.</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a><span class="sd">        2. Identify tipped edges.</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="sd">        3. Remove tipped edges smaller than branch width.</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><span class="sd">        4. Label tipped edges and their vertices.</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><span class="sd">        5. Label edges connected with vertex clusters.</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><span class="sd">        6. Label edges connecting vertex clusters.</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">        7. Label edges from known vertices iteratively.</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a><span class="sd">        8. Label edges looping on 1 vertex.</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a><span class="sd">        9. Clear areas with 1 or 2 unidentified pixels.</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a><span class="sd">        10. Clear edge duplicates.</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><span class="sd">        11. Clear vertices connecting 2 edges.</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_and_tips_coord</span><span class="p">()</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_tipped_edges</span><span class="p">()</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_tipped_edge_smaller_than_branch_width</span><span class="p">()</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_tipped_edges_and_their_vertices</span><span class="p">()</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_vertex_existence</span><span class="p">()</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_edges_connected_with_vertex_clusters</span><span class="p">()</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_edges_connecting_vertex_clusters</span><span class="p">()</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_edges_from_known_vertices_iteratively</span><span class="p">()</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_edges_looping_on_1_vertex</span><span class="p">()</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clear_areas_of_1_or_2_unidentified_pixels</span><span class="p">()</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clear_edge_duplicates</span><span class="p">()</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clear_vertices_connecting_2_edges</span><span class="p">()</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_vertices_and_tips_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process skeleton data to extract non-tip vertices and tip coordinates.</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a><span class="sd">        This method processes the skeleton stored in `self.pad_skeleton` by first</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a><span class="sd">        extracting all vertices and tips. It then separates these into branch points</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a><span class="sd">        (non-tip vertices) and specific tip coordinates using internal processing.</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a><span class="sd">        Attributes</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a><span class="sd">        self.non_tip_vertices : array-like</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a><span class="sd">            Coordinates of non-tip (branch) vertices.</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a><span class="sd">        self.tips_coord : array-like</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a><span class="sd">            Coordinates of identified tips in the skeleton.</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>        <span class="n">pad_vertices</span><span class="p">,</span> <span class="n">pad_tips</span> <span class="o">=</span> <span class="n">get_vertices_and_tips_from_skeleton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span> <span class="o">=</span> <span class="n">get_branches_and_tips_coord</span><span class="p">(</span><span class="n">pad_vertices</span><span class="p">,</span> <span class="n">pad_tips</span><span class="p">)</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tipped_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a><span class="sd">        get_tipped_edges : method to extract skeleton edges connecting branching points and tips.</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a><span class="sd">        Makes sure that there is only one connected component constituting the skeleton of the network and</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><span class="sd">        identifies all edges that are connected to a tip.</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a><span class="sd">        Attributes</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a><span class="sd">        pad_skeleton : ndarray of bool, modified</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a><span class="sd">            Boolean mask representing the pruned skeleton after isolating the largest connected component.</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="sd">        vertices_branching_tips : ndarray of int, shape (N, 2)</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a><span class="sd">            Coordinates of branching points that connect to tips in the skeleton structure.</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="sd">        edge_lengths : ndarray of float, shape (M,)</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">            Lengths of edges connecting non-tip vertices to identified tip locations.</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">        edge_pix_coord : list of array of int</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">            Pixel coordinates for each edge path between connected skeleton elements.</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="n">_find_closest_vertices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">,</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>                                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">,</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>                                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_tipped_edge_smaller_than_branch_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove very short edges from the skeleton.</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">        This method focuses on edges connecting tips. When too short, they are considered are noise and</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">        removed from the skeleton and distances matrices. These edges are considered too short when their length is</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">        smaller than the width of the nearest network branch (an information included in pad_distances).</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><span class="sd">        This method also updates internal data structures (skeleton, edge coordinates, vertex/tip positions)</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">        accordingly through pixel-wise analysis and connectivity checks.</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>        <span class="c1"># Identify edges that are smaller than the width of the branch it is attached to</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>        <span class="n">tipped_edges_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>        <span class="c1"># connecting_vertices_to_remove = np.zeros(self.vertices_branching_tips.shape[0], dtype=bool)</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>        <span class="n">branches_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>        <span class="n">new_edge_pix_coord</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>        <span class="n">remaining_tipped_edges_nb</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">)):</span> <span class="c1"># i = 3142 #1096 # 974 # 222</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>            <span class="n">Y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>            <span class="n">edge_bool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>            <span class="n">eY</span><span class="p">,</span> <span class="n">eX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="n">edge_bool</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="n">edge_bool</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_distances</span><span class="p">[(</span><span class="n">Y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="p">(</span><span class="n">Y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)])</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>                <span class="n">tipped_edges_to_remove</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>                <span class="c1"># Remove the edge</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">[</span><span class="n">eY</span><span class="p">,</span> <span class="n">eX</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>                <span class="c1"># Remove the tip</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>                <span class="c1"># Remove the coordinates corresponding to that edge</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">,</span> <span class="n">edge_bool</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>                <span class="c1"># check whether the connecting vertex remains a vertex of not</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>                <span class="n">pad_sub_skeleton</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">[(</span><span class="n">Y</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span> <span class="p">(</span><span class="n">Y</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span> <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)],</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>                                          <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>                <span class="n">sub_vertices</span><span class="p">,</span> <span class="n">sub_tips</span> <span class="o">=</span> <span class="n">get_vertices_and_tips_from_skeleton</span><span class="p">(</span><span class="n">pad_sub_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>                <span class="c1"># If the vertex does not connect at least 3 edges anymore, remove its vertex label</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>                <span class="k">if</span> <span class="n">sub_vertices</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>                    <span class="n">vertex_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">X</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>                    <span class="n">branches_to_remove</span><span class="p">[</span><span class="n">vertex_to_remove</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>                <span class="c1"># If that pixel became a tip connected to another vertex remove it from the skeleton</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>                <span class="k">if</span> <span class="n">sub_tips</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>                    <span class="k">if</span> <span class="n">sub_vertices</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">[</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>                        <span class="n">vertex_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">X</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>                        <span class="n">branches_to_remove</span><span class="p">[</span><span class="n">vertex_to_remove</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>                <span class="n">remaining_tipped_edges_nb</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>                <span class="n">new_edge_pix_coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">eY</span><span class="p">,</span> <span class="n">eX</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">remaining_tipped_edges_nb</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">eY</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>        <span class="c1"># Check that excedent connected components are 1 pixel size, if so:</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>        <span class="c1"># It means that they were neighbors to removed tips and not necessary for the skeleton</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>        <span class="n">nb</span><span class="p">,</span> <span class="n">sh</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>        <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Removing small tipped edges split the skeleton&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>            <span class="c1"># for i in range(2, nb):</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>            <span class="c1">#     excedent = sh == i</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>            <span class="c1">#     if (excedent).sum() == 1:</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>            <span class="c1">#         self.pad_skeleton[excedent] = 0</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>        <span class="c1"># Remove in distances the pixels removed in skeleton:</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_distances</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>        <span class="c1"># update edge_pix_coord</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_edge_pix_coord</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">new_edge_pix_coord</span><span class="p">)</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>        <span class="c1"># # Remove tips connected to very small edges</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>        <span class="c1"># self.tips_coord = np.delete(self.tips_coord, tipped_edges_to_remove, 0)</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>        <span class="c1"># # Add corresponding edge names</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>        <span class="c1"># self.tips_coord = np.hstack((self.tips_coord, np.arange(1, len(self.tips_coord) + 1)[:, None]))</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>        <span class="c1"># # Within all branching (non-tip) vertices, keep those that did not lose their vertex status because of the edge removal</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>        <span class="c1"># self.non_tip_vertices = np.delete(self.non_tip_vertices, branches_to_remove, 0)</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>        <span class="c1"># # Get the branching vertices who kept their typped edge</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>        <span class="c1"># self.vertices_branching_tips = np.delete(self.vertices_branching_tips, tipped_edges_to_remove, 0)</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>        <span class="c1"># Within all branching (non-tip) vertices, keep those that do not connect a tipped edge.</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>        <span class="c1"># v_branching_tips_in_branching_v = find_common_coord(self.non_tip_vertices, self.vertices_branching_tips[:, :2])</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>        <span class="c1"># self.remaining_vertices = np.delete(self.non_tip_vertices, v_branching_tips_in_branching_v, 0)</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>        <span class="c1"># ordered_v_coord = np.vstack((self.tips_coord[:, :2], self.vertices_branching_tips[:, :2], self.remaining_vertices))</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>        <span class="c1"># tips = self.tips_coord</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>        <span class="c1"># branching_any_edge = self.non_tip_vertices</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>        <span class="c1"># branching_typped_edges = self.vertices_branching_tips</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>        <span class="c1"># branching_no_typped_edges = self.remaining_vertices</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_and_tips_coord</span><span class="p">()</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_tipped_edges</span><span class="p">()</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">label_tipped_edges_and_their_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Label edges connecting tip vertices to branching vertices and assign unique labels to all relevant vertices.</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a><span class="sd">        Processes vertex coordinates by stacking tips, vertices branching from tips, and remaining non-tip vertices.</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a><span class="sd">        Assigns unique sequential identifiers to these vertices in a new array. Constructs an array of edge-label information,</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="sd">        where each row contains the edge label (starting at 1), corresponding tip label, and connected vertex label.</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">        Attributes</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="sd">        tip_number : int</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a><span class="sd">            The number of tip coordinates available in `tips_coord`.</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a><span class="sd">        ordered_v_coord : ndarray of float</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">            Stack of unique vertex coordinates ordered by: tips first, vertices branching tips second, non-tip vertices third.</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a><span class="sd">        numbered_vertices : ndarray of uint32</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">            2D array where each coordinate position is labeled with a sequential integer (starting at 1) based on the order in `ordered_v_coord`.</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a><span class="sd">        edges_labels : ndarray of uint32</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a><span class="sd">            Array of shape (n_edges, 3). Each row contains:</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a><span class="sd">            - Edge label (sequential from 1 to n_edges)</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a><span class="sd">            - Label of the tip vertex for that edge.</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a><span class="sd">            - Label of the vertex branching the tip.</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a><span class="sd">        vertices_branching_tips : ndarray of float</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a><span class="sd">            Unique coordinates of vertices directly connected to tips after removing duplicates.</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tip_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>        <span class="c1"># Stack vertex coordinates in that order: 1. Tips, 2. Vertices branching tips, 3. All remaining vertices</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>        <span class="n">ordered_v_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">))</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>        <span class="n">ordered_v_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ordered_v_coord</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>        <span class="c1"># Create arrays to store edges and vertices labels</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">[</span><span class="n">ordered_v_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ordered_v_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ordered_v_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ordered_v_coord</span><span class="p">):</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index_map</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>        <span class="c1"># Name edges from 1 to the number of edges connecting tips and set the vertices labels from all tips to their connected vertices:</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_number</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>        <span class="c1"># edge label:</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_number</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>        <span class="c1"># tip label:</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>        <span class="c1"># vertex branching tip label:</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>        <span class="c1"># Remove duplicates in vertices_branching_tips</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_vertex_existence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>            <span class="n">loop_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>            <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>            <span class="n">end</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>            <span class="n">vertex_coord</span> <span class="o">=</span> <span class="n">loop_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">loop_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">[</span><span class="n">vertex_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertex_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index_map</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertex_coord</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertex_coord</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>            <span class="n">new_edge_lengths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loop_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>            <span class="n">new_edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(((</span><span class="n">loop_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">loop_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">new_edge_lengths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)))))</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge_data</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="p">)</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">label_edges_connected_with_vertex_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a><span class="sd">        Identify edges connected to touching vertices by processing vertex clusters.</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a><span class="sd">        This function processes the skeleton to identify edges connecting vertices</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a><span class="sd">        that are part of touching clusters. It creates a cropped version of the skeleton</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a><span class="sd">        by removing already detected edges and their tips, then iterates through vertex</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a><span class="sd">        clusters to explore and identify nearby edges.</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>        <span class="c1"># I.1. Identify edges connected to touching vertices:</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>        <span class="c1"># First, create another version of these arrays, where we remove every already detected edge and their tips</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>        <span class="n">cropped_skeleton</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>        <span class="n">cropped_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>        <span class="n">cropped_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>        <span class="c1"># non_tip_vertices does not need to be updated yet, because it only contains verified branching vertices</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>        <span class="n">cropped_non_tip_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>        <span class="c1"># The problem with vertex_to_vertex_connexion is that since they are not separated by zeros,</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>        <span class="c1"># they always atract each other instead of exploring other paths.</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>        <span class="c1"># To fix this, we loop over each vertex group to</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>        <span class="c1"># 1. Add one edge per inter-vertex connexion inside the group</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>        <span class="c1"># 2. Remove all except one, and loop as many time as necessary.</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>        <span class="c1"># Inside that second loop, we explore and identify every edge nearby.</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>        <span class="c1"># Find every vertex_to_vertex_connexion</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>        <span class="n">v_cluster_nb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_lab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_stats</span><span class="p">,</span> <span class="n">vgc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>        <span class="k">if</span> <span class="n">v_cluster_nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>            <span class="n">max_v_nb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">4</span><span class="p">])</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>            <span class="n">cropped_skeleton_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>            <span class="n">starting_vertices_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>            <span class="k">for</span> <span class="n">v_nb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_v_nb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>                <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">v_nb</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>                <span class="n">coord_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>                <span class="k">for</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>  <span class="c1"># lab=labels[0]</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>                    <span class="n">coord_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_lab</span> <span class="o">==</span> <span class="n">lab</span><span class="p">))</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>                <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v_nb</span><span class="p">):</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>                    <span class="k">for</span> <span class="n">lab_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> <span class="c1"># lab=labels[0]</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>                        <span class="n">cs</span> <span class="o">=</span> <span class="n">cropped_skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>                        <span class="n">sv</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>                        <span class="n">v_c</span> <span class="o">=</span> <span class="n">coord_list</span><span class="p">[</span><span class="n">lab_</span><span class="p">]</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>                        <span class="c1"># Save the current coordinate in the starting vertices array of this iteration</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>                        <span class="n">sv</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">v_c</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">iter</span><span class="p">],</span> <span class="n">v_c</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="nb">iter</span><span class="p">]])</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>                        <span class="c1"># Remove one vertex coordinate to keep it from cs</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                        <span class="n">v_y</span><span class="p">,</span> <span class="n">v_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">v_c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">iter</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">v_c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">iter</span><span class="p">)</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                        <span class="n">cs</span><span class="p">[</span><span class="n">v_y</span><span class="p">,</span> <span class="n">v_x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>                        <span class="n">cropped_skeleton_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>                        <span class="n">starting_vertices_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sv</span><span class="p">))</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>            <span class="k">for</span> <span class="n">cropped_skeleton</span><span class="p">,</span> <span class="n">starting_vertices</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cropped_skeleton_list</span><span class="p">,</span> <span class="n">starting_vertices_list</span><span class="p">):</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>                <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_edges_connecting_a_vertex_list</span><span class="p">(</span><span class="n">cropped_skeleton</span><span class="p">,</span> <span class="n">cropped_non_tip_vertices</span><span class="p">,</span> <span class="n">starting_vertices</span><span class="p">)</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">label_edges_connecting_vertex_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a><span class="sd">        Label edges connecting vertex clusters.</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a><span class="sd">        This method identifies the connections between connected vertices within</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a><span class="sd">        vertex clusters and labels these edges. It uses the previously found connected</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a><span class="sd">        vertices, creates an image of the connections, and then identifies</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a><span class="sd">        and labels the edges between these touching vertices.</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>        <span class="c1"># I.2. Identify the connexions between connected vertices:</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>        <span class="n">all_connected_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>        <span class="n">all_con_v_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>        <span class="k">for</span> <span class="n">v_group</span> <span class="ow">in</span> <span class="n">all_connected_vertices</span><span class="p">:</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>            <span class="n">all_con_v_im</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_lab</span> <span class="o">==</span> <span class="n">v_group</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>        <span class="n">cropped_skeleton</span> <span class="o">=</span> <span class="n">all_con_v_im</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cropped_skeleton</span><span class="p">)))</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_edges_connecting_a_vertex_list</span><span class="p">(</span><span class="n">cropped_skeleton</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span><span class="p">)</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>        <span class="c1"># self.edges_labels</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_stats</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_lab</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">label_edges_from_known_vertices_iteratively</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a><span class="sd">        Label edges iteratively from known vertices.</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a><span class="sd">        This method labels edges in an iterative process starting from</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a><span class="sd">        known vertices. It handles the removal of detected edges and</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a><span class="sd">        updates the skeleton accordingly, to avoid detecting edges twice.</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>        <span class="c1"># II/ Identify all remaining edges</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>            <span class="n">starting_vertices_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">))</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>            <span class="n">starting_vertices_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">starting_vertices_coord</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>            <span class="c1"># We start from the vertices connecting tips</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>            <span class="n">starting_vertices_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>        <span class="c1"># Remove the detected edges from cropped_skeleton:</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>        <span class="n">cropped_skeleton</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>        <span class="n">cropped_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>        <span class="n">cropped_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>        <span class="n">cropped_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>        <span class="c1"># Reinitialize cropped_non_tip_vertices to browse all vertices except tips and groups</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>        <span class="n">cropped_non_tip_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>        <span class="n">cropped_non_tip_vertices</span> <span class="o">=</span> <span class="n">remove_coordinates</span><span class="p">(</span><span class="n">cropped_non_tip_vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span><span class="p">)</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>        <span class="n">remaining_v</span> <span class="o">=</span> <span class="n">cropped_non_tip_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>        <span class="k">while</span> <span class="n">remaining_v</span> <span class="o">&gt;</span> <span class="n">cropped_non_tip_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>            <span class="n">remaining_v</span> <span class="o">=</span> <span class="n">cropped_non_tip_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>            <span class="n">cropped_skeleton</span><span class="p">,</span> <span class="n">cropped_non_tip_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_edges_connecting_a_vertex_list</span><span class="p">(</span><span class="n">cropped_skeleton</span><span class="p">,</span> <span class="n">cropped_non_tip_vertices</span><span class="p">,</span> <span class="n">starting_vertices_coord</span><span class="p">)</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>                <span class="n">starting_vertices_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">label_edges_looping_on_1_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a><span class="sd">        Identify and handle edges that form loops around a single vertex.</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a><span class="sd">        This method processes the skeleton image to find looping edges and updates</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a><span class="sd">        the edge data structure accordingly.</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identified</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">)</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>        <span class="n">unidentified</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>        <span class="c1"># Find out the remaining non-identified pixels</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>        <span class="n">nb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">,</span> <span class="n">ce</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="n">unidentified</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>        <span class="c1"># Handle the cases where edges are loops over only one vertex</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>        <span class="n">looping_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[:,</span> <span class="mi">4</span> <span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>        <span class="k">for</span> <span class="n">loop_i</span> <span class="ow">in</span> <span class="n">looping_edges</span><span class="p">:</span> <span class="c1"># loop_i = looping_edges[0] loop_i=11 #  zoom_on_nonzero(unique_vertices_im, return_coord=False)</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>            <span class="n">edge_i</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unidentified_shapes</span> <span class="o">==</span> <span class="n">loop_i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>            <span class="n">dil_edge_i</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">edge_i</span><span class="p">,</span> <span class="n">square_33</span><span class="p">)</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>            <span class="n">unique_vertices_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>            <span class="n">unique_vertices_im</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>            <span class="n">unique_vertices_im</span> <span class="o">=</span> <span class="n">dil_edge_i</span> <span class="o">*</span> <span class="n">unique_vertices_im</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>            <span class="n">unique_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">unique_vertices_im</span><span class="p">)</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>            <span class="n">unique_vertices</span> <span class="o">=</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="n">unique_vertices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>            <span class="n">v_nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_vertices</span><span class="p">)</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>            <span class="n">new_edge_lengths</span> <span class="o">=</span> <span class="n">edge_i</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>            <span class="n">new_edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">edge_i</span><span class="p">))))</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>            <span class="n">new_edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">new_edge_pix_coord</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">]))</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>            <span class="k">if</span> <span class="n">v_nb</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge_data</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="p">)</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>            <span class="k">elif</span> <span class="n">v_nb</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>                <span class="c1"># The edge loops around a group of connected vertices</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge_data</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="p">)</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>                <span class="c1"># conn_v_nb, conn_v = cv2.connectedComponents((unique_vertices_im &gt; 0).astype(np.uint8))</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>                <span class="c1"># if len(unique_vertices) == 2 and conn_v_nb == 2:</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>            <span class="k">elif</span> <span class="n">v_nb</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># The question is: How to choose two vertices so that they link all missing pixels?</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>                <span class="c1"># 1. Find every edge pixel connected to these vertices</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>                <span class="n">vertex_connected_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">((</span><span class="n">unique_vertices_im</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">square_33</span><span class="p">)</span> <span class="o">*</span> <span class="n">edge_i</span><span class="p">)</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>                <span class="c1"># 2. Find the most distant pair of these</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>                <span class="n">pix1</span><span class="p">,</span> <span class="n">pix2</span> <span class="o">=</span> <span class="n">get_min_or_max_euclidean_pair</span><span class="p">(</span><span class="n">vertex_connected_pixels</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>                <span class="c1"># 3. The two best vertices are the two nearest to these two most distant edge pixels</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>                <span class="n">dist_to_pix1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">v_nb</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>                <span class="n">dist_to_pix2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">v_nb</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>                <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">v_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_vertices</span><span class="p">):</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>                    <span class="n">v_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index_map</span><span class="p">[</span><span class="n">v_i</span><span class="p">]</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>                    <span class="n">dist_to_pix1</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">eudist</span><span class="p">(</span><span class="n">pix1</span><span class="p">,</span> <span class="n">v_coord</span><span class="p">)</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>                    <span class="n">dist_to_pix2</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">eudist</span><span class="p">(</span><span class="n">pix2</span><span class="p">,</span> <span class="n">v_coord</span><span class="p">)</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dist_to_pix1</span><span class="p">)],</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dist_to_pix2</span><span class="p">)]</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge_data</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="p">)</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="si">}</span><span class="s2">, One long edge is not identified: i=</span><span class="si">{</span><span class="n">loop_i</span><span class="si">}</span><span class="s2"> of length=</span><span class="si">{</span><span class="n">edge_i</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> close to </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_vertices</span><span class="p">)</span><span class="si">}</span><span class="s2"> vertices.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear_areas_of_1_or_2_unidentified_pixels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes 1 or 2 pixel size non-identified areas from the skeleton.</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a><span class="sd">        This function checks whether small non-identified areas (1 or 2 pixels)</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a><span class="sd">        can be removed without breaking the skeleton structure. It performs</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a><span class="sd">        a series of operations to ensure only safe removals are made, logging</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a><span class="sd">        errors if the final skeleton is not fully connected or if some unidentified pixels remain.</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>        <span class="c1"># Check whether the 1 or 2 pixel size non-identified areas can be removed without breaking the skel</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>        <span class="n">one_pix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[:,</span> <span class="mi">4</span> <span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># == 1)[0]</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>        <span class="n">cutting_removal</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>        <span class="k">for</span> <span class="n">pix_i</span> <span class="ow">in</span> <span class="n">one_pix</span><span class="p">:</span> <span class="c1">#pix_i=one_pix[0]</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>            <span class="n">skel_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>            <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>            <span class="n">skel_copy</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">unidentified_shapes</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">]</span> <span class="o">==</span> <span class="n">pix_i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>            <span class="n">nb1</span><span class="p">,</span> <span class="n">sh1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponents</span><span class="p">(</span><span class="n">skel_copy</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>            <span class="k">if</span> <span class="n">nb1</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>                <span class="n">cutting_removal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pix_i</span><span class="p">)</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">unidentified_shapes</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">]</span> <span class="o">==</span> <span class="n">pix_i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cutting_removal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="si">}</span><span class="s2">, These pixels break the skeleton when removed: </span><span class="si">{</span><span class="n">cutting_removal</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identified</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="si">}</span><span class="s2">, Proportion of identified pixels in the skeleton: </span><span class="si">{</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_distances</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_shapes</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_identify_edges_connecting_a_vertex_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cropped_skeleton</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">cropped_non_tip_vertices</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">starting_vertices_coord</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify edges connecting a list of vertices within a cropped skeleton.</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a><span class="sd">        This function iteratively connects the closest vertices from starting_vertices_coord to their nearest neighbors,</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a><span class="sd">        updating the skeleton and removing already connected vertices until no new connections can be made or</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a><span class="sd">        a maximum number of connections is reached.</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">        cropped_skeleton : ndarray of uint8</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a><span class="sd">            A binary skeleton image where skeletal pixels are marked as 1.</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a><span class="sd">        cropped_non_tip_vertices : ndarray of int</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a><span class="sd">            Coordinates of non-tip vertices in the cropped skeleton.</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a><span class="sd">        starting_vertices_coord : ndarray of int</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a><span class="sd">            Coordinates of vertices from which to find connections.</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a><span class="sd">        cropped_skeleton : ndarray of uint8</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a><span class="sd">            Updated skeleton with edges marked as 0.</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a><span class="sd">        cropped_non_tip_vertices : ndarray of int</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a><span class="sd">            Updated list of non-tip vertices after removing those that have been connected.</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>        <span class="n">explored_connexions_per_vertex</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># the maximal edge number that can connect a vertex</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>        <span class="n">new_connexions</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>        <span class="k">while</span> <span class="n">new_connexions</span> <span class="ow">and</span> <span class="n">explored_connexions_per_vertex</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cropped_non_tip_vertices</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">starting_vertices_coord</span><span class="p">):</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>            <span class="n">explored_connexions_per_vertex</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>            <span class="c1"># 1. Find the ith closest vertex to each focal vertex</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>            <span class="n">ending_vertices_coord</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span> <span class="o">=</span> <span class="n">_find_closest_vertices</span><span class="p">(</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>                <span class="n">cropped_skeleton</span><span class="p">,</span> <span class="n">cropped_non_tip_vertices</span><span class="p">,</span> <span class="n">starting_vertices_coord</span><span class="p">)</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">new_edge_lengths</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">new_edge_lengths</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">new_edge_lengths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>                <span class="n">new_connexions</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>                <span class="c1"># In new_edge_lengths, zeros are duplicates and nan are lone vertices (from starting_vertices_coord)</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>                <span class="c1"># Find out which starting_vertices_coord should be kept and which one should be used to save edges</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>                <span class="n">no_new_connexion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">new_edge_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>                <span class="n">no_found_connexion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">no_new_connexion</span><span class="p">,</span> <span class="n">new_edge_lengths</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>                <span class="n">found_connexion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">no_found_connexion</span><span class="p">)</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>                <span class="c1"># Any vertex_to_vertex_connexions must be analyzed only once. We remove them with the non-connectable vertices</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>                <span class="n">vertex_to_vertex_connexions</span> <span class="o">=</span> <span class="n">new_edge_lengths</span> <span class="o">==</span> <span class="mi">1</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>                <span class="c1"># Save edge data</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>                <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">[</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>                    <span class="n">starting_vertices_coord</span><span class="p">[</span><span class="n">found_connexion</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">starting_vertices_coord</span><span class="p">[</span><span class="n">found_connexion</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>                <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">[</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>                    <span class="n">ending_vertices_coord</span><span class="p">[</span><span class="n">found_connexion</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ending_vertices_coord</span><span class="p">[</span><span class="n">found_connexion</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>                <span class="n">new_edge_lengths</span> <span class="o">=</span> <span class="n">new_edge_lengths</span><span class="p">[</span><span class="n">found_connexion</span><span class="p">]</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge_data</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="p">)</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>                <span class="n">no_new_connexion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">no_new_connexion</span><span class="p">,</span> <span class="n">vertex_to_vertex_connexions</span><span class="p">)</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>                <span class="n">vertices_to_crop</span> <span class="o">=</span> <span class="n">starting_vertices_coord</span><span class="p">[</span><span class="n">no_new_connexion</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>                <span class="c1"># Remove non-connectable and connected_vertices from:</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>                <span class="n">cropped_non_tip_vertices</span> <span class="o">=</span> <span class="n">remove_coordinates</span><span class="p">(</span><span class="n">cropped_non_tip_vertices</span><span class="p">,</span> <span class="n">vertices_to_crop</span><span class="p">)</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>                <span class="n">starting_vertices_coord</span> <span class="o">=</span> <span class="n">remove_coordinates</span><span class="p">(</span><span class="n">starting_vertices_coord</span><span class="p">,</span> <span class="n">vertices_to_crop</span><span class="p">)</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>                <span class="k">if</span> <span class="n">new_edge_pix_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>                    <span class="c1"># Update cropped_skeleton to not identify each edge more than once</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>                    <span class="n">cropped_skeleton</span><span class="p">[</span><span class="n">new_edge_pix_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">new_edge_pix_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>                <span class="c1"># And the starting vertices that cannot connect anymore</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>                <span class="n">cropped_skeleton</span><span class="p">[</span><span class="n">vertices_to_crop</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertices_to_crop</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span> <span class="o">=</span> <span class="n">ending_vertices_coord</span><span class="p">[</span><span class="n">found_connexion</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span><span class="p">,</span> <span class="n">ending_vertices_coord</span><span class="p">[</span><span class="n">found_connexion</span><span class="p">,</span> <span class="p">:]))</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>        <span class="k">return</span> <span class="n">cropped_skeleton</span><span class="p">,</span> <span class="n">cropped_non_tip_vertices</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_edge_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">):</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a><span class="sd">        Update edge data by expanding existing arrays with new edges.</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a><span class="sd">        This method updates the internal edge data structures (lengths,</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a><span class="sd">        labels, and pixel coordinates) by appending new edges.</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a><span class="sd">        start : int or ndarray of int</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a><span class="sd">            The starting vertex label(s) for the new edges.</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a><span class="sd">        end : int or ndarray of int</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a><span class="sd">            The ending vertex label(s) for the new edges.</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a><span class="sd">        new_edge_lengths : ndarray of float</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a><span class="sd">            The lengths of the new edges to be added.</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a><span class="sd">        new_edge_pix_coord : ndarray of float</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a><span class="sd">            The pixel coordinates of the new edges.</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a><span class="sd">        Attributes</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a><span class="sd">        edge_lengths : ndarray of float</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a><span class="sd">            The lengths of all edges.</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a><span class="sd">        edges_labels : ndarray of int</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a><span class="sd">            The labels for each edge (start and end vertices).</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a><span class="sd">        edge_pix_coord : ndarray of float</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a><span class="sd">            The pixel coordinates for all edges.</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">))</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>            <span class="n">end_idx</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>        <span class="n">start_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>        <span class="n">new_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">end_idx</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>        <span class="n">new_edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">start_idx</span> <span class="o">+</span> <span class="n">end_idx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># edge label</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>        <span class="n">new_edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">start</span>  <span class="c1"># starting vertex label</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>        <span class="n">new_edges</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">end</span>  <span class="c1"># ending vertex label</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">,</span> <span class="n">new_edges</span><span class="p">))</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>        <span class="c1"># Add the new edge coord</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>        <span class="k">if</span> <span class="n">new_edge_pix_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>            <span class="c1"># Add the new edge pixel coord</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>            <span class="n">new_edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">start_idx</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="p">))</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear_edge_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a><span class="sd">        Remove duplicate edges by checking vertices and coordinates.</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a><span class="sd">        This method identifies and removes duplicate edges based on their vertex labels</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a><span class="sd">        and pixel coordinates. It scans through the edge attributes, compares them,</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a><span class="sd">        and removes duplicates if they are found.</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>        <span class="n">edges_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>        <span class="n">duplicates</span> <span class="o">=</span> <span class="n">find_duplicates_coord</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>        <span class="n">duplicates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">duplicates</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">duplicates</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:])</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">duplicates</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]:</span> <span class="c1">#v = self.edges_labels[duplicates, 1:][4]</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>            <span class="n">edge_lab1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>            <span class="n">edge_lab2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">v</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>            <span class="n">edge_labs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">edge_lab1</span><span class="p">,</span> <span class="n">edge_lab2</span><span class="p">)))</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>            <span class="k">for</span> <span class="n">edge_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_labs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1">#  edge_i = 0</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>                <span class="n">edge_i_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_labs</span><span class="p">[</span><span class="n">edge_i</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>                <span class="k">for</span> <span class="n">edge_j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">edge_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_labs</span><span class="p">)):</span>  <span class="c1">#  edge_j = 1</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>                    <span class="n">edge_j_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_labs</span><span class="p">[</span><span class="n">edge_j</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">edge_i_coord</span><span class="p">,</span> <span class="n">edge_j_coord</span><span class="p">):</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>                        <span class="n">edges_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_labs</span><span class="p">[</span><span class="n">edge_j</span><span class="p">])</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>        <span class="n">edges_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">edges_to_remove</span><span class="p">)</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges_to_remove</span><span class="p">:</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>            <span class="n">edge_bool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">edge</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">edge_bool</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="n">edge_bool</span><span class="p">]</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear_vertices_connecting_2_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a><span class="sd">        Remove vertices connecting exactly two edges and update edge-related attributes.</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a><span class="sd">        This method identifies vertices that are connected to exactly 2 edges,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a><span class="sd">        renames edges, updates edge lengths and vertex coordinates accordingly.</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a><span class="sd">        It also removes the corresponding vertices from non-tip vertices list.</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>        <span class="n">v_labels</span><span class="p">,</span> <span class="n">v_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>        <span class="n">vertices2</span> <span class="o">=</span> <span class="n">v_labels</span><span class="p">[</span><span class="n">v_counts</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>        <span class="k">for</span> <span class="n">vertex2</span> <span class="ow">in</span> <span class="n">vertices2</span><span class="p">:</span>  <span class="c1"># vertex2 = vertices2[0]</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>            <span class="n">edge_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">vertex2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>            <span class="n">edge_names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>            <span class="n">v_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">:]))</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>            <span class="n">v_names</span> <span class="o">=</span> <span class="n">v_names</span><span class="p">[</span><span class="n">v_names</span> <span class="o">!=</span> <span class="n">vertex2</span><span class="p">]</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Otherwise it&#39;s a vertex between a normal edge and a loop</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>                <span class="n">kept_edge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>                <span class="c1"># Rename the removed edge by the kept edge name in pix_coord:</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_names</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kept_edge</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_names</span><span class="p">[</span><span class="n">kept_edge</span><span class="p">]</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>                <span class="c1"># Add the removed edge length to the kept edge length (minus 2, corresponding to the removed vertex)</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_names</span><span class="p">[</span><span class="n">kept_edge</span><span class="p">]]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_names</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kept_edge</span><span class="p">]]</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>                <span class="c1"># Remove the corresponding edge length from the list</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">edge_names</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kept_edge</span><span class="p">]]</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>                <span class="c1"># Rename the vertex of the kept edge in edges_labels</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_names</span><span class="p">[</span><span class="n">kept_edge</span><span class="p">],</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">v_names</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kept_edge</span><span class="p">],</span> <span class="n">v_names</span><span class="p">[</span><span class="n">kept_edge</span><span class="p">]</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>                <span class="c1"># Remove the removed edge from the edges_labels array</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">edge_names</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kept_edge</span><span class="p">],</span> <span class="p">:]</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>                <span class="c1"># vY, vX = np.nonzero(self.numbered_vertices == vertex2)</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>                <span class="c1"># v_idx = np.nonzero(np.all(self.non_tip_vertices == [vY[0], vX[0]], axis=1))</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>                <span class="n">vY</span><span class="p">,</span> <span class="n">vX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index_map</span><span class="p">[</span><span class="n">vertex2</span><span class="p">]</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>                <span class="n">v_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span> <span class="o">==</span> <span class="p">[</span><span class="n">vY</span><span class="p">,</span> <span class="n">vX</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">,</span> <span class="n">v_idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>        <span class="c1"># Sometimes, clearing vertices connecting 2 edges can create edge duplicates, so:</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clear_edge_duplicates</span><span class="p">()</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_remove_padding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a><span class="sd">        Removes padding from various coordinate arrays.</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a><span class="sd">        This method adjusts the coordinates of edge pixels, tips,</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a><span class="sd">        and non-tip vertices by subtracting 1 from their x and y values.</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a><span class="sd">        It also removes padding from the skeleton, distances, and vertices</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a><span class="sd">        using the `remove_padding` function.</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index_map</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">remove_padding</span><span class="p">(</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_distances</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">])</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_vertex_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin_contours</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">growing_areas</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a><span class="sd">        Generate a table for the vertices.</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a><span class="sd">        This method constructs and returns a 2D NumPy array holding information</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a><span class="sd">        about all vertices. Each row corresponds to one vertex identified either</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a><span class="sd">        by its coordinates in `self.tips_coord` or `self.non_tip_vertices`. The</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a><span class="sd">        array includes additional information about each vertex, including whether</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a><span class="sd">        they are food vertices, growing areas, and connected components.</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a><span class="sd">        origin_contours : ndarray of uint8, optional</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a><span class="sd">            Binary map to identify food vertices. Default is `None`.</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a><span class="sd">        growing_areas : ndarray, optional</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a><span class="sd">            Binary map to identify growing regions. Default is `None`.</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a><span class="sd">            The method updates the instance attribute `self.vertex_table` with</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a><span class="sd">            the generated vertex information.</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_padding</span><span class="p">()</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>        <span class="k">if</span> <span class="n">origin_contours</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>            <span class="n">food_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">origin_contours</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>            <span class="n">food_vertices</span> <span class="o">=</span> <span class="n">food_vertices</span><span class="p">[</span><span class="n">food_vertices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">food_vertices</span><span class="p">),</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>        <span class="k">if</span> <span class="n">growing_areas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">growing_areas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>            <span class="c1"># growing = np.unique(self.vertices * growing_areas)[1:]</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>            <span class="n">growing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">growing_areas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">growing_areas</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>            <span class="n">growing</span> <span class="o">=</span> <span class="n">growing</span><span class="p">[</span><span class="n">growing</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">growing</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>                <span class="n">growing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">growing</span><span class="p">)</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="n">growing</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>        <span class="n">nb</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">cent</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]):</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>            <span class="n">v_labs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">sh</span> <span class="o">==</span> <span class="n">v_i</span><span class="p">]</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>            <span class="k">for</span> <span class="n">v_lab</span> <span class="ow">in</span> <span class="n">v_labs</span><span class="p">:</span> <span class="c1"># v_lab = v_labs[0]</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">v_lab</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_edge_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">greyscale</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">compute_BC</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a><span class="sd">        Generate edge table with length and average intensity information.</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a><span class="sd">        This method processes the vertex coordinates, calculates lengths</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a><span class="sd">        between vertices for each edge, and computes average width and intensity</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a><span class="sd">        along the edges. Additionally, it computes edge betweenness centrality</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a><span class="sd">        for each vertex pair.</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a><span class="sd">        greyscale : ndarray of uint8</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a><span class="sd">            Grayscale image.</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_padding</span><span class="p">()</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">7</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span> <span class="c1"># edge_id, vertex1, vertex2, length, average_width, int, BC</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="p">:]</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">edge_lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>            <span class="n">edge_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>            <span class="n">pix_widths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">edge_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">edge_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>            <span class="n">v_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">,</span> <span class="mi">1</span><span class="p">:][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>            <span class="n">v1_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">v_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="c1">#</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>            <span class="n">v2_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">v_id</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="c1">#</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>            <span class="n">v1_width</span><span class="p">,</span> <span class="n">v2_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">v1_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v1_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">v2_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v2_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v1_width</span><span class="p">):</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>                <span class="n">pix_widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pix_widths</span><span class="p">,</span> <span class="n">v1_width</span><span class="p">)</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v2_width</span><span class="p">):</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>                <span class="n">pix_widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pix_widths</span><span class="p">,</span> <span class="n">v2_width</span><span class="p">)</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>            <span class="k">if</span> <span class="n">pix_widths</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">pix_widths</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>            <span class="n">pix_ints</span> <span class="o">=</span> <span class="n">greyscale</span><span class="p">[</span><span class="n">edge_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">edge_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>            <span class="n">v1_int</span><span class="p">,</span> <span class="n">v2_int</span> <span class="o">=</span> <span class="n">greyscale</span><span class="p">[</span><span class="n">v1_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v1_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">greyscale</span><span class="p">[</span><span class="n">v2_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v2_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>            <span class="n">pix_ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pix_ints</span><span class="p">,</span> <span class="p">(</span><span class="n">v1_int</span><span class="p">,</span> <span class="n">v2_int</span><span class="p">))</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">pix_ints</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>        <span class="k">if</span> <span class="n">compute_BC</span><span class="p">:</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>            <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_edgelist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:])</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>            <span class="n">e_BC</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">edge_betweenness_centrality</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">BC_net</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">)</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>            <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">e_BC</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="c1"># v=(81, 80)</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>                <span class="n">v1_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>                <span class="n">v2_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>                <span class="n">full_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">v1_coord</span><span class="p">,</span> <span class="n">v2_coord</span><span class="p">))</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>                <span class="n">edge_lab1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">v</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>                <span class="n">edge_lab2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>                <span class="n">edge_lab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">edge_lab1</span><span class="p">,</span> <span class="n">edge_lab2</span><span class="p">)))</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_lab</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>                    <span class="n">edge_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>                    <span class="n">full_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">full_coord</span><span class="p">,</span> <span class="n">edge_coord</span><span class="p">))</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">BC_net</span><span class="p">[</span><span class="n">full_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">full_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">k</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_lab</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>                    <span class="n">edge_coord0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>                    <span class="k">for</span> <span class="n">edge_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge_lab</span><span class="p">)):</span> <span class="c1">#  edge_i=1</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>                        <span class="n">edge_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">[</span><span class="n">edge_i</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">[</span><span class="n">edge_i</span><span class="p">],</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>                        <span class="n">full_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">full_coord</span><span class="p">,</span> <span class="n">edge_coord</span><span class="p">))</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">BC_net</span><span class="p">[</span><span class="n">full_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">full_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">k</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>                        <span class="k">if</span> <span class="n">edge_i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">edge_coord0</span><span class="p">,</span> <span class="n">edge_coord</span><span class="p">):</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>                            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There still is two identical edges: </span><span class="si">{</span><span class="n">edge_lab</span><span class="si">}</span><span class="s2"> of len: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">edge_coord</span><span class="p">)</span><span class="si">}</span><span class="s2"> linking vertices </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>                            <span class="k">break</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">pad_distances</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the class with skeleton and distance arrays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pad_skeleton</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array representing the skeleton to pad.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pad_distances</code>
            </td>
            <td>
                  <code>ndarray of float64</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array representing distances corresponding to the skeleton.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.__init__.remaining_vertices">remaining_vertices</span></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Remaining vertices. Initialized as <code>None</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.__init__.vertices">vertices</span></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertices. Initialized as <code>None</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.__init__.growing_vertices">growing_vertices</span></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Growing vertices. Initialized as <code>None</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.__init__.im_shape">im_shape</span></code></td>
            <td>
                  <code>tuple of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape of the skeleton array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad_skeleton</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">pad_distances</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a><span class="sd">    Initialize the class with skeleton and distance arrays.</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a><span class="sd">    pad_skeleton : ndarray of uint8</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a><span class="sd">        Array representing the skeleton to pad.</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a><span class="sd">    pad_distances : ndarray of float64</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="sd">        Array representing distances corresponding to the skeleton.</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="sd">    remaining_vertices : None</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">        Remaining vertices. Initialized as `None`.</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="sd">    vertices : None</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">        Vertices. Initialized as `None`.</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="sd">    growing_vertices : None</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><span class="sd">        Growing vertices. Initialized as `None`.</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">    im_shape : tuple of ints</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">        Shape of the skeleton array.</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span> <span class="o">=</span> <span class="n">pad_skeleton</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pad_distances</span> <span class="o">=</span> <span class="n">pad_distances</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">remaining_vertices</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">growing_vertices</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">im_shape</span> <span class="o">=</span> <span class="n">pad_skeleton</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.clear_areas_of_1_or_2_unidentified_pixels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_areas_of_1_or_2_unidentified_pixels</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Removes 1 or 2 pixel size non-identified areas from the skeleton.</p>
<p>This function checks whether small non-identified areas (1 or 2 pixels)
can be removed without breaking the skeleton structure. It performs
a series of operations to ensure only safe removals are made, logging
errors if the final skeleton is not fully connected or if some unidentified pixels remain.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1443" name="__codelineno-0-1443"></a><span class="k">def</span><span class="w"> </span><span class="nf">clear_areas_of_1_or_2_unidentified_pixels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes 1 or 2 pixel size non-identified areas from the skeleton.</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a><span class="sd">    This function checks whether small non-identified areas (1 or 2 pixels)</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a><span class="sd">    can be removed without breaking the skeleton structure. It performs</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a><span class="sd">    a series of operations to ensure only safe removals are made, logging</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a><span class="sd">    errors if the final skeleton is not fully connected or if some unidentified pixels remain.</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>    <span class="c1"># Check whether the 1 or 2 pixel size non-identified areas can be removed without breaking the skel</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>    <span class="n">one_pix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[:,</span> <span class="mi">4</span> <span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># == 1)[0]</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>    <span class="n">cutting_removal</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>    <span class="k">for</span> <span class="n">pix_i</span> <span class="ow">in</span> <span class="n">one_pix</span><span class="p">:</span> <span class="c1">#pix_i=one_pix[0]</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>        <span class="n">skel_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>        <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[</span><span class="n">pix_i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>        <span class="n">skel_copy</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">unidentified_shapes</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">]</span> <span class="o">==</span> <span class="n">pix_i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>        <span class="n">nb1</span><span class="p">,</span> <span class="n">sh1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponents</span><span class="p">(</span><span class="n">skel_copy</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>        <span class="k">if</span> <span class="n">nb1</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>            <span class="n">cutting_removal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pix_i</span><span class="p">)</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">unidentified_shapes</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">]</span> <span class="o">==</span> <span class="n">pix_i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cutting_removal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="si">}</span><span class="s2">, These pixels break the skeleton when removed: </span><span class="si">{</span><span class="n">cutting_removal</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identified</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="si">}</span><span class="s2">, Proportion of identified pixels in the skeleton: </span><span class="si">{</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pad_distances</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_shapes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.clear_edge_duplicates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_edge_duplicates</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Remove duplicate edges by checking vertices and coordinates.</p>
<p>This method identifies and removes duplicate edges based on their vertex labels
and pixel coordinates. It scans through the edge attributes, compares them,
and removes duplicates if they are found.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1589" name="__codelineno-0-1589"></a><span class="k">def</span><span class="w"> </span><span class="nf">clear_edge_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a><span class="sd">    Remove duplicate edges by checking vertices and coordinates.</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a><span class="sd">    This method identifies and removes duplicate edges based on their vertex labels</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a><span class="sd">    and pixel coordinates. It scans through the edge attributes, compares them,</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a><span class="sd">    and removes duplicates if they are found.</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>    <span class="n">edges_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>    <span class="n">duplicates</span> <span class="o">=</span> <span class="n">find_duplicates_coord</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>    <span class="n">duplicates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">duplicates</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">duplicates</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:])</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">duplicates</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]:</span> <span class="c1">#v = self.edges_labels[duplicates, 1:][4]</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>        <span class="n">edge_lab1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>        <span class="n">edge_lab2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">v</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>        <span class="n">edge_labs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">edge_lab1</span><span class="p">,</span> <span class="n">edge_lab2</span><span class="p">)))</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>        <span class="k">for</span> <span class="n">edge_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_labs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1">#  edge_i = 0</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>            <span class="n">edge_i_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_labs</span><span class="p">[</span><span class="n">edge_i</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>            <span class="k">for</span> <span class="n">edge_j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">edge_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_labs</span><span class="p">)):</span>  <span class="c1">#  edge_j = 1</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>                <span class="n">edge_j_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_labs</span><span class="p">[</span><span class="n">edge_j</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">edge_i_coord</span><span class="p">,</span> <span class="n">edge_j_coord</span><span class="p">):</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>                    <span class="n">edges_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_labs</span><span class="p">[</span><span class="n">edge_j</span><span class="p">])</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>    <span class="n">edges_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">edges_to_remove</span><span class="p">)</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges_to_remove</span><span class="p">:</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>        <span class="n">edge_bool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">edge</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">edge_bool</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="n">edge_bool</span><span class="p">]</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">,</span> <span class="p">:]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.clear_vertices_connecting_2_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_vertices_connecting_2_edges</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Remove vertices connecting exactly two edges and update edge-related attributes.</p>
<p>This method identifies vertices that are connected to exactly 2 edges,
renames edges, updates edge lengths and vertex coordinates accordingly.
It also removes the corresponding vertices from non-tip vertices list.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1618" name="__codelineno-0-1618"></a><span class="k">def</span><span class="w"> </span><span class="nf">clear_vertices_connecting_2_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a><span class="sd">    Remove vertices connecting exactly two edges and update edge-related attributes.</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a><span class="sd">    This method identifies vertices that are connected to exactly 2 edges,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a><span class="sd">    renames edges, updates edge lengths and vertex coordinates accordingly.</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a><span class="sd">    It also removes the corresponding vertices from non-tip vertices list.</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>    <span class="n">v_labels</span><span class="p">,</span> <span class="n">v_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>    <span class="n">vertices2</span> <span class="o">=</span> <span class="n">v_labels</span><span class="p">[</span><span class="n">v_counts</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>    <span class="k">for</span> <span class="n">vertex2</span> <span class="ow">in</span> <span class="n">vertices2</span><span class="p">:</span>  <span class="c1"># vertex2 = vertices2[0]</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>        <span class="n">edge_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">vertex2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>        <span class="n">edge_names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>        <span class="n">v_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">:]))</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>        <span class="n">v_names</span> <span class="o">=</span> <span class="n">v_names</span><span class="p">[</span><span class="n">v_names</span> <span class="o">!=</span> <span class="n">vertex2</span><span class="p">]</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Otherwise it&#39;s a vertex between a normal edge and a loop</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>            <span class="n">kept_edge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>            <span class="c1"># Rename the removed edge by the kept edge name in pix_coord:</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_names</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kept_edge</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_names</span><span class="p">[</span><span class="n">kept_edge</span><span class="p">]</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>            <span class="c1"># Add the removed edge length to the kept edge length (minus 2, corresponding to the removed vertex)</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_names</span><span class="p">[</span><span class="n">kept_edge</span><span class="p">]]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_names</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kept_edge</span><span class="p">]]</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>            <span class="c1"># Remove the corresponding edge length from the list</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">edge_names</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kept_edge</span><span class="p">]]</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>            <span class="c1"># Rename the vertex of the kept edge in edges_labels</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_names</span><span class="p">[</span><span class="n">kept_edge</span><span class="p">],</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">v_names</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kept_edge</span><span class="p">],</span> <span class="n">v_names</span><span class="p">[</span><span class="n">kept_edge</span><span class="p">]</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>            <span class="c1"># Remove the removed edge from the edges_labels array</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">edge_names</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kept_edge</span><span class="p">],</span> <span class="p">:]</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>            <span class="c1"># vY, vX = np.nonzero(self.numbered_vertices == vertex2)</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>            <span class="c1"># v_idx = np.nonzero(np.all(self.non_tip_vertices == [vY[0], vX[0]], axis=1))</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>            <span class="n">vY</span><span class="p">,</span> <span class="n">vX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index_map</span><span class="p">[</span><span class="n">vertex2</span><span class="p">]</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>            <span class="n">v_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span> <span class="o">==</span> <span class="p">[</span><span class="n">vY</span><span class="p">,</span> <span class="n">vX</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">,</span> <span class="n">v_idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>    <span class="c1"># Sometimes, clearing vertices connecting 2 edges can create edge duplicates, so:</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">clear_edge_duplicates</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.get_tipped_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_tipped_edges</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get_tipped_edges : method to extract skeleton edges connecting branching points and tips.</p>
<p>Makes sure that there is only one connected component constituting the skeleton of the network and
identifies all edges that are connected to a tip.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.get_tipped_edges.pad_skeleton">pad_skeleton</span></code></td>
            <td>
                  <code>ndarray of bool, modified</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean mask representing the pruned skeleton after isolating the largest connected component.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.get_tipped_edges.vertices_branching_tips">vertices_branching_tips</span></code></td>
            <td>
                  <code>ndarray of int, shape (N, 2)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinates of branching points that connect to tips in the skeleton structure.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.get_tipped_edges.edge_lengths">edge_lengths</span></code></td>
            <td>
                  <code>ndarray of float, shape (M,)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lengths of edges connecting non-tip vertices to identified tip locations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.get_tipped_edges.edge_pix_coord">edge_pix_coord</span></code></td>
            <td>
                  <code>list of array of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pixel coordinates for each edge path between connected skeleton elements.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1103" name="__codelineno-0-1103"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_tipped_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a><span class="sd">    get_tipped_edges : method to extract skeleton edges connecting branching points and tips.</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a><span class="sd">    Makes sure that there is only one connected component constituting the skeleton of the network and</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><span class="sd">    identifies all edges that are connected to a tip.</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a><span class="sd">    pad_skeleton : ndarray of bool, modified</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a><span class="sd">        Boolean mask representing the pruned skeleton after isolating the largest connected component.</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="sd">    vertices_branching_tips : ndarray of int, shape (N, 2)</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a><span class="sd">        Coordinates of branching points that connect to tips in the skeleton structure.</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="sd">    edge_lengths : ndarray of float, shape (M,)</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">        Lengths of edges connecting non-tip vertices to identified tip locations.</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">    edge_pix_coord : list of array of int</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">        Pixel coordinates for each edge path between connected skeleton elements.</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="n">_find_closest_vertices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">,</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>                                                                                    <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">,</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>                                                                                    <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.get_vertices_and_tips_coord" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_vertices_and_tips_coord</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Process skeleton data to extract non-tip vertices and tip coordinates.</p>
<p>This method processes the skeleton stored in <code>self.pad_skeleton</code> by first
extracting all vertices and tips. It then separates these into branch points
(non-tip vertices) and specific tip coordinates using internal processing.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.get_vertices_and_tips_coord.self.non_tip_vertices">self.non_tip_vertices</span></code></td>
            <td>
                  <code><span title="array">array</span> - <span title="like">like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinates of non-tip (branch) vertices.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.get_vertices_and_tips_coord.self.tips_coord">self.tips_coord</span></code></td>
            <td>
                  <code><span title="array">array</span> - <span title="like">like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinates of identified tips in the skeleton.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_vertices_and_tips_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Process skeleton data to extract non-tip vertices and tip coordinates.</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a><span class="sd">    This method processes the skeleton stored in `self.pad_skeleton` by first</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a><span class="sd">    extracting all vertices and tips. It then separates these into branch points</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a><span class="sd">    (non-tip vertices) and specific tip coordinates using internal processing.</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a><span class="sd">    self.non_tip_vertices : array-like</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a><span class="sd">        Coordinates of non-tip (branch) vertices.</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a><span class="sd">    self.tips_coord : array-like</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a><span class="sd">        Coordinates of identified tips in the skeleton.</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>    <span class="n">pad_vertices</span><span class="p">,</span> <span class="n">pad_tips</span> <span class="o">=</span> <span class="n">get_vertices_and_tips_from_skeleton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span> <span class="o">=</span> <span class="n">get_branches_and_tips_coord</span><span class="p">(</span><span class="n">pad_vertices</span><span class="p">,</span> <span class="n">pad_tips</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.label_edges_connected_with_vertex_clusters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">label_edges_connected_with_vertex_clusters</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Identify edges connected to touching vertices by processing vertex clusters.</p>
<p>This function processes the skeleton to identify edges connecting vertices
that are part of touching clusters. It creates a cropped version of the skeleton
by removing already detected edges and their tips, then iterates through vertex
clusters to explore and identify nearby edges.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1283" name="__codelineno-0-1283"></a><span class="k">def</span><span class="w"> </span><span class="nf">label_edges_connected_with_vertex_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a><span class="sd">    Identify edges connected to touching vertices by processing vertex clusters.</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a><span class="sd">    This function processes the skeleton to identify edges connecting vertices</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a><span class="sd">    that are part of touching clusters. It creates a cropped version of the skeleton</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a><span class="sd">    by removing already detected edges and their tips, then iterates through vertex</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a><span class="sd">    clusters to explore and identify nearby edges.</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>    <span class="c1"># I.1. Identify edges connected to touching vertices:</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>    <span class="c1"># First, create another version of these arrays, where we remove every already detected edge and their tips</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>    <span class="n">cropped_skeleton</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>    <span class="n">cropped_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>    <span class="n">cropped_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>    <span class="c1"># non_tip_vertices does not need to be updated yet, because it only contains verified branching vertices</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>    <span class="n">cropped_non_tip_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>    <span class="c1"># The problem with vertex_to_vertex_connexion is that since they are not separated by zeros,</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>    <span class="c1"># they always atract each other instead of exploring other paths.</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>    <span class="c1"># To fix this, we loop over each vertex group to</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>    <span class="c1"># 1. Add one edge per inter-vertex connexion inside the group</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>    <span class="c1"># 2. Remove all except one, and loop as many time as necessary.</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>    <span class="c1"># Inside that second loop, we explore and identify every edge nearby.</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>    <span class="c1"># Find every vertex_to_vertex_connexion</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>    <span class="n">v_cluster_nb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_lab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_stats</span><span class="p">,</span> <span class="n">vgc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>    <span class="k">if</span> <span class="n">v_cluster_nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>        <span class="n">max_v_nb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">4</span><span class="p">])</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>        <span class="n">cropped_skeleton_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>        <span class="n">starting_vertices_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>        <span class="k">for</span> <span class="n">v_nb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_v_nb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">v_nb</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>            <span class="n">coord_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>            <span class="k">for</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>  <span class="c1"># lab=labels[0]</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>                <span class="n">coord_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_lab</span> <span class="o">==</span> <span class="n">lab</span><span class="p">))</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>            <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v_nb</span><span class="p">):</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>                <span class="k">for</span> <span class="n">lab_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> <span class="c1"># lab=labels[0]</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>                    <span class="n">cs</span> <span class="o">=</span> <span class="n">cropped_skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>                    <span class="n">sv</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>                    <span class="n">v_c</span> <span class="o">=</span> <span class="n">coord_list</span><span class="p">[</span><span class="n">lab_</span><span class="p">]</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>                    <span class="c1"># Save the current coordinate in the starting vertices array of this iteration</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>                    <span class="n">sv</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">v_c</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">iter</span><span class="p">],</span> <span class="n">v_c</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="nb">iter</span><span class="p">]])</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>                    <span class="c1"># Remove one vertex coordinate to keep it from cs</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                    <span class="n">v_y</span><span class="p">,</span> <span class="n">v_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">v_c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">iter</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">v_c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">iter</span><span class="p">)</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                    <span class="n">cs</span><span class="p">[</span><span class="n">v_y</span><span class="p">,</span> <span class="n">v_x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>                    <span class="n">cropped_skeleton_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>                    <span class="n">starting_vertices_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sv</span><span class="p">))</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>        <span class="k">for</span> <span class="n">cropped_skeleton</span><span class="p">,</span> <span class="n">starting_vertices</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cropped_skeleton_list</span><span class="p">,</span> <span class="n">starting_vertices_list</span><span class="p">):</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>            <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_edges_connecting_a_vertex_list</span><span class="p">(</span><span class="n">cropped_skeleton</span><span class="p">,</span> <span class="n">cropped_non_tip_vertices</span><span class="p">,</span> <span class="n">starting_vertices</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.label_edges_connecting_vertex_clusters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">label_edges_connecting_vertex_clusters</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Label edges connecting vertex clusters.</p>
<p>This method identifies the connections between connected vertices within
vertex clusters and labels these edges. It uses the previously found connected
vertices, creates an image of the connections, and then identifies
and labels the edges between these touching vertices.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1335" name="__codelineno-0-1335"></a><span class="k">def</span><span class="w"> </span><span class="nf">label_edges_connecting_vertex_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a><span class="sd">    Label edges connecting vertex clusters.</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a><span class="sd">    This method identifies the connections between connected vertices within</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a><span class="sd">    vertex clusters and labels these edges. It uses the previously found connected</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a><span class="sd">    vertices, creates an image of the connections, and then identifies</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a><span class="sd">    and labels the edges between these touching vertices.</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>    <span class="c1"># I.2. Identify the connexions between connected vertices:</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>    <span class="n">all_connected_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>    <span class="n">all_con_v_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>    <span class="k">for</span> <span class="n">v_group</span> <span class="ow">in</span> <span class="n">all_connected_vertices</span><span class="p">:</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>        <span class="n">all_con_v_im</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_lab</span> <span class="o">==</span> <span class="n">v_group</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>    <span class="n">cropped_skeleton</span> <span class="o">=</span> <span class="n">all_con_v_im</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cropped_skeleton</span><span class="p">)))</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>    <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_edges_connecting_a_vertex_list</span><span class="p">(</span><span class="n">cropped_skeleton</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span><span class="p">)</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>    <span class="c1"># self.edges_labels</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_stats</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_cluster_lab</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.label_edges_from_known_vertices_iteratively" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">label_edges_from_known_vertices_iteratively</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Label edges iteratively from known vertices.</p>
<p>This method labels edges in an iterative process starting from
known vertices. It handles the removal of detected edges and
updates the skeleton accordingly, to avoid detecting edges twice.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1356" name="__codelineno-0-1356"></a><span class="k">def</span><span class="w"> </span><span class="nf">label_edges_from_known_vertices_iteratively</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a><span class="sd">    Label edges iteratively from known vertices.</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a><span class="sd">    This method labels edges in an iterative process starting from</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a><span class="sd">    known vertices. It handles the removal of detected edges and</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a><span class="sd">    updates the skeleton accordingly, to avoid detecting edges twice.</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>    <span class="c1"># II/ Identify all remaining edges</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>        <span class="n">starting_vertices_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">))</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>        <span class="n">starting_vertices_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">starting_vertices_coord</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>        <span class="c1"># We start from the vertices connecting tips</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>        <span class="n">starting_vertices_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>    <span class="c1"># Remove the detected edges from cropped_skeleton:</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>    <span class="n">cropped_skeleton</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>    <span class="n">cropped_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>    <span class="n">cropped_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>    <span class="n">cropped_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>    <span class="c1"># Reinitialize cropped_non_tip_vertices to browse all vertices except tips and groups</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>    <span class="n">cropped_non_tip_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>    <span class="n">cropped_non_tip_vertices</span> <span class="o">=</span> <span class="n">remove_coordinates</span><span class="p">(</span><span class="n">cropped_non_tip_vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span><span class="p">)</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_clusters_coord</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>    <span class="n">remaining_v</span> <span class="o">=</span> <span class="n">cropped_non_tip_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>    <span class="k">while</span> <span class="n">remaining_v</span> <span class="o">&gt;</span> <span class="n">cropped_non_tip_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>        <span class="n">remaining_v</span> <span class="o">=</span> <span class="n">cropped_non_tip_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>        <span class="n">cropped_skeleton</span><span class="p">,</span> <span class="n">cropped_non_tip_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identify_edges_connecting_a_vertex_list</span><span class="p">(</span><span class="n">cropped_skeleton</span><span class="p">,</span> <span class="n">cropped_non_tip_vertices</span><span class="p">,</span> <span class="n">starting_vertices_coord</span><span class="p">)</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>            <span class="n">starting_vertices_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_level_vertices</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.label_edges_looping_on_1_vertex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">label_edges_looping_on_1_vertex</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Identify and handle edges that form loops around a single vertex.
This method processes the skeleton image to find looping edges and updates
the edge data structure accordingly.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1388" name="__codelineno-0-1388"></a><span class="k">def</span><span class="w"> </span><span class="nf">label_edges_looping_on_1_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a><span class="sd">    Identify and handle edges that form loops around a single vertex.</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a><span class="sd">    This method processes the skeleton image to find looping edges and updates</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a><span class="sd">    the edge data structure accordingly.</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">identified</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">)</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>    <span class="n">unidentified</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>    <span class="c1"># Find out the remaining non-identified pixels</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>    <span class="n">nb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">,</span> <span class="n">ce</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="n">unidentified</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>    <span class="c1"># Handle the cases where edges are loops over only one vertex</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>    <span class="n">looping_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unidentified_stats</span><span class="p">[:,</span> <span class="mi">4</span> <span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>    <span class="k">for</span> <span class="n">loop_i</span> <span class="ow">in</span> <span class="n">looping_edges</span><span class="p">:</span> <span class="c1"># loop_i = looping_edges[0] loop_i=11 #  zoom_on_nonzero(unique_vertices_im, return_coord=False)</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>        <span class="n">edge_i</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unidentified_shapes</span> <span class="o">==</span> <span class="n">loop_i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>        <span class="n">dil_edge_i</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">edge_i</span><span class="p">,</span> <span class="n">square_33</span><span class="p">)</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>        <span class="n">unique_vertices_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>        <span class="n">unique_vertices_im</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>        <span class="n">unique_vertices_im</span> <span class="o">=</span> <span class="n">dil_edge_i</span> <span class="o">*</span> <span class="n">unique_vertices_im</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>        <span class="n">unique_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">unique_vertices_im</span><span class="p">)</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>        <span class="n">unique_vertices</span> <span class="o">=</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="n">unique_vertices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>        <span class="n">v_nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_vertices</span><span class="p">)</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>        <span class="n">new_edge_lengths</span> <span class="o">=</span> <span class="n">edge_i</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>        <span class="n">new_edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">edge_i</span><span class="p">))))</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>        <span class="n">new_edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">new_edge_pix_coord</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">]))</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>        <span class="k">if</span> <span class="n">v_nb</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge_data</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="p">)</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>        <span class="k">elif</span> <span class="n">v_nb</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>            <span class="c1"># The edge loops around a group of connected vertices</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge_data</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="p">)</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>            <span class="c1"># conn_v_nb, conn_v = cv2.connectedComponents((unique_vertices_im &gt; 0).astype(np.uint8))</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>            <span class="c1"># if len(unique_vertices) == 2 and conn_v_nb == 2:</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>        <span class="k">elif</span> <span class="n">v_nb</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># The question is: How to choose two vertices so that they link all missing pixels?</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>            <span class="c1"># 1. Find every edge pixel connected to these vertices</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>            <span class="n">vertex_connected_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">((</span><span class="n">unique_vertices_im</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">square_33</span><span class="p">)</span> <span class="o">*</span> <span class="n">edge_i</span><span class="p">)</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>            <span class="c1"># 2. Find the most distant pair of these</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>            <span class="n">pix1</span><span class="p">,</span> <span class="n">pix2</span> <span class="o">=</span> <span class="n">get_min_or_max_euclidean_pair</span><span class="p">(</span><span class="n">vertex_connected_pixels</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>            <span class="c1"># 3. The two best vertices are the two nearest to these two most distant edge pixels</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>            <span class="n">dist_to_pix1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">v_nb</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>            <span class="n">dist_to_pix2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">v_nb</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>            <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">v_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_vertices</span><span class="p">):</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>                <span class="n">v_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index_map</span><span class="p">[</span><span class="n">v_i</span><span class="p">]</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>                <span class="n">dist_to_pix1</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">eudist</span><span class="p">(</span><span class="n">pix1</span><span class="p">,</span> <span class="n">v_coord</span><span class="p">)</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>                <span class="n">dist_to_pix2</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">eudist</span><span class="p">(</span><span class="n">pix2</span><span class="p">,</span> <span class="n">v_coord</span><span class="p">)</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dist_to_pix1</span><span class="p">)],</span> <span class="n">unique_vertices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dist_to_pix2</span><span class="p">)]</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge_data</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">new_edge_lengths</span><span class="p">,</span> <span class="n">new_edge_pix_coord</span><span class="p">)</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="si">}</span><span class="s2">, One long edge is not identified: i=</span><span class="si">{</span><span class="n">loop_i</span><span class="si">}</span><span class="s2"> of length=</span><span class="si">{</span><span class="n">edge_i</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> close to </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_vertices</span><span class="p">)</span><span class="si">}</span><span class="s2"> vertices.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">identified</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.label_tipped_edges_and_their_vertices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">label_tipped_edges_and_their_vertices</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Label edges connecting tip vertices to branching vertices and assign unique labels to all relevant vertices.</p>
<p>Processes vertex coordinates by stacking tips, vertices branching from tips, and remaining non-tip vertices.
Assigns unique sequential identifiers to these vertices in a new array. Constructs an array of edge-label information,
where each row contains the edge label (starting at 1), corresponding tip label, and connected vertex label.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.label_tipped_edges_and_their_vertices.tip_number">tip_number</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of tip coordinates available in <code>tips_coord</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.label_tipped_edges_and_their_vertices.ordered_v_coord">ordered_v_coord</span></code></td>
            <td>
                  <code>ndarray of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stack of unique vertex coordinates ordered by: tips first, vertices branching tips second, non-tip vertices third.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.label_tipped_edges_and_their_vertices.numbered_vertices">numbered_vertices</span></code></td>
            <td>
                  <code>ndarray of uint32</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array where each coordinate position is labeled with a sequential integer (starting at 1) based on the order in <code>ordered_v_coord</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.label_tipped_edges_and_their_vertices.edges_labels">edges_labels</span></code></td>
            <td>
                  <code>ndarray of uint32</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of shape (n_edges, 3). Each row contains:
- Edge label (sequential from 1 to n_edges)
- Label of the tip vertex for that edge.
- Label of the vertex branching the tip.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.EdgeIdentification.label_tipped_edges_and_their_vertices.vertices_branching_tips">vertices_branching_tips</span></code></td>
            <td>
                  <code>ndarray of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique coordinates of vertices directly connected to tips after removing duplicates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1216" name="__codelineno-0-1216"></a><span class="k">def</span><span class="w"> </span><span class="nf">label_tipped_edges_and_their_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Label edges connecting tip vertices to branching vertices and assign unique labels to all relevant vertices.</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a><span class="sd">    Processes vertex coordinates by stacking tips, vertices branching from tips, and remaining non-tip vertices.</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a><span class="sd">    Assigns unique sequential identifiers to these vertices in a new array. Constructs an array of edge-label information,</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="sd">    where each row contains the edge label (starting at 1), corresponding tip label, and connected vertex label.</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="sd">    tip_number : int</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a><span class="sd">        The number of tip coordinates available in `tips_coord`.</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a><span class="sd">    ordered_v_coord : ndarray of float</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">        Stack of unique vertex coordinates ordered by: tips first, vertices branching tips second, non-tip vertices third.</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a><span class="sd">    numbered_vertices : ndarray of uint32</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">        2D array where each coordinate position is labeled with a sequential integer (starting at 1) based on the order in `ordered_v_coord`.</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a><span class="sd">    edges_labels : ndarray of uint32</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a><span class="sd">        Array of shape (n_edges, 3). Each row contains:</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a><span class="sd">        - Edge label (sequential from 1 to n_edges)</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a><span class="sd">        - Label of the tip vertex for that edge.</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a><span class="sd">        - Label of the vertex branching the tip.</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a><span class="sd">    vertices_branching_tips : ndarray of float</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a><span class="sd">        Unique coordinates of vertices directly connected to tips after removing duplicates.</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">tip_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>    <span class="c1"># Stack vertex coordinates in that order: 1. Tips, 2. Vertices branching tips, 3. All remaining vertices</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>    <span class="n">ordered_v_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">))</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>    <span class="n">ordered_v_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ordered_v_coord</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>    <span class="c1"># Create arrays to store edges and vertices labels</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">[</span><span class="n">ordered_v_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ordered_v_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ordered_v_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ordered_v_coord</span><span class="p">):</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index_map</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>    <span class="c1"># Name edges from 1 to the number of edges connecting tips and set the vertices labels from all tips to their connected vertices:</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_number</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>    <span class="c1"># edge label:</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_number</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>    <span class="c1"># tip label:</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>    <span class="c1"># vertex branching tip label:</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbered_vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>    <span class="c1"># Remove duplicates in vertices_branching_tips</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.make_edge_table" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_edge_table</span><span class="p">(</span><span class="n">greyscale</span><span class="p">,</span> <span class="n">compute_BC</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate edge table with length and average intensity information.</p>
<p>This method processes the vertex coordinates, calculates lengths
between vertices for each edge, and computes average width and intensity
along the edges. Additionally, it computes edge betweenness centrality
for each vertex pair.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>greyscale</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Grayscale image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1720" name="__codelineno-0-1720"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_edge_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">greyscale</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">compute_BC</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a><span class="sd">    Generate edge table with length and average intensity information.</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a><span class="sd">    This method processes the vertex coordinates, calculates lengths</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a><span class="sd">    between vertices for each edge, and computes average width and intensity</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a><span class="sd">    along the edges. Additionally, it computes edge betweenness centrality</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a><span class="sd">    for each vertex pair.</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a><span class="sd">    greyscale : ndarray of uint8</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a><span class="sd">        Grayscale image.</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_padding</span><span class="p">()</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">7</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span> <span class="c1"># edge_id, vertex1, vertex2, length, average_width, int, BC</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="p">:]</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">edge_lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>        <span class="n">edge_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>        <span class="n">pix_widths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">edge_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">edge_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>        <span class="n">v_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">,</span> <span class="mi">1</span><span class="p">:][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>        <span class="n">v1_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">v_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="c1">#</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>        <span class="n">v2_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">v_id</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="c1">#</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>        <span class="n">v1_width</span><span class="p">,</span> <span class="n">v2_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">v1_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v1_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">v2_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v2_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v1_width</span><span class="p">):</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>            <span class="n">pix_widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pix_widths</span><span class="p">,</span> <span class="n">v1_width</span><span class="p">)</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v2_width</span><span class="p">):</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>            <span class="n">pix_widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pix_widths</span><span class="p">,</span> <span class="n">v2_width</span><span class="p">)</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>        <span class="k">if</span> <span class="n">pix_widths</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">pix_widths</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>        <span class="n">pix_ints</span> <span class="o">=</span> <span class="n">greyscale</span><span class="p">[</span><span class="n">edge_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">edge_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>        <span class="n">v1_int</span><span class="p">,</span> <span class="n">v2_int</span> <span class="o">=</span> <span class="n">greyscale</span><span class="p">[</span><span class="n">v1_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v1_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">greyscale</span><span class="p">[</span><span class="n">v2_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v2_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>        <span class="n">pix_ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pix_ints</span><span class="p">,</span> <span class="p">(</span><span class="n">v1_int</span><span class="p">,</span> <span class="n">v2_int</span><span class="p">))</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">pix_ints</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>    <span class="k">if</span> <span class="n">compute_BC</span><span class="p">:</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_edgelist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:])</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>        <span class="n">e_BC</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">edge_betweenness_centrality</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">BC_net</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">)</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">e_BC</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="c1"># v=(81, 80)</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>            <span class="n">v1_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>            <span class="n">v2_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>            <span class="n">full_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">v1_coord</span><span class="p">,</span> <span class="n">v2_coord</span><span class="p">))</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>            <span class="n">edge_lab1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">v</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>            <span class="n">edge_lab2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>            <span class="n">edge_lab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">edge_lab1</span><span class="p">,</span> <span class="n">edge_lab2</span><span class="p">)))</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_lab</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>                <span class="n">edge_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>                <span class="n">full_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">full_coord</span><span class="p">,</span> <span class="n">edge_coord</span><span class="p">))</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">BC_net</span><span class="p">[</span><span class="n">full_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">full_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">k</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_lab</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>                <span class="n">edge_coord0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>                <span class="k">for</span> <span class="n">edge_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge_lab</span><span class="p">)):</span> <span class="c1">#  edge_i=1</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>                    <span class="n">edge_coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">[</span><span class="n">edge_i</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_table</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">edge_lab</span><span class="p">[</span><span class="n">edge_i</span><span class="p">],</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>                    <span class="n">full_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">full_coord</span><span class="p">,</span> <span class="n">edge_coord</span><span class="p">))</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">BC_net</span><span class="p">[</span><span class="n">full_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">full_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">k</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>                    <span class="k">if</span> <span class="n">edge_i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">edge_coord0</span><span class="p">,</span> <span class="n">edge_coord</span><span class="p">):</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There still is two identical edges: </span><span class="si">{</span><span class="n">edge_lab</span><span class="si">}</span><span class="s2"> of len: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">edge_coord</span><span class="p">)</span><span class="si">}</span><span class="s2"> linking vertices </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>                        <span class="k">break</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.make_vertex_table" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_vertex_table</span><span class="p">(</span><span class="n">origin_contours</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">growing_areas</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a table for the vertices.</p>
<p>This method constructs and returns a 2D NumPy array holding information
about all vertices. Each row corresponds to one vertex identified either
by its coordinates in <code>self.tips_coord</code> or <code>self.non_tip_vertices</code>. The
array includes additional information about each vertex, including whether
they are food vertices, growing areas, and connected components.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>origin_contours</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binary map to identify food vertices. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>growing_areas</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binary map to identify growing regions. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <div class="highlight"><pre><span></span><code>The method updates the instance attribute `self.vertex_table` with
the generated vertex information.
</code></pre></div>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1670" name="__codelineno-0-1670"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_vertex_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin_contours</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">growing_areas</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a><span class="sd">    Generate a table for the vertices.</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a><span class="sd">    This method constructs and returns a 2D NumPy array holding information</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a><span class="sd">    about all vertices. Each row corresponds to one vertex identified either</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a><span class="sd">    by its coordinates in `self.tips_coord` or `self.non_tip_vertices`. The</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a><span class="sd">    array includes additional information about each vertex, including whether</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a><span class="sd">    they are food vertices, growing areas, and connected components.</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a><span class="sd">    origin_contours : ndarray of uint8, optional</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a><span class="sd">        Binary map to identify food vertices. Default is `None`.</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a><span class="sd">    growing_areas : ndarray, optional</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a><span class="sd">        Binary map to identify growing regions. Default is `None`.</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a><span class="sd">        The method updates the instance attribute `self.vertex_table` with</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a><span class="sd">        the generated vertex information.</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_padding</span><span class="p">()</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>    <span class="k">if</span> <span class="n">origin_contours</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>        <span class="n">food_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">origin_contours</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>        <span class="n">food_vertices</span> <span class="o">=</span> <span class="n">food_vertices</span><span class="p">[</span><span class="n">food_vertices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">food_vertices</span><span class="p">),</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>    <span class="k">if</span> <span class="n">growing_areas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">growing_areas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>        <span class="c1"># growing = np.unique(self.vertices * growing_areas)[1:]</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>        <span class="n">growing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">growing_areas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">growing_areas</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>        <span class="n">growing</span> <span class="o">=</span> <span class="n">growing</span><span class="p">[</span><span class="n">growing</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">growing</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>            <span class="n">growing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">growing</span><span class="p">)</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="n">growing</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>    <span class="n">nb</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">cent</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]):</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>        <span class="n">v_labs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">sh</span> <span class="o">==</span> <span class="n">v_i</span><span class="p">]</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>        <span class="k">for</span> <span class="n">v_lab</span> <span class="ow">in</span> <span class="n">v_labs</span><span class="p">:</span> <span class="c1"># v_lab = v_labs[0]</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">v_lab</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.remove_tipped_edge_smaller_than_branch_width" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_tipped_edge_smaller_than_branch_width</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Remove very short edges from the skeleton.</p>
<p>This method focuses on edges connecting tips. When too short, they are considered are noise and
removed from the skeleton and distances matrices. These edges are considered too short when their length is
smaller than the width of the nearest network branch (an information included in pad_distances).
This method also updates internal data structures (skeleton, edge coordinates, vertex/tip positions)
accordingly through pixel-wise analysis and connectivity checks.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><span class="k">def</span><span class="w"> </span><span class="nf">remove_tipped_edge_smaller_than_branch_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove very short edges from the skeleton.</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">    This method focuses on edges connecting tips. When too short, they are considered are noise and</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">    removed from the skeleton and distances matrices. These edges are considered too short when their length is</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">    smaller than the width of the nearest network branch (an information included in pad_distances).</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><span class="sd">    This method also updates internal data structures (skeleton, edge coordinates, vertex/tip positions)</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">    accordingly through pixel-wise analysis and connectivity checks.</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>    <span class="c1"># Identify edges that are smaller than the width of the branch it is attached to</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>    <span class="n">tipped_edges_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>    <span class="c1"># connecting_vertices_to_remove = np.zeros(self.vertices_branching_tips.shape[0], dtype=bool)</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>    <span class="n">branches_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>    <span class="n">new_edge_pix_coord</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>    <span class="n">remaining_tipped_edges_nb</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">)):</span> <span class="c1"># i = 3142 #1096 # 974 # 222</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>        <span class="n">Y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_branching_tips</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>        <span class="n">edge_bool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>        <span class="n">eY</span><span class="p">,</span> <span class="n">eX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="n">edge_bool</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[</span><span class="n">edge_bool</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_distances</span><span class="p">[(</span><span class="n">Y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="p">(</span><span class="n">Y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span> <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)])</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>            <span class="n">tipped_edges_to_remove</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>            <span class="c1"># Remove the edge</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">[</span><span class="n">eY</span><span class="p">,</span> <span class="n">eX</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>            <span class="c1"># Remove the tip</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tips_coord</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>            <span class="c1"># Remove the coordinates corresponding to that edge</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">,</span> <span class="n">edge_bool</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>            <span class="c1"># check whether the connecting vertex remains a vertex of not</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>            <span class="n">pad_sub_skeleton</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">[(</span><span class="n">Y</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span> <span class="p">(</span><span class="n">Y</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span> <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)],</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>                                      <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>            <span class="n">sub_vertices</span><span class="p">,</span> <span class="n">sub_tips</span> <span class="o">=</span> <span class="n">get_vertices_and_tips_from_skeleton</span><span class="p">(</span><span class="n">pad_sub_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>            <span class="c1"># If the vertex does not connect at least 3 edges anymore, remove its vertex label</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>            <span class="k">if</span> <span class="n">sub_vertices</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>                <span class="n">vertex_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">X</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>                <span class="n">branches_to_remove</span><span class="p">[</span><span class="n">vertex_to_remove</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>            <span class="c1"># If that pixel became a tip connected to another vertex remove it from the skeleton</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>            <span class="k">if</span> <span class="n">sub_tips</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>                <span class="k">if</span> <span class="n">sub_vertices</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">[</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>                    <span class="n">vertex_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_tip_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">X</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>                    <span class="n">branches_to_remove</span><span class="p">[</span><span class="n">vertex_to_remove</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>            <span class="n">remaining_tipped_edges_nb</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>            <span class="n">new_edge_pix_coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">eY</span><span class="p">,</span> <span class="n">eX</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">remaining_tipped_edges_nb</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">eY</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>    <span class="c1"># Check that excedent connected components are 1 pixel size, if so:</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>    <span class="c1"># It means that they were neighbors to removed tips and not necessary for the skeleton</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>    <span class="n">nb</span><span class="p">,</span> <span class="n">sh</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>    <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Removing small tipped edges split the skeleton&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>        <span class="c1"># for i in range(2, nb):</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>        <span class="c1">#     excedent = sh == i</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>        <span class="c1">#     if (excedent).sum() == 1:</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>        <span class="c1">#         self.pad_skeleton[excedent] = 0</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>    <span class="c1"># Remove in distances the pixels removed in skeleton:</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pad_distances</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_skeleton</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>    <span class="c1"># update edge_pix_coord</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_edge_pix_coord</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edge_pix_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">new_edge_pix_coord</span><span class="p">)</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>    <span class="c1"># # Remove tips connected to very small edges</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>    <span class="c1"># self.tips_coord = np.delete(self.tips_coord, tipped_edges_to_remove, 0)</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>    <span class="c1"># # Add corresponding edge names</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>    <span class="c1"># self.tips_coord = np.hstack((self.tips_coord, np.arange(1, len(self.tips_coord) + 1)[:, None]))</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>    <span class="c1"># # Within all branching (non-tip) vertices, keep those that did not lose their vertex status because of the edge removal</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>    <span class="c1"># self.non_tip_vertices = np.delete(self.non_tip_vertices, branches_to_remove, 0)</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>    <span class="c1"># # Get the branching vertices who kept their typped edge</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>    <span class="c1"># self.vertices_branching_tips = np.delete(self.vertices_branching_tips, tipped_edges_to_remove, 0)</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>    <span class="c1"># Within all branching (non-tip) vertices, keep those that do not connect a tipped edge.</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>    <span class="c1"># v_branching_tips_in_branching_v = find_common_coord(self.non_tip_vertices, self.vertices_branching_tips[:, :2])</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>    <span class="c1"># self.remaining_vertices = np.delete(self.non_tip_vertices, v_branching_tips_in_branching_v, 0)</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>    <span class="c1"># ordered_v_coord = np.vstack((self.tips_coord[:, :2], self.vertices_branching_tips[:, :2], self.remaining_vertices))</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>    <span class="c1"># tips = self.tips_coord</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>    <span class="c1"># branching_any_edge = self.non_tip_vertices</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>    <span class="c1"># branching_typped_edges = self.vertices_branching_tips</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>    <span class="c1"># branching_no_typped_edges = self.remaining_vertices</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_and_tips_coord</span><span class="p">()</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">get_tipped_edges</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.EdgeIdentification.run_edge_identification" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_edge_identification</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Run the edge identification process.</p>
<p>This method orchestrates a series of steps to identify and label edges
within the graph structure. Each step handles a specific aspect of edge
identification, ultimately leading to a clearer and more refined edge network.</p>
<p>Steps involved:
1. Get vertices and tips coordinates.
2. Identify tipped edges.
3. Remove tipped edges smaller than branch width.
4. Label tipped edges and their vertices.
5. Label edges connected with vertex clusters.
6. Label edges connecting vertex clusters.
7. Label edges from known vertices iteratively.
8. Label edges looping on 1 vertex.
9. Clear areas with 1 or 2 unidentified pixels.
10. Clear edge duplicates.
11. Clear vertices connecting 2 edges.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_edge_identification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">    Run the edge identification process.</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="sd">    This method orchestrates a series of steps to identify and label edges</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">    within the graph structure. Each step handles a specific aspect of edge</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">    identification, ultimately leading to a clearer and more refined edge network.</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">    Steps involved:</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">    1. Get vertices and tips coordinates.</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a><span class="sd">    2. Identify tipped edges.</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="sd">    3. Remove tipped edges smaller than branch width.</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><span class="sd">    4. Label tipped edges and their vertices.</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><span class="sd">    5. Label edges connected with vertex clusters.</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><span class="sd">    6. Label edges connecting vertex clusters.</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">    7. Label edges from known vertices iteratively.</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a><span class="sd">    8. Label edges looping on 1 vertex.</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a><span class="sd">    9. Clear areas with 1 or 2 unidentified pixels.</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a><span class="sd">    10. Clear edge duplicates.</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><span class="sd">    11. Clear vertices connecting 2 edges.</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_and_tips_coord</span><span class="p">()</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">get_tipped_edges</span><span class="p">()</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">remove_tipped_edge_smaller_than_branch_width</span><span class="p">()</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">label_tipped_edges_and_their_vertices</span><span class="p">()</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">check_vertex_existence</span><span class="p">()</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">label_edges_connected_with_vertex_clusters</span><span class="p">()</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">label_edges_connecting_vertex_clusters</span><span class="p">()</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">label_edges_from_known_vertices_iteratively</span><span class="p">()</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">label_edges_looping_on_1_vertex</span><span class="p">()</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">clear_areas_of_1_or_2_unidentified_pixels</span><span class="p">()</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">clear_edge_duplicates</span><span class="p">()</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">clear_vertices_connecting_2_edges</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cellects.core.motion_analysis.MotionAnalysis" class="doc doc-heading">
            <code>MotionAnalysis</code>


</h2>


    <div class="doc doc-contents ">










              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-58">  58</a></span>
<span class="normal"><a href="#__codelineno-0-59">  59</a></span>
<span class="normal"><a href="#__codelineno-0-60">  60</a></span>
<span class="normal"><a href="#__codelineno-0-61">  61</a></span>
<span class="normal"><a href="#__codelineno-0-62">  62</a></span>
<span class="normal"><a href="#__codelineno-0-63">  63</a></span>
<span class="normal"><a href="#__codelineno-0-64">  64</a></span>
<span class="normal"><a href="#__codelineno-0-65">  65</a></span>
<span class="normal"><a href="#__codelineno-0-66">  66</a></span>
<span class="normal"><a href="#__codelineno-0-67">  67</a></span>
<span class="normal"><a href="#__codelineno-0-68">  68</a></span>
<span class="normal"><a href="#__codelineno-0-69">  69</a></span>
<span class="normal"><a href="#__codelineno-0-70">  70</a></span>
<span class="normal"><a href="#__codelineno-0-71">  71</a></span>
<span class="normal"><a href="#__codelineno-0-72">  72</a></span>
<span class="normal"><a href="#__codelineno-0-73">  73</a></span>
<span class="normal"><a href="#__codelineno-0-74">  74</a></span>
<span class="normal"><a href="#__codelineno-0-75">  75</a></span>
<span class="normal"><a href="#__codelineno-0-76">  76</a></span>
<span class="normal"><a href="#__codelineno-0-77">  77</a></span>
<span class="normal"><a href="#__codelineno-0-78">  78</a></span>
<span class="normal"><a href="#__codelineno-0-79">  79</a></span>
<span class="normal"><a href="#__codelineno-0-80">  80</a></span>
<span class="normal"><a href="#__codelineno-0-81">  81</a></span>
<span class="normal"><a href="#__codelineno-0-82">  82</a></span>
<span class="normal"><a href="#__codelineno-0-83">  83</a></span>
<span class="normal"><a href="#__codelineno-0-84">  84</a></span>
<span class="normal"><a href="#__codelineno-0-85">  85</a></span>
<span class="normal"><a href="#__codelineno-0-86">  86</a></span>
<span class="normal"><a href="#__codelineno-0-87">  87</a></span>
<span class="normal"><a href="#__codelineno-0-88">  88</a></span>
<span class="normal"><a href="#__codelineno-0-89">  89</a></span>
<span class="normal"><a href="#__codelineno-0-90">  90</a></span>
<span class="normal"><a href="#__codelineno-0-91">  91</a></span>
<span class="normal"><a href="#__codelineno-0-92">  92</a></span>
<span class="normal"><a href="#__codelineno-0-93">  93</a></span>
<span class="normal"><a href="#__codelineno-0-94">  94</a></span>
<span class="normal"><a href="#__codelineno-0-95">  95</a></span>
<span class="normal"><a href="#__codelineno-0-96">  96</a></span>
<span class="normal"><a href="#__codelineno-0-97">  97</a></span>
<span class="normal"><a href="#__codelineno-0-98">  98</a></span>
<span class="normal"><a href="#__codelineno-0-99">  99</a></span>
<span class="normal"><a href="#__codelineno-0-100"> 100</a></span>
<span class="normal"><a href="#__codelineno-0-101"> 101</a></span>
<span class="normal"><a href="#__codelineno-0-102"> 102</a></span>
<span class="normal"><a href="#__codelineno-0-103"> 103</a></span>
<span class="normal"><a href="#__codelineno-0-104"> 104</a></span>
<span class="normal"><a href="#__codelineno-0-105"> 105</a></span>
<span class="normal"><a href="#__codelineno-0-106"> 106</a></span>
<span class="normal"><a href="#__codelineno-0-107"> 107</a></span>
<span class="normal"><a href="#__codelineno-0-108"> 108</a></span>
<span class="normal"><a href="#__codelineno-0-109"> 109</a></span>
<span class="normal"><a href="#__codelineno-0-110"> 110</a></span>
<span class="normal"><a href="#__codelineno-0-111"> 111</a></span>
<span class="normal"><a href="#__codelineno-0-112"> 112</a></span>
<span class="normal"><a href="#__codelineno-0-113"> 113</a></span>
<span class="normal"><a href="#__codelineno-0-114"> 114</a></span>
<span class="normal"><a href="#__codelineno-0-115"> 115</a></span>
<span class="normal"><a href="#__codelineno-0-116"> 116</a></span>
<span class="normal"><a href="#__codelineno-0-117"> 117</a></span>
<span class="normal"><a href="#__codelineno-0-118"> 118</a></span>
<span class="normal"><a href="#__codelineno-0-119"> 119</a></span>
<span class="normal"><a href="#__codelineno-0-120"> 120</a></span>
<span class="normal"><a href="#__codelineno-0-121"> 121</a></span>
<span class="normal"><a href="#__codelineno-0-122"> 122</a></span>
<span class="normal"><a href="#__codelineno-0-123"> 123</a></span>
<span class="normal"><a href="#__codelineno-0-124"> 124</a></span>
<span class="normal"><a href="#__codelineno-0-125"> 125</a></span>
<span class="normal"><a href="#__codelineno-0-126"> 126</a></span>
<span class="normal"><a href="#__codelineno-0-127"> 127</a></span>
<span class="normal"><a href="#__codelineno-0-128"> 128</a></span>
<span class="normal"><a href="#__codelineno-0-129"> 129</a></span>
<span class="normal"><a href="#__codelineno-0-130"> 130</a></span>
<span class="normal"><a href="#__codelineno-0-131"> 131</a></span>
<span class="normal"><a href="#__codelineno-0-132"> 132</a></span>
<span class="normal"><a href="#__codelineno-0-133"> 133</a></span>
<span class="normal"><a href="#__codelineno-0-134"> 134</a></span>
<span class="normal"><a href="#__codelineno-0-135"> 135</a></span>
<span class="normal"><a href="#__codelineno-0-136"> 136</a></span>
<span class="normal"><a href="#__codelineno-0-137"> 137</a></span>
<span class="normal"><a href="#__codelineno-0-138"> 138</a></span>
<span class="normal"><a href="#__codelineno-0-139"> 139</a></span>
<span class="normal"><a href="#__codelineno-0-140"> 140</a></span>
<span class="normal"><a href="#__codelineno-0-141"> 141</a></span>
<span class="normal"><a href="#__codelineno-0-142"> 142</a></span>
<span class="normal"><a href="#__codelineno-0-143"> 143</a></span>
<span class="normal"><a href="#__codelineno-0-144"> 144</a></span>
<span class="normal"><a href="#__codelineno-0-145"> 145</a></span>
<span class="normal"><a href="#__codelineno-0-146"> 146</a></span>
<span class="normal"><a href="#__codelineno-0-147"> 147</a></span>
<span class="normal"><a href="#__codelineno-0-148"> 148</a></span>
<span class="normal"><a href="#__codelineno-0-149"> 149</a></span>
<span class="normal"><a href="#__codelineno-0-150"> 150</a></span>
<span class="normal"><a href="#__codelineno-0-151"> 151</a></span>
<span class="normal"><a href="#__codelineno-0-152"> 152</a></span>
<span class="normal"><a href="#__codelineno-0-153"> 153</a></span>
<span class="normal"><a href="#__codelineno-0-154"> 154</a></span>
<span class="normal"><a href="#__codelineno-0-155"> 155</a></span>
<span class="normal"><a href="#__codelineno-0-156"> 156</a></span>
<span class="normal"><a href="#__codelineno-0-157"> 157</a></span>
<span class="normal"><a href="#__codelineno-0-158"> 158</a></span>
<span class="normal"><a href="#__codelineno-0-159"> 159</a></span>
<span class="normal"><a href="#__codelineno-0-160"> 160</a></span>
<span class="normal"><a href="#__codelineno-0-161"> 161</a></span>
<span class="normal"><a href="#__codelineno-0-162"> 162</a></span>
<span class="normal"><a href="#__codelineno-0-163"> 163</a></span>
<span class="normal"><a href="#__codelineno-0-164"> 164</a></span>
<span class="normal"><a href="#__codelineno-0-165"> 165</a></span>
<span class="normal"><a href="#__codelineno-0-166"> 166</a></span>
<span class="normal"><a href="#__codelineno-0-167"> 167</a></span>
<span class="normal"><a href="#__codelineno-0-168"> 168</a></span>
<span class="normal"><a href="#__codelineno-0-169"> 169</a></span>
<span class="normal"><a href="#__codelineno-0-170"> 170</a></span>
<span class="normal"><a href="#__codelineno-0-171"> 171</a></span>
<span class="normal"><a href="#__codelineno-0-172"> 172</a></span>
<span class="normal"><a href="#__codelineno-0-173"> 173</a></span>
<span class="normal"><a href="#__codelineno-0-174"> 174</a></span>
<span class="normal"><a href="#__codelineno-0-175"> 175</a></span>
<span class="normal"><a href="#__codelineno-0-176"> 176</a></span>
<span class="normal"><a href="#__codelineno-0-177"> 177</a></span>
<span class="normal"><a href="#__codelineno-0-178"> 178</a></span>
<span class="normal"><a href="#__codelineno-0-179"> 179</a></span>
<span class="normal"><a href="#__codelineno-0-180"> 180</a></span>
<span class="normal"><a href="#__codelineno-0-181"> 181</a></span>
<span class="normal"><a href="#__codelineno-0-182"> 182</a></span>
<span class="normal"><a href="#__codelineno-0-183"> 183</a></span>
<span class="normal"><a href="#__codelineno-0-184"> 184</a></span>
<span class="normal"><a href="#__codelineno-0-185"> 185</a></span>
<span class="normal"><a href="#__codelineno-0-186"> 186</a></span>
<span class="normal"><a href="#__codelineno-0-187"> 187</a></span>
<span class="normal"><a href="#__codelineno-0-188"> 188</a></span>
<span class="normal"><a href="#__codelineno-0-189"> 189</a></span>
<span class="normal"><a href="#__codelineno-0-190"> 190</a></span>
<span class="normal"><a href="#__codelineno-0-191"> 191</a></span>
<span class="normal"><a href="#__codelineno-0-192"> 192</a></span>
<span class="normal"><a href="#__codelineno-0-193"> 193</a></span>
<span class="normal"><a href="#__codelineno-0-194"> 194</a></span>
<span class="normal"><a href="#__codelineno-0-195"> 195</a></span>
<span class="normal"><a href="#__codelineno-0-196"> 196</a></span>
<span class="normal"><a href="#__codelineno-0-197"> 197</a></span>
<span class="normal"><a href="#__codelineno-0-198"> 198</a></span>
<span class="normal"><a href="#__codelineno-0-199"> 199</a></span>
<span class="normal"><a href="#__codelineno-0-200"> 200</a></span>
<span class="normal"><a href="#__codelineno-0-201"> 201</a></span>
<span class="normal"><a href="#__codelineno-0-202"> 202</a></span>
<span class="normal"><a href="#__codelineno-0-203"> 203</a></span>
<span class="normal"><a href="#__codelineno-0-204"> 204</a></span>
<span class="normal"><a href="#__codelineno-0-205"> 205</a></span>
<span class="normal"><a href="#__codelineno-0-206"> 206</a></span>
<span class="normal"><a href="#__codelineno-0-207"> 207</a></span>
<span class="normal"><a href="#__codelineno-0-208"> 208</a></span>
<span class="normal"><a href="#__codelineno-0-209"> 209</a></span>
<span class="normal"><a href="#__codelineno-0-210"> 210</a></span>
<span class="normal"><a href="#__codelineno-0-211"> 211</a></span>
<span class="normal"><a href="#__codelineno-0-212"> 212</a></span>
<span class="normal"><a href="#__codelineno-0-213"> 213</a></span>
<span class="normal"><a href="#__codelineno-0-214"> 214</a></span>
<span class="normal"><a href="#__codelineno-0-215"> 215</a></span>
<span class="normal"><a href="#__codelineno-0-216"> 216</a></span>
<span class="normal"><a href="#__codelineno-0-217"> 217</a></span>
<span class="normal"><a href="#__codelineno-0-218"> 218</a></span>
<span class="normal"><a href="#__codelineno-0-219"> 219</a></span>
<span class="normal"><a href="#__codelineno-0-220"> 220</a></span>
<span class="normal"><a href="#__codelineno-0-221"> 221</a></span>
<span class="normal"><a href="#__codelineno-0-222"> 222</a></span>
<span class="normal"><a href="#__codelineno-0-223"> 223</a></span>
<span class="normal"><a href="#__codelineno-0-224"> 224</a></span>
<span class="normal"><a href="#__codelineno-0-225"> 225</a></span>
<span class="normal"><a href="#__codelineno-0-226"> 226</a></span>
<span class="normal"><a href="#__codelineno-0-227"> 227</a></span>
<span class="normal"><a href="#__codelineno-0-228"> 228</a></span>
<span class="normal"><a href="#__codelineno-0-229"> 229</a></span>
<span class="normal"><a href="#__codelineno-0-230"> 230</a></span>
<span class="normal"><a href="#__codelineno-0-231"> 231</a></span>
<span class="normal"><a href="#__codelineno-0-232"> 232</a></span>
<span class="normal"><a href="#__codelineno-0-233"> 233</a></span>
<span class="normal"><a href="#__codelineno-0-234"> 234</a></span>
<span class="normal"><a href="#__codelineno-0-235"> 235</a></span>
<span class="normal"><a href="#__codelineno-0-236"> 236</a></span>
<span class="normal"><a href="#__codelineno-0-237"> 237</a></span>
<span class="normal"><a href="#__codelineno-0-238"> 238</a></span>
<span class="normal"><a href="#__codelineno-0-239"> 239</a></span>
<span class="normal"><a href="#__codelineno-0-240"> 240</a></span>
<span class="normal"><a href="#__codelineno-0-241"> 241</a></span>
<span class="normal"><a href="#__codelineno-0-242"> 242</a></span>
<span class="normal"><a href="#__codelineno-0-243"> 243</a></span>
<span class="normal"><a href="#__codelineno-0-244"> 244</a></span>
<span class="normal"><a href="#__codelineno-0-245"> 245</a></span>
<span class="normal"><a href="#__codelineno-0-246"> 246</a></span>
<span class="normal"><a href="#__codelineno-0-247"> 247</a></span>
<span class="normal"><a href="#__codelineno-0-248"> 248</a></span>
<span class="normal"><a href="#__codelineno-0-249"> 249</a></span>
<span class="normal"><a href="#__codelineno-0-250"> 250</a></span>
<span class="normal"><a href="#__codelineno-0-251"> 251</a></span>
<span class="normal"><a href="#__codelineno-0-252"> 252</a></span>
<span class="normal"><a href="#__codelineno-0-253"> 253</a></span>
<span class="normal"><a href="#__codelineno-0-254"> 254</a></span>
<span class="normal"><a href="#__codelineno-0-255"> 255</a></span>
<span class="normal"><a href="#__codelineno-0-256"> 256</a></span>
<span class="normal"><a href="#__codelineno-0-257"> 257</a></span>
<span class="normal"><a href="#__codelineno-0-258"> 258</a></span>
<span class="normal"><a href="#__codelineno-0-259"> 259</a></span>
<span class="normal"><a href="#__codelineno-0-260"> 260</a></span>
<span class="normal"><a href="#__codelineno-0-261"> 261</a></span>
<span class="normal"><a href="#__codelineno-0-262"> 262</a></span>
<span class="normal"><a href="#__codelineno-0-263"> 263</a></span>
<span class="normal"><a href="#__codelineno-0-264"> 264</a></span>
<span class="normal"><a href="#__codelineno-0-265"> 265</a></span>
<span class="normal"><a href="#__codelineno-0-266"> 266</a></span>
<span class="normal"><a href="#__codelineno-0-267"> 267</a></span>
<span class="normal"><a href="#__codelineno-0-268"> 268</a></span>
<span class="normal"><a href="#__codelineno-0-269"> 269</a></span>
<span class="normal"><a href="#__codelineno-0-270"> 270</a></span>
<span class="normal"><a href="#__codelineno-0-271"> 271</a></span>
<span class="normal"><a href="#__codelineno-0-272"> 272</a></span>
<span class="normal"><a href="#__codelineno-0-273"> 273</a></span>
<span class="normal"><a href="#__codelineno-0-274"> 274</a></span>
<span class="normal"><a href="#__codelineno-0-275"> 275</a></span>
<span class="normal"><a href="#__codelineno-0-276"> 276</a></span>
<span class="normal"><a href="#__codelineno-0-277"> 277</a></span>
<span class="normal"><a href="#__codelineno-0-278"> 278</a></span>
<span class="normal"><a href="#__codelineno-0-279"> 279</a></span>
<span class="normal"><a href="#__codelineno-0-280"> 280</a></span>
<span class="normal"><a href="#__codelineno-0-281"> 281</a></span>
<span class="normal"><a href="#__codelineno-0-282"> 282</a></span>
<span class="normal"><a href="#__codelineno-0-283"> 283</a></span>
<span class="normal"><a href="#__codelineno-0-284"> 284</a></span>
<span class="normal"><a href="#__codelineno-0-285"> 285</a></span>
<span class="normal"><a href="#__codelineno-0-286"> 286</a></span>
<span class="normal"><a href="#__codelineno-0-287"> 287</a></span>
<span class="normal"><a href="#__codelineno-0-288"> 288</a></span>
<span class="normal"><a href="#__codelineno-0-289"> 289</a></span>
<span class="normal"><a href="#__codelineno-0-290"> 290</a></span>
<span class="normal"><a href="#__codelineno-0-291"> 291</a></span>
<span class="normal"><a href="#__codelineno-0-292"> 292</a></span>
<span class="normal"><a href="#__codelineno-0-293"> 293</a></span>
<span class="normal"><a href="#__codelineno-0-294"> 294</a></span>
<span class="normal"><a href="#__codelineno-0-295"> 295</a></span>
<span class="normal"><a href="#__codelineno-0-296"> 296</a></span>
<span class="normal"><a href="#__codelineno-0-297"> 297</a></span>
<span class="normal"><a href="#__codelineno-0-298"> 298</a></span>
<span class="normal"><a href="#__codelineno-0-299"> 299</a></span>
<span class="normal"><a href="#__codelineno-0-300"> 300</a></span>
<span class="normal"><a href="#__codelineno-0-301"> 301</a></span>
<span class="normal"><a href="#__codelineno-0-302"> 302</a></span>
<span class="normal"><a href="#__codelineno-0-303"> 303</a></span>
<span class="normal"><a href="#__codelineno-0-304"> 304</a></span>
<span class="normal"><a href="#__codelineno-0-305"> 305</a></span>
<span class="normal"><a href="#__codelineno-0-306"> 306</a></span>
<span class="normal"><a href="#__codelineno-0-307"> 307</a></span>
<span class="normal"><a href="#__codelineno-0-308"> 308</a></span>
<span class="normal"><a href="#__codelineno-0-309"> 309</a></span>
<span class="normal"><a href="#__codelineno-0-310"> 310</a></span>
<span class="normal"><a href="#__codelineno-0-311"> 311</a></span>
<span class="normal"><a href="#__codelineno-0-312"> 312</a></span>
<span class="normal"><a href="#__codelineno-0-313"> 313</a></span>
<span class="normal"><a href="#__codelineno-0-314"> 314</a></span>
<span class="normal"><a href="#__codelineno-0-315"> 315</a></span>
<span class="normal"><a href="#__codelineno-0-316"> 316</a></span>
<span class="normal"><a href="#__codelineno-0-317"> 317</a></span>
<span class="normal"><a href="#__codelineno-0-318"> 318</a></span>
<span class="normal"><a href="#__codelineno-0-319"> 319</a></span>
<span class="normal"><a href="#__codelineno-0-320"> 320</a></span>
<span class="normal"><a href="#__codelineno-0-321"> 321</a></span>
<span class="normal"><a href="#__codelineno-0-322"> 322</a></span>
<span class="normal"><a href="#__codelineno-0-323"> 323</a></span>
<span class="normal"><a href="#__codelineno-0-324"> 324</a></span>
<span class="normal"><a href="#__codelineno-0-325"> 325</a></span>
<span class="normal"><a href="#__codelineno-0-326"> 326</a></span>
<span class="normal"><a href="#__codelineno-0-327"> 327</a></span>
<span class="normal"><a href="#__codelineno-0-328"> 328</a></span>
<span class="normal"><a href="#__codelineno-0-329"> 329</a></span>
<span class="normal"><a href="#__codelineno-0-330"> 330</a></span>
<span class="normal"><a href="#__codelineno-0-331"> 331</a></span>
<span class="normal"><a href="#__codelineno-0-332"> 332</a></span>
<span class="normal"><a href="#__codelineno-0-333"> 333</a></span>
<span class="normal"><a href="#__codelineno-0-334"> 334</a></span>
<span class="normal"><a href="#__codelineno-0-335"> 335</a></span>
<span class="normal"><a href="#__codelineno-0-336"> 336</a></span>
<span class="normal"><a href="#__codelineno-0-337"> 337</a></span>
<span class="normal"><a href="#__codelineno-0-338"> 338</a></span>
<span class="normal"><a href="#__codelineno-0-339"> 339</a></span>
<span class="normal"><a href="#__codelineno-0-340"> 340</a></span>
<span class="normal"><a href="#__codelineno-0-341"> 341</a></span>
<span class="normal"><a href="#__codelineno-0-342"> 342</a></span>
<span class="normal"><a href="#__codelineno-0-343"> 343</a></span>
<span class="normal"><a href="#__codelineno-0-344"> 344</a></span>
<span class="normal"><a href="#__codelineno-0-345"> 345</a></span>
<span class="normal"><a href="#__codelineno-0-346"> 346</a></span>
<span class="normal"><a href="#__codelineno-0-347"> 347</a></span>
<span class="normal"><a href="#__codelineno-0-348"> 348</a></span>
<span class="normal"><a href="#__codelineno-0-349"> 349</a></span>
<span class="normal"><a href="#__codelineno-0-350"> 350</a></span>
<span class="normal"><a href="#__codelineno-0-351"> 351</a></span>
<span class="normal"><a href="#__codelineno-0-352"> 352</a></span>
<span class="normal"><a href="#__codelineno-0-353"> 353</a></span>
<span class="normal"><a href="#__codelineno-0-354"> 354</a></span>
<span class="normal"><a href="#__codelineno-0-355"> 355</a></span>
<span class="normal"><a href="#__codelineno-0-356"> 356</a></span>
<span class="normal"><a href="#__codelineno-0-357"> 357</a></span>
<span class="normal"><a href="#__codelineno-0-358"> 358</a></span>
<span class="normal"><a href="#__codelineno-0-359"> 359</a></span>
<span class="normal"><a href="#__codelineno-0-360"> 360</a></span>
<span class="normal"><a href="#__codelineno-0-361"> 361</a></span>
<span class="normal"><a href="#__codelineno-0-362"> 362</a></span>
<span class="normal"><a href="#__codelineno-0-363"> 363</a></span>
<span class="normal"><a href="#__codelineno-0-364"> 364</a></span>
<span class="normal"><a href="#__codelineno-0-365"> 365</a></span>
<span class="normal"><a href="#__codelineno-0-366"> 366</a></span>
<span class="normal"><a href="#__codelineno-0-367"> 367</a></span>
<span class="normal"><a href="#__codelineno-0-368"> 368</a></span>
<span class="normal"><a href="#__codelineno-0-369"> 369</a></span>
<span class="normal"><a href="#__codelineno-0-370"> 370</a></span>
<span class="normal"><a href="#__codelineno-0-371"> 371</a></span>
<span class="normal"><a href="#__codelineno-0-372"> 372</a></span>
<span class="normal"><a href="#__codelineno-0-373"> 373</a></span>
<span class="normal"><a href="#__codelineno-0-374"> 374</a></span>
<span class="normal"><a href="#__codelineno-0-375"> 375</a></span>
<span class="normal"><a href="#__codelineno-0-376"> 376</a></span>
<span class="normal"><a href="#__codelineno-0-377"> 377</a></span>
<span class="normal"><a href="#__codelineno-0-378"> 378</a></span>
<span class="normal"><a href="#__codelineno-0-379"> 379</a></span>
<span class="normal"><a href="#__codelineno-0-380"> 380</a></span>
<span class="normal"><a href="#__codelineno-0-381"> 381</a></span>
<span class="normal"><a href="#__codelineno-0-382"> 382</a></span>
<span class="normal"><a href="#__codelineno-0-383"> 383</a></span>
<span class="normal"><a href="#__codelineno-0-384"> 384</a></span>
<span class="normal"><a href="#__codelineno-0-385"> 385</a></span>
<span class="normal"><a href="#__codelineno-0-386"> 386</a></span>
<span class="normal"><a href="#__codelineno-0-387"> 387</a></span>
<span class="normal"><a href="#__codelineno-0-388"> 388</a></span>
<span class="normal"><a href="#__codelineno-0-389"> 389</a></span>
<span class="normal"><a href="#__codelineno-0-390"> 390</a></span>
<span class="normal"><a href="#__codelineno-0-391"> 391</a></span>
<span class="normal"><a href="#__codelineno-0-392"> 392</a></span>
<span class="normal"><a href="#__codelineno-0-393"> 393</a></span>
<span class="normal"><a href="#__codelineno-0-394"> 394</a></span>
<span class="normal"><a href="#__codelineno-0-395"> 395</a></span>
<span class="normal"><a href="#__codelineno-0-396"> 396</a></span>
<span class="normal"><a href="#__codelineno-0-397"> 397</a></span>
<span class="normal"><a href="#__codelineno-0-398"> 398</a></span>
<span class="normal"><a href="#__codelineno-0-399"> 399</a></span>
<span class="normal"><a href="#__codelineno-0-400"> 400</a></span>
<span class="normal"><a href="#__codelineno-0-401"> 401</a></span>
<span class="normal"><a href="#__codelineno-0-402"> 402</a></span>
<span class="normal"><a href="#__codelineno-0-403"> 403</a></span>
<span class="normal"><a href="#__codelineno-0-404"> 404</a></span>
<span class="normal"><a href="#__codelineno-0-405"> 405</a></span>
<span class="normal"><a href="#__codelineno-0-406"> 406</a></span>
<span class="normal"><a href="#__codelineno-0-407"> 407</a></span>
<span class="normal"><a href="#__codelineno-0-408"> 408</a></span>
<span class="normal"><a href="#__codelineno-0-409"> 409</a></span>
<span class="normal"><a href="#__codelineno-0-410"> 410</a></span>
<span class="normal"><a href="#__codelineno-0-411"> 411</a></span>
<span class="normal"><a href="#__codelineno-0-412"> 412</a></span>
<span class="normal"><a href="#__codelineno-0-413"> 413</a></span>
<span class="normal"><a href="#__codelineno-0-414"> 414</a></span>
<span class="normal"><a href="#__codelineno-0-415"> 415</a></span>
<span class="normal"><a href="#__codelineno-0-416"> 416</a></span>
<span class="normal"><a href="#__codelineno-0-417"> 417</a></span>
<span class="normal"><a href="#__codelineno-0-418"> 418</a></span>
<span class="normal"><a href="#__codelineno-0-419"> 419</a></span>
<span class="normal"><a href="#__codelineno-0-420"> 420</a></span>
<span class="normal"><a href="#__codelineno-0-421"> 421</a></span>
<span class="normal"><a href="#__codelineno-0-422"> 422</a></span>
<span class="normal"><a href="#__codelineno-0-423"> 423</a></span>
<span class="normal"><a href="#__codelineno-0-424"> 424</a></span>
<span class="normal"><a href="#__codelineno-0-425"> 425</a></span>
<span class="normal"><a href="#__codelineno-0-426"> 426</a></span>
<span class="normal"><a href="#__codelineno-0-427"> 427</a></span>
<span class="normal"><a href="#__codelineno-0-428"> 428</a></span>
<span class="normal"><a href="#__codelineno-0-429"> 429</a></span>
<span class="normal"><a href="#__codelineno-0-430"> 430</a></span>
<span class="normal"><a href="#__codelineno-0-431"> 431</a></span>
<span class="normal"><a href="#__codelineno-0-432"> 432</a></span>
<span class="normal"><a href="#__codelineno-0-433"> 433</a></span>
<span class="normal"><a href="#__codelineno-0-434"> 434</a></span>
<span class="normal"><a href="#__codelineno-0-435"> 435</a></span>
<span class="normal"><a href="#__codelineno-0-436"> 436</a></span>
<span class="normal"><a href="#__codelineno-0-437"> 437</a></span>
<span class="normal"><a href="#__codelineno-0-438"> 438</a></span>
<span class="normal"><a href="#__codelineno-0-439"> 439</a></span>
<span class="normal"><a href="#__codelineno-0-440"> 440</a></span>
<span class="normal"><a href="#__codelineno-0-441"> 441</a></span>
<span class="normal"><a href="#__codelineno-0-442"> 442</a></span>
<span class="normal"><a href="#__codelineno-0-443"> 443</a></span>
<span class="normal"><a href="#__codelineno-0-444"> 444</a></span>
<span class="normal"><a href="#__codelineno-0-445"> 445</a></span>
<span class="normal"><a href="#__codelineno-0-446"> 446</a></span>
<span class="normal"><a href="#__codelineno-0-447"> 447</a></span>
<span class="normal"><a href="#__codelineno-0-448"> 448</a></span>
<span class="normal"><a href="#__codelineno-0-449"> 449</a></span>
<span class="normal"><a href="#__codelineno-0-450"> 450</a></span>
<span class="normal"><a href="#__codelineno-0-451"> 451</a></span>
<span class="normal"><a href="#__codelineno-0-452"> 452</a></span>
<span class="normal"><a href="#__codelineno-0-453"> 453</a></span>
<span class="normal"><a href="#__codelineno-0-454"> 454</a></span>
<span class="normal"><a href="#__codelineno-0-455"> 455</a></span>
<span class="normal"><a href="#__codelineno-0-456"> 456</a></span>
<span class="normal"><a href="#__codelineno-0-457"> 457</a></span>
<span class="normal"><a href="#__codelineno-0-458"> 458</a></span>
<span class="normal"><a href="#__codelineno-0-459"> 459</a></span>
<span class="normal"><a href="#__codelineno-0-460"> 460</a></span>
<span class="normal"><a href="#__codelineno-0-461"> 461</a></span>
<span class="normal"><a href="#__codelineno-0-462"> 462</a></span>
<span class="normal"><a href="#__codelineno-0-463"> 463</a></span>
<span class="normal"><a href="#__codelineno-0-464"> 464</a></span>
<span class="normal"><a href="#__codelineno-0-465"> 465</a></span>
<span class="normal"><a href="#__codelineno-0-466"> 466</a></span>
<span class="normal"><a href="#__codelineno-0-467"> 467</a></span>
<span class="normal"><a href="#__codelineno-0-468"> 468</a></span>
<span class="normal"><a href="#__codelineno-0-469"> 469</a></span>
<span class="normal"><a href="#__codelineno-0-470"> 470</a></span>
<span class="normal"><a href="#__codelineno-0-471"> 471</a></span>
<span class="normal"><a href="#__codelineno-0-472"> 472</a></span>
<span class="normal"><a href="#__codelineno-0-473"> 473</a></span>
<span class="normal"><a href="#__codelineno-0-474"> 474</a></span>
<span class="normal"><a href="#__codelineno-0-475"> 475</a></span>
<span class="normal"><a href="#__codelineno-0-476"> 476</a></span>
<span class="normal"><a href="#__codelineno-0-477"> 477</a></span>
<span class="normal"><a href="#__codelineno-0-478"> 478</a></span>
<span class="normal"><a href="#__codelineno-0-479"> 479</a></span>
<span class="normal"><a href="#__codelineno-0-480"> 480</a></span>
<span class="normal"><a href="#__codelineno-0-481"> 481</a></span>
<span class="normal"><a href="#__codelineno-0-482"> 482</a></span>
<span class="normal"><a href="#__codelineno-0-483"> 483</a></span>
<span class="normal"><a href="#__codelineno-0-484"> 484</a></span>
<span class="normal"><a href="#__codelineno-0-485"> 485</a></span>
<span class="normal"><a href="#__codelineno-0-486"> 486</a></span>
<span class="normal"><a href="#__codelineno-0-487"> 487</a></span>
<span class="normal"><a href="#__codelineno-0-488"> 488</a></span>
<span class="normal"><a href="#__codelineno-0-489"> 489</a></span>
<span class="normal"><a href="#__codelineno-0-490"> 490</a></span>
<span class="normal"><a href="#__codelineno-0-491"> 491</a></span>
<span class="normal"><a href="#__codelineno-0-492"> 492</a></span>
<span class="normal"><a href="#__codelineno-0-493"> 493</a></span>
<span class="normal"><a href="#__codelineno-0-494"> 494</a></span>
<span class="normal"><a href="#__codelineno-0-495"> 495</a></span>
<span class="normal"><a href="#__codelineno-0-496"> 496</a></span>
<span class="normal"><a href="#__codelineno-0-497"> 497</a></span>
<span class="normal"><a href="#__codelineno-0-498"> 498</a></span>
<span class="normal"><a href="#__codelineno-0-499"> 499</a></span>
<span class="normal"><a href="#__codelineno-0-500"> 500</a></span>
<span class="normal"><a href="#__codelineno-0-501"> 501</a></span>
<span class="normal"><a href="#__codelineno-0-502"> 502</a></span>
<span class="normal"><a href="#__codelineno-0-503"> 503</a></span>
<span class="normal"><a href="#__codelineno-0-504"> 504</a></span>
<span class="normal"><a href="#__codelineno-0-505"> 505</a></span>
<span class="normal"><a href="#__codelineno-0-506"> 506</a></span>
<span class="normal"><a href="#__codelineno-0-507"> 507</a></span>
<span class="normal"><a href="#__codelineno-0-508"> 508</a></span>
<span class="normal"><a href="#__codelineno-0-509"> 509</a></span>
<span class="normal"><a href="#__codelineno-0-510"> 510</a></span>
<span class="normal"><a href="#__codelineno-0-511"> 511</a></span>
<span class="normal"><a href="#__codelineno-0-512"> 512</a></span>
<span class="normal"><a href="#__codelineno-0-513"> 513</a></span>
<span class="normal"><a href="#__codelineno-0-514"> 514</a></span>
<span class="normal"><a href="#__codelineno-0-515"> 515</a></span>
<span class="normal"><a href="#__codelineno-0-516"> 516</a></span>
<span class="normal"><a href="#__codelineno-0-517"> 517</a></span>
<span class="normal"><a href="#__codelineno-0-518"> 518</a></span>
<span class="normal"><a href="#__codelineno-0-519"> 519</a></span>
<span class="normal"><a href="#__codelineno-0-520"> 520</a></span>
<span class="normal"><a href="#__codelineno-0-521"> 521</a></span>
<span class="normal"><a href="#__codelineno-0-522"> 522</a></span>
<span class="normal"><a href="#__codelineno-0-523"> 523</a></span>
<span class="normal"><a href="#__codelineno-0-524"> 524</a></span>
<span class="normal"><a href="#__codelineno-0-525"> 525</a></span>
<span class="normal"><a href="#__codelineno-0-526"> 526</a></span>
<span class="normal"><a href="#__codelineno-0-527"> 527</a></span>
<span class="normal"><a href="#__codelineno-0-528"> 528</a></span>
<span class="normal"><a href="#__codelineno-0-529"> 529</a></span>
<span class="normal"><a href="#__codelineno-0-530"> 530</a></span>
<span class="normal"><a href="#__codelineno-0-531"> 531</a></span>
<span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">class</span><span class="w"> </span><span class="nc">MotionAnalysis</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Analyzes motion in a given arena using video data.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        This class processes video frames to analyze motion within a specified area,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        detecting shapes, covering durations, and generating descriptors for further</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        analysis.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">            l (list): A list containing various parameters and flags necessary for the motion</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">                analysis.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            l[0] (int): Arena index.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            l[1] (str): Arena identifier or name, stored in one_descriptor_per_arena[&#39;arena&#39;].</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            l[2] (dict): Variables required for the analysis, stored in vars.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            l[3] (bool): Flag to detect shape.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            l[4] (bool): Flag to analyze shape.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            l[5] (bool): Flag to show segmentation.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            l[6] (None or list): Videos already in RAM.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Attributes:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            vars (dict): Variables required for the analysis.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            visu (None): Placeholder for visualization data.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            binary (None): Placeholder for binary segmentation data.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            origin_idx (None): Placeholder for the index of the first frame.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            smoothing_flag (bool): Flag to indicate if smoothing should be applied.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            dims (tuple): Dimensions of the converted video.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            segmentation (ndarray): Array to store segmentation data.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            covering_intensity (ndarray): Intensity values for covering analysis.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            mean_intensity_per_frame (ndarray): Mean intensity per frame.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            borders (object): Borders of the arena.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            pixel_ring_depth (int): Depth of the pixel ring for analysis, default is 9.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            step (int): Step size for processing, default is 10.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            lost_frames (int): Number of lost frames to account for, default is 10.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            start (None or int): Starting frame index for the analysis.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        Methods:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">            load_images_and_videos(videos_already_in_ram, arena_idx): Loads images and videos</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">                for the specified arena index.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">            update_ring_width(): Updates the width of the pixel ring for analysis.</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">            get_origin_shape(): Detects the origin shape in the video frames.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">            get_covering_duration(step): Calculates the covering duration based on a step size.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">            detection(): Performs motion detection within the arena.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">            initialize_post_processing(): Initializes post-processing steps.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">            update_shape(show_seg): Updates the shape based on segmentation and visualization flags.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">            get_descriptors_from_binary(): Extracts descriptors from binary data.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">            detect_growth_transitions(): Detects growth transitions in the data.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">            networks_analysis(show_seg): Detected networks within the arena based on segmentation</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">                visualization.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">            study_cytoscillations(show_seg): Studies cytoscillations within the arena with</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                segmentation visualization.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">            fractal_descriptions(): Generates fractal descriptions of the analyzed data.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">            get_descriptors_summary(): Summarizes the descriptors obtained from the analysis.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">            save_results(): Saves the results of the analysis.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="nb">vars</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">detect_shape</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">analyse_shape</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">show_seg</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">videos_already_in_ram</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start the motion analysis of the arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="nb">vars</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;contour_color&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;background_list&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_images_and_videos</span><span class="p">(</span><span class="n">videos_already_in_ram</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mean_intensity_per_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">borders</span> <span class="o">=</span> <span class="n">image_borders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;arena_shape&#39;</span><span class="p">])</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">=</span> <span class="mi">9</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_ring_width</span><span class="p">()</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="k">if</span> <span class="n">detect_shape</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="c1"># Here to conditional layers allow to detect if an expansion/exploration occured</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_origin_shape</span><span class="p">()</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="c1"># The first, user-defined is the &#39;first_move_threshold&#39; and the second is the detection of the</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="c1"># substantial image: if any of them is not detected, the program considers there is not exp.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">20</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">step</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_covering_duration</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">detection</span><span class="p">()</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">initialize_post_processing</span><span class="p">()</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1">#200:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">(</span><span class="n">show_seg</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="c1">#</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="k">if</span> <span class="n">analyse_shape</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_descriptors_from_binary</span><span class="p">()</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">detect_growth_transitions</span><span class="p">()</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">networks_analysis</span><span class="p">(</span><span class="n">show_seg</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">study_cytoscillations</span><span class="p">(</span><span class="n">show_seg</span><span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fractal_descriptions</span><span class="p">()</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                <span class="k">if</span> <span class="n">videos_already_in_ram</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">save_results</span><span class="p">()</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_images_and_videos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">videos_already_in_ram</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        Load images and videos from disk or RAM.</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        videos_already_in_ram : numpy.ndarray or None</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">            Video data that is already loaded into RAM. If `None`, videos will be</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">            loaded from disk.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        i : int</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">            Index used to select the origin and background data.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        -----</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        This method logs information about the arena number and loads necessary data</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        from disk or RAM based on whether videos are already in memory. It sets various</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        attributes like `self.origin`, `self.background`, and `self.converted_video`.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Load images and videos&quot;</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_list&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># self.vars[&#39;origins_list&#39;][i]</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="n">true_frame_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="n">vid_name</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;video_list&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>            <span class="n">vid_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;video_list&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">background2</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="k">if</span> <span class="s1">&#39;background_list2&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list2&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">background2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="n">vids</span> <span class="o">=</span> <span class="n">read_one_arena</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;already_greyscale&#39;</span><span class="p">],</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                              <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span> <span class="n">videos_already_in_ram</span><span class="p">,</span> <span class="n">true_frame_width</span><span class="p">,</span> <span class="n">vid_name</span><span class="p">,</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                              <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background2</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span> <span class="o">=</span> <span class="n">vids</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                <span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Convert the RGB visu video into a greyscale image using the color space combination: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="n">vids</span> <span class="o">=</span> <span class="n">convert_subtract_and_filter_video</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                                                     <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background2</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                                                     <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">],</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                                                     <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;filter_spec&#39;</span><span class="p">])</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span> <span class="o">=</span> <span class="n">vids</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_origin_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        Determine the origin shape and initialize variables based on the state of the current analysis.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">        This method analyzes the initial frame or frames to determine the origin shape</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        of an object in a video, initializing necessary variables and matrices for</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        further processing.</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        Attributes Modified:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">            start: (int) Indicates the starting frame index.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">            origin_idx: (np.ndarray) The indices of non-zero values in the origin matrix.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">            covering_intensity: (np.ndarray) Matrix used for pixel fading intensity.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">            substantial_growth: (int) Represents a significant growth measure based on the origin.</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        Notes:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">            - The method behavior varies if &#39;origin_state&#39; is set to &quot;constant&quot; or not.</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">            - If the background is lighter, &#39;covering_intensity&#39; matrix is initialized.</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">            - Uses connected components to determine which shape is closest to the center</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">              or largest, based on &#39;appearance_detection_method&#39;.</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Make sure of origin shape&quot;</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="k">for</span> <span class="n">frame_i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># 100):#</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                <span class="n">true_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">frame_i</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[</span><span class="n">frame_i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">true_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">true_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">true_pixels</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">true_pixels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Drift correction has been wrongly detected. Images do not contain zero-valued pixels&quot;</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                <span class="c1"># Initialize the covering_intensity matrix as a reference for pixel fading</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">200</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="n">analysisi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_by_frame_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">analysisi</span><span class="o">.</span><span class="n">binary_image</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                <span class="n">analysisi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_by_frame_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="c1"># Use connected components to find which shape is the nearest from the image center.</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">analysisi</span><span class="o">.</span><span class="n">binary_image</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>                <span class="n">nb_components</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centroids</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="n">analysisi</span><span class="o">.</span><span class="n">binary_image</span><span class="p">,</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>                                                                                           <span class="n">connectivity</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;appearance_detection_method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;most_central&#39;</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                    <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                    <span class="n">stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nb_components</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                    <span class="k">for</span> <span class="n">shape_i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_components</span><span class="p">):</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                        <span class="n">stats</span><span class="p">[</span><span class="n">shape_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eudist</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">centroids</span><span class="p">[</span><span class="n">shape_i</span><span class="p">,</span> <span class="p">:])</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                    <span class="c1"># The shape having the minimal euclidean distance from the center will be the original shape</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="n">output</span> <span class="o">==</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;appearance_detection_method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;largest&#39;</span><span class="p">:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="n">output</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">4</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">substantial_growth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="mf">1.2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">250</span><span class="p">))</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_covering_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">        Determine the number of frames necessary for a pixel to get covered.</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        This function identifies the time when significant growth or motion occurs</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        in a video and calculates the number of frames needed for a pixel to be</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">        completely covered. It also handles noise and ensures that the calculated</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        step value is reasonable.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">        step : int</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">            The initial step size for frame analysis.</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">        ------</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">        Exception</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">            If an error occurs during the calculation process.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        -----</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        This function may modify several instance attributes including</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        `substantial_time`, `step`, and `start`.</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Find a frame with a significant growth/motion and determine the number of frames necessary for a pixel to get covered&quot;</span><span class="p">)</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="c1">## Find the time at which growth reached a substantial growth.</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="c1"># To avoid noisy images to have deleterious effects, make sure that area area reaches the threshold thrice.</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">occurrence</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">allowed_window</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="n">allowed_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="n">prev_bin_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">occurrence</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">step</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">+=</span> <span class="n">step</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="n">growth_vision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_by_frame_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="n">prev_bin_im</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="n">prev_bin_im</span> <span class="o">=</span> <span class="n">growth_vision</span><span class="o">.</span><span class="n">binary_image</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="n">surfarea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prev_bin_im</span><span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="n">prev_bin_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">prev_bin_im</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="k">if</span> <span class="n">surfarea</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_growth</span><span class="p">:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                <span class="n">occurrence</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="c1"># get a rough idea of the area covered during this time</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                <span class="n">growth</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">-</span> <span class="mi">10</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>                <span class="n">growth</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">-</span> <span class="mi">10</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>                            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>                <span class="n">growth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>                <span class="n">growth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="n">intensity_extent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="n">growth</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">growth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">intensity_extent</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">intensity_extent</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="n">growth</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">growth</span><span class="p">)</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="n">growth</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="n">growth_vision</span> <span class="o">=</span> <span class="n">OneImageAnalysis</span><span class="p">(</span><span class="n">growth</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="n">growth_vision</span><span class="o">.</span><span class="n">segmentation</span><span class="p">(</span><span class="n">allowed_window</span><span class="o">=</span><span class="n">allowed_window</span><span class="p">)</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="n">do_erode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="n">do_erode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">50</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="k">if</span> <span class="n">do_erode</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="n">growth_vision</span><span class="o">.</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span> <span class="o">=</span> <span class="n">growth_vision</span><span class="o">.</span><span class="n">binary_image</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span><span class="p">):</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">natural_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">intensity_extent</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">intensity_extent</span><span class="p">))</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">natural_noise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="n">natural_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">natural_noise</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">natural_noise</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">natural_noise</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="n">natural_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">natural_noise</span><span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="n">subst_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span><span class="p">)</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>            <span class="n">cover_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subst_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subst_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>                <span class="n">vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="n">subst_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">],</span> <span class="n">subst_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">index</span><span class="p">]]</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">find_major_incline</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">natural_noise</span><span class="p">)</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                <span class="c1"># If find_major_incline did find a major incline: (otherwise it put 0 to left and 1 to right)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">left</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">right</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                    <span class="n">cover_lengths</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="o">-</span><span class="n">right</span><span class="p">])</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="c1"># If this analysis fails put a deterministic step</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cover_lengths</span><span class="p">[</span><span class="n">cover_lengths</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cover_lengths</span><span class="p">[</span><span class="n">cover_lengths</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Pre-processing detection: the time for a pixel to get covered is set to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Pre-processing detection: could not automatically find the time for a pixel to get covered. Default value is 1 for video length &lt; 40 and 10 otherwise&quot;</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="c1"># Make sure to avoid a step overestimation</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">20</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="c1"># When the first_move_threshold is not stringent enough the program may detect a movement due to noise</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="c1"># In that case, the substantial_image is empty and there is no reason to proceed further</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compute_all_possibilities</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">            Perform frame-by-frame or luminosity-based segmentation on video data to detect cell motion and growth.</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">            This function processes video frames using either frame-by-frame segmentation or luminosity-based</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">            segmentation algorithms to detect cell motion and growth. It handles drift correction, adjusts parameters</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">            based on configuration settings, and applies logical operations to combine results from different segmentation</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">            methods.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">            Parameters</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">            ----------</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">            compute_all_possibilities : bool, optional</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">                Flag to determine if all segmentation possibilities should be computed, by default False</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">            Returns</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">            -------</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">            None</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">            Notes</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">            -----</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">            This function modifies the instance variables `self.segmented`, `self.converted_video`,</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">            and potentially `self.luminosity_segmentation` and `self.gradient_segmentation`.</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">            Depending on the configuration settings, it performs various segmentation algorithms and updates</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">            the instance variables accordingly.</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="c1"># I/ Image by image segmentation algorithms</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="c1"># If images contain a drift correction (zeros at borders of the image,</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="c1"># Replace these 0 by normal background values before segmenting</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;frame_by_frame_segmentation&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">compute_all_possibilities</span><span class="p">:</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Detect cell motion and growth using the frame by frame segmentation algorithm&quot;</span><span class="p">)</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span><span class="c1">#20):#</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="n">analysisi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_by_frame_segmentation</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysisi</span><span class="o">.</span><span class="n">binary_image</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">analysisi</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysisi</span><span class="o">.</span><span class="n">image</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">analysisi</span><span class="o">.</span><span class="n">image2</span><span class="p">)</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysisi</span><span class="o">.</span><span class="n">image2</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;color_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum_value_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">do_threshold_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_threshold_segmentation&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">compute_all_possibilities</span><span class="p">)</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_pixel_slopes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>            <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_slope_segmentation&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">compute_all_possibilities</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>                <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum_slope_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                <span class="k">if</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                    <span class="n">gradient_segmentation</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">gradient_segmentation</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_threshold_segmentation&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">compute_all_possibilities</span><span class="p">:</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                    <span class="n">luminosity_segmentation2</span><span class="p">,</span> <span class="n">l_threshold_over_time2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum_value_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">,</span> <span class="n">do_threshold_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>                    <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                        <span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="n">luminosity_segmentation2</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                    <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Or&#39;</span><span class="p">:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                            <span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">luminosity_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;And&#39;</span><span class="p">:</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                            <span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">luminosity_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Xor&#39;</span><span class="p">:</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>                            <span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">luminosity_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_pixel_slopes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">)</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_slope_segmentation&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">compute_all_possibilities</span><span class="p">:</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>                    <span class="n">gradient_segmentation2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum_slope_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>                    <span class="k">if</span> <span class="n">gradient_segmentation2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>                        <span class="n">gradient_segmentation2</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">gradient_segmentation2</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>                    <span class="k">if</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>                        <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">gradient_segmentation2</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>                    <span class="k">if</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Or&#39;</span><span class="p">:</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>                            <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">gradient_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;And&#39;</span><span class="p">:</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>                            <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">gradient_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Xor&#39;</span><span class="p">:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>                            <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">gradient_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="k">if</span> <span class="n">compute_all_possibilities</span><span class="p">:</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Compute all options to detect cell motion and growth. Maximal growth per frame: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;maximal_growth_factor&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                <span class="k">if</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">gradient_segmentation</span><span class="p">)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logical_and</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation</span><span class="p">))</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logical_or</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation</span><span class="p">))</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;frame_by_frame_segmentation&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_threshold_segmentation&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_slope_segmentation&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Detect with luminosity threshold segmentation algorithm&quot;</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">luminosity_segmentation</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_slope_segmentation&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Detect with luminosity slope segmentation algorithm&quot;</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">gradient_segmentation</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_threshold_segmentation&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_slope_segmentation&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;true_if_use_light_AND_slope_else_OR&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Detection resuts from threshold AND slope segmentation algorithms&quot;</span><span class="p">)</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>                        <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation</span><span class="p">)</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Detection resuts from threshold OR slope segmentation algorithms&quot;</span><span class="p">)</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                        <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation</span><span class="p">)</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">frame_by_frame_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">previous_binary_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">        Frame-by-frame segmentation of a video.</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">        t : int</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">            The time index of the frame to process.</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">        previous_binary_image : NDArray, optional</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">            The binary image from the previous frame. Default is `None`.</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">        -------</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">        OneImageAnalysis</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">            An object containing the analysis of the current frame.</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>        <span class="n">contrasted_im</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="c1"># 1. Get the mask valid for a number of images around it (step).</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="n">allowed_window</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>            <span class="n">half_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>            <span class="n">t_start</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">half_step</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>            <span class="n">t_end</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">half_step</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>            <span class="n">t_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">t_start</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>            <span class="n">t_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">t_end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>            <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>            <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>            <span class="n">allowed_window</span> <span class="o">=</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="n">analysisi</span> <span class="o">=</span> <span class="n">OneImageAnalysis</span><span class="p">(</span><span class="n">contrasted_im</span><span class="p">)</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>            <span class="n">contrasted_im2</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="n">analysisi</span><span class="o">.</span><span class="n">image2</span> <span class="o">=</span> <span class="n">contrasted_im2</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="k">if</span> <span class="n">previous_binary_image</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="n">analysisi</span><span class="o">.</span><span class="n">previous_binary_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>            <span class="n">analysisi</span><span class="o">.</span><span class="n">previous_binary_image</span> <span class="o">=</span> <span class="n">previous_binary_image</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="n">analysisi</span><span class="o">.</span><span class="n">segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;color_number&#39;</span><span class="p">],</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>                               <span class="n">bio_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;bio_label&quot;</span><span class="p">],</span> <span class="n">bio_label2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;bio_label2&quot;</span><span class="p">],</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                               <span class="n">rolling_window_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;rolling_window_segmentation&#39;</span><span class="p">],</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                               <span class="n">lighter_background</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">],</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>                               <span class="n">allowed_window</span><span class="o">=</span><span class="n">allowed_window</span><span class="p">,</span> <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;filter_spec&#39;</span><span class="p">])</span> <span class="c1"># filtering already done when creating converted_video</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="k">return</span> <span class="n">analysisi</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lum_value_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">do_threshold_segmentation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">        Perform segmentation based on luminosity values from a video.</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">        converted_video : NDArray</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">            The input video data in a NumPy array format.</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">        do_threshold_segmentation : bool</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">            Flag to determine whether threshold segmentation should be applied.</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">        -------</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">        Tuple[NDArray, NDArray]</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">            A tuple containing two NumPy arrays:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">            - The first array is the luminosity segmentation of the video.</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">            - The second array represents the luminosity threshold over time.</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">        -----</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">        This function operates under the assumption that there is sufficient motion in the video data.</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">        If no valid thresholds are found for segmentation, the function returns None for</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">        `luminosity_segmentation`.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>        <span class="n">shape_motion_failed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="n">covering_l_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>                                             <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>            <span class="n">covering_l_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>                                             <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="c1"># Avoid errors by checking whether the covering values are nonzero</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>        <span class="n">covering_l_values</span> <span class="o">=</span> <span class="n">covering_l_values</span><span class="p">[</span><span class="n">covering_l_values</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">covering_l_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>            <span class="n">shape_motion_failed</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">shape_motion_failed</span><span class="p">:</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="n">value_segmentation_thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>            <span class="n">validated_thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">value_segmentation_thresholds</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>            <span class="n">while_condition</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="n">max_motion_per_frame</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;maximal_growth_factor&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>                <span class="n">basic_bckgrnd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>                <span class="n">basic_bckgrnd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="c1"># Try different values of do_threshold_segmentation and keep the one that does not</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="c1"># segment more than x percent of the image</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">14</span><span class="p">:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>                <span class="n">value_threshold</span> <span class="o">=</span> <span class="n">value_segmentation_thresholds</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                    <span class="n">l_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">value_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covering_l_values</span><span class="p">)</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>                    <span class="n">l_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">value_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covering_l_values</span><span class="p">)</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>                <span class="n">starting_segmentation</span><span class="p">,</span> <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="n">segment_with_lum_value</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>                                                               <span class="n">basic_bckgrnd_values</span><span class="p">,</span> <span class="n">l_threshold</span><span class="p">,</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>                                                               <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">])</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>                <span class="n">changing_pixel_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">starting_segmentation</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                <span class="n">validation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">starting_segmentation</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="n">max_motion_per_frame</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">changing_pixel_number</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_motion_per_frame</span><span class="p">)</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                <span class="n">validated_thresholds</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">validated_thresholds</span><span class="p">):</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">validation</span><span class="p">:</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                        <span class="k">break</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>            <span class="c1"># If any threshold is accepted, use their average to proceed the final thresholding</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>            <span class="n">valid_number</span> <span class="o">=</span> <span class="n">validated_thresholds</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>            <span class="k">if</span> <span class="n">valid_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>                <span class="k">if</span> <span class="n">valid_number</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>                    <span class="n">index_to_keep</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>                    <span class="n">index_to_keep</span> <span class="o">=</span> <span class="n">valid_number</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>                <span class="n">value_threshold</span> <span class="o">=</span> <span class="n">value_segmentation_thresholds</span><span class="p">[</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">validated_thresholds</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">index_to_keep</span><span class="p">])))]</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>                <span class="n">value_threshold</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>                <span class="n">l_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">value_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covering_l_values</span><span class="p">)</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>                <span class="n">l_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">value_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covering_l_values</span><span class="p">)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>            <span class="k">if</span> <span class="n">do_threshold_segmentation</span><span class="p">:</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>                    <span class="n">basic_bckgrnd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>                    <span class="n">basic_bckgrnd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>                <span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="n">segment_with_lum_value</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">basic_bckgrnd_values</span><span class="p">,</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>                                                                 <span class="n">l_threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">])</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>                <span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="n">segment_with_lum_value</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>                                                               <span class="n">basic_bckgrnd_values</span><span class="p">,</span> <span class="n">l_threshold</span><span class="p">,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                                                               <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">])</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="k">return</span> <span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">l_threshold_over_time</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">smooth_pixel_slopes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">        Apply smoothing to pixel slopes in a video by convolving with a moving average kernel.</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">        converted_video : NDArray</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">            The input video array to be smoothed.</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">        -------</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">        NDArray</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">            Smoothed video array with pixel slopes averaged using a moving average kernel.</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">        ------</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">        MemoryError</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">            If there is not enough RAM available to perform the smoothing operation.</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">        -----</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">        This function applies a moving average kernel to each pixel across the frames of</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="sd">        the input video. The smoothing operation can be repeated based on user-defined settings.</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="sd">        The precision of the output array is controlled by a flag that determines whether to</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">        save memory at the cost of accuracy.</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">        --------</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">        &gt;&gt;&gt; smoothed = smooth_pixel_slopes(converted_video)</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">        &gt;&gt;&gt; print(smoothed.shape)  # Expected output will vary depending on the input video shape</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>                <span class="n">smoothed_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>                <span class="n">smooth_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>                        <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_intensity_per_frame</span><span class="p">,</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>                                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>                        <span class="n">moving_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">smooth_kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;repeat_video_smoothing&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>                            <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;repeat_video_smoothing&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>                                <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">moving_average</span><span class="p">,</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>                                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>                                <span class="n">moving_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">smooth_kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>                        <span class="n">smoothed_video</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">moving_average</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>                <span class="n">smoothed_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>                <span class="n">smooth_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>                        <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_intensity_per_frame</span><span class="p">,</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>                                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>                        <span class="n">moving_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">smooth_kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;repeat_video_smoothing&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>                            <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;repeat_video_smoothing&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                                <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">moving_average</span><span class="p">,</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                                <span class="n">moving_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">smooth_kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                        <span class="n">smoothed_video</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">moving_average</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>            <span class="k">return</span> <span class="n">smoothed_video</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>        <span class="k">except</span> <span class="ne">MemoryError</span><span class="p">:</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Not enough RAM available to smooth pixel curves. Detection may fail.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>            <span class="n">smoothed_video</span> <span class="o">=</span> <span class="n">converted_video</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>            <span class="k">return</span> <span class="n">smoothed_video</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lum_slope_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">        Perform lum slope segmentation on the given video.</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">        converted_video : NDArray</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">            The input video array for segmentation processing.</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">        -------</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">        NDArray</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">            Segmented gradient array of the video. If segmentation fails,</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">            returns `None` for the corresponding frames.</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">        -----</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="sd">        This function may consume significant memory and adjusts</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">        data types (float32 or float64) based on available RAM.</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">        --------</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">        &gt;&gt;&gt; result = lum_slope_segmentation(converted_video)</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="n">shape_motion_failed</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>        <span class="c1"># 2) Contrast increase</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>        <span class="n">oridx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>        <span class="n">notoridx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>        <span class="n">do_increase_contrast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">oridx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oridx</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>                <span class="n">converted_video</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">notoridx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">notoridx</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>        <span class="n">necessary_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">1.16415e-10</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>        <span class="n">available_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">available</span> <span class="o">&gt;&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;min_ram_free&#39;</span><span class="p">]</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>            <span class="n">derive</span> <span class="o">=</span> <span class="n">converted_video</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>            <span class="n">derive</span> <span class="o">=</span> <span class="n">converted_video</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="k">if</span> <span class="n">necessary_memory</span> <span class="o">&gt;</span> <span class="n">available_memory</span><span class="p">:</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>            <span class="n">converted_video</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="k">if</span> <span class="n">do_increase_contrast</span><span class="p">:</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>            <span class="n">derive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">derive</span><span class="p">)</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>        <span class="c1"># 3) Get the gradient</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="n">necessary_memory</span> <span class="o">=</span> <span class="n">derive</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">1.16415e-10</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>        <span class="n">available_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">available</span> <span class="o">&gt;&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;min_ram_free&#39;</span><span class="p">]</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="k">if</span> <span class="n">necessary_memory</span> <span class="o">&gt;</span> <span class="n">available_memory</span><span class="p">:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>            <span class="k">for</span> <span class="n">cy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>                <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>                        <span class="n">derive</span><span class="p">[:,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">derive</span><span class="p">[:,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>                        <span class="n">derive</span><span class="p">[:,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">derive</span><span class="p">[:,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>                <span class="n">derive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>                <span class="n">derive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>        <span class="c1"># 4) Segment</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>            <span class="n">covering_slopes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">derive</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>            <span class="n">covering_slopes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">derive</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="n">covering_slopes</span> <span class="o">=</span> <span class="n">covering_slopes</span><span class="p">[</span><span class="n">covering_slopes</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">covering_slopes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>            <span class="n">shape_motion_failed</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>        <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">shape_motion_failed</span><span class="p">:</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>            <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>            <span class="c1">####</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>            <span class="c1"># ease_slope_segmentation = 0.8</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>            <span class="n">value_segmentation_thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>            <span class="n">validated_thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">value_segmentation_thresholds</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>            <span class="n">while_condition</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>            <span class="n">max_motion_per_frame</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;maximal_growth_factor&#39;</span><span class="p">]</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>            <span class="c1"># Try different values of do_slope_segmentation and keep the one that does not</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="c1"># segment more than x percent of the image</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>            <span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="n">value_segmentation_thresholds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>                <span class="n">ease_slope_segmentation</span> <span class="o">=</span> <span class="n">value_segmentation_thresholds</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>                    <span class="n">gradient_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ease_slope_segmentation</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covering_slopes</span><span class="p">)</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>                    <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">derive</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">],</span> <span class="n">gradient_threshold</span><span class="p">)</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>                    <span class="n">gradient_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ease_slope_segmentation</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covering_slopes</span><span class="p">)</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>                    <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">derive</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">],</span> <span class="n">gradient_threshold</span><span class="p">)</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>                <span class="n">changing_pixel_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>                <span class="n">validation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="n">max_motion_per_frame</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">changing_pixel_number</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_motion_per_frame</span><span class="p">)</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>                <span class="n">validated_thresholds</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">validated_thresholds</span><span class="p">):</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">validation</span><span class="p">:</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>                        <span class="k">break</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>                <span class="c1"># If any threshold is accepted, use their average to proceed the final thresholding</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>            <span class="n">valid_number</span> <span class="o">=</span> <span class="n">validated_thresholds</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>            <span class="k">if</span> <span class="n">valid_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                <span class="k">if</span> <span class="n">valid_number</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>                    <span class="n">index_to_keep</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>                    <span class="n">index_to_keep</span> <span class="o">=</span> <span class="n">valid_number</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>                <span class="n">ease_slope_segmentation</span> <span class="o">=</span> <span class="n">value_segmentation_thresholds</span><span class="p">[</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">validated_thresholds</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">index_to_keep</span><span class="p">])))]</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                    <span class="n">gradient_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ease_slope_segmentation</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covering_slopes</span><span class="p">)</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                    <span class="n">gradient_segmentation</span><span class="p">[:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="n">gradient_threshold</span><span class="p">)[</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                    <span class="n">gradient_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ease_slope_segmentation</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covering_slopes</span><span class="p">)</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                    <span class="n">gradient_segmentation</span><span class="p">[:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="n">gradient_threshold</span><span class="p">)[</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>                    <span class="n">gradient_segmentation</span><span class="p">[:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">derive</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                    <span class="n">gradient_segmentation</span><span class="p">[:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">derive</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>        <span class="k">return</span> <span class="n">gradient_segmentation</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_ring_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="sd">        Update the `pixel_ring_depth` and create an erodila disk.</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="sd">        This method ensures that the pixel ring depth is odd and at least 3,</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">        then creates an erodila disk of that size.</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>        <span class="c1"># Make sure that self.pixels_depths are odd and greater than 3</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">erodila_disk</span> <span class="o">=</span> <span class="n">create_ellipse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;detection_range_factor&#39;</span><span class="p">]</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_post_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a><span class="sd">        Initialize post-processing for video analysis.</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a><span class="sd">        This function initializes various parameters and prepares the binary</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">        representation used in post-processing of video data. It logs information about</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a><span class="sd">        the settings, handles initial origin states, sets up segmentation data,</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a><span class="sd">        calculates surface areas, and optionally corrects errors around the initial</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a><span class="sd">        shape or prevents fast growth near the periphery.</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a><span class="sd">        -----</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a><span class="sd">        This function performs several initialization steps and logs relevant information,</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="sd">        including handling different origin states, updating segmentation data, and</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="sd">        calculating the gravity field based on binary representation.</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>        <span class="c1">## Initialization</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Starting Post_processing. Fading detection: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fading&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Subtract background: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;subtract_background&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Correct errors around initial shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;correct_errors_around_initial&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Connect distant shapes: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;detection_range_factor&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="si">}</span><span class="s2">, How to select appearing cell(s): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;appearance_detection_method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unaltered videos deprecated, they have been created with different settings.</span><span class="se">\n</span><span class="s2">Delete .npy videos and Data to run Cellects quickly.pkl and re-run&quot;</span><span class="p">)</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;invisible&quot;</span><span class="p">:</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;fluctuating&quot;</span><span class="p">:</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">:</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>                <span class="n">frames_to_assess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">):</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>                    <span class="c1"># Only keep pixels that are always detected</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>                    <span class="n">always_found</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">:(</span><span class="n">t</span> <span class="o">+</span> <span class="n">frames_to_assess</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>                    <span class="n">always_found</span> <span class="o">=</span> <span class="n">always_found</span> <span class="o">==</span> <span class="n">frames_to_assess</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>                    <span class="c1"># Remove too small shapes</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>                    <span class="n">without_small</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centro</span> <span class="o">=</span> <span class="n">cc</span><span class="p">(</span><span class="n">always_found</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>                    <span class="n">large_enough</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">large_enough</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                        <span class="n">always_found</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">always_found</span><span class="p">,</span> <span class="n">large_enough</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>                        <span class="n">always_found</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">always_found</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">always_found</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mean_distance_per_frame</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gravity_field</span> <span class="o">=</span> <span class="n">inverted_distance_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>                                           <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:])))</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;correct_errors_around_initial&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rays</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sun</span> <span class="o">=</span> <span class="n">draw_me_a_sun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">ray_length_coef</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># plt.imshow(sun)</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">holes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">+=</span> <span class="mi">2</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_ring_width</span><span class="p">()</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;prevent_fast_growth_near_periphery&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;arena_shape&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;circle&#39;</span><span class="p">:</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>                <span class="n">periphery_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;periphery_width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>                <span class="n">elliperiphery</span> <span class="o">=</span> <span class="n">create_ellipse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">periphery_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">periphery_width</span><span class="p">)</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>                <span class="n">half_width</span> <span class="o">=</span> <span class="n">periphery_width</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>                <span class="k">if</span> <span class="n">periphery_width</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="n">half_width</span><span class="p">:</span><span class="o">-</span><span class="n">half_width</span><span class="p">,</span> <span class="n">half_width</span><span class="p">:</span><span class="o">-</span><span class="n">half_width</span><span class="p">]</span> <span class="o">=</span> <span class="n">elliperiphery</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="n">half_width</span><span class="p">:</span><span class="o">-</span><span class="n">half_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">half_width</span><span class="p">:</span><span class="o">-</span><span class="n">half_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">elliperiphery</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;periphery_width&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;periphery_width&#39;</span><span class="p">]:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;periphery_width&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;periphery_width&#39;</span><span class="p">]:]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">)</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_seg</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="sd">        Update the shape of detected objects in the current frame by analyzing</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">        segmentation potentials and applying morphological operations.</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">        show_seg : bool</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">            Flag indicating whether to display segmentation results.</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">        -----</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">        This function performs several operations to update the shape of detected objects:</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">        - Analyzes segmentation potentials from previous frames.</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="sd">        - Applies morphological operations to refine the shape.</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">        - Updates internal state variables such as `binary` and `covering_intensity`.</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>        <span class="c1"># Get from gradients, a 2D matrix of potentially covered pixels</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>        <span class="c1"># I/ dilate the shape made with covered pixels to assess for covering</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>        <span class="c1"># I/ 1) Only keep pixels that have been detected at least two times in the three previous frames</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>            <span class="n">new_potentials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>                <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>                <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>            <span class="n">new_potentials</span><span class="p">[</span><span class="n">new_potentials</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>            <span class="n">new_potentials</span><span class="p">[</span><span class="n">new_potentials</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>        <span class="c1"># I/ 2) If an image displays more new potential pixels than 50% of image pixels,</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>        <span class="c1"># one of these images is considered noisy and we try taking only one.</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>        <span class="n">frame_counter</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>        <span class="n">maximal_size</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">new_potentials</span><span class="o">.</span><span class="n">size</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;do_threshold_segmentation&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;frame_by_frame_segmentation&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="mi">6</span><span class="p">)):</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>           <span class="n">maximal_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;maximal_growth_factor&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>        <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maximal_size</span><span class="p">,</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>                             <span class="n">frame_counter</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">):</span>  <span class="c1"># np.logical_and(np.sum(new_potentials &gt; 0) &gt; 5 * np.sum(dila_ring), frame_counter &lt;= 5):</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>            <span class="n">frame_counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>            <span class="k">if</span> <span class="n">frame_counter</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">:</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>                <span class="k">break</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>                <span class="k">if</span> <span class="n">frame_counter</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                    <span class="n">new_potentials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">frame_counter</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>                <span class="c1"># If taking only one image is not enough, use the inverse of the fadinged matrix as new_potentials</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>                <span class="c1"># Given it haven&#39;t been processed by any slope calculation, it should be less noisy</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>                    <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">5</span><span class="p">):</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>                    <span class="n">new_potentials</span><span class="p">[</span><span class="n">new_potentials</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>                    <span class="n">new_potentials</span><span class="p">[</span><span class="n">new_potentials</span> <span class="o">==</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>        <span class="n">new_shape</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>        <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>        <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>        <span class="n">new_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="n">new_potentials</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>        <span class="c1"># Add distant shapes within a radius, score every added pixels according to their distance</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>            <span class="k">if</span> <span class="n">new_shape</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                <span class="n">new_shape</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>                <span class="n">pads</span> <span class="o">=</span> <span class="n">ProgressivelyAddDistantShapes</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_distance</span><span class="p">)</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                <span class="n">r</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">pads</span><span class="p">)</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                <span class="c1"># If max_distance is non nul look for distant shapes</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                <span class="n">pads</span><span class="o">.</span><span class="n">consider_shapes_sizes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;min_size_for_connection&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                                                     <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;max_size_for_connection&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                <span class="n">pads</span><span class="o">.</span><span class="n">connect_shapes</span><span class="p">(</span><span class="n">only_keep_connected_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rank_connecting_pixels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>                <span class="n">new_shape</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">pads</span><span class="o">.</span><span class="n">expanded_shape</span><span class="p">)</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                <span class="n">new_shape</span><span class="p">[</span><span class="n">new_shape</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pads</span><span class="o">.</span><span class="n">expanded_shape</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>                        <span class="c1"># Add distant shapes back in time at the covering speed of neighbors</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">):(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> \
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>                            <span class="n">pads</span><span class="o">.</span><span class="n">modify_past_analysis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">):(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>                                                      <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">):(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>                        <span class="n">new_shape</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>                <span class="n">pads</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>            <span class="c1"># Fill holes</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>            <span class="n">new_shape</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">)</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">):</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>            <span class="c1"># Shape Erosion</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>            <span class="c1"># I/ After a substantial growth, erode the shape made with covered pixels to assess for fading</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>            <span class="c1"># Use the newly covered pixels to calculate their mean covering intensity</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>            <span class="n">new_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]))</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>            <span class="n">start_intensity_monitoring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>            <span class="n">end_intensity_monitoring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span><span class="p">[</span><span class="n">new_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">start_intensity_monitoring</span><span class="p">:</span><span class="n">end_intensity_monitoring</span><span class="p">,</span> <span class="n">new_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>            <span class="n">previous_binary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>            <span class="n">greyscale_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>            <span class="n">protect_from_fading</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>                <span class="n">protect_from_fading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>            <span class="n">new_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span> <span class="o">=</span> <span class="n">cell_leaving_detection</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span><span class="p">,</span> <span class="n">previous_binary</span><span class="p">,</span> <span class="n">greyscale_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fading&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">erodila_disk</span><span class="p">,</span> <span class="n">protect_from_fading</span><span class="p">)</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span> <span class="o">*=</span> <span class="n">new_shape</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">new_shape</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>        <span class="c1"># Calculate the mean distance covered per frame and correct for a ring of not really fading pixels</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_distance_per_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;correct_errors_around_initial&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">%</span> <span class="mi">20</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>                                  <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_growth</span><span class="p">,</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>                                                 <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_growth</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)):</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>                    <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sun</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>                    <span class="n">back</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sun</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>                    <span class="k">for</span> <span class="n">ray</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rays</span><span class="p">:</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>                        <span class="c1"># For each sun&#39;s ray, see how they cross the shape/back and</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>                        <span class="c1"># store the gravity_field value of these pixels (distance to the original shape).</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>                        <span class="n">ray_through_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape</span> <span class="o">==</span> <span class="n">ray</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity_field</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>                        <span class="n">ray_through_back</span> <span class="o">=</span> <span class="p">(</span><span class="n">back</span> <span class="o">==</span> <span class="n">ray</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity_field</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ray_through_shape</span><span class="p">):</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ray_through_back</span><span class="p">):</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>                                <span class="c1"># If at least one back pixel is nearer to the original shape than a shape pixel,</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>                                <span class="c1"># there is a hole to fill.</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>                                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ray_through_back</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ray_through_shape</span><span class="p">[</span><span class="n">ray_through_shape</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])):</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>                                    <span class="c1"># Check if the nearest pixels are shape, if so, supress them until the nearest pixel</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>                                    <span class="c1"># becomes back</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>                                    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ray_through_back</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ray_through_shape</span><span class="p">):</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>                                        <span class="n">ray_through_shape</span><span class="p">[</span><span class="n">ray_through_shape</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ray_through_shape</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>                                    <span class="c1"># Now, all back pixels that are nearer than the closest shape pixel should get filled</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>                                    <span class="c1"># To do so, replace back pixels further than the nearest shape pixel by 0</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>                                    <span class="n">ray_through_back</span><span class="p">[</span><span class="n">ray_through_back</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ray_through_shape</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">holes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ray_through_back</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>                            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">rays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rays</span><span class="p">[:(</span><span class="n">ray</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rays</span><span class="p">[(</span><span class="n">ray</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):]))</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>                        <span class="n">ray_through_shape</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>                        <span class="n">ray_through_back</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_growth</span> <span class="o">*</span> <span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;correct_errors_around_initial&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>                    <span class="c1"># Apply the hole correction</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">holes</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">holes</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>                    <span class="c1"># If some holes are not covered by now</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">holes</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])):</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">holes_time_end</span><span class="p">,</span> <span class="n">distance_against_time</span> <span class="o">=</span> \
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>                            <span class="n">dynamically_expand_to_fill_holes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">holes</span><span class="p">)</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>                        <span class="k">if</span> <span class="n">holes_time_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">holes_time_end</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">holes_time_end</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">holes_time_end</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:][</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">holes_time_end</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>                        <span class="n">distance_against_time</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                    <span class="n">distance_against_time</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                <span class="n">distance_against_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">distance_against_time</span><span class="p">)</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">distance_against_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">mean_distance_per_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">-</span> <span class="n">distance_against_time</span><span class="p">)</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">mean_distance_per_frame</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;prevent_fast_growth_near_periphery&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>            <span class="c1"># growth_near_periphery = np.diff(self.binary[self.t-1:self.t+1, :, :] * self.near_periphery, axis=0)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>            <span class="n">growth_near_periphery</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">growth_near_periphery</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;max_periphery_growth&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>                <span class="c1"># self.binary[self.t, self.near_periphery[0], self.near_periphery[1]] = self.binary[self.t - 1, self.near_periphery[0], self.near_periphery[1]]</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>                <span class="n">periphery_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>                <span class="n">periphery_to_remove</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                <span class="n">shapes</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centers</span> <span class="o">=</span> <span class="n">cc</span><span class="p">(</span><span class="n">periphery_to_remove</span><span class="p">)</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>                <span class="n">periphery_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;max_periphery_growth&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">periphery_to_remove</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">periphery_to_remove</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">periphery_to_remove</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">periphery_to_remove</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>                    <span class="n">shapes</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centers</span> <span class="o">=</span> <span class="n">cc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>                    <span class="n">shapes</span><span class="p">[</span><span class="n">shapes</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapes</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>        <span class="c1"># Display</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>        <span class="k">if</span> <span class="n">show_seg</span><span class="p">:</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>                <span class="n">im_to_display</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>                <span class="n">contours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_GRADIENT</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">))</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>                    <span class="n">im_to_display</span><span class="p">[</span><span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                    <span class="n">im_to_display</span><span class="p">[</span><span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>                <span class="n">im_to_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="mi">255</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>            <span class="n">imtoshow</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">im_to_display</span><span class="p">,</span> <span class="p">(</span><span class="mi">540</span><span class="p">,</span> <span class="mi">540</span><span class="p">))</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;shape_motion&quot;</span><span class="p">,</span> <span class="n">imtoshow</span><span class="p">)</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>            <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_descriptors_from_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">release_memory</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><span class="sd">        Methods: get_descriptors_from_binary</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">        Summary</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">        Generates shape descriptors for binary images, computes these descriptors for each frame and handles colony</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><span class="sd">        tracking. This method can optionally release memory to reduce usage, apply scaling factors to descriptors</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">        in millimeters and computes solidity separately if requested.</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a><span class="sd">        release_memory : bool, optional</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><span class="sd">            Flag to determine whether memory should be released after computation. Default is True.</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a><span class="sd">        Other Parameters</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><span class="sd">        ----------------</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a><span class="sd">        **self.one_row_per_frame**</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><span class="sd">            DataFrame to store one row of descriptors per frame.</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a><span class="sd">            - **&#39;arena&#39;**: Arena identifier, repeated for each frame.</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a><span class="sd">            - **&#39;time&#39;**: Array of time values corresponding to frames.</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a><span class="sd">        **self.binary**</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a><span class="sd">            3D array representing binary images over time.</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a><span class="sd">            - **t,x,y**: Time index, x-coordinate, and y-coordinate.</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><span class="sd">        **self.dims**</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a><span class="sd">            Tuple containing image dimensions.</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a><span class="sd">            - **0**: Number of time frames.</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a><span class="sd">            - **1,2**: Image width and height respectively.</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a><span class="sd">        **self.surfarea**</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a><span class="sd">            Array containing surface areas for each frame.</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><span class="sd">        **self.time_interval**</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><span class="sd">            Time interval between frames, calculated only if provided timings are non-zero.</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a><span class="sd">        This method uses various helper methods and classes like `ShapeDescriptors` for computing shape descriptors,</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a><span class="sd">        `PercentAndTimeTracker` for progress tracking, and other image processing techniques such as connected components analysis.</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>        <span class="c1">##</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>        <span class="k">if</span> <span class="n">release_memory</span><span class="p">:</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gravity_field</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sun</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rays</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">holes</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>            <span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>        <span class="n">timings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;exif&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timings</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>            <span class="n">timings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">timings</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">timings</span><span class="p">))</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span> <span class="o">=</span> <span class="mf">1.</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>        <span class="n">timings</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>        <span class="c1"># Detect first motion</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;first_move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detect_first_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compute_solidity_separately</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;iso_digi_analysis&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;solidity&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_solidity_separately</span><span class="p">:</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">solidity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>            <span class="c1"># solidity must be added if detect growth transition is computed</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_solidity_separately</span><span class="p">:</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>                    <span class="n">solidity</span> <span class="o">=</span> <span class="n">ShapeDescriptors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">solidity</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">solidity</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="n">compute_one_descriptor_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="n">timings</span><span class="p">,</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;output_in_mm&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_specimen&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="n">compute_one_descriptor_per_colony</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="n">timings</span><span class="p">,</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;output_in_mm&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_specimen&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;final_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;output_in_mm&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span> <span class="o">=</span> <span class="n">scale_descriptors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect_growth_transitions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">        Detect growth transitions in a biological image processing context.</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="sd">        Analyzes the growth transitions of a shape within an arena, determining</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a><span class="sd">        whether growth is isotropic and identifying any breaking points.</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a><span class="sd">        Notes:</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">            This method modifies the `one_descriptor_per_arena` dictionary in place</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a><span class="sd">            to include growth transition information.</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;iso_digi_analysis&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;iso_digi_transi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;first_move&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Starting growth transition analysis.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>                <span class="c1"># II) Once a pseudopod is deployed, look for a disk/ around the original shape</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>                <span class="n">growth_begining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span> <span class="o">&lt;</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)))</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>                <span class="n">dilated_origin</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;first_move&#39;</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">kernel</span><span class="o">=</span><span class="n">cross_33</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">borderType</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_CONSTANT</span><span class="p">,</span> <span class="n">borderValue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>                <span class="n">isisotropic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">dilated_origin</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>                <span class="n">isisotropic</span> <span class="o">*=</span> <span class="n">growth_begining</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>                <span class="c1"># Ask if the dilated origin area is 90% covered during the growth beginning</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>                <span class="n">isisotropic</span> <span class="o">=</span> <span class="n">isisotropic</span> <span class="o">&gt;</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">dilated_origin</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">isisotropic</span><span class="p">):</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;is_growth_isotropic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>                    <span class="c1"># Determine a solidity reference to look for a potential breaking of the isotropic growth</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_solidity_separately</span><span class="p">:</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>                        <span class="n">solidity_reference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solidity</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;first_move&#39;</span><span class="p">]])</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>                        <span class="n">different_solidity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solidity</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mf">0.9</span> <span class="o">*</span> <span class="n">solidity_reference</span><span class="p">)</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">solidity</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>                        <span class="n">solidity_reference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;first_move&#39;</span><span class="p">]),</span> <span class="p">:][</span><span class="s2">&quot;solidity&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>                        <span class="n">different_solidity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mf">0.9</span> <span class="o">*</span> <span class="n">solidity_reference</span><span class="p">)</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>                    <span class="c1"># Make sure that isotropic breaking not occur before isotropic growth</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">different_solidity</span><span class="p">):</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;iso_digi_transi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">different_solidity</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;is_growth_isotropic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;is_growth_isotropic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_converted_video_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a><span class="sd">        Check if the converted video type is uint8 and normalize it if necessary.</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s2">&quot;uint8&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">)</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">networks_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_seg</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a><span class="sd">        Perform network detection within a given arena.</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a><span class="sd">        This function carries out the task of detecting networks in an arena</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a><span class="sd">        based on several parameters and variables. It involves checking video</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a><span class="sd">        type, performing network detection over time, potentially detecting</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a><span class="sd">        pseudopods, and smoothing segmentation. The results can be visualized or saved.</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a><span class="sd">Extract and analyze graphs from a binary representation of network dynamics, producing vertex</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a><span class="sd">        and edge tables that represent the graph structure over time.</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a><span class="sd">            None</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a><span class="sd">        Attributes:</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a><span class="sd">            vars (dict): Dictionary of variables that control the graph extraction process.</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a><span class="sd">                - &#39;save_graph&#39;: Boolean indicating if graph extraction should be performed.</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a><span class="sd">                - &#39;save_coord_network&#39;: Boolean indicating if the coordinate network should be saved.</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a><span class="sd">            one_descriptor_per_arena (dict): Dictionary containing descriptors for each arena.</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a><span class="sd">            dims (tuple): Tuple containing dimension information.</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a><span class="sd">                - [0]: Integer representing the number of time steps.</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a><span class="sd">                - [1]: Integer representing the y-dimension size.</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a><span class="sd">                - [2]: Integer representing the x-dimension size.</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a><span class="sd">            origin (np.ndarray): Binary image representing the origin of the network.</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a><span class="sd">            binary (np.ndarray): Binary representation of network dynamics over time.</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a><span class="sd">                Shape: (time_steps, y_dimension, x_dimension).</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a><span class="sd">            converted_video (np.ndarray): Converted video data.</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a><span class="sd">                Shape: (y_dimension, x_dimension, time_steps).</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a><span class="sd">            network_dynamics (np.ndarray): Network dynamics representation.</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a><span class="sd">                Shape: (time_steps, y_dimension, x_dimension).</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a><span class="sd">        Notes:</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a><span class="sd">            - This method performs graph extraction and saves the vertex and edge tables to CSV files.</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><span class="sd">            - The CSV files are named according to the arena, time steps, and dimensions.</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a><span class="sd">            show_seg: bool = False</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a><span class="sd">                A flag that determines whether to display the segmentation visually.</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>        <span class="n">coord_pseudopods</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_converted_video_type</span><span class="p">()</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">,</span> <span class="n">coord_pseudopods</span> <span class="o">=</span> <span class="n">detect_network_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">],</span> <span class="n">show_seg</span><span class="p">)</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">,</span> <span class="n">coord_pseudopods</span> <span class="o">=</span> <span class="n">detect_network_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">],</span> <span class="n">show_seg</span><span class="p">)</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_graph&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">))</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>                <span class="n">extract_graph_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>                                       <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">coord_pseudopods</span><span class="p">)</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>                <span class="n">extract_graph_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>                                       <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">coord_pseudopods</span><span class="p">)</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">study_cytoscillations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_seg</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a><span class="sd">            Study the cytoskeletal oscillations within a video frame by frame.</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a><span class="sd">            This method performs an analysis of cytoskeletal oscillations in the video,</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a><span class="sd">            identifying regions of influx and efflux based on pixel connectivity.</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a><span class="sd">            It also handles memory allocation for the oscillations video, computes</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a><span class="sd">            connected components, and optionally displays the segmented regions.</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a><span class="sd">            Args:</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a><span class="sd">                show_seg (bool): If True, display the segmentation results.</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_thickening_slimming&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;oscilacyto_analysis&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>            <span class="n">oscillations_video</span> <span class="o">=</span> <span class="n">detect_oscillations_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>                                                              <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>                                                              <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;expected_oscillation_period&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>                                                              <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span><span class="p">,</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>                                                              <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;minimal_oscillating_cluster_size&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>                                                              <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;min_ram_free&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>                                                              <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>                                                              <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_thickening_slimming&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>            <span class="k">del</span> <span class="n">oscillations_video</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fractal_descriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a><span class="sd">        Method for analyzing fractal patterns in binary data.</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a><span class="sd">        Fractal analysis is performed on the binary representation of the data,</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a><span class="sd">        optionally considering network dynamics if specified. The results</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a><span class="sd">        include fractal dimensions, R-values, and box counts for the data.</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a><span class="sd">        If network analysis is enabled, additional fractal dimensions,</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a><span class="sd">        R-values, and box counts are calculated for the inner network.</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a><span class="sd">        If &#39;output_in_mm&#39; is True, then values in mm can be obtained.</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_analysis&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Starting fractal analysis.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>                <span class="n">box_counting_dimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">7</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>                <span class="n">box_counting_dimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>                    <span class="n">current_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>                    <span class="n">net_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>                    <span class="n">current_network</span><span class="p">[</span><span class="n">net_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">net_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>                    <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_network</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>                    <span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span> <span class="o">=</span> <span class="n">prepare_box_counting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">min_mesh_side</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>                        <span class="s1">&#39;fractal_box_side_threshold&#39;</span><span class="p">],</span> <span class="n">zoom_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_zoom_step&#39;</span><span class="p">],</span> <span class="n">contours</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>                    <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">box_counting_dimensions</span><span class="p">[</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>                        <span class="n">t</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimension</span><span class="p">(</span><span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>                    <span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span> <span class="o">=</span> <span class="n">prepare_box_counting</span><span class="p">(</span><span class="n">current_network</span><span class="p">,</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>                                                                       <span class="n">min_mesh_side</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>                                                                           <span class="s1">&#39;fractal_box_side_threshold&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>                                                                       <span class="n">zoom_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_zoom_step&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>                                                                       <span class="n">contours</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>                    <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">box_counting_dimensions</span><span class="p">[</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>                        <span class="n">t</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimension</span><span class="p">(</span><span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>                    <span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span> <span class="o">=</span> <span class="n">prepare_box_counting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>                                                                       <span class="n">min_mesh_side</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_box_side_threshold&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>                                                                       <span class="n">zoom_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_zoom_step&#39;</span><span class="p">],</span> <span class="n">contours</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>                    <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">box_counting_dimension</span><span class="p">(</span><span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;inner_network_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_dimension&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_r_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_box_nb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;inner_network_fractal_dimension&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;inner_network_fractal_r_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;inner_network_fractal_box_nb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;output_in_mm&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;inner_network_size&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_dimension&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_box_nb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_r_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_efficiency_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a><span class="sd">        Provide images allowing to assess the analysis efficiency</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><span class="sd">        This method generates two test images used for assessing</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a><span class="sd">        the efficiency of the analysis. It performs various operations on</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a><span class="sd">        video frames to create these images, including copying and manipulating</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a><span class="sd">        frames from the video, detecting contours on binary images,</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a><span class="sd">        and drawing the arena label on the left of the frames.</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>        <span class="c1"># Provide images allowing to assess the analysis efficiency</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>            <span class="n">after_one_tenth_of_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>            <span class="n">after_one_tenth_of_time</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>        <span class="n">last_good_detection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_threshold_segmentation&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>                <span class="n">last_good_detection</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>            <span class="n">last_good_detection</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">),</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>                                             <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_1</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">after_one_tenth_of_time</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_2</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">last_good_detection</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_1</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">[</span><span class="n">after_one_tenth_of_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_2</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">[</span><span class="n">last_good_detection</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>        <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>        <span class="n">contours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">get_contours</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">after_one_tenth_of_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]))</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_1</span><span class="p">[</span><span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_1</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>                                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>                                         <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>        <span class="n">eroded_binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">last_good_detection</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">cross_33</span><span class="p">)</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>        <span class="n">contours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">last_good_detection</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">eroded_binary</span><span class="p">)</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_2</span><span class="p">[</span><span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_2</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>                                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>                                          <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_video</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a><span class="sd">        Save processed video with contours and other annotations.</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a><span class="sd">        This method processes the binary image to extract contours, overlay them</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">        on a video, and save the resulting video file.</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a><span class="sd">        Notes:</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a><span class="sd">            - This method uses OpenCV for image processing and contour extraction.</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a><span class="sd">            - The processed video includes contours colored according to the</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a><span class="sd">              `contour_color` specified in the variables.</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a><span class="sd">            - Additional annotations such as time in minutes are added to each</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a><span class="sd">              frame if applicable.</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_processed_videos&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_converted_video_type</span><span class="p">()</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">),</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>                                                <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>                <span class="n">eroded_binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">cross_33</span><span class="p">)</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>                <span class="n">contours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">eroded_binary</span><span class="p">)</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>                <span class="k">if</span> <span class="s2">&quot;iso_digi_transi&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;iso_digi_analysis&#39;</span><span class="p">]</span>  <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;iso_digi_transi&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;is_growth_isotropic&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>                            <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;iso_digi_transi&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_intensity_per_frame</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">erodila_disk</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>            <span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>                <span class="n">true_frame_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ind_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="o">=</span> <span class="n">video2numpy</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ind_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>                              <span class="kc">None</span><span class="p">,</span> <span class="n">true_frame_width</span><span class="o">=</span><span class="n">true_frame_width</span><span class="p">)</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>                <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step_is_arbitrary&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step_is_arbitrary&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>                    <span class="n">time_unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>                    <span class="n">time_unit</span> <span class="o">=</span> <span class="s2">&quot; min&quot;</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>                    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>                    <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">])</span> <span class="o">+</span> <span class="n">time_unit</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>                    <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">image</span><span class="p">,</span>  <span class="c1"># numpy array on which text is written</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>                                    <span class="n">text</span><span class="p">,</span>  <span class="c1"># text</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>                                    <span class="n">position</span><span class="p">,</span>  <span class="c1"># position at which writing has to start</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>                                    <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span>  <span class="c1"># font family</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>                                    <span class="mi">1</span><span class="p">,</span>  <span class="c1"># font size</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="mi">255</span><span class="p">),</span>  <span class="c1">#(209, 80, 0, 255),  </span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>                                    <span class="mi">2</span><span class="p">)</span>  <span class="c1"># font stroke</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>            <span class="n">vid_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ind_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;videos_extension&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>            <span class="n">write_video</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">vid_name</span><span class="p">,</span> <span class="n">is_color</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;video_fps&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a><span class="sd">        Save the results of testing and video processing.</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a><span class="sd">        This method handles the saving of efficiency tests, video files,</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a><span class="sd">        and CSV data related to test results. It checks for existing files before writing new data.</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a><span class="sd">        Additionally, it cleans up temporary files if configured to do so.</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_efficiency_tests</span><span class="p">()</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_video</span><span class="p">()</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_frame_arena</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>            <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Never let one_row_per_frame_arena</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>            <span class="n">create_new_csv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>                        <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>                <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>                            <span class="n">stats</span><span class="o">.</span><span class="n">iloc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>                            <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>                    <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>                    <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>                <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>            <span class="k">if</span> <span class="n">create_new_csv</span><span class="p">:</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>                    <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">))),</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>                               <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>                    <span class="n">stats</span><span class="o">.</span><span class="n">iloc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>                    <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;keep_unaltered_videos&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ind_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ind_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">change_results_of_one_arena</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_video</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a><span class="sd">        Manages the saving and updating of CSV files based on data extracted from analyzed</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a><span class="sd">        one arena. Specifically handles three CSV files: &quot;one_row_per_arena.csv&quot;,</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a><span class="sd">        &quot;one_row_per_frame.csv&quot;, and &quot;one_row_per_oscillating_cluster.csv&quot;.</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a><span class="sd">        Each file is updated or created based on the presence of existing data.</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a><span class="sd">        The method ensures that each CSV file contains the relevant information for</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a><span class="sd">        the given arena, frame, and oscillator cluster data.</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>        <span class="k">if</span> <span class="n">save_video</span><span class="p">:</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">save_video</span><span class="p">()</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>        <span class="c1"># I/ Update/Create one_row_per_arena.csv</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>        <span class="n">create_new_csv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>                    <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>                <span class="k">for</span> <span class="n">stat_name</span><span class="p">,</span> <span class="n">stat_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>                    <span class="k">if</span> <span class="n">stat_name</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>                        <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="n">stat_name</span><span class="p">])</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>                    <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>            <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>                <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>            <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>        <span class="k">if</span> <span class="n">create_new_csv</span><span class="p">:</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create a new one_row_per_arena.csv file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>                    <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">))),</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>                               <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>                    <span class="n">stats</span><span class="o">.</span><span class="n">iloc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="c1">#  np.array(list(self.one_descriptor_per_arena.values()), dtype=np.uint32)</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>                    <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>            <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>        <span class="c1"># II/ Update/Create one_row_per_frame.csv</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>        <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;one_row_per_frame.csv&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_frame.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>                    <span class="n">descriptors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>                <span class="k">for</span> <span class="n">stat_name</span><span class="p">,</span> <span class="n">stat_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>                    <span class="k">if</span> <span class="n">stat_name</span> <span class="ow">in</span> <span class="n">descriptors</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>                        <span class="n">descriptors</span><span class="o">.</span><span class="n">loc</span><span class="p">[((</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):((</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stat_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">stat_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:]</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_frame.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>                    <span class="n">descriptors</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>            <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_frame.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>                <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>            <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>        <span class="k">if</span> <span class="n">create_new_csv</span><span class="p">:</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create a new one_row_per_frame.csv file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_frame.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>                    <span class="n">descriptors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">))),</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>                               <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>                    <span class="n">descriptors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[((</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):((</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>                    <span class="n">descriptors</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>            <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_frame.csv open when Cellects runs&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">l</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Analyzes motion in a given arena using video data.</p>
<p>This class processes video frames to analyze motion within a specified area,
detecting shapes, covering durations, and generating descriptors for further
analysis.</p>
<p>Args:
    l (list): A list containing various parameters and flags necessary for the motion
        analysis.</p>
<p>Args:
    l[0] (int): Arena index.
    l[1] (str): Arena identifier or name, stored in one_descriptor_per_arena['arena'].
    l[2] (dict): Variables required for the analysis, stored in vars.
    l[3] (bool): Flag to detect shape.
    l[4] (bool): Flag to analyze shape.
    l[5] (bool): Flag to show segmentation.
    l[6] (None or list): Videos already in RAM.</p>
<p>Attributes:
    vars (dict): Variables required for the analysis.
    visu (None): Placeholder for visualization data.
    binary (None): Placeholder for binary segmentation data.
    origin_idx (None): Placeholder for the index of the first frame.
    smoothing_flag (bool): Flag to indicate if smoothing should be applied.
    dims (tuple): Dimensions of the converted video.
    segmentation (ndarray): Array to store segmentation data.
    covering_intensity (ndarray): Intensity values for covering analysis.
    mean_intensity_per_frame (ndarray): Mean intensity per frame.
    borders (object): Borders of the arena.
    pixel_ring_depth (int): Depth of the pixel ring for analysis, default is 9.
    step (int): Step size for processing, default is 10.
    lost_frames (int): Number of lost frames to account for, default is 10.
    start (None or int): Starting frame index for the analysis.</p>
<p>Methods:
    load_images_and_videos(videos_already_in_ram, arena_idx): Loads images and videos
        for the specified arena index.
    update_ring_width(): Updates the width of the pixel ring for analysis.
    get_origin_shape(): Detects the origin shape in the video frames.
    get_covering_duration(step): Calculates the covering duration based on a step size.
    detection(): Performs motion detection within the arena.
    initialize_post_processing(): Initializes post-processing steps.
    update_shape(show_seg): Updates the shape based on segmentation and visualization flags.
    get_descriptors_from_binary(): Extracts descriptors from binary data.
    detect_growth_transitions(): Detects growth transitions in the data.
    networks_analysis(show_seg): Detected networks within the arena based on segmentation
        visualization.
    study_cytoscillations(show_seg): Studies cytoscillations within the arena with
        segmentation visualization.
    fractal_descriptions(): Generates fractal descriptions of the analyzed data.
    get_descriptors_summary(): Summarizes the descriptors obtained from the analysis.
    save_results(): Saves the results of the analysis.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Analyzes motion in a given arena using video data.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    This class processes video frames to analyze motion within a specified area,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    detecting shapes, covering durations, and generating descriptors for further</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    analysis.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        l (list): A list containing various parameters and flags necessary for the motion</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            analysis.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        l[0] (int): Arena index.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        l[1] (str): Arena identifier or name, stored in one_descriptor_per_arena[&#39;arena&#39;].</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        l[2] (dict): Variables required for the analysis, stored in vars.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        l[3] (bool): Flag to detect shape.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        l[4] (bool): Flag to analyze shape.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        l[5] (bool): Flag to show segmentation.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        l[6] (None or list): Videos already in RAM.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        vars (dict): Variables required for the analysis.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        visu (None): Placeholder for visualization data.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        binary (None): Placeholder for binary segmentation data.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        origin_idx (None): Placeholder for the index of the first frame.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        smoothing_flag (bool): Flag to indicate if smoothing should be applied.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        dims (tuple): Dimensions of the converted video.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        segmentation (ndarray): Array to store segmentation data.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        covering_intensity (ndarray): Intensity values for covering analysis.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        mean_intensity_per_frame (ndarray): Mean intensity per frame.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        borders (object): Borders of the arena.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        pixel_ring_depth (int): Depth of the pixel ring for analysis, default is 9.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        step (int): Step size for processing, default is 10.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        lost_frames (int): Number of lost frames to account for, default is 10.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        start (None or int): Starting frame index for the analysis.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Methods:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        load_images_and_videos(videos_already_in_ram, arena_idx): Loads images and videos</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">            for the specified arena index.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        update_ring_width(): Updates the width of the pixel ring for analysis.</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        get_origin_shape(): Detects the origin shape in the video frames.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        get_covering_duration(step): Calculates the covering duration based on a step size.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        detection(): Performs motion detection within the arena.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        initialize_post_processing(): Initializes post-processing steps.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        update_shape(show_seg): Updates the shape based on segmentation and visualization flags.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        get_descriptors_from_binary(): Extracts descriptors from binary data.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        detect_growth_transitions(): Detects growth transitions in the data.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        networks_analysis(show_seg): Detected networks within the arena based on segmentation</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">            visualization.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        study_cytoscillations(show_seg): Studies cytoscillations within the arena with</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">            segmentation visualization.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        fractal_descriptions(): Generates fractal descriptions of the analyzed data.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        get_descriptors_summary(): Summarizes the descriptors obtained from the analysis.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        save_results(): Saves the results of the analysis.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="nb">vars</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">detect_shape</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="n">analyse_shape</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">show_seg</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="n">videos_already_in_ram</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">smoothing_flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start the motion analysis of the arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="nb">vars</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;contour_color&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;background_list&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">load_images_and_videos</span><span class="p">(</span><span class="n">videos_already_in_ram</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">mean_intensity_per_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">borders</span> <span class="o">=</span> <span class="n">image_borders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;arena_shape&#39;</span><span class="p">])</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">=</span> <span class="mi">9</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">update_ring_width</span><span class="p">()</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">if</span> <span class="n">detect_shape</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="c1"># Here to conditional layers allow to detect if an expansion/exploration occured</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_origin_shape</span><span class="p">()</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="c1"># The first, user-defined is the &#39;first_move_threshold&#39; and the second is the detection of the</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="c1"># substantial image: if any of them is not detected, the program considers there is not exp.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">20</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">step</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_covering_duration</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">detection</span><span class="p">()</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">initialize_post_processing</span><span class="p">()</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1">#200:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">(</span><span class="n">show_seg</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="c1">#</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="k">if</span> <span class="n">analyse_shape</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_descriptors_from_binary</span><span class="p">()</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">detect_growth_transitions</span><span class="p">()</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">networks_analysis</span><span class="p">(</span><span class="n">show_seg</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">study_cytoscillations</span><span class="p">(</span><span class="n">show_seg</span><span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fractal_descriptions</span><span class="p">()</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="k">if</span> <span class="n">videos_already_in_ram</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">save_results</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.change_results_of_one_arena" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">change_results_of_one_arena</span><span class="p">(</span><span class="n">save_video</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Manages the saving and updating of CSV files based on data extracted from analyzed
one arena. Specifically handles three CSV files: "one_row_per_arena.csv",
"one_row_per_frame.csv", and "one_row_per_oscillating_cluster.csv".
Each file is updated or created based on the presence of existing data.
The method ensures that each CSV file contains the relevant information for
the given arena, frame, and oscillator cluster data.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1596" name="__codelineno-0-1596"></a><span class="k">def</span><span class="w"> </span><span class="nf">change_results_of_one_arena</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_video</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a><span class="sd">    Manages the saving and updating of CSV files based on data extracted from analyzed</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a><span class="sd">    one arena. Specifically handles three CSV files: &quot;one_row_per_arena.csv&quot;,</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a><span class="sd">    &quot;one_row_per_frame.csv&quot;, and &quot;one_row_per_oscillating_cluster.csv&quot;.</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a><span class="sd">    Each file is updated or created based on the presence of existing data.</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a><span class="sd">    The method ensures that each CSV file contains the relevant information for</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a><span class="sd">    the given arena, frame, and oscillator cluster data.</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>    <span class="k">if</span> <span class="n">save_video</span><span class="p">:</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_video</span><span class="p">()</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>    <span class="c1"># I/ Update/Create one_row_per_arena.csv</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>    <span class="n">create_new_csv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>                <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>            <span class="k">for</span> <span class="n">stat_name</span><span class="p">,</span> <span class="n">stat_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>                <span class="k">if</span> <span class="n">stat_name</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>                    <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="n">stat_name</span><span class="p">])</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>                <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>            <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>        <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>    <span class="k">if</span> <span class="n">create_new_csv</span><span class="p">:</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create a new one_row_per_arena.csv file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>                <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">))),</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>                           <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>                <span class="n">stats</span><span class="o">.</span><span class="n">iloc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="c1">#  np.array(list(self.one_descriptor_per_arena.values()), dtype=np.uint32)</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>                <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>    <span class="c1"># II/ Update/Create one_row_per_frame.csv</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>    <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;one_row_per_frame.csv&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_frame.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>                <span class="n">descriptors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>            <span class="k">for</span> <span class="n">stat_name</span><span class="p">,</span> <span class="n">stat_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>                <span class="k">if</span> <span class="n">stat_name</span> <span class="ow">in</span> <span class="n">descriptors</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>                    <span class="n">descriptors</span><span class="o">.</span><span class="n">loc</span><span class="p">[((</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):((</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stat_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">stat_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:]</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_frame.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>                <span class="n">descriptors</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_frame.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>            <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>        <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>    <span class="k">if</span> <span class="n">create_new_csv</span><span class="p">:</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create a new one_row_per_frame.csv file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_frame.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>                <span class="n">descriptors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">))),</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>                           <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>                <span class="n">descriptors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[((</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):((</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>                <span class="n">descriptors</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_frame.csv open when Cellects runs&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.check_converted_video_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_converted_video_type</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if the converted video type is uint8 and normalize it if necessary.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1265" name="__codelineno-0-1265"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_converted_video_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a><span class="sd">    Check if the converted video type is uint8 and normalize it if necessary.</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s2">&quot;uint8&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.detect_growth_transitions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect_growth_transitions</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Detect growth transitions in a biological image processing context.</p>
<p>Analyzes the growth transitions of a shape within an arena, determining
whether growth is isotropic and identifying any breaking points.</p>
<p>Notes:
    This method modifies the <code>one_descriptor_per_arena</code> dictionary in place
    to include growth transition information.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect_growth_transitions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">    Detect growth transitions in a biological image processing context.</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="sd">    Analyzes the growth transitions of a shape within an arena, determining</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a><span class="sd">    whether growth is isotropic and identifying any breaking points.</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a><span class="sd">    Notes:</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">        This method modifies the `one_descriptor_per_arena` dictionary in place</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a><span class="sd">        to include growth transition information.</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;iso_digi_analysis&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;iso_digi_transi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;first_move&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Starting growth transition analysis.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>            <span class="c1"># II) Once a pseudopod is deployed, look for a disk/ around the original shape</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>            <span class="n">growth_begining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span> <span class="o">&lt;</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)))</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>            <span class="n">dilated_origin</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;first_move&#39;</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">kernel</span><span class="o">=</span><span class="n">cross_33</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">borderType</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_CONSTANT</span><span class="p">,</span> <span class="n">borderValue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>            <span class="n">isisotropic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">dilated_origin</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>            <span class="n">isisotropic</span> <span class="o">*=</span> <span class="n">growth_begining</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>            <span class="c1"># Ask if the dilated origin area is 90% covered during the growth beginning</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>            <span class="n">isisotropic</span> <span class="o">=</span> <span class="n">isisotropic</span> <span class="o">&gt;</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">dilated_origin</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">isisotropic</span><span class="p">):</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;is_growth_isotropic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>                <span class="c1"># Determine a solidity reference to look for a potential breaking of the isotropic growth</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_solidity_separately</span><span class="p">:</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>                    <span class="n">solidity_reference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solidity</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;first_move&#39;</span><span class="p">]])</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>                    <span class="n">different_solidity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solidity</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mf">0.9</span> <span class="o">*</span> <span class="n">solidity_reference</span><span class="p">)</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">solidity</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>                    <span class="n">solidity_reference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;first_move&#39;</span><span class="p">]),</span> <span class="p">:][</span><span class="s2">&quot;solidity&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>                    <span class="n">different_solidity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mf">0.9</span> <span class="o">*</span> <span class="n">solidity_reference</span><span class="p">)</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>                <span class="c1"># Make sure that isotropic breaking not occur before isotropic growth</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">different_solidity</span><span class="p">):</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;iso_digi_transi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">different_solidity</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;is_growth_isotropic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;is_growth_isotropic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.detection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detection</span><span class="p">(</span><span class="n">compute_all_possibilities</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Perform frame-by-frame or luminosity-based segmentation on video data to detect cell motion and growth.</p>
<p>This function processes video frames using either frame-by-frame segmentation or luminosity-based
segmentation algorithms to detect cell motion and growth. It handles drift correction, adjusts parameters
based on configuration settings, and applies logical operations to combine results from different segmentation
methods.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>compute_all_possibilities</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to determine if all segmentation possibilities should be computed, by default False</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function modifies the instance variables <code>self.segmented</code>, <code>self.converted_video</code>,
and potentially <code>self.luminosity_segmentation</code> and <code>self.gradient_segmentation</code>.
Depending on the configuration settings, it performs various segmentation algorithms and updates
the instance variables accordingly.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="k">def</span><span class="w"> </span><span class="nf">detection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compute_all_possibilities</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        Perform frame-by-frame or luminosity-based segmentation on video data to detect cell motion and growth.</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        This function processes video frames using either frame-by-frame segmentation or luminosity-based</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        segmentation algorithms to detect cell motion and growth. It handles drift correction, adjusts parameters</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        based on configuration settings, and applies logical operations to combine results from different segmentation</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        methods.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">        compute_all_possibilities : bool, optional</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">            Flag to determine if all segmentation possibilities should be computed, by default False</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">        -------</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">        None</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        -----</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">        This function modifies the instance variables `self.segmented`, `self.converted_video`,</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">        and potentially `self.luminosity_segmentation` and `self.gradient_segmentation`.</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">        Depending on the configuration settings, it performs various segmentation algorithms and updates</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">        the instance variables accordingly.</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="c1"># I/ Image by image segmentation algorithms</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="c1"># If images contain a drift correction (zeros at borders of the image,</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="c1"># Replace these 0 by normal background values before segmenting</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;frame_by_frame_segmentation&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">compute_all_possibilities</span><span class="p">:</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Detect cell motion and growth using the frame by frame segmentation algorithm&quot;</span><span class="p">)</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span><span class="c1">#20):#</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="n">analysisi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_by_frame_segmentation</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysisi</span><span class="o">.</span><span class="n">binary_image</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">analysisi</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysisi</span><span class="o">.</span><span class="n">image</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">analysisi</span><span class="o">.</span><span class="n">image2</span><span class="p">)</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysisi</span><span class="o">.</span><span class="n">image2</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;color_number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum_value_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">do_threshold_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_threshold_segmentation&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">compute_all_possibilities</span><span class="p">)</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_pixel_slopes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_slope_segmentation&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">compute_all_possibilities</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum_slope_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="k">if</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                <span class="n">gradient_segmentation</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">gradient_segmentation</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_threshold_segmentation&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">compute_all_possibilities</span><span class="p">:</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                <span class="n">luminosity_segmentation2</span><span class="p">,</span> <span class="n">l_threshold_over_time2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum_value_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">,</span> <span class="n">do_threshold_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>                <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                    <span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="n">luminosity_segmentation2</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Or&#39;</span><span class="p">:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                        <span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">luminosity_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;And&#39;</span><span class="p">:</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                        <span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">luminosity_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Xor&#39;</span><span class="p">:</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>                        <span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">luminosity_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_pixel_slopes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">)</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_slope_segmentation&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">compute_all_possibilities</span><span class="p">:</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>                <span class="n">gradient_segmentation2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum_slope_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>                <span class="k">if</span> <span class="n">gradient_segmentation2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>                    <span class="n">gradient_segmentation2</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">gradient_segmentation2</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>                <span class="k">if</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>                    <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">gradient_segmentation2</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>                <span class="k">if</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Or&#39;</span><span class="p">:</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>                        <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">gradient_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;And&#39;</span><span class="p">:</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>                        <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">gradient_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Xor&#39;</span><span class="p">:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>                        <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">gradient_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation2</span><span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="k">if</span> <span class="n">compute_all_possibilities</span><span class="p">:</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Compute all options to detect cell motion and growth. Maximal growth per frame: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;maximal_growth_factor&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="k">if</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">gradient_segmentation</span><span class="p">)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logical_and</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation</span><span class="p">))</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logical_or</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation</span><span class="p">))</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;frame_by_frame_segmentation&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_threshold_segmentation&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_slope_segmentation&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Detect with luminosity threshold segmentation algorithm&quot;</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">luminosity_segmentation</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_slope_segmentation&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Detect with luminosity slope segmentation algorithm&quot;</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">gradient_segmentation</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_threshold_segmentation&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_slope_segmentation&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;true_if_use_light_AND_slope_else_OR&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Detection resuts from threshold AND slope segmentation algorithms&quot;</span><span class="p">)</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>                    <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation</span><span class="p">)</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Detection resuts from threshold OR slope segmentation algorithms&quot;</span><span class="p">)</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                    <span class="k">if</span> <span class="n">luminosity_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gradient_segmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">gradient_segmentation</span><span class="p">)</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.fractal_descriptions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fractal_descriptions</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method for analyzing fractal patterns in binary data.</p>
<p>Fractal analysis is performed on the binary representation of the data,
optionally considering network dynamics if specified. The results
include fractal dimensions, R-values, and box counts for the data.</p>
<p>If network analysis is enabled, additional fractal dimensions,
R-values, and box counts are calculated for the inner network.
If 'output_in_mm' is True, then values in mm can be obtained.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1367" name="__codelineno-0-1367"></a><span class="k">def</span><span class="w"> </span><span class="nf">fractal_descriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a><span class="sd">    Method for analyzing fractal patterns in binary data.</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a><span class="sd">    Fractal analysis is performed on the binary representation of the data,</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a><span class="sd">    optionally considering network dynamics if specified. The results</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a><span class="sd">    include fractal dimensions, R-values, and box counts for the data.</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a><span class="sd">    If network analysis is enabled, additional fractal dimensions,</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a><span class="sd">    R-values, and box counts are calculated for the inner network.</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a><span class="sd">    If &#39;output_in_mm&#39; is True, then values in mm can be obtained.</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_analysis&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Starting fractal analysis.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>            <span class="n">box_counting_dimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">7</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>            <span class="n">box_counting_dimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>                <span class="n">current_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>                <span class="n">net_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>                <span class="n">current_network</span><span class="p">[</span><span class="n">net_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">net_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>                <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_network</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>                <span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span> <span class="o">=</span> <span class="n">prepare_box_counting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">min_mesh_side</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>                    <span class="s1">&#39;fractal_box_side_threshold&#39;</span><span class="p">],</span> <span class="n">zoom_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_zoom_step&#39;</span><span class="p">],</span> <span class="n">contours</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>                <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">box_counting_dimensions</span><span class="p">[</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>                    <span class="n">t</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimension</span><span class="p">(</span><span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>                <span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span> <span class="o">=</span> <span class="n">prepare_box_counting</span><span class="p">(</span><span class="n">current_network</span><span class="p">,</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>                                                                   <span class="n">min_mesh_side</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>                                                                       <span class="s1">&#39;fractal_box_side_threshold&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>                                                                   <span class="n">zoom_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_zoom_step&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>                                                                   <span class="n">contours</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>                <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">box_counting_dimensions</span><span class="p">[</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>                    <span class="n">t</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimension</span><span class="p">(</span><span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>                <span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span> <span class="o">=</span> <span class="n">prepare_box_counting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>                                                                   <span class="n">min_mesh_side</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_box_side_threshold&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>                                                                   <span class="n">zoom_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_zoom_step&#39;</span><span class="p">],</span> <span class="n">contours</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>                <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">box_counting_dimension</span><span class="p">(</span><span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;inner_network_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_dimension&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_r_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_box_nb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;inner_network_fractal_dimension&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;inner_network_fractal_r_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;inner_network_fractal_box_nb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;output_in_mm&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;inner_network_size&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_dimension&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_box_nb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_r_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.frame_by_frame_segmentation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">frame_by_frame_segmentation</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">previous_binary_image</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Frame-by-frame segmentation of a video.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time index of the frame to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>previous_binary_image</code>
            </td>
            <td>
                  <code><span title="cellects.image_analysis.network_functions.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The binary image from the previous frame. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="OneImageAnalysis (cellects.core.one_image_analysis.OneImageAnalysis)" href="../one_image_analysis/#cellects.core.one_image_analysis.OneImageAnalysis">OneImageAnalysis</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An object containing the analysis of the current frame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="k">def</span><span class="w"> </span><span class="nf">frame_by_frame_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">previous_binary_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">    Frame-by-frame segmentation of a video.</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">    t : int</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">        The time index of the frame to process.</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">    previous_binary_image : NDArray, optional</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">        The binary image from the previous frame. Default is `None`.</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">    -------</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    OneImageAnalysis</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">        An object containing the analysis of the current frame.</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="n">contrasted_im</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="c1"># 1. Get the mask valid for a number of images around it (step).</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>    <span class="n">allowed_window</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>        <span class="n">half_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="n">t_start</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">half_step</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="n">t_end</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">half_step</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="n">t_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">t_start</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>        <span class="n">t_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">t_end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="n">allowed_window</span> <span class="o">=</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="n">analysisi</span> <span class="o">=</span> <span class="n">OneImageAnalysis</span><span class="p">(</span><span class="n">contrasted_im</span><span class="p">)</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="n">contrasted_im2</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="n">analysisi</span><span class="o">.</span><span class="n">image2</span> <span class="o">=</span> <span class="n">contrasted_im2</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>    <span class="k">if</span> <span class="n">previous_binary_image</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>        <span class="n">analysisi</span><span class="o">.</span><span class="n">previous_binary_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="n">analysisi</span><span class="o">.</span><span class="n">previous_binary_image</span> <span class="o">=</span> <span class="n">previous_binary_image</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>    <span class="n">analysisi</span><span class="o">.</span><span class="n">segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;color_number&#39;</span><span class="p">],</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>                           <span class="n">bio_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;bio_label&quot;</span><span class="p">],</span> <span class="n">bio_label2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;bio_label2&quot;</span><span class="p">],</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                           <span class="n">rolling_window_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;rolling_window_segmentation&#39;</span><span class="p">],</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                           <span class="n">lighter_background</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">],</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>                           <span class="n">allowed_window</span><span class="o">=</span><span class="n">allowed_window</span><span class="p">,</span> <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;filter_spec&#39;</span><span class="p">])</span> <span class="c1"># filtering already done when creating converted_video</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="k">return</span> <span class="n">analysisi</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.get_covering_duration" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_covering_duration</span><span class="p">(</span><span class="n">step</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine the number of frames necessary for a pixel to get covered.</p>
<p>This function identifies the time when significant growth or motion occurs
in a video and calculates the number of frames needed for a pixel to be
completely covered. It also handles noise and ensures that the calculated
step value is reasonable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial step size for frame analysis.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If an error occurs during the calculation process.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function may modify several instance attributes including
<code>substantial_time</code>, <code>step</code>, and <code>start</code>.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_covering_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">    Determine the number of frames necessary for a pixel to get covered.</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    This function identifies the time when significant growth or motion occurs</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">    in a video and calculates the number of frames needed for a pixel to be</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">    completely covered. It also handles noise and ensures that the calculated</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">    step value is reasonable.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    step : int</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        The initial step size for frame analysis.</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    ------</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">    Exception</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">        If an error occurs during the calculation process.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    -----</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    This function may modify several instance attributes including</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    `substantial_time`, `step`, and `start`.</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Find a frame with a significant growth/motion and determine the number of frames necessary for a pixel to get covered&quot;</span><span class="p">)</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="c1">## Find the time at which growth reached a substantial growth.</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="c1"># To avoid noisy images to have deleterious effects, make sure that area area reaches the threshold thrice.</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="n">occurrence</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="n">allowed_window</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="n">allowed_window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>    <span class="n">prev_bin_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">occurrence</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">step</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">+=</span> <span class="n">step</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="n">growth_vision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_by_frame_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="n">prev_bin_im</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="n">prev_bin_im</span> <span class="o">=</span> <span class="n">growth_vision</span><span class="o">.</span><span class="n">binary_image</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="n">surfarea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prev_bin_im</span><span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">prev_bin_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">prev_bin_im</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="k">if</span> <span class="n">surfarea</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_growth</span><span class="p">:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="n">occurrence</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="c1"># get a rough idea of the area covered during this time</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="n">growth</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">-</span> <span class="mi">10</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="n">growth</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span> <span class="o">-</span> <span class="mi">10</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="n">growth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="n">growth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="n">intensity_extent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="n">growth</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">growth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">intensity_extent</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">intensity_extent</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="n">growth</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">growth</span><span class="p">)</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="n">growth</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="n">growth_vision</span> <span class="o">=</span> <span class="n">OneImageAnalysis</span><span class="p">(</span><span class="n">growth</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="n">growth_vision</span><span class="o">.</span><span class="n">segmentation</span><span class="p">(</span><span class="n">allowed_window</span><span class="o">=</span><span class="n">allowed_window</span><span class="p">)</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="n">do_erode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="n">do_erode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">50</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="k">if</span> <span class="n">do_erode</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="n">growth_vision</span><span class="o">.</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span> <span class="o">=</span> <span class="n">growth_vision</span><span class="o">.</span><span class="n">binary_image</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span><span class="p">):</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="n">natural_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">intensity_extent</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">intensity_extent</span><span class="p">))</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="n">natural_noise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="n">natural_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">natural_noise</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">natural_noise</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">natural_noise</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="n">natural_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">natural_noise</span><span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="n">subst_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span><span class="p">)</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="n">cover_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subst_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subst_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="n">vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="n">subst_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">],</span> <span class="n">subst_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">index</span><span class="p">]]</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">find_major_incline</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">natural_noise</span><span class="p">)</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="c1"># If find_major_incline did find a major incline: (otherwise it put 0 to left and 1 to right)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">left</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">right</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                <span class="n">cover_lengths</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="o">-</span><span class="n">right</span><span class="p">])</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="c1"># If this analysis fails put a deterministic step</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cover_lengths</span><span class="p">[</span><span class="n">cover_lengths</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cover_lengths</span><span class="p">[</span><span class="n">cover_lengths</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Pre-processing detection: the time for a pixel to get covered is set to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Pre-processing detection: could not automatically find the time for a pixel to get covered. Default value is 1 for video length &lt; 40 and 10 otherwise&quot;</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="c1"># Make sure to avoid a step overestimation</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">20</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="c1"># When the first_move_threshold is not stringent enough the program may detect a movement due to noise</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="c1"># In that case, the substantial_image is empty and there is no reason to proceed further</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.get_descriptors_from_binary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_descriptors_from_binary</span><span class="p">(</span><span class="n">release_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Methods: get_descriptors_from_binary</p>


<details class="summary" open>
  <summary>Summary</summary>
  <p>Generates shape descriptors for binary images, computes these descriptors for each frame and handles colony
tracking. This method can optionally release memory to reduce usage, apply scaling factors to descriptors
in millimeters and computes solidity separately if requested.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>release_memory</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to determine whether memory should be released after computation. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Other Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>**self</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame to store one row of descriptors per frame.
- <strong>'arena'</strong>: Arena identifier, repeated for each frame.
- <strong>'time'</strong>: Array of time values corresponding to frames.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**self</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>3D array representing binary images over time.
- <strong>t,x,y</strong>: Time index, x-coordinate, and y-coordinate.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**self</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple containing image dimensions.
- <strong>0</strong>: Number of time frames.
- <strong>1,2</strong>: Image width and height respectively.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**self</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array containing surface areas for each frame.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**self</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time interval between frames, calculated only if provided timings are non-zero.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method uses various helper methods and classes like <code>ShapeDescriptors</code> for computing shape descriptors,
<code>PercentAndTimeTracker</code> for progress tracking, and other image processing techniques such as connected components analysis.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1125" name="__codelineno-0-1125"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_descriptors_from_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">release_memory</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><span class="sd">    Methods: get_descriptors_from_binary</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">    Summary</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">    Generates shape descriptors for binary images, computes these descriptors for each frame and handles colony</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><span class="sd">    tracking. This method can optionally release memory to reduce usage, apply scaling factors to descriptors</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">    in millimeters and computes solidity separately if requested.</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a><span class="sd">    release_memory : bool, optional</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><span class="sd">        Flag to determine whether memory should be released after computation. Default is True.</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a><span class="sd">    Other Parameters</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><span class="sd">    ----------------</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a><span class="sd">    **self.one_row_per_frame**</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><span class="sd">        DataFrame to store one row of descriptors per frame.</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a><span class="sd">        - **&#39;arena&#39;**: Arena identifier, repeated for each frame.</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a><span class="sd">        - **&#39;time&#39;**: Array of time values corresponding to frames.</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a><span class="sd">    **self.binary**</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a><span class="sd">        3D array representing binary images over time.</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a><span class="sd">        - **t,x,y**: Time index, x-coordinate, and y-coordinate.</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><span class="sd">    **self.dims**</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a><span class="sd">        Tuple containing image dimensions.</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a><span class="sd">        - **0**: Number of time frames.</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a><span class="sd">        - **1,2**: Image width and height respectively.</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a><span class="sd">    **self.surfarea**</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a><span class="sd">        Array containing surface areas for each frame.</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><span class="sd">    **self.time_interval**</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><span class="sd">        Time interval between frames, calculated only if provided timings are non-zero.</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a><span class="sd">    This method uses various helper methods and classes like `ShapeDescriptors` for computing shape descriptors,</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a><span class="sd">    `PercentAndTimeTracker` for progress tracking, and other image processing techniques such as connected components analysis.</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>    <span class="c1">##</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>    <span class="k">if</span> <span class="n">release_memory</span><span class="p">:</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gravity_field</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sun</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rays</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">holes</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>        <span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>    <span class="n">timings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;exif&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timings</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>        <span class="n">timings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">timings</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">timings</span><span class="p">))</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span> <span class="o">=</span> <span class="mf">1.</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>    <span class="n">timings</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>    <span class="c1"># Detect first motion</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;first_move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detect_first_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">compute_solidity_separately</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;iso_digi_analysis&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;solidity&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_solidity_separately</span><span class="p">:</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solidity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>        <span class="c1"># solidity must be added if detect growth transition is computed</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_solidity_separately</span><span class="p">:</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>                <span class="n">solidity</span> <span class="o">=</span> <span class="n">ShapeDescriptors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">solidity</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">solidity</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="n">compute_one_descriptor_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="n">timings</span><span class="p">,</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;output_in_mm&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_specimen&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="n">compute_one_descriptor_per_colony</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="n">timings</span><span class="p">,</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;output_in_mm&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_specimen&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;final_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;output_in_mm&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span> <span class="o">=</span> <span class="n">scale_descriptors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.get_origin_shape" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_origin_shape</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine the origin shape and initialize variables based on the state of the current analysis.</p>
<p>This method analyzes the initial frame or frames to determine the origin shape
of an object in a video, initializing necessary variables and matrices for
further processing.</p>
<p>Attributes Modified:
    start: (int) Indicates the starting frame index.
    origin_idx: (np.ndarray) The indices of non-zero values in the origin matrix.
    covering_intensity: (np.ndarray) Matrix used for pixel fading intensity.
    substantial_growth: (int) Represents a significant growth measure based on the origin.</p>
<p>Notes:
    - The method behavior varies if 'origin_state' is set to "constant" or not.
    - If the background is lighter, 'covering_intensity' matrix is initialized.
    - Uses connected components to determine which shape is closest to the center
      or largest, based on 'appearance_detection_method'.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_origin_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    Determine the origin shape and initialize variables based on the state of the current analysis.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    This method analyzes the initial frame or frames to determine the origin shape</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    of an object in a video, initializing necessary variables and matrices for</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    further processing.</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    Attributes Modified:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        start: (int) Indicates the starting frame index.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        origin_idx: (np.ndarray) The indices of non-zero values in the origin matrix.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        covering_intensity: (np.ndarray) Matrix used for pixel fading intensity.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        substantial_growth: (int) Represents a significant growth measure based on the origin.</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    Notes:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">        - The method behavior varies if &#39;origin_state&#39; is set to &quot;constant&quot; or not.</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">        - If the background is lighter, &#39;covering_intensity&#39; matrix is initialized.</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        - Uses connected components to determine which shape is closest to the center</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">          or largest, based on &#39;appearance_detection_method&#39;.</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Make sure of origin shape&quot;</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="k">for</span> <span class="n">frame_i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># 100):#</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="n">true_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">frame_i</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[</span><span class="n">frame_i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">true_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">true_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">true_pixels</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">true_pixels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Drift correction has been wrongly detected. Images do not contain zero-valued pixels&quot;</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="c1"># Initialize the covering_intensity matrix as a reference for pixel fading</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">200</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="n">analysisi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_by_frame_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">analysisi</span><span class="o">.</span><span class="n">binary_image</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="n">analysisi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_by_frame_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="c1"># Use connected components to find which shape is the nearest from the image center.</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">analysisi</span><span class="o">.</span><span class="n">binary_image</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="n">nb_components</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centroids</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="n">analysisi</span><span class="o">.</span><span class="n">binary_image</span><span class="p">,</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>                                                                                       <span class="n">connectivity</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;appearance_detection_method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;most_central&#39;</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                <span class="n">stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nb_components</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="k">for</span> <span class="n">shape_i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_components</span><span class="p">):</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                    <span class="n">stats</span><span class="p">[</span><span class="n">shape_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eudist</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">centroids</span><span class="p">[</span><span class="n">shape_i</span><span class="p">,</span> <span class="p">:])</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                <span class="c1"># The shape having the minimal euclidean distance from the center will be the original shape</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="n">output</span> <span class="o">==</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;appearance_detection_method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;largest&#39;</span><span class="p">:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="n">output</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">4</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">substantial_growth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="mf">1.2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">250</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.initialize_post_processing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_post_processing</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize post-processing for video analysis.</p>
<p>This function initializes various parameters and prepares the binary
representation used in post-processing of video data. It logs information about
the settings, handles initial origin states, sets up segmentation data,
calculates surface areas, and optionally corrects errors around the initial
shape or prevents fast growth near the periphery.</p>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function performs several initialization steps and logs relevant information,
including handling different origin states, updating segmentation data, and
calculating the gravity field based on binary representation.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize_post_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a><span class="sd">    Initialize post-processing for video analysis.</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a><span class="sd">    This function initializes various parameters and prepares the binary</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">    representation used in post-processing of video data. It logs information about</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a><span class="sd">    the settings, handles initial origin states, sets up segmentation data,</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a><span class="sd">    calculates surface areas, and optionally corrects errors around the initial</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a><span class="sd">    shape or prevents fast growth near the periphery.</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a><span class="sd">    -----</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a><span class="sd">    This function performs several initialization steps and logs relevant information,</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="sd">    including handling different origin states, updating segmentation data, and</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="sd">    calculating the gravity field based on binary representation.</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>    <span class="c1">## Initialization</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Starting Post_processing. Fading detection: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fading&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Subtract background: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;subtract_background&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Correct errors around initial shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;correct_errors_around_initial&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Connect distant shapes: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;detection_range_factor&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="si">}</span><span class="s2">, How to select appearing cell(s): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;appearance_detection_method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unaltered videos deprecated, they have been created with different settings.</span><span class="se">\n</span><span class="s2">Delete .npy videos and Data to run Cellects quickly.pkl and re-run&quot;</span><span class="p">)</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;invisible&quot;</span><span class="p">:</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;fluctuating&quot;</span><span class="p">:</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">:</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>            <span class="n">frames_to_assess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">):</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>                <span class="c1"># Only keep pixels that are always detected</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>                <span class="n">always_found</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">:(</span><span class="n">t</span> <span class="o">+</span> <span class="n">frames_to_assess</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>                <span class="n">always_found</span> <span class="o">=</span> <span class="n">always_found</span> <span class="o">==</span> <span class="n">frames_to_assess</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>                <span class="c1"># Remove too small shapes</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>                <span class="n">without_small</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centro</span> <span class="o">=</span> <span class="n">cc</span><span class="p">(</span><span class="n">always_found</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>                <span class="n">large_enough</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">large_enough</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                    <span class="n">always_found</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">always_found</span><span class="p">,</span> <span class="n">large_enough</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>                    <span class="n">always_found</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">always_found</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">always_found</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">mean_distance_per_frame</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">gravity_field</span> <span class="o">=</span> <span class="n">inverted_distance_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>                                       <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:])))</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;correct_errors_around_initial&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rays</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sun</span> <span class="o">=</span> <span class="n">draw_me_a_sun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">ray_length_coef</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># plt.imshow(sun)</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">holes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">+=</span> <span class="mi">2</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_ring_width</span><span class="p">()</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;prevent_fast_growth_near_periphery&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;arena_shape&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;circle&#39;</span><span class="p">:</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>            <span class="n">periphery_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;periphery_width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>            <span class="n">elliperiphery</span> <span class="o">=</span> <span class="n">create_ellipse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">periphery_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">periphery_width</span><span class="p">)</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>            <span class="n">half_width</span> <span class="o">=</span> <span class="n">periphery_width</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>            <span class="k">if</span> <span class="n">periphery_width</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="n">half_width</span><span class="p">:</span><span class="o">-</span><span class="n">half_width</span><span class="p">,</span> <span class="n">half_width</span><span class="p">:</span><span class="o">-</span><span class="n">half_width</span><span class="p">]</span> <span class="o">=</span> <span class="n">elliperiphery</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="n">half_width</span><span class="p">:</span><span class="o">-</span><span class="n">half_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">half_width</span><span class="p">:</span><span class="o">-</span><span class="n">half_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">elliperiphery</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;periphery_width&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;periphery_width&#39;</span><span class="p">]:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;periphery_width&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;periphery_width&#39;</span><span class="p">]:]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.load_images_and_videos" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_images_and_videos</span><span class="p">(</span><span class="n">videos_already_in_ram</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load images and videos from disk or RAM.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>videos_already_in_ram</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Video data that is already loaded into RAM. If <code>None</code>, videos will be
loaded from disk.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>i</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index used to select the origin and background data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method logs information about the arena number and loads necessary data
from disk or RAM based on whether videos are already in memory. It sets various
attributes like <code>self.origin</code>, <code>self.background</code>, and <code>self.converted_video</code>.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_images_and_videos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">videos_already_in_ram</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    Load images and videos from disk or RAM.</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    videos_already_in_ram : numpy.ndarray or None</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        Video data that is already loaded into RAM. If `None`, videos will be</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        loaded from disk.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    i : int</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        Index used to select the origin and background data.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    -----</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    This method logs information about the arena number and loads necessary data</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    from disk or RAM based on whether videos are already in memory. It sets various</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    attributes like `self.origin`, `self.background`, and `self.converted_video`.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Load images and videos&quot;</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_list&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># self.vars[&#39;origins_list&#39;][i]</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="n">true_frame_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="n">vid_name</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;video_list&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="n">vid_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;video_list&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">background2</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="k">if</span> <span class="s1">&#39;background_list2&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list2&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">background2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="n">vids</span> <span class="o">=</span> <span class="n">read_one_arena</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;already_greyscale&#39;</span><span class="p">],</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                          <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span> <span class="n">videos_already_in_ram</span><span class="p">,</span> <span class="n">true_frame_width</span><span class="p">,</span> <span class="n">vid_name</span><span class="p">,</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                          <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background2</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span> <span class="o">=</span> <span class="n">vids</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Convert the RGB visu video into a greyscale image using the color space combination: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">vids</span> <span class="o">=</span> <span class="n">convert_subtract_and_filter_video</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                                                 <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background2</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                                                 <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">],</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                                                 <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;filter_spec&#39;</span><span class="p">])</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video2</span> <span class="o">=</span> <span class="n">vids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.lum_slope_segmentation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lum_slope_segmentation</span><span class="p">(</span><span class="n">converted_video</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Perform lum slope segmentation on the given video.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>converted_video</code>
            </td>
            <td>
                  <code><span title="cellects.image_analysis.network_functions.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input video array for segmentation processing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cellects.image_analysis.network_functions.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Segmented gradient array of the video. If segmentation fails,
returns <code>None</code> for the corresponding frames.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function may consume significant memory and adjusts
data types (float32 or float64) based on available RAM.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">lum_slope_segmentation</span><span class="p">(</span><span class="n">converted_video</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="k">def</span><span class="w"> </span><span class="nf">lum_slope_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">    Perform lum slope segmentation on the given video.</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">    converted_video : NDArray</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">        The input video array for segmentation processing.</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">    -------</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">    NDArray</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">        Segmented gradient array of the video. If segmentation fails,</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">        returns `None` for the corresponding frames.</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">    -----</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="sd">    This function may consume significant memory and adjusts</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">    data types (float32 or float64) based on available RAM.</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">    --------</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">    &gt;&gt;&gt; result = lum_slope_segmentation(converted_video)</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>    <span class="n">shape_motion_failed</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>    <span class="c1"># 2) Contrast increase</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>    <span class="n">oridx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>    <span class="n">notoridx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>    <span class="n">do_increase_contrast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">oridx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oridx</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>            <span class="n">converted_video</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">notoridx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">notoridx</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>    <span class="n">necessary_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">1.16415e-10</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>    <span class="n">available_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">available</span> <span class="o">&gt;&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;min_ram_free&#39;</span><span class="p">]</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>        <span class="n">derive</span> <span class="o">=</span> <span class="n">converted_video</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>        <span class="n">derive</span> <span class="o">=</span> <span class="n">converted_video</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>    <span class="k">if</span> <span class="n">necessary_memory</span> <span class="o">&gt;</span> <span class="n">available_memory</span><span class="p">:</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>        <span class="n">converted_video</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>    <span class="k">if</span> <span class="n">do_increase_contrast</span><span class="p">:</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>        <span class="n">derive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">derive</span><span class="p">)</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>    <span class="c1"># 3) Get the gradient</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>    <span class="n">necessary_memory</span> <span class="o">=</span> <span class="n">derive</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">1.16415e-10</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>    <span class="n">available_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">available</span> <span class="o">&gt;&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;min_ram_free&#39;</span><span class="p">]</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>    <span class="k">if</span> <span class="n">necessary_memory</span> <span class="o">&gt;</span> <span class="n">available_memory</span><span class="p">:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>        <span class="k">for</span> <span class="n">cy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>                    <span class="n">derive</span><span class="p">[:,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">derive</span><span class="p">[:,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>                    <span class="n">derive</span><span class="p">[:,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">derive</span><span class="p">[:,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>            <span class="n">derive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>            <span class="n">derive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>    <span class="c1"># 4) Segment</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>        <span class="n">covering_slopes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">derive</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>        <span class="n">covering_slopes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">derive</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>    <span class="n">covering_slopes</span> <span class="o">=</span> <span class="n">covering_slopes</span><span class="p">[</span><span class="n">covering_slopes</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">covering_slopes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>        <span class="n">shape_motion_failed</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>    <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">shape_motion_failed</span><span class="p">:</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>        <span class="n">gradient_segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="c1">####</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="c1"># ease_slope_segmentation = 0.8</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="n">value_segmentation_thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="n">validated_thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">value_segmentation_thresholds</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="n">while_condition</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="n">max_motion_per_frame</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;maximal_growth_factor&#39;</span><span class="p">]</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="c1"># Try different values of do_slope_segmentation and keep the one that does not</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="c1"># segment more than x percent of the image</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="n">value_segmentation_thresholds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>            <span class="n">ease_slope_segmentation</span> <span class="o">=</span> <span class="n">value_segmentation_thresholds</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>                <span class="n">gradient_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ease_slope_segmentation</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covering_slopes</span><span class="p">)</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>                <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">derive</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">],</span> <span class="n">gradient_threshold</span><span class="p">)</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>                <span class="n">gradient_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ease_slope_segmentation</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covering_slopes</span><span class="p">)</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>                <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">derive</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">],</span> <span class="n">gradient_threshold</span><span class="p">)</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>            <span class="n">changing_pixel_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>            <span class="n">validation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="n">max_motion_per_frame</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">changing_pixel_number</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_motion_per_frame</span><span class="p">)</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>            <span class="n">validated_thresholds</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">validated_thresholds</span><span class="p">):</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">validation</span><span class="p">:</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>                    <span class="k">break</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>            <span class="c1"># If any threshold is accepted, use their average to proceed the final thresholding</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>        <span class="n">valid_number</span> <span class="o">=</span> <span class="n">validated_thresholds</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>        <span class="k">if</span> <span class="n">valid_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>            <span class="k">if</span> <span class="n">valid_number</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>                <span class="n">index_to_keep</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>                <span class="n">index_to_keep</span> <span class="o">=</span> <span class="n">valid_number</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>            <span class="n">ease_slope_segmentation</span> <span class="o">=</span> <span class="n">value_segmentation_thresholds</span><span class="p">[</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>                <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">validated_thresholds</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">index_to_keep</span><span class="p">])))]</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                <span class="n">gradient_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ease_slope_segmentation</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covering_slopes</span><span class="p">)</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                <span class="n">gradient_segmentation</span><span class="p">[:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="n">gradient_threshold</span><span class="p">)[</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                <span class="n">gradient_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ease_slope_segmentation</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covering_slopes</span><span class="p">)</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                <span class="n">gradient_segmentation</span><span class="p">[:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="n">gradient_threshold</span><span class="p">)[</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>                <span class="n">gradient_segmentation</span><span class="p">[:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">derive</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                <span class="n">gradient_segmentation</span><span class="p">[:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">derive</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">derive</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>    <span class="k">return</span> <span class="n">gradient_segmentation</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.lum_value_segmentation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lum_value_segmentation</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">do_threshold_segmentation</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Perform segmentation based on luminosity values from a video.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>converted_video</code>
            </td>
            <td>
                  <code><span title="cellects.image_analysis.network_functions.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input video data in a NumPy array format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>do_threshold_segmentation</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to determine whether threshold segmentation should be applied.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cellects.image_analysis.network_functions.Tuple">Tuple</span>[<span title="cellects.image_analysis.network_functions.NDArray">NDArray</span>, <span title="cellects.image_analysis.network_functions.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing two NumPy arrays:
- The first array is the luminosity segmentation of the video.
- The second array represents the luminosity threshold over time.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function operates under the assumption that there is sufficient motion in the video data.
If no valid thresholds are found for segmentation, the function returns None for
<code>luminosity_segmentation</code>.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="k">def</span><span class="w"> </span><span class="nf">lum_value_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">do_threshold_segmentation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">    Perform segmentation based on luminosity values from a video.</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">    converted_video : NDArray</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">        The input video data in a NumPy array format.</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">    do_threshold_segmentation : bool</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">        Flag to determine whether threshold segmentation should be applied.</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">    -------</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">    Tuple[NDArray, NDArray]</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">        A tuple containing two NumPy arrays:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">        - The first array is the luminosity segmentation of the video.</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">        - The second array represents the luminosity threshold over time.</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">    -----</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">    This function operates under the assumption that there is sufficient motion in the video data.</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">    If no valid thresholds are found for segmentation, the function returns None for</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">    `luminosity_segmentation`.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>    <span class="n">shape_motion_failed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="n">covering_l_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>                                         <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="n">covering_l_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">substantial_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>                                         <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_image</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>    <span class="c1"># Avoid errors by checking whether the covering values are nonzero</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>    <span class="n">covering_l_values</span> <span class="o">=</span> <span class="n">covering_l_values</span><span class="p">[</span><span class="n">covering_l_values</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">covering_l_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="n">shape_motion_failed</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>    <span class="n">luminosity_segmentation</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>    <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">shape_motion_failed</span><span class="p">:</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="n">value_segmentation_thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="n">validated_thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">value_segmentation_thresholds</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="n">while_condition</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="n">max_motion_per_frame</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;maximal_growth_factor&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="n">basic_bckgrnd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="n">basic_bckgrnd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>        <span class="c1"># Try different values of do_threshold_segmentation and keep the one that does not</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="c1"># segment more than x percent of the image</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">14</span><span class="p">:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="n">value_threshold</span> <span class="o">=</span> <span class="n">value_segmentation_thresholds</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                <span class="n">l_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">value_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covering_l_values</span><span class="p">)</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>                <span class="n">l_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">value_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covering_l_values</span><span class="p">)</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="n">starting_segmentation</span><span class="p">,</span> <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="n">segment_with_lum_value</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>                                                           <span class="n">basic_bckgrnd_values</span><span class="p">,</span> <span class="n">l_threshold</span><span class="p">,</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">])</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>            <span class="n">changing_pixel_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">starting_segmentation</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>            <span class="n">validation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">starting_segmentation</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="n">max_motion_per_frame</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">changing_pixel_number</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_motion_per_frame</span><span class="p">)</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>            <span class="n">validated_thresholds</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">validated_thresholds</span><span class="p">):</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">validation</span><span class="p">:</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                    <span class="k">break</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="c1"># If any threshold is accepted, use their average to proceed the final thresholding</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="n">valid_number</span> <span class="o">=</span> <span class="n">validated_thresholds</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="k">if</span> <span class="n">valid_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="k">if</span> <span class="n">valid_number</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>                <span class="n">index_to_keep</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>                <span class="n">index_to_keep</span> <span class="o">=</span> <span class="n">valid_number</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>            <span class="n">value_threshold</span> <span class="o">=</span> <span class="n">value_segmentation_thresholds</span><span class="p">[</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>                <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">validated_thresholds</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">index_to_keep</span><span class="p">])))]</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>            <span class="n">value_threshold</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>            <span class="n">l_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">value_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covering_l_values</span><span class="p">)</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>            <span class="n">l_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">value_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covering_l_values</span><span class="p">)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>        <span class="k">if</span> <span class="n">do_threshold_segmentation</span><span class="p">:</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>                <span class="n">basic_bckgrnd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>                <span class="n">basic_bckgrnd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>            <span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="n">segment_with_lum_value</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">basic_bckgrnd_values</span><span class="p">,</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>                                                             <span class="n">l_threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">])</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>            <span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="n">segment_with_lum_value</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">],</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>                                                           <span class="n">basic_bckgrnd_values</span><span class="p">,</span> <span class="n">l_threshold</span><span class="p">,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">])</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>    <span class="k">return</span> <span class="n">luminosity_segmentation</span><span class="p">,</span> <span class="n">l_threshold_over_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.networks_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">networks_analysis</span><span class="p">(</span><span class="n">show_seg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <div class="highlight"><pre><span></span><code>    Perform network detection within a given arena.

    This function carries out the task of detecting networks in an arena
    based on several parameters and variables. It involves checking video
    type, performing network detection over time, potentially detecting
    pseudopods, and smoothing segmentation. The results can be visualized or saved.
</code></pre></div>
<p>Extract and analyze graphs from a binary representation of network dynamics, producing vertex
        and edge tables that represent the graph structure over time.</p>
<div class="highlight"><pre><span></span><code>    Args:
        None

    Attributes:
        vars (dict): Dictionary of variables that control the graph extraction process.
            - &#39;save_graph&#39;: Boolean indicating if graph extraction should be performed.
            - &#39;save_coord_network&#39;: Boolean indicating if the coordinate network should be saved.

        one_descriptor_per_arena (dict): Dictionary containing descriptors for each arena.

        dims (tuple): Tuple containing dimension information.
            - [0]: Integer representing the number of time steps.
            - [1]: Integer representing the y-dimension size.
            - [2]: Integer representing the x-dimension size.

        origin (np.ndarray): Binary image representing the origin of the network.

        binary (np.ndarray): Binary representation of network dynamics over time.
            Shape: (time_steps, y_dimension, x_dimension).

        converted_video (np.ndarray): Converted video data.
            Shape: (y_dimension, x_dimension, time_steps).

        network_dynamics (np.ndarray): Network dynamics representation.
            Shape: (time_steps, y_dimension, x_dimension).

    Notes:
        - This method performs graph extraction and saves the vertex and edge tables to CSV files.
        - The CSV files are named according to the arena, time steps, and dimensions.

    Args:
        show_seg: bool = False
            A flag that determines whether to display the segmentation visually.
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">networks_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_seg</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a><span class="sd">        Perform network detection within a given arena.</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a><span class="sd">        This function carries out the task of detecting networks in an arena</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a><span class="sd">        based on several parameters and variables. It involves checking video</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a><span class="sd">        type, performing network detection over time, potentially detecting</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a><span class="sd">        pseudopods, and smoothing segmentation. The results can be visualized or saved.</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a><span class="sd">Extract and analyze graphs from a binary representation of network dynamics, producing vertex</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a><span class="sd">        and edge tables that represent the graph structure over time.</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a><span class="sd">            None</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a><span class="sd">        Attributes:</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a><span class="sd">            vars (dict): Dictionary of variables that control the graph extraction process.</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a><span class="sd">                - &#39;save_graph&#39;: Boolean indicating if graph extraction should be performed.</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a><span class="sd">                - &#39;save_coord_network&#39;: Boolean indicating if the coordinate network should be saved.</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a><span class="sd">            one_descriptor_per_arena (dict): Dictionary containing descriptors for each arena.</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a><span class="sd">            dims (tuple): Tuple containing dimension information.</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a><span class="sd">                - [0]: Integer representing the number of time steps.</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a><span class="sd">                - [1]: Integer representing the y-dimension size.</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a><span class="sd">                - [2]: Integer representing the x-dimension size.</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a><span class="sd">            origin (np.ndarray): Binary image representing the origin of the network.</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a><span class="sd">            binary (np.ndarray): Binary representation of network dynamics over time.</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a><span class="sd">                Shape: (time_steps, y_dimension, x_dimension).</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a><span class="sd">            converted_video (np.ndarray): Converted video data.</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a><span class="sd">                Shape: (y_dimension, x_dimension, time_steps).</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a><span class="sd">            network_dynamics (np.ndarray): Network dynamics representation.</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a><span class="sd">                Shape: (time_steps, y_dimension, x_dimension).</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a><span class="sd">        Notes:</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a><span class="sd">            - This method performs graph extraction and saves the vertex and edge tables to CSV files.</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><span class="sd">            - The CSV files are named according to the arena, time steps, and dimensions.</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a><span class="sd">            show_seg: bool = False</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a><span class="sd">                A flag that determines whether to display the segmentation visually.</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>        <span class="n">coord_pseudopods</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_converted_video_type</span><span class="p">()</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">,</span> <span class="n">coord_pseudopods</span> <span class="o">=</span> <span class="n">detect_network_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">],</span> <span class="n">show_seg</span><span class="p">)</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">,</span> <span class="n">coord_pseudopods</span> <span class="o">=</span> <span class="n">detect_network_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>                                                           <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">],</span> <span class="n">show_seg</span><span class="p">)</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_graph&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">))</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>                <span class="n">extract_graph_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>                                       <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">coord_pseudopods</span><span class="p">)</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>                <span class="n">extract_graph_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>                                       <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">coord_pseudopods</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.save_efficiency_tests" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_efficiency_tests</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Provide images allowing to assess the analysis efficiency</p>
<p>This method generates two test images used for assessing
the efficiency of the analysis. It performs various operations on
video frames to create these images, including copying and manipulating
frames from the video, detecting contours on binary images,
and drawing the arena label on the left of the frames.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1430" name="__codelineno-0-1430"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_efficiency_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a><span class="sd">    Provide images allowing to assess the analysis efficiency</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><span class="sd">    This method generates two test images used for assessing</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a><span class="sd">    the efficiency of the analysis. It performs various operations on</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a><span class="sd">    video frames to create these images, including copying and manipulating</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a><span class="sd">    frames from the video, detecting contours on binary images,</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a><span class="sd">    and drawing the arena label on the left of the frames.</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>    <span class="c1"># Provide images allowing to assess the analysis efficiency</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>        <span class="n">after_one_tenth_of_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>        <span class="n">after_one_tenth_of_time</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>    <span class="n">last_good_detection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">:</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_threshold_segmentation&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>            <span class="n">last_good_detection</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>        <span class="n">last_good_detection</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">),</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>                                         <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_1</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">after_one_tenth_of_time</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_2</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">last_good_detection</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_1</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">[</span><span class="n">after_one_tenth_of_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_2</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">[</span><span class="n">last_good_detection</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>    <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>    <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>    <span class="n">contours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">get_contours</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">after_one_tenth_of_time</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]))</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_1</span><span class="p">[</span><span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_1</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>                                     <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>    <span class="n">eroded_binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">last_good_detection</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">cross_33</span><span class="p">)</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>    <span class="n">contours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">last_good_detection</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">eroded_binary</span><span class="p">)</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_2</span><span class="p">[</span><span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efficiency_test_2</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>                                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.save_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_results</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Save the results of testing and video processing.</p>
<p>This method handles the saving of efficiency tests, video files,
and CSV data related to test results. It checks for existing files before writing new data.
Additionally, it cleans up temporary files if configured to do so.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1551" name="__codelineno-0-1551"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a><span class="sd">    Save the results of testing and video processing.</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a><span class="sd">    This method handles the saving of efficiency tests, video files,</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a><span class="sd">    and CSV data related to test results. It checks for existing files before writing new data.</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a><span class="sd">    Additionally, it cleans up temporary files if configured to do so.</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">save_efficiency_tests</span><span class="p">()</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">save_video</span><span class="p">()</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_frame_arena</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Never let one_row_per_frame_arena</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>        <span class="n">create_new_csv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>                    <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>            <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>                        <span class="n">stats</span><span class="o">.</span><span class="n">iloc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>                        <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>                <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>                <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>            <span class="n">create_new_csv</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>        <span class="k">if</span> <span class="n">create_new_csv</span><span class="p">:</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>                <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">))),</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>                           <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>                <span class="n">stats</span><span class="o">.</span><span class="n">iloc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>                <span class="n">stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;keep_unaltered_videos&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ind_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ind_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.save_video" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_video</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Save processed video with contours and other annotations.</p>
<p>This method processes the binary image to extract contours, overlay them
on a video, and save the resulting video file.</p>
<p>Notes:
    - This method uses OpenCV for image processing and contour extraction.
    - The processed video includes contours colored according to the
      <code>contour_color</code> specified in the variables.
    - Additional annotations such as time in minutes are added to each
      frame if applicable.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1477" name="__codelineno-0-1477"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_video</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a><span class="sd">    Save processed video with contours and other annotations.</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a><span class="sd">    This method processes the binary image to extract contours, overlay them</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">    on a video, and save the resulting video file.</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a><span class="sd">    Notes:</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a><span class="sd">        - This method uses OpenCV for image processing and contour extraction.</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a><span class="sd">        - The processed video includes contours colored according to the</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a><span class="sd">          `contour_color` specified in the variables.</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a><span class="sd">        - Additional annotations such as time in minutes are added to each</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a><span class="sd">          frame if applicable.</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_processed_videos&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_converted_video_type</span><span class="p">()</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">),</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>                                            <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>            <span class="n">eroded_binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">cross_33</span><span class="p">)</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>            <span class="n">contours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">eroded_binary</span><span class="p">)</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>            <span class="k">if</span> <span class="s2">&quot;iso_digi_transi&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;iso_digi_analysis&#39;</span><span class="p">]</span>  <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;iso_digi_transi&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;is_growth_isotropic&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>                        <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;iso_digi_transi&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_idx</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_intensity_per_frame</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">erodila_disk</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>        <span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>            <span class="n">true_frame_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ind_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="o">=</span> <span class="n">video2numpy</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ind_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>                          <span class="kc">None</span><span class="p">,</span> <span class="n">true_frame_width</span><span class="o">=</span><span class="n">true_frame_width</span><span class="p">)</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step_is_arbitrary&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step_is_arbitrary&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>                <span class="n">time_unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>                <span class="n">time_unit</span> <span class="o">=</span> <span class="s2">&quot; min&quot;</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>                <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>                <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">])</span> <span class="o">+</span> <span class="n">time_unit</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">image</span><span class="p">,</span>  <span class="c1"># numpy array on which text is written</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>                                <span class="n">text</span><span class="p">,</span>  <span class="c1"># text</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>                                <span class="n">position</span><span class="p">,</span>  <span class="c1"># position at which writing has to start</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>                                <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span>  <span class="c1"># font family</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>                                <span class="mi">1</span><span class="p">,</span>  <span class="c1"># font size</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;contour_color&quot;</span><span class="p">],</span> <span class="mi">255</span><span class="p">),</span>  <span class="c1">#(209, 80, 0, 255),  </span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>                                <span class="mi">2</span><span class="p">)</span>  <span class="c1"># font stroke</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>        <span class="n">vid_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ind_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;videos_extension&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>        <span class="n">write_video</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">vid_name</span><span class="p">,</span> <span class="n">is_color</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;video_fps&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.smooth_pixel_slopes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smooth_pixel_slopes</span><span class="p">(</span><span class="n">converted_video</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Apply smoothing to pixel slopes in a video by convolving with a moving average kernel.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>converted_video</code>
            </td>
            <td>
                  <code><span title="cellects.image_analysis.network_functions.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input video array to be smoothed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cellects.image_analysis.network_functions.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Smoothed video array with pixel slopes averaged using a moving average kernel.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="MemoryError">MemoryError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is not enough RAM available to perform the smoothing operation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function applies a moving average kernel to each pixel across the frames of
the input video. The smoothing operation can be repeated based on user-defined settings.
The precision of the output array is controlled by a flag that determines whether to
save memory at the cost of accuracy.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">smoothed</span> <span class="o">=</span> <span class="n">smooth_pixel_slopes</span><span class="p">(</span><span class="n">converted_video</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">smoothed</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># Expected output will vary depending on the input video shape</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="k">def</span><span class="w"> </span><span class="nf">smooth_pixel_slopes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">    Apply smoothing to pixel slopes in a video by convolving with a moving average kernel.</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">    converted_video : NDArray</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">        The input video array to be smoothed.</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">    -------</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">    NDArray</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">        Smoothed video array with pixel slopes averaged using a moving average kernel.</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">    ------</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">    MemoryError</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">        If there is not enough RAM available to perform the smoothing operation.</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">    -----</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">    This function applies a moving average kernel to each pixel across the frames of</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="sd">    the input video. The smoothing operation can be repeated based on user-defined settings.</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="sd">    The precision of the output array is controlled by a flag that determines whether to</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">    save memory at the cost of accuracy.</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">    --------</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">    &gt;&gt;&gt; smoothed = smooth_pixel_slopes(converted_video)</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">    &gt;&gt;&gt; print(smoothed.shape)  # Expected output will vary depending on the input video shape</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>            <span class="n">smoothed_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>            <span class="n">smooth_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>                    <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_intensity_per_frame</span><span class="p">,</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>                    <span class="n">moving_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">smooth_kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;repeat_video_smoothing&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>                        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;repeat_video_smoothing&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>                            <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">moving_average</span><span class="p">,</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>                                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>                            <span class="n">moving_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">smooth_kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>                    <span class="n">smoothed_video</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">moving_average</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>            <span class="n">smoothed_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>            <span class="n">smooth_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>                    <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_intensity_per_frame</span><span class="p">,</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>                    <span class="n">moving_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">smooth_kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;repeat_video_smoothing&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>                        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;repeat_video_smoothing&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                            <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">moving_average</span><span class="p">,</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                            <span class="n">moving_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">smooth_kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                    <span class="n">smoothed_video</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">moving_average</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="k">return</span> <span class="n">smoothed_video</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>    <span class="k">except</span> <span class="ne">MemoryError</span><span class="p">:</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Not enough RAM available to smooth pixel curves. Detection may fail.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>        <span class="n">smoothed_video</span> <span class="o">=</span> <span class="n">converted_video</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="k">return</span> <span class="n">smoothed_video</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.study_cytoscillations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">study_cytoscillations</span><span class="p">(</span><span class="n">show_seg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Study the cytoskeletal oscillations within a video frame by frame.</p>
<p>This method performs an analysis of cytoskeletal oscillations in the video,
identifying regions of influx and efflux based on pixel connectivity.
It also handles memory allocation for the oscillations video, computes
connected components, and optionally displays the segmented regions.</p>
<p>Args:
    show_seg (bool): If True, display the segmentation results.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1342" name="__codelineno-0-1342"></a><span class="k">def</span><span class="w"> </span><span class="nf">study_cytoscillations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_seg</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a><span class="sd">        Study the cytoskeletal oscillations within a video frame by frame.</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a><span class="sd">        This method performs an analysis of cytoskeletal oscillations in the video,</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a><span class="sd">        identifying regions of influx and efflux based on pixel connectivity.</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a><span class="sd">        It also handles memory allocation for the oscillations video, computes</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a><span class="sd">        connected components, and optionally displays the segmented regions.</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a><span class="sd">            show_seg (bool): If True, display the segmentation results.</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_thickening_slimming&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;oscilacyto_analysis&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>        <span class="n">oscillations_video</span> <span class="o">=</span> <span class="n">detect_oscillations_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>                                                          <span class="bp">self</span><span class="o">.</span><span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s1">&#39;arena&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>                                                          <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;expected_oscillation_period&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>                                                          <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span><span class="p">,</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>                                                          <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;minimal_oscillating_cluster_size&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>                                                          <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;min_ram_free&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>                                                          <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>                                                          <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_thickening_slimming&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>        <span class="k">del</span> <span class="n">oscillations_video</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.update_ring_width" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_ring_width</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the <code>pixel_ring_depth</code> and create an erodila disk.</p>
<p>This method ensures that the pixel ring depth is odd and at least 3,
then creates an erodila disk of that size.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_ring_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="sd">    Update the `pixel_ring_depth` and create an erodila disk.</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="sd">    This method ensures that the pixel ring depth is odd and at least 3,</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">    then creates an erodila disk of that size.</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>    <span class="c1"># Make sure that self.pixels_depths are odd and greater than 3</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">erodila_disk</span> <span class="o">=</span> <span class="n">create_ellipse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">max_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ring_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;detection_range_factor&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.MotionAnalysis.update_shape" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_shape</span><span class="p">(</span><span class="n">show_seg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the shape of detected objects in the current frame by analyzing
segmentation potentials and applying morphological operations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>show_seg</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating whether to display segmentation results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function performs several operations to update the shape of detected objects:
- Analyzes segmentation potentials from previous frames.
- Applies morphological operations to refine the shape.
- Updates internal state variables such as <code>binary</code> and <code>covering_intensity</code>.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/motion_analysis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_seg</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="sd">    Update the shape of detected objects in the current frame by analyzing</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">    segmentation potentials and applying morphological operations.</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">    show_seg : bool</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">        Flag indicating whether to display segmentation results.</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">    -----</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">    This function performs several operations to update the shape of detected objects:</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">    - Analyzes segmentation potentials from previous frames.</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="sd">    - Applies morphological operations to refine the shape.</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">    - Updates internal state variables such as `binary` and `covering_intensity`.</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>    <span class="c1"># Get from gradients, a 2D matrix of potentially covered pixels</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>    <span class="c1"># I/ dilate the shape made with covered pixels to assess for covering</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>    <span class="c1"># I/ 1) Only keep pixels that have been detected at least two times in the three previous frames</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="n">new_potentials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>            <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>            <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>        <span class="n">new_potentials</span><span class="p">[</span><span class="n">new_potentials</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>        <span class="n">new_potentials</span><span class="p">[</span><span class="n">new_potentials</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>    <span class="c1"># I/ 2) If an image displays more new potential pixels than 50% of image pixels,</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>    <span class="c1"># one of these images is considered noisy and we try taking only one.</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>    <span class="n">frame_counter</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>    <span class="n">maximal_size</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">new_potentials</span><span class="o">.</span><span class="n">size</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;do_threshold_segmentation&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;frame_by_frame_segmentation&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="mi">6</span><span class="p">)):</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>       <span class="n">maximal_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;maximal_growth_factor&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maximal_size</span><span class="p">,</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>                         <span class="n">frame_counter</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">):</span>  <span class="c1"># np.logical_and(np.sum(new_potentials &gt; 0) &gt; 5 * np.sum(dila_ring), frame_counter &lt;= 5):</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="n">frame_counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="k">if</span> <span class="n">frame_counter</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">:</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>            <span class="k">break</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>            <span class="k">if</span> <span class="n">frame_counter</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                <span class="n">new_potentials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">frame_counter</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>            <span class="c1"># If taking only one image is not enough, use the inverse of the fadinged matrix as new_potentials</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>            <span class="c1"># Given it haven&#39;t been processed by any slope calculation, it should be less noisy</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>                <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">5</span><span class="p">):</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>                <span class="n">new_potentials</span><span class="p">[</span><span class="n">new_potentials</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>                <span class="n">new_potentials</span><span class="p">[</span><span class="n">new_potentials</span> <span class="o">==</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>    <span class="n">new_shape</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>    <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>    <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>    <span class="n">new_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="n">new_potentials</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>    <span class="c1"># Add distant shapes within a radius, score every added pixels according to their distance</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>        <span class="k">if</span> <span class="n">new_shape</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>            <span class="n">new_shape</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>            <span class="n">pads</span> <span class="o">=</span> <span class="n">ProgressivelyAddDistantShapes</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_distance</span><span class="p">)</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">pads</span><span class="p">)</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>            <span class="c1"># If max_distance is non nul look for distant shapes</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>            <span class="n">pads</span><span class="o">.</span><span class="n">consider_shapes_sizes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;min_size_for_connection&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                                                 <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;max_size_for_connection&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>            <span class="n">pads</span><span class="o">.</span><span class="n">connect_shapes</span><span class="p">(</span><span class="n">only_keep_connected_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rank_connecting_pixels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>            <span class="n">new_shape</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">pads</span><span class="o">.</span><span class="n">expanded_shape</span><span class="p">)</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>            <span class="n">new_shape</span><span class="p">[</span><span class="n">new_shape</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pads</span><span class="o">.</span><span class="n">expanded_shape</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>                    <span class="c1"># Add distant shapes back in time at the covering speed of neighbors</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">):(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> \
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>                        <span class="n">pads</span><span class="o">.</span><span class="n">modify_past_analysis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">):(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>                                                  <span class="bp">self</span><span class="o">.</span><span class="n">segmented</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">):(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>                    <span class="n">new_shape</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>            <span class="n">pads</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>        <span class="c1"># Fill holes</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>        <span class="n">new_shape</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">)</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">):</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>        <span class="c1"># Shape Erosion</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>        <span class="c1"># I/ After a substantial growth, erode the shape made with covered pixels to assess for fading</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>        <span class="c1"># Use the newly covered pixels to calculate their mean covering intensity</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>        <span class="n">new_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]))</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>        <span class="n">start_intensity_monitoring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>        <span class="n">end_intensity_monitoring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span><span class="p">[</span><span class="n">new_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="n">start_intensity_monitoring</span><span class="p">:</span><span class="n">end_intensity_monitoring</span><span class="p">,</span> <span class="n">new_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>        <span class="n">previous_binary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="n">greyscale_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_video</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lost_frames</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>        <span class="n">protect_from_fading</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>            <span class="n">protect_from_fading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>        <span class="n">new_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span> <span class="o">=</span> <span class="n">cell_leaving_detection</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span><span class="p">,</span> <span class="n">previous_binary</span><span class="p">,</span> <span class="n">greyscale_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fading&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">erodila_disk</span><span class="p">,</span> <span class="n">protect_from_fading</span><span class="p">)</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">covering_intensity</span> <span class="o">*=</span> <span class="n">new_shape</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">new_shape</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">borders</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>    <span class="c1"># Calculate the mean distance covered per frame and correct for a ring of not really fading pixels</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_distance_per_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;correct_errors_around_initial&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">%</span> <span class="mi">20</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>                              <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_growth</span><span class="p">,</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>                                             <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_growth</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)):</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>                <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sun</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>                <span class="n">back</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sun</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>                <span class="k">for</span> <span class="n">ray</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rays</span><span class="p">:</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>                    <span class="c1"># For each sun&#39;s ray, see how they cross the shape/back and</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>                    <span class="c1"># store the gravity_field value of these pixels (distance to the original shape).</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>                    <span class="n">ray_through_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape</span> <span class="o">==</span> <span class="n">ray</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity_field</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>                    <span class="n">ray_through_back</span> <span class="o">=</span> <span class="p">(</span><span class="n">back</span> <span class="o">==</span> <span class="n">ray</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity_field</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ray_through_shape</span><span class="p">):</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ray_through_back</span><span class="p">):</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>                            <span class="c1"># If at least one back pixel is nearer to the original shape than a shape pixel,</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>                            <span class="c1"># there is a hole to fill.</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ray_through_back</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ray_through_shape</span><span class="p">[</span><span class="n">ray_through_shape</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])):</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>                                <span class="c1"># Check if the nearest pixels are shape, if so, supress them until the nearest pixel</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>                                <span class="c1"># becomes back</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>                                <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ray_through_back</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ray_through_shape</span><span class="p">):</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>                                    <span class="n">ray_through_shape</span><span class="p">[</span><span class="n">ray_through_shape</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ray_through_shape</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>                                <span class="c1"># Now, all back pixels that are nearer than the closest shape pixel should get filled</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>                                <span class="c1"># To do so, replace back pixels further than the nearest shape pixel by 0</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>                                <span class="n">ray_through_back</span><span class="p">[</span><span class="n">ray_through_back</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ray_through_shape</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">holes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ray_through_back</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">rays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rays</span><span class="p">[:(</span><span class="n">ray</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rays</span><span class="p">[(</span><span class="n">ray</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):]))</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>                    <span class="n">ray_through_shape</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>                    <span class="n">ray_through_back</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">substantial_growth</span> <span class="o">*</span> <span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;correct_errors_around_initial&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>                <span class="c1"># Apply the hole correction</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">holes</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">holes</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>                <span class="c1"># If some holes are not covered by now</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">holes</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])):</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">holes_time_end</span><span class="p">,</span> <span class="n">distance_against_time</span> <span class="o">=</span> \
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>                        <span class="n">dynamically_expand_to_fill_holes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">holes</span><span class="p">)</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>                    <span class="k">if</span> <span class="n">holes_time_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">holes_time_end</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">holes_time_end</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">holes_time_end</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:][</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="n">holes_time_end</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">surfarea</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>                    <span class="n">distance_against_time</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                <span class="n">distance_against_time</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>            <span class="n">distance_against_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">distance_against_time</span><span class="p">)</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">distance_against_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mean_distance_per_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">-</span> <span class="n">distance_against_time</span><span class="p">)</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mean_distance_per_frame</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;prevent_fast_growth_near_periphery&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>        <span class="c1"># growth_near_periphery = np.diff(self.binary[self.t-1:self.t+1, :, :] * self.near_periphery, axis=0)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>        <span class="n">growth_near_periphery</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">growth_near_periphery</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;max_periphery_growth&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>            <span class="c1"># self.binary[self.t, self.near_periphery[0], self.near_periphery[1]] = self.binary[self.t - 1, self.near_periphery[0], self.near_periphery[1]]</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>            <span class="n">periphery_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>            <span class="n">periphery_to_remove</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">near_periphery</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>            <span class="n">shapes</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centers</span> <span class="o">=</span> <span class="n">cc</span><span class="p">(</span><span class="n">periphery_to_remove</span><span class="p">)</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>            <span class="n">periphery_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;max_periphery_growth&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">periphery_to_remove</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">periphery_to_remove</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">periphery_to_remove</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">periphery_to_remove</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>                <span class="n">shapes</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centers</span> <span class="o">=</span> <span class="n">cc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>                <span class="n">shapes</span><span class="p">[</span><span class="n">shapes</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapes</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>    <span class="c1"># Display</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>    <span class="k">if</span> <span class="n">show_seg</span><span class="p">:</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visu</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>            <span class="n">im_to_display</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visu</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>            <span class="n">contours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_GRADIENT</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">))</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>                <span class="n">im_to_display</span><span class="p">[</span><span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                <span class="n">im_to_display</span><span class="p">[</span><span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>            <span class="n">im_to_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="mi">255</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>        <span class="n">imtoshow</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">im_to_display</span><span class="p">,</span> <span class="p">(</span><span class="mi">540</span><span class="p">,</span> <span class="mi">540</span><span class="p">))</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;shape_motion&quot;</span><span class="p">,</span> <span class="n">imtoshow</span><span class="p">)</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cellects.core.motion_analysis.NetworkDetection" class="doc doc-heading">
            <code>NetworkDetection</code>


</h2>


    <div class="doc doc-contents ">



        <p>NetworkDetection</p>
<p>Class for detecting vessels in images using Frangi and Sato filters with various parameter sets.
It applies different thresholding methods, calculates quality metrics, and selects the best detection method.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="k">class</span><span class="w">  </span><span class="nc">NetworkDetection</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    NetworkDetection</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    Class for detecting vessels in images using Frangi and Sato filters with various parameter sets.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    It applies different thresholding methods, calculates quality metrics, and selects the best detection method.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">greyscale_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">possibly_filled_pixels</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_rolling_window</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">origin_to_add</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">best_result</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        Initialize the object with given parameters.</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        greyscale_image : NDArray[np.uint8]</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">            The input greyscale image.</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        possibly_filled_pixels : NDArray[np.uint8], optional</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">            Image containing possibly filled pixels. Defaults to None.</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        add_rolling_window : bool, optional</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">            Flag to add rolling window. Defaults to False.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        origin_to_add : NDArray[np.uint8], optional</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">            Origin to add. Defaults to None.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">        best_result : dict, optional</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">            Best result dictionary. Defaults to None.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">greyscale_image</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">if</span> <span class="n">possibly_filled_pixels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span> <span class="o">=</span> <span class="n">possibly_filled_pixels</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span> <span class="o">=</span> <span class="n">best_result</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_rolling_window</span> <span class="o">=</span> <span class="n">add_rolling_window</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">origin_to_add</span> <span class="o">=</span> <span class="n">origin_to_add</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">frangi_beta</span> <span class="o">=</span> <span class="mf">1.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">frangi_gamma</span> <span class="o">=</span> <span class="mf">1.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">black_ridges</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_frangi_variations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        Applies various Frangi filter variations with different sigma values and thresholding methods.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        This method applies the Frangi vesselness filter with multiple sets of sigma values</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        to detect vessels at different scales. It applies both Otsu thresholding and rolling window</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">        segmentation to the filtered results and calculates binary quality indices.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        -------</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        results : list of dict</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">            A list containing dictionaries with the method name, binary result, quality index,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">            filtered image, filter type, rolling window flag, and sigma values used.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="c1"># Parameter variations for Frangi filter</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">frangi_sigmas</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="s1">&#39;s_fine_vessels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">],</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="s1">&#39;fine_vessels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>  <span class="c1"># Very fine capillaries, thin fibers</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="s1">&#39;small_vessels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>  <span class="c1"># Small vessels, fine structures</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="s1">&#39;multi_scale_medium&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>  <span class="c1"># Standard multi-scale</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="s1">&#39;ultra_fine&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>  <span class="c1"># Ultra-fine structures</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="s1">&#39;comprehensive&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>  <span class="c1"># Multi-scale</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="s1">&#39;retinal_vessels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">],</span>  <span class="c1"># Optimized for retinal imaging</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="s1">&#39;microscopy&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span>  <span class="c1"># Microscopy applications</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="s1">&#39;broad_spectrum&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="p">}</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frangi_sigmas</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="c1"># Apply Frangi filter</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="n">frangi_result</span> <span class="o">=</span> <span class="n">frangi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="n">sigmas</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frangi_beta</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frangi_gamma</span><span class="p">,</span> <span class="n">black_ridges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">black_ridges</span><span class="p">)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="c1"># Apply both thresholding methods</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="c1"># Method 1: Otsu thresholding</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="n">thresh_otsu</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">frangi_result</span><span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="n">binary_otsu</span> <span class="o">=</span> <span class="n">frangi_result</span> <span class="o">&gt;</span> <span class="n">thresh_otsu</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="n">quality_otsu</span> <span class="o">=</span> <span class="n">binary_quality_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span> <span class="o">*</span> <span class="n">binary_otsu</span><span class="p">)</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="c1"># Method 2: Rolling window thresholding</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="c1"># Store results</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;f_</span><span class="si">{</span><span class="n">sigmas</span><span class="si">}</span><span class="s1">_thresh&#39;</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                <span class="s1">&#39;binary&#39;</span><span class="p">:</span> <span class="n">binary_otsu</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                <span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="n">quality_otsu</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                <span class="s1">&#39;filtered&#39;</span><span class="p">:</span> <span class="n">frangi_result</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Frangi&#39;</span><span class="p">,</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                <span class="s1">&#39;rolling_window&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>                <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span> <span class="n">sigmas</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="p">})</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="c1"># Method 2: Rolling window thresholding</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_rolling_window</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                <span class="n">binary_rolling</span> <span class="o">=</span> <span class="n">rolling_window_segmentation</span><span class="p">(</span><span class="n">frangi_result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                <span class="n">quality_rolling</span> <span class="o">=</span> <span class="n">binary_quality_index</span><span class="p">(</span><span class="n">binary_rolling</span><span class="p">)</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                    <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;f_</span><span class="si">{</span><span class="n">sigmas</span><span class="si">}</span><span class="s1">_roll&#39;</span><span class="p">,</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                    <span class="s1">&#39;binary&#39;</span><span class="p">:</span> <span class="n">binary_rolling</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                    <span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="n">quality_rolling</span><span class="p">,</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                    <span class="s1">&#39;filtered&#39;</span><span class="p">:</span> <span class="n">frangi_result</span><span class="p">,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                    <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Frangi&#39;</span><span class="p">,</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                    <span class="s1">&#39;rolling_window&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                    <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span> <span class="n">sigmas</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                <span class="p">})</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="k">return</span> <span class="n">results</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_sato_variations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        Apply various Sato filter variations to an image and store the results.</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">        This function applies different parameter sets for the Sato vesselness</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        filter to an image, applies two thresholding methods (Otsu and rolling window),</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">        and stores the results. The function supports optional rolling window</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">        segmentation based on a configuration flag.</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        -------</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">        list of dict</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">            A list containing dictionaries with the results for each filter variation.</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">            Each dictionary includes method name, binary image, quality index,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">            filtered result, filter type, rolling window flag, and sigma values.</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="c1"># Parameter variations for Frangi filter</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="n">sato_sigmas</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>            <span class="s1">&#39;super_small_tubes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">],</span>  <span class="c1">#</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>            <span class="s1">&#39;small_tubes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>  <span class="c1">#</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="s1">&#39;s_thick_ridges&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span>  <span class="c1"># Thick ridges/tubes</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="s1">&#39;small_multi_scale&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">],</span>  <span class="c1">#</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="s1">&#39;fine_ridges&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span>  <span class="c1"># Fine ridge detection</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>            <span class="s1">&#39;medium_ridges&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>  <span class="c1"># Medium ridge structures</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="s1">&#39;multi_scale_fine&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span>  <span class="c1"># Multi-scale fine detection</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="s1">&#39;multi_scale_standard&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span>  <span class="c1"># Standard multi-scale</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="s1">&#39;edge_enhanced&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>  <span class="c1"># Edge-enhanced detection</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="s1">&#39;noise_robust&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>  <span class="c1"># Robust to noise</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="s1">&#39;fingerprint&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>  <span class="c1"># Fingerprint ridge detection</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="s1">&#39;geological&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">]</span>  <span class="c1"># Geological structures</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="p">}</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sato_sigmas</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="c1"># Apply sato filter</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="n">sato_result</span> <span class="o">=</span> <span class="n">sato</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="n">sigmas</span><span class="p">,</span> <span class="n">black_ridges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">black_ridges</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;reflect&#39;</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="c1"># Apply both thresholding methods</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="c1"># Method 1: Otsu thresholding</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="n">thresh_otsu</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">sato_result</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="n">binary_otsu</span> <span class="o">=</span> <span class="n">sato_result</span> <span class="o">&gt;</span> <span class="n">thresh_otsu</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="n">quality_otsu</span> <span class="o">=</span> <span class="n">binary_quality_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span> <span class="o">*</span> <span class="n">binary_otsu</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="c1"># Store results</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;s_</span><span class="si">{</span><span class="n">sigmas</span><span class="si">}</span><span class="s1">_thresh&#39;</span><span class="p">,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>                <span class="s1">&#39;binary&#39;</span><span class="p">:</span> <span class="n">binary_otsu</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>                <span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="n">quality_otsu</span><span class="p">,</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>                <span class="s1">&#39;filtered&#39;</span><span class="p">:</span> <span class="n">sato_result</span><span class="p">,</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>                <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Sato&#39;</span><span class="p">,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>                <span class="s1">&#39;rolling_window&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>                <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span> <span class="n">sigmas</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="p">})</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="c1"># Method 2: Rolling window thresholding</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_rolling_window</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                <span class="n">binary_rolling</span> <span class="o">=</span> <span class="n">rolling_window_segmentation</span><span class="p">(</span><span class="n">sato_result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                <span class="n">quality_rolling</span> <span class="o">=</span> <span class="n">binary_quality_index</span><span class="p">(</span><span class="n">binary_rolling</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                    <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;s_</span><span class="si">{</span><span class="n">sigmas</span><span class="si">}</span><span class="s1">_roll&#39;</span><span class="p">,</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                    <span class="s1">&#39;binary&#39;</span><span class="p">:</span> <span class="n">binary_rolling</span><span class="p">,</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                    <span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="n">quality_rolling</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                    <span class="s1">&#39;filtered&#39;</span><span class="p">:</span> <span class="n">sato_result</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                    <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Sato&#39;</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                    <span class="s1">&#39;rolling_window&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                    <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span> <span class="n">sigmas</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="p">})</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="k">return</span> <span class="n">results</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_best_network_detection_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">        Get the best network detection method based on quality metrics.</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">        This function applies Frangi and Sato variations, combines their results,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">        calculates quality metrics for each result, and selects the best method.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">        Attributes</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">        all_results : list of dicts</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">            Combined results from Frangi and Sato variations.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">        quality_metrics : ndarray of float64</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">            Quality metrics for each detection result.</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">        best_idx : int</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">            Index of the best detection method based on quality metrics.</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">        best_result : dict</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">            The best detection result from all possible methods.</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">        incomplete_network : ndarray of bool</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">            Binary representation of the best detection result.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        &gt;&gt;&gt; possibly_filled_pixels = np.zeros((9, 9), dtype=np.uint8)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        &gt;&gt;&gt; possibly_filled_pixels[3:6, 3:6] = 1</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        &gt;&gt;&gt; possibly_filled_pixels[1:6, 3] = 1</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        &gt;&gt;&gt; possibly_filled_pixels[6:-1, 5] = 1</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        &gt;&gt;&gt; possibly_filled_pixels[4, 1:-1] = 1</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">        &gt;&gt;&gt; greyscale_image = possibly_filled_pixels.copy()</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        &gt;&gt;&gt; greyscale_image[greyscale_image &gt; 0] = np.random.randint(170, 255, possibly_filled_pixels.sum())</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">        &gt;&gt;&gt; greyscale_image[greyscale_image == 0] = np.random.randint(0, 120, possibly_filled_pixels.size - possibly_filled_pixels.sum())</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        &gt;&gt;&gt; add_rolling_window=False</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        &gt;&gt;&gt; origin_to_add = np.zeros((9, 9), dtype=np.uint8)</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        &gt;&gt;&gt; origin_to_add[3:6, 3:6] = 1</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        &gt;&gt;&gt; NetDet = NetworkDetection(greyscale_image, possibly_filled_pixels, add_rolling_window, origin_to_add)</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        &gt;&gt;&gt; NetDet.get_best_network_detection_method()</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">        &gt;&gt;&gt; print(NetDet.best_result[&#39;method&#39;])</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">        &gt;&gt;&gt; print(NetDet.best_result[&#39;binary&#39;])</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">        &gt;&gt;&gt; print(NetDet.best_result[&#39;quality&#39;])</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">        &gt;&gt;&gt; print(NetDet.best_result[&#39;filtered&#39;])</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">        &gt;&gt;&gt; print(NetDet.best_result[&#39;filter&#39;])</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">        &gt;&gt;&gt; print(NetDet.best_result[&#39;rolling_window&#39;])</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">        &gt;&gt;&gt; print(NetDet.best_result[&#39;sigmas&#39;])</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">        bgr_image = np.random.randint(0, 256, (100, 100, 3), dtype=np.uint8)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">frangi_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_frangi_variations</span><span class="p">()</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="n">sato_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_sato_variations</span><span class="p">()</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span> <span class="o">=</span> <span class="n">frangi_res</span> <span class="o">+</span> <span class="n">sato_res</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span><span class="p">])</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics</span><span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">best_idx</span><span class="p">]</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">        Process and detect network features in the greyscale image.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">        This method applies a frangi or sato filter based on the best result and</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">        performs segmentation using either rolling window or Otsu&#39;s thresholding.</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">        The final network detection result is stored in `self.incomplete_network`.</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Frangi&#39;</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>            <span class="n">filtered_result</span> <span class="o">=</span> <span class="n">frangi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;sigmas&#39;</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frangi_beta</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frangi_gamma</span><span class="p">,</span> <span class="n">black_ridges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">black_ridges</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="n">filtered_result</span> <span class="o">=</span> <span class="n">sato</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;sigmas&#39;</span><span class="p">],</span> <span class="n">black_ridges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">black_ridges</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;reflect&#39;</span><span class="p">)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;rolling_window&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>            <span class="n">binary_image</span> <span class="o">=</span> <span class="n">rolling_window_segmentation</span><span class="p">(</span><span class="n">filtered_result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="n">thresh_otsu</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">filtered_result</span><span class="p">)</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="n">binary_image</span> <span class="o">=</span> <span class="n">filtered_result</span> <span class="o">&gt;</span> <span class="n">thresh_otsu</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_network</span> <span class="o">=</span> <span class="n">binary_image</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">change_greyscale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">first_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        Change the image to greyscale using color space combinations.</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        This function converts an input image to greyscale by generating</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        and applying a combination of color spaces specified in the dictionary.</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">        The resulting greyscale image is stored as an attribute of the instance.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">        img : ndarray of uint8</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">            The input image to be converted to greyscale.</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">first_pc_vector</span>  <span class="o">=</span> <span class="n">generate_color_space_combination</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">first_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">first_dict</span><span class="p">)</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect_pseudopods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lighter_background</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">pseudopod_min_width</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pseudopod_min_size</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">only_one_connected_component</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">        Detect pseudopods in a binary image.</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">        Identify and process regions that resemble pseudopods based on width, size,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">        and connectivity criteria. This function is used to detect and label areas</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        that are indicative of pseudopod-like structures within a binary image.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        lighter_background : bool</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">            Boolean flag to indicate if the background should be considered lighter.</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">        pseudopod_min_width : int, optional</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">            Minimum width for pseudopods to be considered valid. Default is 5.</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        pseudopod_min_size : int, optional</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">            Minimum size for pseudopods to be considered valid. Default is 50.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        only_one_connected_component : bool, optional</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">            Flag to ensure only one connected component is kept. Default is True.</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">        -------</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">        None</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">        -----</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">        This function modifies internal attributes of the object, specifically setting `self.pseudopods` to an array indicating pseudopod regions.</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">        --------</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">        &gt;&gt;&gt; result = detect_pseudopods(True, 5, 50)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">        &gt;&gt;&gt; print(self.pseudopods)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">        array([[0, 1, ..., 0],</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">               [0, 0, ..., 0],</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">               ...,</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">               [0, 1, ..., 0]], dtype=uint8)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="n">closed_im</span> <span class="o">=</span> <span class="n">close_holes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="n">dist_trans</span> <span class="o">=</span> <span class="n">distance_transform_edt</span><span class="p">(</span><span class="n">closed_im</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="n">dist_trans</span> <span class="o">=</span> <span class="n">dist_trans</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">dist_trans</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>        <span class="c1"># Add dilatation of bracket of distances from medial_axis to the multiplication</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="k">if</span> <span class="n">lighter_background</span><span class="p">:</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="n">grey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>            <span class="n">grey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_to_add</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>            <span class="n">dist_trans_ori</span> <span class="o">=</span> <span class="n">distance_transform_edt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_to_add</span><span class="p">)</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>            <span class="n">scored_im</span> <span class="o">=</span> <span class="n">dist_trans</span> <span class="o">*</span> <span class="n">dist_trans_ori</span> <span class="o">*</span> <span class="n">grey</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="n">scored_im</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist_trans</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">grey</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>        <span class="n">scored_im</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">scored_im</span><span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="n">thresh</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">scored_im</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="n">thresh</span> <span class="o">=</span> <span class="n">find_threshold_given_mask</span><span class="p">(</span><span class="n">scored_im</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">min_threshold</span><span class="o">=</span><span class="n">thresh</span><span class="p">)</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="n">high_int_in_periphery</span> <span class="o">=</span> <span class="p">(</span><span class="n">scored_im</span> <span class="o">&gt;</span> <span class="n">thresh</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">pseudopod_widths</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">medial_axis</span><span class="p">(</span><span class="n">high_int_in_periphery</span><span class="p">,</span> <span class="n">return_distance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>        <span class="n">bin_im</span> <span class="o">=</span> <span class="n">pseudopod_widths</span> <span class="o">&gt;=</span> <span class="n">pseudopod_min_width</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>        <span class="n">dil_bin_im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">bin_im</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">kernel</span><span class="o">=</span><span class="n">create_ellipse</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="n">bin_im</span> <span class="o">=</span> <span class="n">high_int_in_periphery</span> <span class="o">*</span> <span class="n">dil_bin_im</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="n">nb</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centro</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="n">bin_im</span><span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="n">true_pseudopods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pseudopod_min_size</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="n">true_pseudopods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">true_pseudopods</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="c1"># Make sure that the tubes connecting two pseudopods belong to pseudopods if removing pseudopods cuts the network</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="n">complete_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">true_pseudopods</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_network</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="k">if</span> <span class="n">only_one_connected_component</span><span class="p">:</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>            <span class="n">complete_network</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="n">complete_network</span><span class="p">)</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>            <span class="n">without_pseudopods</span> <span class="o">=</span> <span class="n">complete_network</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="n">without_pseudopods</span><span class="p">[</span><span class="n">true_pseudopods</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>            <span class="n">only_connected_network</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="n">without_pseudopods</span><span class="p">)</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pseudopods</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">only_connected_network</span><span class="p">)</span> <span class="o">*</span> <span class="n">complete_network</span>  <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pseudopods</span> <span class="o">=</span> <span class="n">true_pseudopods</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">merge_network_with_pseudopods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        Merge the incomplete network with pseudopods.</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">        This method combines the incomplete network and pseudopods to form</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        the complete network. The incomplete network is updated by subtracting</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">        areas where pseudopods are present.</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">complete_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incomplete_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudopods</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_network</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudopods</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.NetworkDetection.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_rolling_window</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">origin_to_add</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">best_result</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the object with given parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>greyscale_image</code>
            </td>
            <td>
                  <code><span title="cellects.utils.load_display_save.NDArray">NDArray</span>[<span title="cellects.utils.load_display_save.np.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input greyscale image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>possibly_filled_pixels</code>
            </td>
            <td>
                  <code><span title="cellects.utils.load_display_save.NDArray">NDArray</span>[<span title="cellects.utils.load_display_save.np.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Image containing possibly filled pixels. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>add_rolling_window</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to add rolling window. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>origin_to_add</code>
            </td>
            <td>
                  <code><span title="cellects.utils.load_display_save.NDArray">NDArray</span>[<span title="cellects.utils.load_display_save.np.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Origin to add. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>best_result</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Best result dictionary. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">greyscale_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">possibly_filled_pixels</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_rolling_window</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">origin_to_add</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">best_result</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    Initialize the object with given parameters.</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    greyscale_image : NDArray[np.uint8]</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        The input greyscale image.</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    possibly_filled_pixels : NDArray[np.uint8], optional</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        Image containing possibly filled pixels. Defaults to None.</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">    add_rolling_window : bool, optional</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        Flag to add rolling window. Defaults to False.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    origin_to_add : NDArray[np.uint8], optional</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        Origin to add. Defaults to None.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    best_result : dict, optional</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        Best result dictionary. Defaults to None.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">greyscale_image</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="k">if</span> <span class="n">possibly_filled_pixels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span> <span class="o">=</span> <span class="n">possibly_filled_pixels</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span> <span class="o">=</span> <span class="n">best_result</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_rolling_window</span> <span class="o">=</span> <span class="n">add_rolling_window</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">origin_to_add</span> <span class="o">=</span> <span class="n">origin_to_add</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">frangi_beta</span> <span class="o">=</span> <span class="mf">1.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">frangi_gamma</span> <span class="o">=</span> <span class="mf">1.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">black_ridges</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.NetworkDetection.apply_frangi_variations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_frangi_variations</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Applies various Frangi filter variations with different sigma values and thresholding methods.</p>
<p>This method applies the Frangi vesselness filter with multiple sets of sigma values
to detect vessels at different scales. It applies both Otsu thresholding and rolling window
segmentation to the filtered results and calculates binary quality indices.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>results</code></td>            <td>
                  <code>list of dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list containing dictionaries with the method name, binary result, quality index,
filtered image, filter type, rolling window flag, and sigma values used.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_frangi_variations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    Applies various Frangi filter variations with different sigma values and thresholding methods.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    This method applies the Frangi vesselness filter with multiple sets of sigma values</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    to detect vessels at different scales. It applies both Otsu thresholding and rolling window</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    segmentation to the filtered results and calculates binary quality indices.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    -------</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    results : list of dict</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        A list containing dictionaries with the method name, binary result, quality index,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        filtered image, filter type, rolling window flag, and sigma values used.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="c1"># Parameter variations for Frangi filter</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="n">frangi_sigmas</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="s1">&#39;s_fine_vessels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">],</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="s1">&#39;fine_vessels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>  <span class="c1"># Very fine capillaries, thin fibers</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="s1">&#39;small_vessels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>  <span class="c1"># Small vessels, fine structures</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="s1">&#39;multi_scale_medium&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>  <span class="c1"># Standard multi-scale</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="s1">&#39;ultra_fine&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>  <span class="c1"># Ultra-fine structures</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="s1">&#39;comprehensive&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>  <span class="c1"># Multi-scale</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="s1">&#39;retinal_vessels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">],</span>  <span class="c1"># Optimized for retinal imaging</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="s1">&#39;microscopy&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span>  <span class="c1"># Microscopy applications</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="s1">&#39;broad_spectrum&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="p">}</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frangi_sigmas</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="c1"># Apply Frangi filter</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">frangi_result</span> <span class="o">=</span> <span class="n">frangi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="n">sigmas</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frangi_beta</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frangi_gamma</span><span class="p">,</span> <span class="n">black_ridges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">black_ridges</span><span class="p">)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="c1"># Apply both thresholding methods</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="c1"># Method 1: Otsu thresholding</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="n">thresh_otsu</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">frangi_result</span><span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="n">binary_otsu</span> <span class="o">=</span> <span class="n">frangi_result</span> <span class="o">&gt;</span> <span class="n">thresh_otsu</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="n">quality_otsu</span> <span class="o">=</span> <span class="n">binary_quality_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span> <span class="o">*</span> <span class="n">binary_otsu</span><span class="p">)</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="c1"># Method 2: Rolling window thresholding</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="c1"># Store results</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;f_</span><span class="si">{</span><span class="n">sigmas</span><span class="si">}</span><span class="s1">_thresh&#39;</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="s1">&#39;binary&#39;</span><span class="p">:</span> <span class="n">binary_otsu</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="n">quality_otsu</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="s1">&#39;filtered&#39;</span><span class="p">:</span> <span class="n">frangi_result</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Frangi&#39;</span><span class="p">,</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="s1">&#39;rolling_window&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span> <span class="n">sigmas</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="p">})</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="c1"># Method 2: Rolling window thresholding</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_rolling_window</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="n">binary_rolling</span> <span class="o">=</span> <span class="n">rolling_window_segmentation</span><span class="p">(</span><span class="n">frangi_result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="n">quality_rolling</span> <span class="o">=</span> <span class="n">binary_quality_index</span><span class="p">(</span><span class="n">binary_rolling</span><span class="p">)</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;f_</span><span class="si">{</span><span class="n">sigmas</span><span class="si">}</span><span class="s1">_roll&#39;</span><span class="p">,</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                <span class="s1">&#39;binary&#39;</span><span class="p">:</span> <span class="n">binary_rolling</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="n">quality_rolling</span><span class="p">,</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                <span class="s1">&#39;filtered&#39;</span><span class="p">:</span> <span class="n">frangi_result</span><span class="p">,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Frangi&#39;</span><span class="p">,</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                <span class="s1">&#39;rolling_window&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span> <span class="n">sigmas</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="p">})</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.NetworkDetection.apply_sato_variations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_sato_variations</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Apply various Sato filter variations to an image and store the results.</p>
<p>This function applies different parameter sets for the Sato vesselness
filter to an image, applies two thresholding methods (Otsu and rolling window),
and stores the results. The function supports optional rolling window
segmentation based on a configuration flag.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list of dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list containing dictionaries with the results for each filter variation.
Each dictionary includes method name, binary image, quality index,
filtered result, filter type, rolling window flag, and sigma values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_sato_variations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    Apply various Sato filter variations to an image and store the results.</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">    This function applies different parameter sets for the Sato vesselness</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">    filter to an image, applies two thresholding methods (Otsu and rolling window),</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">    and stores the results. The function supports optional rolling window</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">    segmentation based on a configuration flag.</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">    -------</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">    list of dict</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">        A list containing dictionaries with the results for each filter variation.</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">        Each dictionary includes method name, binary image, quality index,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">        filtered result, filter type, rolling window flag, and sigma values.</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="c1"># Parameter variations for Frangi filter</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="n">sato_sigmas</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="s1">&#39;super_small_tubes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">],</span>  <span class="c1">#</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="s1">&#39;small_tubes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>  <span class="c1">#</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="s1">&#39;s_thick_ridges&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span>  <span class="c1"># Thick ridges/tubes</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="s1">&#39;small_multi_scale&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">],</span>  <span class="c1">#</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="s1">&#39;fine_ridges&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span>  <span class="c1"># Fine ridge detection</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="s1">&#39;medium_ridges&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>  <span class="c1"># Medium ridge structures</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="s1">&#39;multi_scale_fine&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span>  <span class="c1"># Multi-scale fine detection</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="s1">&#39;multi_scale_standard&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span>  <span class="c1"># Standard multi-scale</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="s1">&#39;edge_enhanced&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>  <span class="c1"># Edge-enhanced detection</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="s1">&#39;noise_robust&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>  <span class="c1"># Robust to noise</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="s1">&#39;fingerprint&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>  <span class="c1"># Fingerprint ridge detection</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="s1">&#39;geological&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">]</span>  <span class="c1"># Geological structures</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="p">}</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sato_sigmas</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="c1"># Apply sato filter</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">sato_result</span> <span class="o">=</span> <span class="n">sato</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="n">sigmas</span><span class="p">,</span> <span class="n">black_ridges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">black_ridges</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;reflect&#39;</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="c1"># Apply both thresholding methods</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="c1"># Method 1: Otsu thresholding</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="n">thresh_otsu</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">sato_result</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="n">binary_otsu</span> <span class="o">=</span> <span class="n">sato_result</span> <span class="o">&gt;</span> <span class="n">thresh_otsu</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="n">quality_otsu</span> <span class="o">=</span> <span class="n">binary_quality_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span> <span class="o">*</span> <span class="n">binary_otsu</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="c1"># Store results</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;s_</span><span class="si">{</span><span class="n">sigmas</span><span class="si">}</span><span class="s1">_thresh&#39;</span><span class="p">,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="s1">&#39;binary&#39;</span><span class="p">:</span> <span class="n">binary_otsu</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="n">quality_otsu</span><span class="p">,</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="s1">&#39;filtered&#39;</span><span class="p">:</span> <span class="n">sato_result</span><span class="p">,</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Sato&#39;</span><span class="p">,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="s1">&#39;rolling_window&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span> <span class="n">sigmas</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="p">})</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="c1"># Method 2: Rolling window thresholding</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_rolling_window</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="n">binary_rolling</span> <span class="o">=</span> <span class="n">rolling_window_segmentation</span><span class="p">(</span><span class="n">sato_result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="n">quality_rolling</span> <span class="o">=</span> <span class="n">binary_quality_index</span><span class="p">(</span><span class="n">binary_rolling</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;s_</span><span class="si">{</span><span class="n">sigmas</span><span class="si">}</span><span class="s1">_roll&#39;</span><span class="p">,</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="s1">&#39;binary&#39;</span><span class="p">:</span> <span class="n">binary_rolling</span><span class="p">,</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                <span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="n">quality_rolling</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="s1">&#39;filtered&#39;</span><span class="p">:</span> <span class="n">sato_result</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Sato&#39;</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="s1">&#39;rolling_window&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span> <span class="n">sigmas</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="p">})</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.NetworkDetection.change_greyscale" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">change_greyscale</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">first_dict</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Change the image to greyscale using color space combinations.</p>
<p>This function converts an input image to greyscale by generating
and applying a combination of color spaces specified in the dictionary.
The resulting greyscale image is stored as an attribute of the instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>img</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input image to be converted to greyscale.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="k">def</span><span class="w"> </span><span class="nf">change_greyscale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">first_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    Change the image to greyscale using color space combinations.</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">    This function converts an input image to greyscale by generating</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">    and applying a combination of color spaces specified in the dictionary.</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">    The resulting greyscale image is stored as an attribute of the instance.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">    img : ndarray of uint8</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">        The input image to be converted to greyscale.</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">first_pc_vector</span>  <span class="o">=</span> <span class="n">generate_color_space_combination</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">first_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">first_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.NetworkDetection.detect_network" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect_network</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Process and detect network features in the greyscale image.</p>
<p>This method applies a frangi or sato filter based on the best result and
performs segmentation using either rolling window or Otsu's thresholding.
The final network detection result is stored in <code>self.incomplete_network</code>.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">    Process and detect network features in the greyscale image.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    This method applies a frangi or sato filter based on the best result and</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">    performs segmentation using either rolling window or Otsu&#39;s thresholding.</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">    The final network detection result is stored in `self.incomplete_network`.</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Frangi&#39;</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="n">filtered_result</span> <span class="o">=</span> <span class="n">frangi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;sigmas&#39;</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frangi_beta</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frangi_gamma</span><span class="p">,</span> <span class="n">black_ridges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">black_ridges</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="n">filtered_result</span> <span class="o">=</span> <span class="n">sato</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;sigmas&#39;</span><span class="p">],</span> <span class="n">black_ridges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">black_ridges</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;reflect&#39;</span><span class="p">)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;rolling_window&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="n">binary_image</span> <span class="o">=</span> <span class="n">rolling_window_segmentation</span><span class="p">(</span><span class="n">filtered_result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>        <span class="n">thresh_otsu</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">filtered_result</span><span class="p">)</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>        <span class="n">binary_image</span> <span class="o">=</span> <span class="n">filtered_result</span> <span class="o">&gt;</span> <span class="n">thresh_otsu</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_network</span> <span class="o">=</span> <span class="n">binary_image</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.NetworkDetection.detect_pseudopods" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect_pseudopods</span><span class="p">(</span><span class="n">lighter_background</span><span class="p">,</span> <span class="n">pseudopod_min_width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pseudopod_min_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">only_one_connected_component</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Detect pseudopods in a binary image.</p>
<p>Identify and process regions that resemble pseudopods based on width, size,
and connectivity criteria. This function is used to detect and label areas
that are indicative of pseudopod-like structures within a binary image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lighter_background</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean flag to indicate if the background should be considered lighter.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pseudopod_min_width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum width for pseudopods to be considered valid. Default is 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pseudopod_min_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum size for pseudopods to be considered valid. Default is 50.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>only_one_connected_component</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to ensure only one connected component is kept. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function modifies internal attributes of the object, specifically setting <code>self.pseudopods</code> to an array indicating pseudopod regions.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">detect_pseudopods</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudopods</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">array([[0, 1, ..., 0],</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">       [0, 0, ..., 0],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">       ...,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">       [0, 1, ..., 0]], dtype=uint8)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect_pseudopods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lighter_background</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">pseudopod_min_width</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pseudopod_min_size</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">only_one_connected_component</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">    Detect pseudopods in a binary image.</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">    Identify and process regions that resemble pseudopods based on width, size,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    and connectivity criteria. This function is used to detect and label areas</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    that are indicative of pseudopod-like structures within a binary image.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    lighter_background : bool</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">        Boolean flag to indicate if the background should be considered lighter.</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">    pseudopod_min_width : int, optional</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">        Minimum width for pseudopods to be considered valid. Default is 5.</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">    pseudopod_min_size : int, optional</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        Minimum size for pseudopods to be considered valid. Default is 50.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    only_one_connected_component : bool, optional</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">        Flag to ensure only one connected component is kept. Default is True.</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">    -------</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">    None</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    -----</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">    This function modifies internal attributes of the object, specifically setting `self.pseudopods` to an array indicating pseudopod regions.</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    --------</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    &gt;&gt;&gt; result = detect_pseudopods(True, 5, 50)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    &gt;&gt;&gt; print(self.pseudopods)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    array([[0, 1, ..., 0],</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">           [0, 0, ..., 0],</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">           ...,</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">           [0, 1, ..., 0]], dtype=uint8)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="n">closed_im</span> <span class="o">=</span> <span class="n">close_holes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">dist_trans</span> <span class="o">=</span> <span class="n">distance_transform_edt</span><span class="p">(</span><span class="n">closed_im</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="n">dist_trans</span> <span class="o">=</span> <span class="n">dist_trans</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">dist_trans</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="c1"># Add dilatation of bracket of distances from medial_axis to the multiplication</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="k">if</span> <span class="n">lighter_background</span><span class="p">:</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="n">grey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>        <span class="n">grey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">greyscale_image</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_to_add</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="n">dist_trans_ori</span> <span class="o">=</span> <span class="n">distance_transform_edt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_to_add</span><span class="p">)</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="n">scored_im</span> <span class="o">=</span> <span class="n">dist_trans</span> <span class="o">*</span> <span class="n">dist_trans_ori</span> <span class="o">*</span> <span class="n">grey</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>        <span class="n">scored_im</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist_trans</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">grey</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>    <span class="n">scored_im</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">scored_im</span><span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>    <span class="n">thresh</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">scored_im</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="n">thresh</span> <span class="o">=</span> <span class="n">find_threshold_given_mask</span><span class="p">(</span><span class="n">scored_im</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">min_threshold</span><span class="o">=</span><span class="n">thresh</span><span class="p">)</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>    <span class="n">high_int_in_periphery</span> <span class="o">=</span> <span class="p">(</span><span class="n">scored_im</span> <span class="o">&gt;</span> <span class="n">thresh</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="n">_</span><span class="p">,</span> <span class="n">pseudopod_widths</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">medial_axis</span><span class="p">(</span><span class="n">high_int_in_periphery</span><span class="p">,</span> <span class="n">return_distance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>    <span class="n">bin_im</span> <span class="o">=</span> <span class="n">pseudopod_widths</span> <span class="o">&gt;=</span> <span class="n">pseudopod_min_width</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="n">dil_bin_im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">bin_im</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">kernel</span><span class="o">=</span><span class="n">create_ellipse</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="n">bin_im</span> <span class="o">=</span> <span class="n">high_int_in_periphery</span> <span class="o">*</span> <span class="n">dil_bin_im</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>    <span class="n">nb</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centro</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="n">bin_im</span><span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>    <span class="n">true_pseudopods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pseudopod_min_size</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>    <span class="n">true_pseudopods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">true_pseudopods</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="c1"># Make sure that the tubes connecting two pseudopods belong to pseudopods if removing pseudopods cuts the network</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>    <span class="n">complete_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">true_pseudopods</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_network</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>    <span class="k">if</span> <span class="n">only_one_connected_component</span><span class="p">:</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="n">complete_network</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="n">complete_network</span><span class="p">)</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>        <span class="n">without_pseudopods</span> <span class="o">=</span> <span class="n">complete_network</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>        <span class="n">without_pseudopods</span><span class="p">[</span><span class="n">true_pseudopods</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="n">only_connected_network</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="n">without_pseudopods</span><span class="p">)</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pseudopods</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">only_connected_network</span><span class="p">)</span> <span class="o">*</span> <span class="n">complete_network</span>  <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pseudopods</span> <span class="o">=</span> <span class="n">true_pseudopods</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.NetworkDetection.get_best_network_detection_method" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_best_network_detection_method</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the best network detection method based on quality metrics.</p>
<p>This function applies Frangi and Sato variations, combines their results,
calculates quality metrics for each result, and selects the best method.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.NetworkDetection.get_best_network_detection_method.all_results">all_results</span></code></td>
            <td>
                  <code>list of dicts</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Combined results from Frangi and Sato variations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.NetworkDetection.get_best_network_detection_method.quality_metrics">quality_metrics</span></code></td>
            <td>
                  <code>ndarray of float64</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quality metrics for each detection result.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.NetworkDetection.get_best_network_detection_method.best_idx">best_idx</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the best detection method based on quality metrics.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.NetworkDetection.get_best_network_detection_method.best_result">best_result</span></code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The best detection result from all possible methods.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.motion_analysis.NetworkDetection.get_best_network_detection_method.incomplete_network">incomplete_network</span></code></td>
            <td>
                  <code>ndarray of bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binary representation of the best detection result.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">possibly_filled_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">possibly_filled_pixels</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">possibly_filled_pixels</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">possibly_filled_pixels</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">possibly_filled_pixels</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">possibly_filled_pixels</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">greyscale_image</span><span class="p">[</span><span class="n">greyscale_image</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">170</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">greyscale_image</span><span class="p">[</span><span class="n">greyscale_image</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">possibly_filled_pixels</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">add_rolling_window</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">origin_to_add</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">origin_to_add</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">NetDet</span> <span class="o">=</span> <span class="n">NetworkDetection</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">add_rolling_window</span><span class="p">,</span> <span class="n">origin_to_add</span><span class="p">)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">NetDet</span><span class="o">.</span><span class="n">get_best_network_detection_method</span><span class="p">()</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">NetDet</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">NetDet</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">])</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">NetDet</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">])</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">NetDet</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;filtered&#39;</span><span class="p">])</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">NetDet</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">])</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">NetDet</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;rolling_window&#39;</span><span class="p">])</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">NetDet</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;sigmas&#39;</span><span class="p">])</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="go">bgr_image = np.random.randint(0, 256, (100, 100, 3), dtype=np.uint8)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_best_network_detection_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">    Get the best network detection method based on quality metrics.</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">    This function applies Frangi and Sato variations, combines their results,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">    calculates quality metrics for each result, and selects the best method.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">    all_results : list of dicts</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">        Combined results from Frangi and Sato variations.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">    quality_metrics : ndarray of float64</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">        Quality metrics for each detection result.</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">    best_idx : int</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">        Index of the best detection method based on quality metrics.</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">    best_result : dict</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">        The best detection result from all possible methods.</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">    incomplete_network : ndarray of bool</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">        Binary representation of the best detection result.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">    &gt;&gt;&gt; possibly_filled_pixels = np.zeros((9, 9), dtype=np.uint8)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">    &gt;&gt;&gt; possibly_filled_pixels[3:6, 3:6] = 1</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">    &gt;&gt;&gt; possibly_filled_pixels[1:6, 3] = 1</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">    &gt;&gt;&gt; possibly_filled_pixels[6:-1, 5] = 1</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">    &gt;&gt;&gt; possibly_filled_pixels[4, 1:-1] = 1</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">    &gt;&gt;&gt; greyscale_image = possibly_filled_pixels.copy()</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">    &gt;&gt;&gt; greyscale_image[greyscale_image &gt; 0] = np.random.randint(170, 255, possibly_filled_pixels.sum())</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">    &gt;&gt;&gt; greyscale_image[greyscale_image == 0] = np.random.randint(0, 120, possibly_filled_pixels.size - possibly_filled_pixels.sum())</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">    &gt;&gt;&gt; add_rolling_window=False</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    &gt;&gt;&gt; origin_to_add = np.zeros((9, 9), dtype=np.uint8)</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    &gt;&gt;&gt; origin_to_add[3:6, 3:6] = 1</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    &gt;&gt;&gt; NetDet = NetworkDetection(greyscale_image, possibly_filled_pixels, add_rolling_window, origin_to_add)</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">    &gt;&gt;&gt; NetDet.get_best_network_detection_method()</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">    &gt;&gt;&gt; print(NetDet.best_result[&#39;method&#39;])</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    &gt;&gt;&gt; print(NetDet.best_result[&#39;binary&#39;])</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">    &gt;&gt;&gt; print(NetDet.best_result[&#39;quality&#39;])</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">    &gt;&gt;&gt; print(NetDet.best_result[&#39;filtered&#39;])</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">    &gt;&gt;&gt; print(NetDet.best_result[&#39;filter&#39;])</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">    &gt;&gt;&gt; print(NetDet.best_result[&#39;rolling_window&#39;])</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">    &gt;&gt;&gt; print(NetDet.best_result[&#39;sigmas&#39;])</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">    bgr_image = np.random.randint(0, 256, (100, 100, 3), dtype=np.uint8)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="n">frangi_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_frangi_variations</span><span class="p">()</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="n">sato_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_sato_variations</span><span class="p">()</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span> <span class="o">=</span> <span class="n">frangi_res</span> <span class="o">+</span> <span class="n">sato_res</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span><span class="p">])</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">best_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics</span><span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">best_idx</span><span class="p">]</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibly_filled_pixels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.NetworkDetection.merge_network_with_pseudopods" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_network_with_pseudopods</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Merge the incomplete network with pseudopods.</p>
<p>This method combines the incomplete network and pseudopods to form
the complete network. The incomplete network is updated by subtracting
areas where pseudopods are present.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="k">def</span><span class="w"> </span><span class="nf">merge_network_with_pseudopods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    Merge the incomplete network with pseudopods.</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">    This method combines the incomplete network and pseudopods to form</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">    the complete network. The incomplete network is updated by subtracting</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    areas where pseudopods are present.</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">complete_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incomplete_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudopods</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_network</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudopods</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cellects.core.motion_analysis.PickleRick" class="doc doc-heading">
            <code>PickleRick</code>


</h2>


    <div class="doc doc-contents ">



        <p>A class to handle safe file reading and writing operations using pickle.</p>
<p>This class ensures that files are not being accessed concurrently by
creating a lock file (PickleRickX.pkl) to signal that the file is open.
It includes methods to check for the lock file, write data safely,
and read data safely.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="k">class</span><span class="w"> </span><span class="nc">PickleRick</span><span class="p">:</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    A class to handle safe file reading and writing operations using pickle.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    This class ensures that files are not being accessed concurrently by</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    creating a lock file (PickleRickX.pkl) to signal that the file is open.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    It includes methods to check for the lock file, write data safely,</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    and read data safely.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickle_rick_number</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        Initialize a new instance of the class.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        This constructor sets up initial attributes for tracking Rick&#39;s state, including</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        a boolean flag for waiting for Pickle Rick, a counter, the provided pickle Rick number,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        and the time when the first check was performed.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        pickle_rick_number : str, optional</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            The number associated with Pickle Rick. Defaults to an empty string.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_pickle_rick</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pickle_rick_number</span> <span class="o">=</span> <span class="n">pickle_rick_number</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_check_time</span> <span class="o">=</span> <span class="n">default_timer</span><span class="p">()</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_that_file_is_not_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        Check if a specific pickle file exists and handle it accordingly.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        This function checks whether a file named `PickleRick{self.pickle_rick_number}.pkl`</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        exists. If the file has not been modified for more than 2 seconds, it is removed.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        The function then updates an attribute to indicate whether the file exists.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        self : PickleRickObject</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            The instance of the class containing this method.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        -------</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        None</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            This function does not return any value.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            It updates the `self.wait_for_pickle_rick` attribute.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        -----</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        This function removes the pickle file if it has not been modified for more than 2 seconds.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        The `self.wait_for_pickle_rick` attribute is updated based on the existence of the file.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PickleRick</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_rick_number</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">):</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="k">if</span> <span class="n">default_timer</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_check_time</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PickleRick</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_rick_number</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="c1"># logging.error((f&quot;Cannot read/write, Trying again... tip: unlock by deleting the file named PickleRick{self.pickle_rick_number}.pkl&quot;))</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_pickle_rick</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PickleRick</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_rick_number</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_write_pickle_rick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        Write pickle data to a file for Pickle Rick.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        self : object</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            The instance of the class that this method belongs to.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            This typically contains attributes and methods relevant to managing</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            pickle operations for Pickle Rick.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        ------</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        Exception</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">            General exception raised if there is any issue with writing the file.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">            The error details are logged.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        -----</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        This function creates a file named `PickleRick{self.pickle_rick_number}.pkl`</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        with a dictionary indicating readiness for Pickle Rick.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        --------</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        &gt;&gt;&gt; obj = PickleRick()  # Assuming `YourClassInstance` is the class containing this method</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        &gt;&gt;&gt; obj.pickle_rick_number = 1  # Set an example value for the attribute</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        &gt;&gt;&gt; obj._write_pickle_rick()     # Call the method to create and write to file</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PickleRick</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_rick_number</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_to_write</span><span class="p">:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s1">&#39;wait_for_pickle_rick&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">file_to_write</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Don&#39;t know how but Pickle Rick failed... Error is: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_delete_pickle_rick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Delete a specific Pickle Rick file.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        Deletes the pickle file associated with the current instance&#39;s</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        `pickle_rick_number`.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        ------</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        FileNotFoundError</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">            If the file with name `PickleRick{self.pickle_rick_number}.pkl` does not exist.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PickleRick</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_rick_number</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">):</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PickleRick</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_rick_number</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_content</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        Write content to a file with error handling and retry logic.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        This function attempts to write the provided content into a file.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        If it fails, it retries up to 100 times with some additional checks</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        and delays. Note that the content is serialized using pickle.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        file_content : Any</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">            The data to be written into the file. This will be pickled.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        file_name : str</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">            The name of the file where data should be written.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        -------</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        None</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        ------</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        Exception</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">            If the file cannot be written after 100 attempts, an error is logged.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        -----</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        This function uses pickle to serialize the data, which can introduce security risks</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        if untrusted content is being written. It performs some internal state checks,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        such as verifying that the target file isn&#39;t open and whether it should delete</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        some internal state, represented by `_delete_pickle_rick`.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        The function implements a retry mechanism with a backoff strategy that can include</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        random delays, though the example code does not specify these details explicitly.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        --------</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        &gt;&gt;&gt; result = PickleRick().write_file({&#39;key&#39;: &#39;value&#39;}, &#39;test.pkl&#39;)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        Success to write file</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">95</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="c1"># time.sleep(np.random.choice(np.arange(1, os.cpu_count(), 0.5)))</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_that_file_is_not_open</span><span class="p">()</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_pickle_rick</span><span class="p">:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_write_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_to_write</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">file_to_write</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_delete_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success to write file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Pickle error on the file </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> is: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_delete_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        Reads the contents of a file using pickle and returns it.</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        file_name : str</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">            The name of the file to be read.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        -------</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        Union[Any, None]</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">            The content of the file if successfully read; otherwise, `None`.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        ------</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">        Exception</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">            If there is an error reading the file.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        -----</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        This function attempts to read a file multiple times if it fails.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        If the number of attempts exceeds 1000, it logs an error and returns `None`.</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        --------</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        &gt;&gt;&gt; PickleRick().read_file(&quot;example.pkl&quot;)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">950</span><span class="p">:</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_that_file_is_not_open</span><span class="p">()</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_pickle_rick</span><span class="p">:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_write_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileopen</span><span class="p">:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                        <span class="n">file_content</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fileopen</span><span class="p">)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Pickle error on the file </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> is: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                    <span class="n">file_content</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                <span class="k">if</span> <span class="n">file_content</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success to read file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                <span class="k">return</span> <span class="n">file_content</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.PickleRick.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">pickle_rick_number</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize a new instance of the class.</p>
<p>This constructor sets up initial attributes for tracking Rick's state, including
a boolean flag for waiting for Pickle Rick, a counter, the provided pickle Rick number,
and the time when the first check was performed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pickle_rick_number</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number associated with Pickle Rick. Defaults to an empty string.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickle_rick_number</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    Initialize a new instance of the class.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    This constructor sets up initial attributes for tracking Rick&#39;s state, including</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    a boolean flag for waiting for Pickle Rick, a counter, the provided pickle Rick number,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    and the time when the first check was performed.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    pickle_rick_number : str, optional</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        The number associated with Pickle Rick. Defaults to an empty string.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_pickle_rick</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pickle_rick_number</span> <span class="o">=</span> <span class="n">pickle_rick_number</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_check_time</span> <span class="o">=</span> <span class="n">default_timer</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.PickleRick.read_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reads the contents of a file using pickle and returns it.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the file to be read.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Union">Union</span>[<span title="Any">Any</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The content of the file if successfully read; otherwise, <code>None</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is an error reading the file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function attempts to read a file multiple times if it fails.
If the number of attempts exceeds 1000, it logs an error and returns <code>None</code>.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">PickleRick</span><span class="p">()</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;example.pkl&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="k">def</span><span class="w"> </span><span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    Reads the contents of a file using pickle and returns it.</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    file_name : str</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        The name of the file to be read.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    -------</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    Union[Any, None]</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        The content of the file if successfully read; otherwise, `None`.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    ------</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    Exception</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        If there is an error reading the file.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    -----</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    This function attempts to read a file multiple times if it fails.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    If the number of attempts exceeds 1000, it logs an error and returns `None`.</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    --------</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    &gt;&gt;&gt; PickleRick().read_file(&quot;example.pkl&quot;)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">950</span><span class="p">:</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_that_file_is_not_open</span><span class="p">()</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_pickle_rick</span><span class="p">:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileopen</span><span class="p">:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                    <span class="n">file_content</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fileopen</span><span class="p">)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Pickle error on the file </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> is: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="n">file_content</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>            <span class="k">if</span> <span class="n">file_content</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success to read file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="k">return</span> <span class="n">file_content</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.motion_analysis.PickleRick.write_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_file</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Write content to a file with error handling and retry logic.</p>
<p>This function attempts to write the provided content into a file.
If it fails, it retries up to 100 times with some additional checks
and delays. Note that the content is serialized using pickle.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_content</code>
            </td>
            <td>
                  <code><span title="Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data to be written into the file. This will be pickled.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the file where data should be written.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file cannot be written after 100 attempts, an error is logged.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function uses pickle to serialize the data, which can introduce security risks
if untrusted content is being written. It performs some internal state checks,
such as verifying that the target file isn't open and whether it should delete
some internal state, represented by <code>_delete_pickle_rick</code>.</p>
<p>The function implements a retry mechanism with a backoff strategy that can include
random delays, though the example code does not specify these details explicitly.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">()</span><span class="o">.</span><span class="n">write_file</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">},</span> <span class="s1">&#39;test.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="go">Success to write file</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="k">def</span><span class="w"> </span><span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_content</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    Write content to a file with error handling and retry logic.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    This function attempts to write the provided content into a file.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    If it fails, it retries up to 100 times with some additional checks</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    and delays. Note that the content is serialized using pickle.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    file_content : Any</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        The data to be written into the file. This will be pickled.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">    file_name : str</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        The name of the file where data should be written.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    -------</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    None</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    ------</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">    Exception</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        If the file cannot be written after 100 attempts, an error is logged.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    -----</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    This function uses pickle to serialize the data, which can introduce security risks</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    if untrusted content is being written. It performs some internal state checks,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    such as verifying that the target file isn&#39;t open and whether it should delete</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    some internal state, represented by `_delete_pickle_rick`.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    The function implements a retry mechanism with a backoff strategy that can include</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">    random delays, though the example code does not specify these details explicitly.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    --------</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    &gt;&gt;&gt; result = PickleRick().write_file({&#39;key&#39;: &#39;value&#39;}, &#39;test.pkl&#39;)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    Success to write file</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">95</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="c1"># time.sleep(np.random.choice(np.arange(1, os.cpu_count(), 0.5)))</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_that_file_is_not_open</span><span class="p">()</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_pickle_rick</span><span class="p">:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_to_write</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">file_to_write</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success to write file&quot;</span><span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Pickle error on the file </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> is: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_pickle_rick</span><span class="p">()</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.ad_pad" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ad_pad</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Pad the input array with a single layer of zeros around its edges.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arr</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input array to pad. Must be at least 2-dimensional.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>padded_arr</code></td>            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The output array with a single 0-padded layer around its edges.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function uses NumPy's <code>pad</code> with mode='constant' to add a single layer
of zeros around the edges of the input array.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">ad_pad</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">array([[0, 0, 0, 0],</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">   [0, 1, 2, 0],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">   [0, 3, 4, 0],</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">   [0, 0, 0, 0]])</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1895" name="__codelineno-0-1895"></a><span class="k">def</span><span class="w"> </span><span class="nf">ad_pad</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-1896" name="__codelineno-0-1896"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1897" name="__codelineno-0-1897"></a><span class="sd">    Pad the input array with a single layer of zeros around its edges.</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898"></a>
<a id="__codelineno-0-1899" name="__codelineno-0-1899"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1901" name="__codelineno-0-1901"></a><span class="sd">    arr : ndarray</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902"></a><span class="sd">        The input array to pad. Must be at least 2-dimensional.</span>
<a id="__codelineno-0-1903" name="__codelineno-0-1903"></a>
<a id="__codelineno-0-1904" name="__codelineno-0-1904"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1905" name="__codelineno-0-1905"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1906" name="__codelineno-0-1906"></a><span class="sd">    padded_arr : ndarray</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907"></a><span class="sd">        The output array with a single 0-padded layer around its edges.</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908"></a>
<a id="__codelineno-0-1909" name="__codelineno-0-1909"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1910" name="__codelineno-0-1910"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911"></a><span class="sd">    This function uses NumPy&#39;s `pad` with mode=&#39;constant&#39; to add a single layer</span>
<a id="__codelineno-0-1912" name="__codelineno-0-1912"></a><span class="sd">    of zeros around the edges of the input array.</span>
<a id="__codelineno-0-1913" name="__codelineno-0-1913"></a>
<a id="__codelineno-0-1914" name="__codelineno-0-1914"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1915" name="__codelineno-0-1915"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a><span class="sd">    &gt;&gt;&gt; arr = np.array([[1, 2], [3, 4]])</span>
<a id="__codelineno-0-1917" name="__codelineno-0-1917"></a><span class="sd">    &gt;&gt;&gt; ad_pad(arr)</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918"></a><span class="sd">    array([[0, 0, 0, 0],</span>
<a id="__codelineno-0-1919" name="__codelineno-0-1919"></a><span class="sd">       [0, 1, 2, 0],</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a><span class="sd">       [0, 3, 4, 0],</span>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a><span class="sd">       [0, 0, 0, 0]])</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">)],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.add_padding" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_padding</span><span class="p">(</span><span class="n">array_list</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add padding to each 2D array in a list.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array_list</code>
            </td>
            <td>
                  <code>list of ndarrays</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of 2D NumPy arrays to be processed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>list of ndarrays</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of 2D NumPy arrays with the padding removed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">array_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])]</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">padded_list</span> <span class="o">=</span> <span class="n">add_padding</span><span class="p">(</span><span class="n">array_list</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">padded_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">[[0 0 0]</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go"> [0 1 2 0]</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go"> [0 3 4 0]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go"> [0 0 0]]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1954" name="__codelineno-0-1954"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_padding</span><span class="p">(</span><span class="n">array_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-1955" name="__codelineno-0-1955"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1956" name="__codelineno-0-1956"></a><span class="sd">    Add padding to each 2D array in a list.</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a><span class="sd">    array_list : list of ndarrays</span>
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a><span class="sd">        List of 2D NumPy arrays to be processed.</span>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a><span class="sd">    out : list of ndarrays</span>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a><span class="sd">        List of 2D NumPy arrays with the padding removed.</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>
<a id="__codelineno-0-1968" name="__codelineno-0-1968"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a><span class="sd">    &gt;&gt;&gt; array_list = [np.array([[1, 2], [3, 4]])]</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a><span class="sd">    &gt;&gt;&gt; padded_list = add_padding(array_list)</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a><span class="sd">    &gt;&gt;&gt; print(padded_list[0])</span>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a><span class="sd">    [[0 0 0]</span>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a><span class="sd">     [0 1 2 0]</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a><span class="sd">     [0 3 4 0]</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a><span class="sd">     [0 0 0]]</span>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>    <span class="n">new_array_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>    <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">array_list</span><span class="p">:</span>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>        <span class="n">new_array_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ad_pad</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>    <span class="k">return</span> <span class="n">new_array_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.binary_quality_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">binary_quality_index</span><span class="p">(</span><span class="n">binary_img</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the binary quality index for a binary image.</p>
<p>The binary quality index is computed based on the perimeter of the largest
connected component in the binary image, normalized by the total number of
pixels.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>binary_img</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input binary image array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The binary quality index value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="k">def</span><span class="w"> </span><span class="nf">binary_quality_index</span><span class="p">(</span><span class="n">binary_img</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">    Calculate the binary quality index for a binary image.</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="sd">    The binary quality index is computed based on the perimeter of the largest</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a><span class="sd">    connected component in the binary image, normalized by the total number of</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a><span class="sd">    pixels.</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a><span class="sd">    binary_img : ndarray of uint8</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a><span class="sd">        Input binary image array.</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="sd">    -------</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a><span class="sd">    out : float</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a><span class="sd">        The binary quality index value.</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">binary_img</span><span class="p">):</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>        <span class="c1"># SD = ShapeDescriptors(binary_img, [&quot;euler_number&quot;])</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>        <span class="c1"># index = - SD.descriptors[&#39;euler_number&#39;]</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>        <span class="n">size</span><span class="p">,</span> <span class="n">largest_cc</span> <span class="o">=</span> <span class="n">get_largest_connected_component</span><span class="p">(</span><span class="n">binary_img</span><span class="p">)</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">perimeter</span><span class="p">(</span><span class="n">largest_cc</span><span class="p">))</span> <span class="o">/</span> <span class="n">binary_img</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>        <span class="c1"># index = (largest_cc.sum() * perimeter(largest_cc)) / binary_img.sum()</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span class="n">index</span> <span class="o">=</span> <span class="mf">0.</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>    <span class="k">return</span> <span class="n">index</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.bracket_to_uint8_image_contrast" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert an image with bracket contrast values to uint8 type.</p>
<p>This function normalizes an input image by scaling the minimum and maximum
values of the image to the range [0, 255] and then converts it to uint8
data type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input image as a numpy array with floating-point values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output image converted to uint8 type after normalization.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="k">def</span><span class="w"> </span><span class="nf">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">):</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    Convert an image with bracket contrast values to uint8 type.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    This function normalizes an input image by scaling the minimum and maximum</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    values of the image to the range [0, 255] and then converts it to uint8</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    data type.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    image : ndarray</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        Input image as a numpy array with floating-point values.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    -------</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    ndarray of uint8</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        Output image converted to uint8 type after normalization.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    --------</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    &gt;&gt;&gt; image = np.random.randint(0, 255, (10, 10), dtype=np.uint8)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    &gt;&gt;&gt; res = bracket_to_uint8_image_contrast(image)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    &gt;&gt;&gt; print(res)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    &gt;&gt;&gt; image = np.zeros((10, 10), dtype=np.uint8)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    &gt;&gt;&gt; res = bracket_to_uint8_image_contrast(image)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    &gt;&gt;&gt; print(res)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">image</span> <span class="o">-=</span> <span class="n">image</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="k">return</span> <span class="n">to_uint8</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.close_holes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close_holes</span><span class="p">(</span><span class="n">binary_img</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Close holes in a binary image using connected components analysis.</p>
<p>This function identifies and closes small holes within the foreground objects of a binary image. It uses connected component analysis to find and fill holes that are smaller than the main object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>binary_img</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binary input image where holes need to be closed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binary image with closed holes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_img</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_img</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Creating a hole</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">close_holes</span><span class="p">(</span><span class="n">binary_img</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">[[0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go"> [0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go"> [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go"> [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="go"> [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="go"> [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="go"> [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="go"> [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="go"> [0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="go"> [0 0 0 0 0 0 0 0 0 0]]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/morphological_operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1358" name="__codelineno-0-1358"></a><span class="k">def</span><span class="w"> </span><span class="nf">close_holes</span><span class="p">(</span><span class="n">binary_img</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a><span class="sd">    Close holes in a binary image using connected components analysis.</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a><span class="sd">    This function identifies and closes small holes within the foreground objects of a binary image. It uses connected component analysis to find and fill holes that are smaller than the main object.</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a><span class="sd">    binary_img : ndarray of uint8</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a><span class="sd">        Binary input image where holes need to be closed.</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a><span class="sd">    out : ndarray of uint8</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a><span class="sd">        Binary image with closed holes.</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a><span class="sd">    &gt;&gt;&gt; binary_img = np.zeros((10, 10), dtype=np.uint8)</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a><span class="sd">    &gt;&gt;&gt; binary_img[2:8, 2:8] = 1</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a><span class="sd">    &gt;&gt;&gt; binary_img[4:6, 4:6] = 0  # Creating a hole</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a><span class="sd">    &gt;&gt;&gt; result = close_holes(binary_img)</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a><span class="sd">    [[0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a><span class="sd">     [0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a><span class="sd">     [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a><span class="sd">     [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a><span class="sd">     [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a><span class="sd">     [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a><span class="sd">     [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a><span class="sd">     [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a><span class="sd">     [0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a><span class="sd">     [0 0 0 0 0 0 0 0 0 0]]</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>    <span class="c1">#### Third version ####</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>    <span class="n">nb</span><span class="p">,</span> <span class="n">new_order</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponents</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">binary_img</span><span class="p">)</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>    <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>        <span class="n">binary_img</span><span class="p">[</span><span class="n">new_order</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>    <span class="k">return</span> <span class="n">binary_img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.combine_color_spaces" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">combine_color_spaces</span><span class="p">(</span><span class="n">c_space_dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">subtract_background</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Combine color spaces from a dictionary and generate an analyzable image.</p>
<p>This function processes multiple color spaces defined in <code>c_space_dict</code>, combines
them according to given coefficients, and produces a normalized image that can be
converted to uint8. Optionally subtracts background from the resultant image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>c_space_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing color spaces and their respective coefficients.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_c_spaces</code>
            </td>
            <td>
                  <code><span title="numba.typed.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of all available color spaces in the image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subtract_background</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Background image to subtract from the resultant image. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processed and normalized image in float64 format, ready for uint8 conversion.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">c_space_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">c_space_dict</span><span class="p">[</span><span class="s1">&#39;hsv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">all_c_spaces</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">all_c_spaces</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">all_c_spaces</span><span class="p">[</span><span class="s1">&#39;hsv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">combine_color_spaces</span><span class="p">(</span><span class="n">c_space_dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go">(5, 5)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="k">def</span><span class="w"> </span><span class="nf">combine_color_spaces</span><span class="p">(</span><span class="n">c_space_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">subtract_background</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    Combine color spaces from a dictionary and generate an analyzable image.</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    This function processes multiple color spaces defined in `c_space_dict`, combines</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    them according to given coefficients, and produces a normalized image that can be</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    converted to uint8. Optionally subtracts background from the resultant image.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    c_space_dict : dict</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        Dictionary containing color spaces and their respective coefficients.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    all_c_spaces : Dict</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        Dictionary of all available color spaces in the image.</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    subtract_background : NDArray, optional</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">        Background image to subtract from the resultant image. Defaults to None.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    -------</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    out : NDArray</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        Processed and normalized image in float64 format, ready for uint8 conversion.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    --------</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    &gt;&gt;&gt; c_space_dict = Dict()</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    &gt;&gt;&gt; c_space_dict[&#39;hsv&#39;] = np.array((0, 1, 1))</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    &gt;&gt;&gt; all_c_spaces = Dict()</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    &gt;&gt;&gt; all_c_spaces[&#39;bgr&#39;] = np.random.rand(5, 5, 3)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">    &gt;&gt;&gt; all_c_spaces[&#39;hsv&#39;] = np.random.rand(5, 5, 3)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    &gt;&gt;&gt; background = np.zeros((5, 5))</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">    &gt;&gt;&gt; result = combine_color_spaces(c_space_dict, all_c_spaces)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    &gt;&gt;&gt; print(result.shape)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    (5, 5)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">all_c_spaces</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">all_c_spaces</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="k">for</span> <span class="n">space</span><span class="p">,</span> <span class="n">channels</span> <span class="ow">in</span> <span class="n">c_space_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">image</span> <span class="o">+=</span> <span class="n">c_space_dict</span><span class="p">[</span><span class="n">space</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">all_c_spaces</span><span class="p">[</span><span class="n">space</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_space_dict</span><span class="p">[</span><span class="n">space</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> \
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                 <span class="n">all_c_spaces</span><span class="p">[</span><span class="n">space</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_space_dict</span><span class="p">[</span><span class="n">space</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">all_c_spaces</span><span class="p">[</span><span class="n">space</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="k">if</span> <span class="n">subtract_background</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="c1"># add (resp. subtract) the most negative (resp. smallest) value to the whole matrix to get a min = 0</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">image</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="c1"># Make analysable this image by bracketing its values between 0 and 255 and converting it to uint8</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">max_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="k">if</span> <span class="n">max_im</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="n">image</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">subtract_background</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="n">image</span> <span class="o">-=</span> <span class="n">subtract_background</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">subtract_background</span> <span class="o">-</span> <span class="n">image</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="c1"># add (resp. subtract) the most negative (resp. smallest) value to the whole matrix to get a min = 0</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="n">image</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="c1"># Make analysable this image by bracketing its values between 0 and 255</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">max_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="k">if</span> <span class="n">max_im</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="n">image</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span> <span class="o">/</span> <span class="n">max_im</span><span class="p">)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.create_empty_videos" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_empty_videos</span><span class="p">(</span><span class="n">image_list</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">lose_accuracy_to_save_memory</span><span class="p">,</span> <span class="n">already_greyscale</span><span class="p">,</span> <span class="n">csc_dict</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create empty video arrays based on input parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_list</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cr</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Crop region defined by [x_start, y_start, x_end, y_end].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lose_accuracy_to_save_memory</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean flag to determine if memory should be saved by using uint8 data type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>already_greyscale</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean flag indicating if the images are already in greyscale format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>csc_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing color space conversion settings, including 'logical' key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing three elements:
    - <code>visu</code>: NumPy array with shape (len(image_list), cr[1] - cr[0] + 1, cr[3] - cr[2] + 1, 3) and dtype uint8 for RGB images.
    - <code>converted_video</code>: NumPy array with shape (len(image_list), cr[1] - cr[0] + 1, cr[3] - cr[2] + 1) and dtype uint8 or float according to <code>lose_accuracy_to_save_memory</code>.
    - <code>converted_video2</code>: NumPy array with shape same as <code>converted_video</code> and dtype uint8 or float according to <code>lose_accuracy_to_save_memory</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Performance considerations:
    - If <code>lose_accuracy_to_save_memory</code> is True, the function uses np.uint8 for memory efficiency.
    - If <code>already_greyscale</code> is False, additional arrays are created to store RGB data.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1207" name="__codelineno-0-1207"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_empty_videos</span><span class="p">(</span><span class="n">image_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">cr</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">lose_accuracy_to_save_memory</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>                        <span class="n">already_greyscale</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">csc_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><span class="sd">    Create empty video arrays based on input parameters.</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">    image_list : list</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a><span class="sd">        List of images.</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a><span class="sd">    cr : list</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a><span class="sd">        Crop region defined by [x_start, y_start, x_end, y_end].</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a><span class="sd">    lose_accuracy_to_save_memory : bool</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a><span class="sd">        Boolean flag to determine if memory should be saved by using uint8 data type.</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="sd">    already_greyscale : bool</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a><span class="sd">        Boolean flag indicating if the images are already in greyscale format.</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">    csc_dict : dict</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a><span class="sd">        Dictionary containing color space conversion settings, including &#39;logical&#39; key.</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">        A tuple containing three elements:</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a><span class="sd">            - `visu`: NumPy array with shape (len(image_list), cr[1] - cr[0] + 1, cr[3] - cr[2] + 1, 3) and dtype uint8 for RGB images.</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a><span class="sd">            - `converted_video`: NumPy array with shape (len(image_list), cr[1] - cr[0] + 1, cr[3] - cr[2] + 1) and dtype uint8 or float according to `lose_accuracy_to_save_memory`.</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">            - `converted_video2`: NumPy array with shape same as `converted_video` and dtype uint8 or float according to `lose_accuracy_to_save_memory`.</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a><span class="sd">    Performance considerations:</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a><span class="sd">        - If `lose_accuracy_to_save_memory` is True, the function uses np.uint8 for memory efficiency.</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a><span class="sd">        - If `already_greyscale` is False, additional arrays are created to store RGB data.</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>    <span class="n">visu</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">,</span> <span class="n">converted_video2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_list</span><span class="p">),</span> <span class="n">cr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">cr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>    <span class="k">if</span> <span class="n">lose_accuracy_to_save_memory</span><span class="p">:</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>        <span class="n">converted_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>        <span class="n">converted_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">already_greyscale</span><span class="p">:</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>        <span class="n">visu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>        <span class="k">if</span> <span class="n">csc_dict</span><span class="p">[</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>            <span class="k">if</span> <span class="n">lose_accuracy_to_save_memory</span><span class="p">:</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>                <span class="n">converted_video2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>                <span class="n">converted_video2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>    <span class="k">return</span> <span class="n">visu</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">,</span> <span class="n">converted_video2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.detect_network_dynamics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect_network_dynamics</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">binary</span><span class="p">,</span> <span class="n">arena_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">starting_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">visu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">smooth_segmentation_over_time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">detect_pseudopods</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_coord_network</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_seg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Detects and tracks dynamic features (e.g., pseudopods) in a biological network over time from video data.</p>
<p>Analyzes spatiotemporal dynamics of a network structure using binary masks and grayscale video data. Processes each frame to detect network components, optionally identifies pseudopods, applies temporal smoothing, and generates visualization overlays. Saves coordinate data for detected networks if enabled.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>converted_video</code>
            </td>
            <td>
                  <code><span title="cellects.utils.load_display_save.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input video data array with shape (time x y x z) representing grayscale intensities.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>binary</code>
            </td>
            <td>
                  <code><span title="cellects.utils.load_display_save.NDArray">NDArray</span>[<span title="cellects.utils.load_display_save.np.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binary mask array with shape (time x y x z) indicating filled regions in each frame.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>arena_label</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier for the current processing arena/session to name saved output files.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>starting_time</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Zero-based index of the first frame to begin network detection and analysis from.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>visu</code>
            </td>
            <td>
                  <code><span title="cellects.utils.load_display_save.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Visualization video array (time x y x z) with RGB channels for overlay rendering.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>origin</code>
            </td>
            <td>
                  <code><span title="cellects.utils.load_display_save.NDArray">NDArray</span>[<span title="cellects.utils.load_display_save.np.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binary mask defining a central region of interest to exclude from network detection.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smooth_segmentation_over_time</code>
            </td>
            <td>
                  <code>(<span title="bool">bool</span>, <span title="optional">optional</span>(default=True))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating whether to apply temporal smoothing using adjacent frame data.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>detect_pseudopods</code>
            </td>
            <td>
                  <code>(<span title="bool">bool</span>, <span title="optional">optional</span>(default=True))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Determines if pseudopod regions should be detected and merged with the network.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_coord_network</code>
            </td>
            <td>
                  <code>(<span title="bool">bool</span>, <span title="optional">optional</span>(default=True))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Controls saving of detected network/pseudopod coordinates as NumPy arrays.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_seg</code>
            </td>
            <td>
                  <code>(<span title="bool">bool</span>, <span title="optional">optional</span>(default=False))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enables real-time visualization display during processing.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cellects.utils.load_display_save.NDArray">NDArray</span>[<span title="cellects.utils.load_display_save.np.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>3D array containing detected network structures with shape (time x y x z). Uses:
- <code>0</code> for background,
- <code>1</code> for regular network components,
- <code>2</code> for pseudopod regions when detect_pseudopods is True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>Memory-intensive operations on large arrays may require system resources.</li>
<li>Temporal smoothing effectiveness depends on network dynamics consistency between frames.</li>
<li>Pseudopod detection requires sufficient contrast with the background in grayscale images.</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect_network_dynamics</span><span class="p">(</span><span class="n">converted_video</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">binary</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">arena_label</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>                            <span class="n">starting_time</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">visu</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>                            <span class="n">smooth_segmentation_over_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">detect_pseudopods</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>                            <span class="n">save_coord_network</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show_seg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Detects and tracks dynamic features (e.g., pseudopods) in a biological network over time from video data.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Analyzes spatiotemporal dynamics of a network structure using binary masks and grayscale video data. Processes each frame to detect network components, optionally identifies pseudopods, applies temporal smoothing, and generates visualization overlays. Saves coordinate data for detected networks if enabled.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    converted_video : NDArray</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        Input video data array with shape (time x y x z) representing grayscale intensities.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    binary : NDArray[np.uint8]</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        Binary mask array with shape (time x y x z) indicating filled regions in each frame.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    arena_label : int</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        Unique identifier for the current processing arena/session to name saved output files.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    starting_time : int</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        Zero-based index of the first frame to begin network detection and analysis from.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    visu : NDArray</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        Visualization video array (time x y x z) with RGB channels for overlay rendering.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    origin : NDArray[np.uint8]</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        Binary mask defining a central region of interest to exclude from network detection.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    smooth_segmentation_over_time : bool, optional (default=True)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Flag indicating whether to apply temporal smoothing using adjacent frame data.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    detect_pseudopods : bool, optional (default=True)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        Determines if pseudopod regions should be detected and merged with the network.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    save_coord_network : bool, optional (default=True)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        Controls saving of detected network/pseudopod coordinates as NumPy arrays.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    show_seg : bool, optional (default=False)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        Enables real-time visualization display during processing.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    -------</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    NDArray[np.uint8]</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        3D array containing detected network structures with shape (time x y x z). Uses:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        - `0` for background,</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        - `1` for regular network components,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        - `2` for pseudopod regions when detect_pseudopods is True.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    -----</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    - Memory-intensive operations on large arrays may require system resources.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    - Temporal smoothing effectiveness depends on network dynamics consistency between frames.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    - Pseudopod detection requires sufficient contrast with the background in grayscale images.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="n">arena_label</span><span class="si">}</span><span class="s2">. Starting network detection.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="c1"># converted_video = self.converted_video; binary=self.binary; arena_label=1; starting_time=0; visu=self.visu; origin=None; smooth_segmentation_over_time=True; detect_pseudopods=True;save_coord_network=True; show_seg=False</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">dims</span> <span class="o">=</span> <span class="n">binary</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">pseudopod_min_size</span> <span class="o">=</span> <span class="mi">50</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">if</span> <span class="n">detect_pseudopods</span><span class="p">:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">pseudopod_vid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">potential_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="n">network_dynamics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">do_convert</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">if</span> <span class="n">visu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">do_convert</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">visu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">greyscale</span> <span class="o">=</span> <span class="n">converted_video</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">greyscale</span> <span class="o">=</span> <span class="n">visu</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">NetDet</span> <span class="o">=</span> <span class="n">NetworkDetection</span><span class="p">(</span><span class="n">greyscale</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="o">=</span><span class="n">binary</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                              <span class="n">origin_to_add</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">NetDet</span><span class="o">.</span><span class="n">get_best_network_detection_method</span><span class="p">()</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">if</span> <span class="n">do_convert</span><span class="p">:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">NetDet</span><span class="o">.</span><span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">converted_video</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">lighter_background</span> <span class="o">=</span> <span class="n">NetDet</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">[</span><span class="n">binary</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">NetDet</span><span class="o">.</span><span class="n">greyscale_image</span><span class="p">[</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">binary</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">starting_time</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># 20):#</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="k">if</span> <span class="n">do_convert</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">greyscale</span> <span class="o">=</span> <span class="n">visu</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="n">greyscale</span> <span class="o">=</span> <span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">NetDet_fast</span> <span class="o">=</span> <span class="n">NetworkDetection</span><span class="p">(</span><span class="n">greyscale</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="o">=</span><span class="n">binary</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                                       <span class="n">origin_to_add</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">best_result</span><span class="o">=</span><span class="n">NetDet</span><span class="o">.</span><span class="n">best_result</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="n">NetDet_fast</span><span class="o">.</span><span class="n">detect_network</span><span class="p">()</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">NetDet_fast</span><span class="o">.</span><span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="k">if</span> <span class="n">detect_pseudopods</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="n">NetDet_fast</span><span class="o">.</span><span class="n">detect_pseudopods</span><span class="p">(</span><span class="n">lighter_background</span><span class="p">,</span> <span class="n">pseudopod_min_size</span><span class="o">=</span><span class="n">pseudopod_min_size</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="n">NetDet_fast</span><span class="o">.</span><span class="n">merge_network_with_pseudopods</span><span class="p">()</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">pseudopod_vid</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">NetDet_fast</span><span class="o">.</span><span class="n">pseudopods</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">potential_network</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">NetDet_fast</span><span class="o">.</span><span class="n">complete_network</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">if</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">network_dynamics</span> <span class="o">=</span> <span class="n">potential_network</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">starting_time</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># 20):#</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="k">if</span> <span class="n">smooth_segmentation_over_time</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>                <span class="k">if</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                    <span class="n">computed_network</span> <span class="o">=</span> <span class="n">potential_network</span><span class="p">[(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                    <span class="n">computed_network</span><span class="p">[</span><span class="n">computed_network</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                    <span class="n">computed_network</span><span class="p">[</span><span class="n">computed_network</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                        <span class="n">computed_network</span> <span class="o">=</span> <span class="n">potential_network</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                        <span class="n">computed_network</span> <span class="o">=</span> <span class="n">potential_network</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                    <span class="n">computed_network</span><span class="p">[</span><span class="n">computed_network</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="n">computed_network</span> <span class="o">=</span> <span class="n">computed_network</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="n">computed_network</span> <span class="o">=</span> <span class="n">computed_network</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="n">origin_contours</span> <span class="o">=</span> <span class="n">get_contours</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="n">complete_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">origin_contours</span><span class="p">,</span> <span class="n">computed_network</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="n">complete_network</span> <span class="o">=</span> <span class="n">computed_network</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="n">complete_network</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="n">complete_network</span><span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="k">if</span> <span class="n">detect_pseudopods</span><span class="p">:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="c1"># Make sure that removing pseudopods do not cut the network:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="n">without_pseudopods</span> <span class="o">=</span> <span class="n">complete_network</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pseudopod_vid</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="n">only_connected_network</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="n">without_pseudopods</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="c1"># # Option A: To add these cutting regions to the pseudopods do:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="n">pseudopods</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">only_connected_network</span><span class="p">)</span> <span class="o">*</span> <span class="n">complete_network</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="n">pseudopod_vid</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">pseudopods</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">network_dynamics</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">complete_network</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">imtoshow</span> <span class="o">=</span> <span class="n">visu</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="n">eroded_binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="n">network_dynamics</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">cross_33</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="n">net_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">network_dynamics</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">-</span> <span class="n">eroded_binary</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="n">imtoshow</span><span class="p">[</span><span class="n">net_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">net_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">158</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="k">if</span> <span class="n">show_seg</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">imtoshow</span><span class="p">,</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)))</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>                <span class="n">visu</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">imtoshow</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="k">if</span> <span class="n">show_seg</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="n">network_coord</span> <span class="o">=</span> <span class="n">smallest_memory_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">network_dynamics</span><span class="p">),</span> <span class="s2">&quot;uint&quot;</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="n">pseudopod_coord</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">if</span> <span class="n">detect_pseudopods</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="n">network_dynamics</span><span class="p">[</span><span class="n">pseudopod_vid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">pseudopod_coord</span> <span class="o">=</span> <span class="n">smallest_memory_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">pseudopod_vid</span><span class="p">),</span> <span class="s2">&quot;uint&quot;</span><span class="p">)</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="k">if</span> <span class="n">save_coord_network</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;coord_pseudopods</span><span class="si">{</span><span class="n">arena_label</span><span class="si">}</span><span class="s2">_t</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_y</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">_x</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="n">pseudopod_coord</span><span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">if</span> <span class="n">save_coord_network</span><span class="p">:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;coord_network</span><span class="si">{</span><span class="n">arena_label</span><span class="si">}</span><span class="s2">_t</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_y</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">_x</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="n">network_coord</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">return</span> <span class="n">network_coord</span><span class="p">,</span> <span class="n">pseudopod_coord</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.display_boxes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">display_boxes</span><span class="p">(</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">box_diameter</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Display grid lines on a binary image at specified box diameter intervals.</p>
<p>This function displays the given binary image with vertical and horizontal
grid lines drawn at regular intervals defined by <code>box_diameter</code>. The function
returns the total number of grid lines drawn.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>binary_image</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binary image on which to draw the grid lines.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>box_diameter</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Diameter of each box in pixels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>line_nb</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of grid lines drawn, both vertical and horizontal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">display_boxes</span><span class="p">(</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">box_diameter</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1021" name="__codelineno-0-1021"></a><span class="k">def</span><span class="w"> </span><span class="nf">display_boxes</span><span class="p">(</span><span class="n">binary_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">box_diameter</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><span class="sd">    Display grid lines on a binary image at specified box diameter intervals.</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a><span class="sd">    This function displays the given binary image with vertical and horizontal</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a><span class="sd">    grid lines drawn at regular intervals defined by `box_diameter`. The function</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a><span class="sd">    returns the total number of grid lines drawn.</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="sd">    binary_image : ndarray</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><span class="sd">        Binary image on which to draw the grid lines.</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="sd">    box_diameter : int</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">        Diameter of each box in pixels.</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">    line_nb : int</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="sd">        Number of grid lines drawn, both vertical and horizontal.</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="sd">    &gt;&gt;&gt; binary_image = np.random.randint(0, 2, (100, 100), dtype=np.uint8)</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><span class="sd">    &gt;&gt;&gt; display_boxes(binary_image, box_diameter=25)</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">binary_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">binary_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">binary_image</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>    <span class="n">line_nb</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">box_diameter</span><span class="p">):</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>        <span class="n">line_nb</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">box_diameter</span><span class="p">):</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>        <span class="n">line_nb</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>    <span class="k">return</span> <span class="n">line_nb</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.display_network_methods" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">display_network_methods</span><span class="p">(</span><span class="n">network_detection</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Display segmentation results from a network detection object.</p>


<details class="extended-description" open>
  <summary>Extended Description</summary>
  <p>Plots the binary segmentation results for various methods stored in <code>network_detection.all_results</code>.
Highlights the best result based on quality metrics and allows for saving the figure to a file.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>network_detection</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An object containing segmentation results and quality metrics.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the figure. If <code>None</code>, the plot is displayed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1255" name="__codelineno-0-1255"></a><span class="k">def</span><span class="w"> </span><span class="nf">display_network_methods</span><span class="p">(</span><span class="n">network_detection</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a><span class="sd">    Display segmentation results from a network detection object.</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a><span class="sd">    Extended Description</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a><span class="sd">    --------------------</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a><span class="sd">    Plots the binary segmentation results for various methods stored in ``network_detection.all_results``.</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a><span class="sd">    Highlights the best result based on quality metrics and allows for saving the figure to a file.</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a><span class="sd">    network_detection : object</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a><span class="sd">        An object containing segmentation results and quality metrics.</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a><span class="sd">    save_path : str, optional</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a><span class="sd">        Path to save the figure. If ``None``, the plot is displayed.</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>    <span class="n">row_nb</span> <span class="o">=</span> <span class="mi">6</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">network_detection</span><span class="o">.</span><span class="n">all_results</span><span class="p">)</span> <span class="o">/</span> <span class="n">row_nb</span><span class="p">)),</span> <span class="n">row_nb</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Segmentation Comparison: Frangi + Sato Variations&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>    <span class="c1"># Plot all results</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">network_detection</span><span class="o">.</span><span class="n">all_results</span><span class="p">):</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">//</span> <span class="n">row_nb</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>        <span class="n">col</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">%</span> <span class="n">row_nb</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>        <span class="c1"># Display binary segmentation result</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>        <span class="c1"># Create title with filter info and quality score</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">network_detection</span><span class="o">.</span><span class="n">quality_metrics</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>        <span class="c1"># Highlight the best result</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">network_detection</span><span class="o">.</span><span class="n">best_idx</span><span class="p">:</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>                                       <span class="n">result</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>                                       <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.eudist" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eudist</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the Euclidean distance between two points in n-dimensional space.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v1</code>
            </td>
            <td>
                  <code>iterable of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The coordinates of the first point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>v2</code>
            </td>
            <td>
                  <code>iterable of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The coordinates of the second point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Euclidean distance between <code>v1</code> and <code>v2</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>v1</code> and <code>v2</code> do not have the same length.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The Euclidean distance is calculated using the standard formula:
((x2  x1)^2 + (y2  y1)^2 + ...).</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">v1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">v2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">eudist</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">5.0</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">v1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">v2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">eudist</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">7.0710678118654755</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="k">def</span><span class="w"> </span><span class="nf">eudist</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">    Calculate the Euclidean distance between two points in n-dimensional space.</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">    v1 : iterable of float</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">        The coordinates of the first point.</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">    v2 : iterable of float</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">        The coordinates of the second point.</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">    -------</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">    float</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">        The Euclidean distance between `v1` and `v2`.</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">    ------</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">        If `v1` and `v2` do not have the same length.</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    -----</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">    The Euclidean distance is calculated using the standard formula:</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">    ((x2  x1)^2 + (y2  y1)^2 + ...).</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">    --------</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">    &gt;&gt;&gt; v1 = [1.0, 2.0]</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    &gt;&gt;&gt; v2 = [4.0, 6.0]</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">    &gt;&gt;&gt; eudist(v1, v2)</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">    5.0</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">    &gt;&gt;&gt; v1 = [1.0, 2.0, 3.0]</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">    &gt;&gt;&gt; v2 = [4.0, 6.0, 8.0]</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    &gt;&gt;&gt; eudist(v1, v2)</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">    7.0710678118654755</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>    <span class="n">dist</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)]</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist</span><span class="p">))</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>    <span class="k">return</span> <span class="n">dist</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.extract_graph_dynamics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_graph_dynamics</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">coord_network</span><span class="p">,</span> <span class="n">arena_label</span><span class="p">,</span> <span class="n">starting_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coord_pseudopods</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts dynamic graph data from video frames based on network dynamics.</p>
<p>This function processes time-series binary network structures to extract evolving vertices and edges over time. It computes spatial relationships between networks and an origin point through image processing steps including contour detection, padding for alignment, skeleton extraction, and morphological analysis. Vertex and edge attributes like position, connectivity, width, intensity, and betweenness are compiled into tables saved as CSV files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>converted_video</code>
            </td>
            <td>
                  <code><span title="cellects.utils.load_display_save.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>3D video data array (t x y x) containing pixel intensities used for calculating edge intensity attributes during table generation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coord_network</code>
            </td>
            <td>
                  <code><span title="cellects.utils.load_display_save.NDArray">NDArray</span>[<span title="cellects.utils.load_display_save.np.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>3D binary network mask array (t x y x) representing connectivity structures across time points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>arena_label</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier to prefix output filenames corresponding to specific experimental arenas.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>starting_time</code>
            </td>
            <td>
                  <code>(<span title="int">int</span>, <span title="optional">optional</span>(default=0))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time index within <code>coord_network</code> to begin processing from (exclusive of origin initialization).</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>origin</code>
            </td>
            <td>
                  <code>(<span title="cellects.utils.load_display_save.NDArray">NDArray</span>[<span title="cellects.utils.load_display_save.np.uint8">uint8</span>], <span title="optional">optional</span>(default=None))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binary mask identifying the region of interest's central origin for spatial reference during network comparison.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Saves two CSV files in working directory:</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>1. `vertex_table{arena_label}_t{T}_y{Y}_x{X}.csv` - Vertex table with time, coordinates, and connectivity information</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>2. `edge_table{arena_label}_t{T}_y{Y}_x{X}.csv` - Edge table containing attributes like length, width, intensity, and betweenness</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Output CSVs use NumPy arrays converted to pandas DataFrames with columns:
- Vertex table includes timestamps (t), coordinates (y,x), and connectivity flags.
- Edge table contains betweenness centrality calculated during skeleton processing.
Origin contours are spatially aligned through padding operations to maintain coordinate consistency across time points.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_graph_dynamics</span><span class="p">(</span><span class="n">converted_video</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">coord_network</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">arena_label</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>                            <span class="n">starting_time</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coord_pseudopods</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    Extracts dynamic graph data from video frames based on network dynamics.</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">    This function processes time-series binary network structures to extract evolving vertices and edges over time. It computes spatial relationships between networks and an origin point through image processing steps including contour detection, padding for alignment, skeleton extraction, and morphological analysis. Vertex and edge attributes like position, connectivity, width, intensity, and betweenness are compiled into tables saved as CSV files.</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">    converted_video : NDArray</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">        3D video data array (t x y x) containing pixel intensities used for calculating edge intensity attributes during table generation.</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    coord_network : NDArray[np.uint8]</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">        3D binary network mask array (t x y x) representing connectivity structures across time points.</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">    arena_label : int</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">        Unique identifier to prefix output filenames corresponding to specific experimental arenas.</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">    starting_time : int, optional (default=0)</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">        Time index within `coord_network` to begin processing from (exclusive of origin initialization).</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">    origin : NDArray[np.uint8], optional (default=None)</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">        Binary mask identifying the region of interest&#39;s central origin for spatial reference during network comparison.</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">    -------</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">    None</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">    Saves two CSV files in working directory:</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">    1. `vertex_table{arena_label}_t{T}_y{Y}_x{X}.csv` - Vertex table with time, coordinates, and connectivity information</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">    2. `edge_table{arena_label}_t{T}_y{Y}_x{X}.csv` - Edge table containing attributes like length, width, intensity, and betweenness</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">    ---</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    Output CSVs use NumPy arrays converted to pandas DataFrames with columns:</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">    - Vertex table includes timestamps (t), coordinates (y,x), and connectivity flags.</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">    - Edge table contains betweenness centrality calculated during skeleton processing.</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">    Origin contours are spatially aligned through padding operations to maintain coordinate consistency across time points.</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="n">arena_label</span><span class="si">}</span><span class="s2">. Starting graph extraction.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="c1"># converted_video = self.converted_video; coord_network=self.coord_network; arena_label=1; starting_time=0; origin=self.origin</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>    <span class="n">dims</span> <span class="o">=</span> <span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>    <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">origin_centroid</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="n">origin_centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">origin_centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">origin_centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>        <span class="n">pad_origin_centroid</span> <span class="o">=</span> <span class="n">origin_centroid</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="n">origin_contours</span> <span class="o">=</span> <span class="n">get_contours</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="n">pad_origin</span> <span class="o">=</span> <span class="n">add_padding</span><span class="p">([</span><span class="n">origin</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="n">pad_origin_centroid</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>        <span class="n">pad_origin</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="n">origin_contours</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>    <span class="n">vertex_table</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">starting_time</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> <span class="c1"># t=320   Y, X = 729, 554</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="n">computed_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="n">net_t</span> <span class="o">=</span> <span class="n">coord_network</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="n">coord_network</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="n">computed_network</span><span class="p">[</span><span class="n">net_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">net_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>            <span class="n">computed_network</span> <span class="o">=</span> <span class="n">computed_network</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">origin</span><span class="p">)</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>            <span class="n">computed_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">origin_contours</span><span class="p">,</span> <span class="n">computed_network</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="n">computed_network</span> <span class="o">=</span> <span class="n">computed_network</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">if</span> <span class="n">computed_network</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="n">computed_network</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="n">computed_network</span><span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="n">pad_network</span> <span class="o">=</span> <span class="n">add_padding</span><span class="p">([</span><span class="n">computed_network</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">pad_distances</span><span class="p">,</span> <span class="n">pad_origin_contours</span> <span class="o">=</span> <span class="n">get_skeleton_and_widths</span><span class="p">(</span><span class="n">pad_network</span><span class="p">,</span> <span class="n">pad_origin</span><span class="p">,</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>                                                                                           <span class="n">pad_origin_centroid</span><span class="p">)</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="n">edge_id</span> <span class="o">=</span> <span class="n">EdgeIdentification</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">pad_distances</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="n">edge_id</span><span class="o">.</span><span class="n">run_edge_identification</span><span class="p">()</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="k">if</span> <span class="n">pad_origin_contours</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>                <span class="n">origin_contours</span> <span class="o">=</span> <span class="n">remove_padding</span><span class="p">([</span><span class="n">pad_origin_contours</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>            <span class="n">growing_areas</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>            <span class="k">if</span> <span class="n">coord_pseudopods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>                <span class="n">growing_areas</span> <span class="o">=</span> <span class="n">coord_pseudopods</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="n">coord_pseudopods</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="n">edge_id</span><span class="o">.</span><span class="n">make_vertex_table</span><span class="p">(</span><span class="n">origin_contours</span><span class="p">,</span> <span class="n">growing_areas</span><span class="p">)</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="n">edge_id</span><span class="o">.</span><span class="n">make_edge_table</span><span class="p">(</span><span class="n">converted_video</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>            <span class="n">edge_id</span><span class="o">.</span><span class="n">vertex_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">edge_id</span><span class="o">.</span><span class="n">vertex_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">edge_id</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">))</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>            <span class="n">edge_id</span><span class="o">.</span><span class="n">edge_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">edge_id</span><span class="o">.</span><span class="n">edge_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">edge_id</span><span class="o">.</span><span class="n">edge_table</span><span class="p">))</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>            <span class="k">if</span> <span class="n">vertex_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                <span class="n">vertex_table</span> <span class="o">=</span> <span class="n">edge_id</span><span class="o">.</span><span class="n">vertex_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                <span class="n">edge_table</span> <span class="o">=</span> <span class="n">edge_id</span><span class="o">.</span><span class="n">edge_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>                <span class="n">vertex_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">vertex_table</span><span class="p">,</span> <span class="n">edge_id</span><span class="o">.</span><span class="n">vertex_table</span><span class="p">))</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>                <span class="n">edge_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">edge_table</span><span class="p">,</span> <span class="n">edge_id</span><span class="o">.</span><span class="n">edge_table</span><span class="p">))</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>    <span class="n">vertex_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">vertex_table</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;vertex_id&quot;</span><span class="p">,</span> <span class="s2">&quot;is_tip&quot;</span><span class="p">,</span> <span class="s2">&quot;origin&quot;</span><span class="p">,</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>                                                       <span class="s2">&quot;vertex_connected&quot;</span><span class="p">])</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>    <span class="n">edge_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">edge_table</span><span class="p">,</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>                              <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;edge_id&quot;</span><span class="p">,</span> <span class="s2">&quot;vertex1&quot;</span><span class="p">,</span> <span class="s2">&quot;vertex2&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="s2">&quot;average_width&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>                                       <span class="s2">&quot;betweenness_centrality&quot;</span><span class="p">])</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>    <span class="n">vertex_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="sa">f</span><span class="s2">&quot;vertex_table</span><span class="si">{</span><span class="n">arena_label</span><span class="si">}</span><span class="s2">_t</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_y</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">_x</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="n">edge_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="sa">f</span><span class="s2">&quot;edge_table</span><span class="si">{</span><span class="n">arena_label</span><span class="si">}</span><span class="s2">_t</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_y</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">_x</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.extract_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_time</span><span class="p">(</span><span class="n">image_list</span><span class="p">,</span> <span class="n">pathway</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">raw_images</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract timestamps from a list of images.</p>
<p>This function extracts the DateTimeOriginal or datetime values from
the EXIF data of a list of image files, and computes the total time in seconds.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_list</code>
            </td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of image file names.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pathway</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the directory containing the images. Default is an empty string.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw_images</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, use the exifread library. Otherwise, use the exif library.
Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>time</code></td>            <td>
                  <code>ndarray of int64</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array containing the total time in seconds for each image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">pathway</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;experiment&quot;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;image1.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;image2.tif&#39;</span><span class="p">]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">=</span> <span class="n">extract_time</span><span class="p">(</span><span class="n">image_list</span><span class="p">,</span> <span class="n">pathway</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">array([0, 0])</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_time</span><span class="p">(</span><span class="n">image_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">pathway</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">raw_images</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><span class="sd">    Extract timestamps from a list of images.</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">    This function extracts the DateTimeOriginal or datetime values from</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a><span class="sd">    the EXIF data of a list of image files, and computes the total time in seconds.</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a><span class="sd">    image_list : list of str</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a><span class="sd">        List of image file names.</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a><span class="sd">    pathway : str, optional</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="sd">        Path to the directory containing the images. Default is an empty string.</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="sd">    raw_images : bool, optional</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="sd">        If True, use the exifread library. Otherwise, use the exif library.</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a><span class="sd">        Default is False.</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><span class="sd">    time : ndarray of int64</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="sd">        Array containing the total time in seconds for each image.</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a><span class="sd">    &gt;&gt;&gt; pathway = Path(__name__).resolve().parents[0] / &quot;data&quot; / &quot;experiment&quot;</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a><span class="sd">    &gt;&gt;&gt; image_list = [&#39;image1.tif&#39;, &#39;image2.tif&#39;]</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a><span class="sd">    &gt;&gt;&gt; time = extract_time(image_list, pathway)</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a><span class="sd">    &gt;&gt;&gt; print(time)</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a><span class="sd">    array([0, 0])</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pathway</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>        <span class="n">pathway</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>    <span class="n">nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_list</span><span class="p">)</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>    <span class="n">timings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>    <span class="k">if</span> <span class="n">raw_images</span><span class="p">:</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nb</span><span class="p">):</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pathway</span> <span class="o">/</span> <span class="n">image_list</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_file</span><span class="p">:</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                <span class="n">my_image</span> <span class="o">=</span> <span class="n">exifread</span><span class="o">.</span><span class="n">process_file</span><span class="p">(</span><span class="n">image_file</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stop_tag</span><span class="o">=</span><span class="s1">&#39;DateTimeOriginal&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>                <span class="n">datetime</span> <span class="o">=</span> <span class="n">my_image</span><span class="p">[</span><span class="s2">&quot;EXIF DateTimeOriginal&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>            <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">11</span><span class="p">:]</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>            <span class="n">timings</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nb</span><span class="p">):</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pathway</span> <span class="o">/</span> <span class="n">image_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_file</span><span class="p">:</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>                <span class="n">my_image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>                <span class="k">if</span> <span class="n">my_image</span><span class="o">.</span><span class="n">has_exif</span><span class="p">:</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                    <span class="n">datetime</span> <span class="o">=</span> <span class="n">my_image</span><span class="o">.</span><span class="n">datetime</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>                    <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">datetime</span><span class="p">[</span><span class="mi">11</span><span class="p">:]</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>                    <span class="n">timings</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">timings</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">timings</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">timings</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">timings</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">timings</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">timings</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]):</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                <span class="n">time</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">+</span> <span class="n">timings</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">timings</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>                <span class="n">time</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span> <span class="n">timings</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">+</span> <span class="n">timings</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">timings</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>            <span class="n">days_per_month</span> <span class="o">=</span> <span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nb</span><span class="p">):</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>                <span class="n">month_number</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="c1">#int(timings[j, 1])</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>                <span class="n">timings</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">days_per_month</span><span class="p">[</span><span class="n">month_number</span><span class="p">]</span> <span class="o">*</span> <span class="n">month_number</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>            <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">timings</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">timings</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span> <span class="n">timings</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">+</span> <span class="n">timings</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">timings</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>        <span class="c1">#time = int(time)</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb</span><span class="p">)</span><span class="c1">#arange(1, nb * 60, 60)#&quot;Do not experiment the 31th of december!!!&quot;</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>    <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb</span><span class="p">)</span><span class="c1">#arange(1, nb * 60, 60)</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>    <span class="k">return</span> <span class="n">time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.find_common_coord" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_common_coord</span><span class="p">(</span><span class="n">array1</span><span class="p">,</span> <span class="n">array2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find common coordinates between two arrays.</p>
<p>This function compares the given 2D <code>array1</code> and <code>array2</code>
to determine if there are any common coordinates.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array1</code>
            </td>
            <td>
                  <code>ndarray of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 2D numpy ndarray.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>array2</code>
            </td>
            <td>
                  <code>ndarray of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Another 2D numpy ndarray.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>ndarray of bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A boolean numpy ndarray where True indicates common
coordinates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">array1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">find_common_coord</span><span class="p">(</span><span class="n">array1</span><span class="p">,</span> <span class="n">array2</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">array([ True, False])</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="k">def</span><span class="w"> </span><span class="nf">find_common_coord</span><span class="p">(</span><span class="n">array1</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">array2</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find common coordinates between two arrays.</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">    This function compares the given 2D `array1` and `array2`</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">    to determine if there are any common coordinates.</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">    array1 : ndarray of int</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">        A 2D numpy ndarray.</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">    array2 : ndarray of int</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">        Another 2D numpy ndarray.</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">    -------</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">    out : ndarray of bool</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">        A boolean numpy ndarray where True indicates common</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">        coordinates.</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">    --------</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="sd">    &gt;&gt;&gt; array1 = np.array([[1, 2], [3, 4]])</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a><span class="sd">    &gt;&gt;&gt; array2 = np.array([[5, 6], [1, 2]])</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">    &gt;&gt;&gt; result = find_common_coord(array1, array2)</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">    array([ True, False])&quot;&quot;&quot;</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">array1</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">array2</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.find_duplicates_coord" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_duplicates_coord</span><span class="p">(</span><span class="n">array1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find duplicate rows in a 2D array and return their coordinate indices.</p>
<p>Given a 2D NumPy array, this function identifies rows that are duplicated (i.e., appear more than once) and returns a boolean array indicating their positions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array1</code>
            </td>
            <td>
                  <code>ndarray of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input 2D array of shape (n_rows, n_columns) from which to find duplicate rows.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>duplicates</code></td>            <td>
                  <code>ndarray of bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean array of shape (n_rows,), where <code>True</code> indicates that the corresponding row in <code>array1</code> is a duplicate.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">array1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">find_duplicates_coord</span><span class="p">(</span><span class="n">array1</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">array([ True, False,  True, False])</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="k">def</span><span class="w"> </span><span class="nf">find_duplicates_coord</span><span class="p">(</span><span class="n">array1</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">    Find duplicate rows in a 2D array and return their coordinate indices.</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    Given a 2D NumPy array, this function identifies rows that are duplicated (i.e., appear more than once) and returns a boolean array indicating their positions.</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">    array1 : ndarray of int</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">        Input 2D array of shape (n_rows, n_columns) from which to find duplicate rows.</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">    -------</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">    duplicates : ndarray of bool</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">        Boolean array of shape (n_rows,), where `True` indicates that the corresponding row in `array1` is a duplicate.</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">    --------</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="sd">    &gt;&gt;&gt; array1 = np.array([[1, 2], [3, 4], [1, 2], [5, 6]])</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">    &gt;&gt;&gt; find_duplicates_coord(array1)</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">    array([ True, False,  True, False])&quot;&quot;&quot;</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>    <span class="n">unique_rows</span><span class="p">,</span> <span class="n">inverse_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">array1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>    <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">inverse_indices</span><span class="p">)</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>    <span class="c1"># A row is duplicate if its count &gt; 1</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>    <span class="k">return</span> <span class="n">counts</span><span class="p">[</span><span class="n">inverse_indices</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.find_threshold_given_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_threshold_given_mask</span><span class="p">(</span><span class="n">greyscale</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">min_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find the optimal threshold value for a greyscale image given a mask.</p>
<p>This function performs a binary search to find the optimal threshold
that maximizes the separation between two regions defined by the mask.
The search is bounded by a minimum threshold value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>greyscale</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The greyscale image array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The binary mask array where positive values define region A and zero values define region B.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_threshold</code>
            </td>
            <td>
                  <code><span title="uint8">uint8</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum threshold value for the search. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="uint8">uint8</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optimal threshold value found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">greyscale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">54</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">20</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">find_threshold_given_mask</span><span class="p">(</span><span class="n">greyscale</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">54</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-883" name="__codelineno-0-883"></a><span class="k">def</span><span class="w"> </span><span class="nf">find_threshold_given_mask</span><span class="p">(</span><span class="n">greyscale</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">min_threshold</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="sd">    Find the optimal threshold value for a greyscale image given a mask.</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a><span class="sd">    This function performs a binary search to find the optimal threshold</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">    that maximizes the separation between two regions defined by the mask.</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">    The search is bounded by a minimum threshold value.</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="sd">    greyscale : ndarray of uint8</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">        The greyscale image array.</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">    mask : ndarray of uint8</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">        The binary mask array where positive values define region A and zero values define region B.</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">    min_threshold : uint8, optional</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">        The minimum threshold value for the search. Defaults to 0.</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">    -------</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">    out : uint8</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">        The optimal threshold value found.</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a><span class="sd">    --------</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a><span class="sd">    &gt;&gt;&gt; greyscale = np.array([[255, 128, 54], [0, 64, 20]], dtype=np.uint8)</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a><span class="sd">    &gt;&gt;&gt; mask = np.array([[1, 1, 0], [0, 0, 0]], dtype=np.uint8)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a><span class="sd">    &gt;&gt;&gt; find_threshold_given_mask(greyscale, mask)</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a><span class="sd">    54</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>    <span class="n">region_a</span> <span class="o">=</span> <span class="n">greyscale</span><span class="p">[</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">region_a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>    <span class="n">region_b</span> <span class="o">=</span> <span class="n">greyscale</span><span class="p">[</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">region_b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>        <span class="k">return</span> <span class="n">min_threshold</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>        <span class="n">low</span> <span class="o">=</span> <span class="n">min_threshold</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>        <span class="n">high</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>        <span class="n">best_thresh</span> <span class="o">=</span> <span class="n">low</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>        <span class="k">while</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">low</span> <span class="o">&lt;=</span> <span class="n">high</span><span class="p">:</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>            <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>            <span class="n">count_a</span><span class="p">,</span> <span class="n">count_b</span> <span class="o">=</span> <span class="n">_get_counts_jit</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">region_a</span><span class="p">,</span> <span class="n">region_b</span><span class="p">)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>            <span class="k">if</span> <span class="n">count_a</span> <span class="o">&gt;</span> <span class="n">count_b</span><span class="p">:</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>                <span class="c1"># Try to find a lower threshold that still satisfies the condition</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>                <span class="n">best_thresh</span> <span class="o">=</span> <span class="n">mid</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>                <span class="n">high</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>                <span class="k">if</span> <span class="n">count_a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">count_b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>                    <span class="n">best_thresh</span> <span class="o">=</span> <span class="n">greyscale</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>                    <span class="k">break</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>                <span class="c1"># Need higher threshold</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>                <span class="n">low</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>    <span class="k">return</span> <span class="n">best_thresh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.generate_color_space_combination" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_color_space_combination</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">c_spaces</span><span class="p">,</span> <span class="n">first_dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="o">=</span><span class="p">{},</span> <span class="n">background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">convert_to_uint8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="o">=</span><span class="p">{})</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate color space combinations for an input image.</p>
<p>This function generates a grayscale image by combining multiple color spaces
from an input BGR image and provided dictionaries. Optionally, it can also generate
a second grayscale image using another dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bgr_image</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input image in BGR color space.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>c_spaces</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of color spaces to consider for combination.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>first_dict</code>
            </td>
            <td>
                  <code><span title="numba.typed.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing color space and transformation details for the first grayscale image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>second_dict</code>
            </td>
            <td>
                  <code><span title="numba.typed.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing color space and transformation details for the second grayscale image.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>background</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Background image to be used. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>background2</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second background image to be used for the second grayscale image. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_uint8</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating whether to convert the output images to uint8. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>tuple of ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the first and second grayscale images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">bgr_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">c_spaces</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">,</span> <span class="s1">&#39;hsv&#39;</span><span class="p">]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">first_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">first_dict</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">second_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">second_dict</span><span class="p">[</span><span class="s1">&#39;hsv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">greyscale_image1</span><span class="p">,</span> <span class="n">greyscale_image2</span> <span class="o">=</span> <span class="n">generate_color_space_combination</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">c_spaces</span><span class="p">,</span> <span class="n">first_dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">greyscale_image1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go">(100, 100)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_color_space_combination</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">c_spaces</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">first_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="o">=</span><span class="p">{},</span> <span class="n">background</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background2</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">convert_to_uint8</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    Generate color space combinations for an input image.</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">    This function generates a grayscale image by combining multiple color spaces</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    from an input BGR image and provided dictionaries. Optionally, it can also generate</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">    a second grayscale image using another dictionary.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    bgr_image : ndarray of uint8</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        The input image in BGR color space.</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    c_spaces : list</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        List of color spaces to consider for combination.</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    first_dict : Dict</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        Dictionary containing color space and transformation details for the first grayscale image.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">    second_dict : Dict, optional</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        Dictionary containing color space and transformation details for the second grayscale image.</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">    background : ndarray, optional</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        Background image to be used. Default is None.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    background2 : ndarray, optional</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        Second background image to be used for the second grayscale image. Default is None.</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">    convert_to_uint8 : bool, optional</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        Flag indicating whether to convert the output images to uint8. Default is False.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">    -------</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    out : tuple of ndarray of uint8</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        A tuple containing the first and second grayscale images.</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    --------</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">    &gt;&gt;&gt; bgr_image = np.random.randint(0, 256, (100, 100, 3), dtype=np.uint8)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">    &gt;&gt;&gt; c_spaces = [&#39;bgr&#39;, &#39;hsv&#39;]</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    &gt;&gt;&gt; first_dict = Dict()</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    &gt;&gt;&gt; first_dict[&#39;bgr&#39;] = np.array((0, 1, 1))</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    &gt;&gt;&gt; second_dict = Dict()</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    &gt;&gt;&gt; second_dict[&#39;hsv&#39;] = np.array((0, 0, 1))</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    &gt;&gt;&gt; greyscale_image1, greyscale_image2 = generate_color_space_combination(bgr_image, c_spaces, first_dict, second_dict)</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    &gt;&gt;&gt; print(greyscale_image1.shape)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    (100, 100)</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="n">greyscale_image2</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="k">if</span> <span class="s2">&quot;PCA&quot;</span> <span class="ow">in</span> <span class="n">c_spaces</span><span class="p">:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">greyscale_image</span><span class="p">,</span> <span class="n">var_ratio</span><span class="p">,</span> <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="n">extract_first_pc</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_c_spaces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="n">all_c_spaces</span> <span class="o">=</span> <span class="n">get_color_spaces</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">c_spaces</span><span class="p">)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">combine_color_spaces</span><span class="p">(</span><span class="n">first_dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="n">first_dict</span> <span class="o">=</span> <span class="n">translate_dict</span><span class="p">(</span><span class="n">first_dict</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">combine_color_spaces</span><span class="p">(</span><span class="n">first_dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">second_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="n">greyscale_image2</span> <span class="o">=</span> <span class="n">combine_color_spaces</span><span class="p">(</span><span class="n">second_dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">background2</span><span class="p">)</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="k">if</span> <span class="n">convert_to_uint8</span><span class="p">:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="k">if</span> <span class="n">greyscale_image2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">second_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="n">greyscale_image2</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">greyscale_image2</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="k">return</span> <span class="n">greyscale_image</span><span class="p">,</span> <span class="n">greyscale_image2</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">first_pc_vector</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_all_line_coordinates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_line_coordinates</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="n">end_points</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get all line coordinates between start point and end points.</p>
<p>This function computes the coordinates of lines connecting a
start point to multiple end points, converting input arrays to float
if necessary before processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>start_point</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting coordinate point for the lines. Can be of any numeric type,
will be converted to float if needed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_points</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of end coordinate points for the lines. Can be of any
numeric type, will be converted to float if needed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="List">List</span>[<span title="numpy.typing.NDArray">NDArray</span>[<span title="int">int</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of numpy arrays containing the coordinates of each line
as integer values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">start_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">end_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">get_all_line_coordinates</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="n">end_points</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">[array([[0, 0],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">   [0, 1],</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">   [1, 2]], dtype=uint64), array([[0, 0],</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go">   [1, 1],</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">   [1, 2],</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go">   [2, 3],</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="go">   [3, 4]], dtype=uint64)]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/morphological_operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-706" name="__codelineno-0-706"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_all_line_coordinates</span><span class="p">(</span><span class="n">start_point</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">end_points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a><span class="sd">    Get all line coordinates between start point and end points.</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a><span class="sd">    This function computes the coordinates of lines connecting a</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a><span class="sd">    start point to multiple end points, converting input arrays to float</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a><span class="sd">    if necessary before processing.</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">    start_point : NDArray[float]</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">        Starting coordinate point for the lines. Can be of any numeric type,</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="sd">        will be converted to float if needed.</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">    end_points : NDArray[float]</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">        Array of end coordinate points for the lines. Can be of any</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">        numeric type, will be converted to float if needed.</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">    -------</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">    out : List[NDArray[int]]</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="sd">        A list of numpy arrays containing the coordinates of each line</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">        as integer values.</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">    --------</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">    &gt;&gt;&gt; start_point = np.array([0, 0])</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">    &gt;&gt;&gt; end_points = np.array([[1, 2], [3, 4]])</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">    &gt;&gt;&gt; get_all_line_coordinates(start_point, end_points)</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">    [array([[0, 0],</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">       [0, 1],</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">       [1, 2]], dtype=uint64), array([[0, 0],</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">       [1, 1],</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="sd">       [1, 2],</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">       [2, 3],</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">       [3, 4]], dtype=uint64)]</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>    <span class="k">for</span> <span class="n">end_point</span> <span class="ow">in</span> <span class="n">end_points</span><span class="p">:</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="n">line_coords</span> <span class="o">=</span> <span class="n">get_line_points</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line_coords</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">))</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>    <span class="k">return</span> <span class="n">lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_branches_and_tips_coord" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_branches_and_tips_coord</span><span class="p">(</span><span class="n">pad_vertices</span><span class="p">,</span> <span class="n">pad_tips</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts the coordinates of branches and tips from vertices and tips binary images.</p>
<p>This function calculates branch coordinates by subtracting
tips from vertices. Then it finds and outputs the non-zero indices of branches and tips separatly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pad_vertices</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array containing the vertices to be padded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pad_tips</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array containing the tips of the padding.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>branch_v_coord</code></td>            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinates of branches derived from subtracting tips from vertices.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>tips_coord</code></td>            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinates of the tips.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">branch_v</span><span class="p">,</span> <span class="n">tip_c</span> <span class="o">=</span> <span class="n">get_branches_and_tips_coord</span><span class="p">(</span><span class="n">pad_vertices</span><span class="p">,</span> <span class="n">pad_tips</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">branch_v</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">tip_c</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_branches_and_tips_coord</span><span class="p">(</span><span class="n">pad_vertices</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">pad_tips</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="sd">    Extracts the coordinates of branches and tips from vertices and tips binary images.</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="sd">    This function calculates branch coordinates by subtracting</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">    tips from vertices. Then it finds and outputs the non-zero indices of branches and tips separatly.</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">    pad_vertices : ndarray</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="sd">        Array containing the vertices to be padded.</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">    pad_tips : ndarray</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">        Array containing the tips of the padding.</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">    -------</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a><span class="sd">    branch_v_coord : ndarray</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a><span class="sd">        Coordinates of branches derived from subtracting tips from vertices.</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="sd">    tips_coord : ndarray</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a><span class="sd">        Coordinates of the tips.</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><span class="sd">    &gt;&gt;&gt; branch_v, tip_c = get_branches_and_tips_coord(pad_vertices, pad_tips)</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">    &gt;&gt;&gt; branch_v</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><span class="sd">    &gt;&gt;&gt; tip_c</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>    <span class="n">pad_branches</span> <span class="o">=</span> <span class="n">pad_vertices</span> <span class="o">-</span> <span class="n">pad_tips</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>    <span class="n">branch_v_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">pad_branches</span><span class="p">)))</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>    <span class="n">tips_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">pad_tips</span><span class="p">)))</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>    <span class="k">return</span> <span class="n">branch_v_coord</span><span class="p">,</span> <span class="n">tips_coord</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_color_spaces" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_color_spaces</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">space_names</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert a BGR image into various color spaces.</p>
<p>Converts the input BGR image to specified color spaces and returns them
as a dictionary. If no space names are provided, converts to all default
color spaces (LAB, HSV, LUV, HLS, YUV). If 'logical' is in the space names,
it will be removed before conversion.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bgr_image</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input image in BGR color space.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>space_names</code>
            </td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of color spaces to convert the image to. Defaults to none.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with keys as color space names and values as the converted images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">bgr_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">c_spaces</span> <span class="o">=</span> <span class="n">get_color_spaces</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;lab&#39;</span><span class="p">,</span> <span class="s1">&#39;hsv&#39;</span><span class="p">])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">c_spaces</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">[&#39;bgr&#39;, &#39;lab&#39;, &#39;hsv&#39;]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_color_spaces</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">space_names</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    Convert a BGR image into various color spaces.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    Converts the input BGR image to specified color spaces and returns them</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    as a dictionary. If no space names are provided, converts to all default</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    color spaces (LAB, HSV, LUV, HLS, YUV). If &#39;logical&#39; is in the space names,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    it will be removed before conversion.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    bgr_image : ndarray of uint8</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">        Input image in BGR color space.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    space_names : list of str, optional</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        List of color spaces to convert the image to. Defaults to none.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    -------</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    out : dict</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Dictionary with keys as color space names and values as the converted images.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    --------</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    &gt;&gt;&gt; bgr_image = np.zeros((5, 5, 3), dtype=np.uint8)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    &gt;&gt;&gt; c_spaces = get_color_spaces(bgr_image, [&#39;lab&#39;, &#39;hsv&#39;])</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    &gt;&gt;&gt; print(list(c_spaces.keys()))</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    [&#39;bgr&#39;, &#39;lab&#39;, &#39;hsv&#39;]</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">if</span> <span class="s1">&#39;logical&#39;</span> <span class="ow">in</span> <span class="n">space_names</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">space_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">space_names</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;logical&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="n">c_spaces</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bgr_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">space_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;lab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2LAB</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;hsv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;luv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2LUV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;hls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HLS</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;yuv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2YUV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s1">&#39;lab&#39;</span><span class="p">,</span> <span class="n">space_names</span><span class="p">):</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;lab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2LAB</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s1">&#39;hsv&#39;</span><span class="p">,</span> <span class="n">space_names</span><span class="p">):</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;hsv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s1">&#39;luv&#39;</span><span class="p">,</span> <span class="n">space_names</span><span class="p">):</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;luv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2LUV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s1">&#39;hls&#39;</span><span class="p">,</span> <span class="n">space_names</span><span class="p">):</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;hls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HLS</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s1">&#39;yuv&#39;</span><span class="p">,</span> <span class="n">space_names</span><span class="p">):</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;yuv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2YUV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">return</span> <span class="n">c_spaces</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_contour_width_from_im_shape" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_contour_width_from_im_shape</span><span class="p">(</span><span class="n">im_shape</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the contour width based on image shape.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>im_shape</code>
            </td>
            <td>
                  <code>tuple of int, two items</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dimensions of the image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated contour width.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_contour_width_from_im_shape</span><span class="p">(</span><span class="n">im_shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">    Calculate the contour width based on image shape.</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">    im_shape : tuple of int, two items</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">        The dimensions of the image.</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">    -------</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">    int</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">        The calculated contour width.</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">im_shape</span><span class="p">))</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_contours" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_contours</span><span class="p">(</span><span class="n">binary_image</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find and return the contours of a binary image.</p>
<p>This function erodes the input binary image using a 3x3 cross-shaped
structuring element and then subtracts the eroded image from the original to obtain the contours.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>binary_image</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input binary image from which to extract contours.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Image containing only the contours extracted from <code>binary_image</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_image</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">get_contours</span><span class="p">(</span><span class="n">binary_image</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">[[0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go"> [0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go"> [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go"> [0 0 1 0 0 0 0 1 0 0]</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go"> [0 0 1 0 0 0 0 1 0 0]</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="go"> [0 0 1 0 0 0 0 1 0 0]</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="go"> [0 0 1 0 0 0 0 1 0 0]</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="go"> [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="go"> [0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="go"> [0 0 0 0 0 0 0 0 0 0]]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/morphological_operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1507" name="__codelineno-0-1507"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_contours</span><span class="p">(</span><span class="n">binary_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a><span class="sd">    Find and return the contours of a binary image.</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a><span class="sd">    This function erodes the input binary image using a 3x3 cross-shaped</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a><span class="sd">    structuring element and then subtracts the eroded image from the original to obtain the contours.</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a><span class="sd">    binary_image : ndarray of uint8</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a><span class="sd">        Input binary image from which to extract contours.</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a><span class="sd">    out : ndarray of uint8</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a><span class="sd">        Image containing only the contours extracted from `binary_image`.</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a><span class="sd">    &gt;&gt;&gt; binary_image = np.zeros((10, 10), dtype=np.uint8)</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a><span class="sd">    &gt;&gt;&gt; binary_image[2:8, 2:8] = 1</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a><span class="sd">    &gt;&gt;&gt; result = get_contours(binary_image)</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a><span class="sd">    [[0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a><span class="sd">     [0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a><span class="sd">     [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a><span class="sd">     [0 0 1 0 0 0 0 1 0 0]</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a><span class="sd">     [0 0 1 0 0 0 0 1 0 0]</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a><span class="sd">     [0 0 1 0 0 0 0 1 0 0]</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a><span class="sd">     [0 0 1 0 0 0 0 1 0 0]</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a><span class="sd">     [0 0 1 1 1 1 1 1 0 0]</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a><span class="sd">     [0 0 0 0 0 0 0 0 0 0]</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a><span class="sd">     [0 0 0 0 0 0 0 0 0 0]]</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">binary_image</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">):</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>        <span class="n">binary_image</span> <span class="o">=</span> <span class="n">binary_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">binary_image</span><span class="p">):</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>        <span class="n">contours</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">image_borders</span><span class="p">(</span><span class="n">binary_image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">binary_image</span><span class="p">):</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>        <span class="n">eroded_binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">,</span> <span class="n">borderType</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_CONSTANT</span><span class="p">,</span> <span class="n">borderValue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>        <span class="n">contours</span> <span class="o">=</span> <span class="n">binary_image</span> <span class="o">-</span> <span class="n">eroded_binary</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>        <span class="n">contours</span> <span class="o">=</span> <span class="n">binary_image</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>    <span class="k">return</span> <span class="n">contours</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_h5_keys" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_h5_keys</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieve all keys from a given HDF5 file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the HDF5 file from which keys are to be retrieved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list containing all the keys present in the specified HDF5 file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified HDF5 file does not exist.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_h5_keys</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="sd">    Retrieve all keys from a given HDF5 file.</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">    file_name : str</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">        The path to the HDF5 file from which keys are to be retrieved.</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">    -------</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="sd">    list of str</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">        A list containing all the keys present in the specified HDF5 file.</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a><span class="sd">    ------</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="sd">    FileNotFoundError</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a><span class="sd">        If the specified HDF5 file does not exist.</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5f</span><span class="p">:</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>            <span class="n">all_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">h5f</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>            <span class="k">return</span> <span class="n">all_keys</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_inertia_axes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_inertia_axes</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the inertia axes of a moment object.</p>
<p>This function computes the barycenters, central moments,
and the lengths of the major and minor axes, as well as
their orientation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mo</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing moments, which should include keys:
'm00', 'm10', 'm01', 'm20', and 'm11'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
    - cx : float
        The x-coordinate of the barycenter.
    - cy : float
        The y-coordinate of the barycenter.
    - major_axis_len : float
        The length of the major axis.
    - minor_axis_len : float
        The length of the minor axis.
    - axes_orientation : float
        The orientation of the axes in radians.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function uses Numba's @njit decorator for performance.
The moments in the input dictionary should be computed from
the same image region.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">mo</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;m00&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;m10&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;m01&#39;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s1">&#39;m20&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span> <span class="s1">&#39;m11&#39;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">}</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">get_inertia_axes</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">(2.0, 3.0, 9.165151389911677, 0.8421875803239, 0.7853981633974483)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_inertia_axes</span><span class="p">(</span><span class="n">mo</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">    Calculate the inertia axes of a moment object.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">    This function computes the barycenters, central moments,</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">    and the lengths of the major and minor axes, as well as</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">    their orientation.</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">    mo : dict</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">        Dictionary containing moments, which should include keys:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">        &#39;m00&#39;, &#39;m10&#39;, &#39;m01&#39;, &#39;m20&#39;, and &#39;m11&#39;.</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">    -------</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        A tuple containing:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">            - cx : float</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">                The x-coordinate of the barycenter.</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">            - cy : float</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">                The y-coordinate of the barycenter.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">            - major_axis_len : float</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">                The length of the major axis.</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">            - minor_axis_len : float</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">                The length of the minor axis.</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">            - axes_orientation : float</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">                The orientation of the axes in radians.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">    -----</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">    This function uses Numba&#39;s @njit decorator for performance.</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">    The moments in the input dictionary should be computed from</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">    the same image region.</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">    --------</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">    &gt;&gt;&gt; mo = {&#39;m00&#39;: 1.0, &#39;m10&#39;: 2.0, &#39;m01&#39;: 3.0, &#39;m20&#39;: 4.0, &#39;m11&#39;: 5.0}</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    &gt;&gt;&gt; get_inertia_axes(mo)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    (2.0, 3.0, 9.165151389911677, 0.8421875803239, 0.7853981633974483)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="c1">#L. Rocha, L. Velho and P.C.P. Calvalho (2002)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="c1">#http://sibgrapi.sid.inpe.br/col/sid.inpe.br/banon/2002/10.23.11.34/doc/35.pdf</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="c1"># http://raphael.candelier.fr/?blog=Image%20Moments</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="c1"># Calculate barycenters</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>    <span class="n">cx</span> <span class="o">=</span> <span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m10&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m00&quot;</span><span class="p">]</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="n">cy</span> <span class="o">=</span> <span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m01&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m00&quot;</span><span class="p">]</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="c1"># Calculate central moments</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">c20</span> <span class="o">=</span> <span class="p">(</span><span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m20&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m00&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">cx</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="n">c02</span> <span class="o">=</span> <span class="p">(</span><span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m02&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m00&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="n">c11</span> <span class="o">=</span> <span class="p">(</span><span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m11&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m00&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span><span class="p">)</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="c1"># Calculate major and minor axi lengths OK</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="n">major_axis_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="n">c20</span> <span class="o">+</span> <span class="n">c02</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c11</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">c20</span> <span class="o">-</span> <span class="n">c02</span><span class="p">))))</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>    <span class="n">minor_axis_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="n">c20</span> <span class="o">+</span> <span class="n">c02</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c11</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">c20</span> <span class="o">-</span> <span class="n">c02</span><span class="p">))))</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">c20</span> <span class="o">-</span> <span class="n">c02</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="n">axes_orientation</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c11</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c20</span> <span class="o">-</span> <span class="n">c02</span><span class="p">)))</span> <span class="o">+</span> <span class="p">((</span><span class="n">c20</span> <span class="o">&lt;</span> <span class="n">c02</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="n">axes_orientation</span> <span class="o">=</span> <span class="mf">0.</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>    <span class="k">return</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">major_axis_len</span><span class="p">,</span> <span class="n">minor_axis_len</span><span class="p">,</span> <span class="n">axes_orientation</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_inner_vertices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_inner_vertices</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">potential_tips</span><span class="p">,</span> <span class="n">cnv4</span><span class="p">,</span> <span class="n">cnv8</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get inner vertices from skeleton image.</p>
<p>This function identifies and returns the inner vertices of a skeletonized image.
It processes potential tips to determine which pixels should be considered as
vertices based on their neighbor count and connectivity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pad_skeleton</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The padded skeleton image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>potential_tips</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Potential tip points in the skeleton. Defaults to pad_tips.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cnv4</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Object for handling 4-connections.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cnv8</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Object for handling 8-connections.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>tuple of ndarray of uint8, ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the final vertices matrix and the updated potential tips.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">pad_vertices</span><span class="p">,</span> <span class="n">potential_tips</span> <span class="o">=</span> <span class="n">get_inner_vertices</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">potential_tips</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pad_vertices</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span>
<span class="normal"><a href="#__codelineno-0-975">975</a></span>
<span class="normal"><a href="#__codelineno-0-976">976</a></span>
<span class="normal"><a href="#__codelineno-0-977">977</a></span>
<span class="normal"><a href="#__codelineno-0-978">978</a></span>
<span class="normal"><a href="#__codelineno-0-979">979</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_inner_vertices</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">potential_tips</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">cnv4</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">cnv8</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]:</span> <span class="c1"># potential_tips=pad_tips</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">    Get inner vertices from skeleton image.</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="sd">    This function identifies and returns the inner vertices of a skeletonized image.</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">    It processes potential tips to determine which pixels should be considered as</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">    vertices based on their neighbor count and connectivity.</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">    pad_skeleton : ndarray of uint8</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">        The padded skeleton image.</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="sd">    potential_tips : ndarray of uint8, optional</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a><span class="sd">        Potential tip points in the skeleton. Defaults to pad_tips.</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a><span class="sd">    cnv4 : object</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a><span class="sd">        Object for handling 4-connections.</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a><span class="sd">    cnv8 : object</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">        Object for handling 8-connections.</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a><span class="sd">    -------</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="sd">    out : tuple of ndarray of uint8, ndarray of uint8</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="sd">        A tuple containing the final vertices matrix and the updated potential tips.</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="sd">    --------</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="sd">    &gt;&gt;&gt; pad_vertices, potential_tips = get_inner_vertices(pad_skeleton, potential_tips)</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a><span class="sd">    &gt;&gt;&gt; print(pad_vertices)</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>    <span class="c1"># Initiate the vertices final matrix as a copy of the potential_tips</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>    <span class="n">pad_vertices</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">potential_tips</span><span class="p">)</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>    <span class="k">for</span> <span class="n">neighbor_nb</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span class="c1"># All pixels having neighbor_nb neighbor are potential vertices</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>        <span class="n">potential_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">potential_tips</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>        <span class="n">potential_vertices</span><span class="p">[</span><span class="n">cnv8</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">==</span> <span class="n">neighbor_nb</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>        <span class="c1"># remove the false intersections that are a neighbor of a previously detected intersection</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>        <span class="c1"># Dilate vertices to make sure that no neighbors of the current potential vertices are already vertices.</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>        <span class="n">dilated_previous_intersections</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">pad_vertices</span><span class="p">,</span> <span class="n">cross_33</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>        <span class="n">potential_vertices</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">dilated_previous_intersections</span><span class="p">)</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>        <span class="n">pad_vertices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">potential_vertices</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>    <span class="c1"># Having 3 neighbors is ambiguous</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>    <span class="n">with_3_neighbors</span> <span class="o">=</span> <span class="n">cnv8</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">==</span> <span class="mi">3</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">with_3_neighbors</span><span class="p">):</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>        <span class="c1"># We compare 8-connections with 4-connections</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>        <span class="c1"># We loop over all 3 connected</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>        <span class="n">coord_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">with_3_neighbors</span><span class="p">)</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>        <span class="k">for</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x3</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coord_3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord_3</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span> <span class="c1"># y3, x3 = 3,7</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>            <span class="c1"># If, in the neighborhood of the 3, there is at least a 2 (in 8) that is 0 (in 4), and not a termination: the 3 is a node</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>            <span class="n">has_2_8neigh</span> <span class="o">=</span> <span class="n">cnv8</span><span class="o">.</span><span class="n">equal_neighbor_nb</span><span class="p">[(</span><span class="n">y3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">y3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">x3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># 1</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>            <span class="n">has_2_8neigh_without_focal</span> <span class="o">=</span> <span class="n">has_2_8neigh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>            <span class="n">has_2_8neigh_without_focal</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>            <span class="n">node_but_not_term</span> <span class="o">=</span> <span class="n">pad_vertices</span><span class="p">[(</span><span class="n">y3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">y3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">x3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">potential_tips</span><span class="p">[(</span><span class="n">y3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">y3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">x3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)])</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>            <span class="n">all_are_node_but_not_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">has_2_8neigh_without_focal</span><span class="p">,</span> <span class="n">node_but_not_term</span><span class="p">)</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">has_2_8neigh</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">all_are_node_but_not_term</span><span class="p">)):</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>                <span class="c1"># At least 3 of the 8neigh are not connected:</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>                <span class="n">has_2_8neigh_without_focal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">has_2_8neigh_without_focal</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>                <span class="n">cnv_8con</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">has_2_8neigh_without_focal</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>                <span class="n">cnv_8con</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>                <span class="n">disconnected_nb</span> <span class="o">=</span> <span class="n">has_2_8neigh_without_focal</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="n">cnv_8con</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>                <span class="k">if</span> <span class="n">disconnected_nb</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>                    <span class="n">pad_vertices</span><span class="p">[</span><span class="n">y3</span><span class="p">,</span> <span class="n">x3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>    <span class="c1"># Now there may be too many vertices:</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>    <span class="c1"># - Those that are 4-connected:</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>    <span class="n">nb</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">ce</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="n">pad_vertices</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>    <span class="n">problematic_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">st</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>    <span class="k">for</span> <span class="n">prob_v</span> <span class="ow">in</span> <span class="n">problematic_vertices</span><span class="p">:</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>        <span class="n">vertices_group</span> <span class="o">=</span> <span class="n">sh</span> <span class="o">==</span> <span class="n">prob_v</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>        <span class="c1"># If there is a tip in the group, do</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">potential_tips</span><span class="p">[</span><span class="n">vertices_group</span><span class="p">]):</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>            <span class="c1"># Change the most connected one from tip to vertex</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>            <span class="n">curr_neighbor_nb</span> <span class="o">=</span> <span class="n">cnv8</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">*</span> <span class="n">vertices_group</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>            <span class="n">wrong_tip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">curr_neighbor_nb</span> <span class="o">==</span> <span class="n">curr_neighbor_nb</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>            <span class="n">potential_tips</span><span class="p">[</span><span class="n">wrong_tip</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>            <span class="c1">#  otherwise do:</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>            <span class="c1"># Find the most 8-connected one, if its 4-connected neighbors have no more 8-connexions than 4-connexions + 1, they can be removed</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>            <span class="c1"># Otherwise,</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>            <span class="c1"># Find the most 4-connected one, and remove its 4 connected neighbors having only 1 or other 8-connexion</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">zoom_on_nonzero</span><span class="p">(</span><span class="n">vertices_group</span><span class="p">)</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>            <span class="c1"># 1. Find the most 8-connected one:</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>            <span class="n">sub_v_grp</span> <span class="o">=</span> <span class="n">vertices_group</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>            <span class="n">c8</span> <span class="o">=</span> <span class="n">cnv8</span><span class="o">.</span><span class="n">equal_neighbor_nb</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>            <span class="n">vertices_group_8</span> <span class="o">=</span> <span class="n">c8</span> <span class="o">*</span> <span class="n">sub_v_grp</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>            <span class="n">max_8_con</span> <span class="o">=</span> <span class="n">vertices_group_8</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>            <span class="n">most_8_con</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">vertices_group_8</span> <span class="o">==</span> <span class="n">max_8_con</span><span class="p">)</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>            <span class="c1"># c4[(most_8_con[0][0] - 1):(most_8_con[0][0] + 2), (most_8_con[1][0] - 1):(most_8_con[1][0] + 2)]</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">most_8_con</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>                <span class="n">skel_copy</span> <span class="o">=</span> <span class="n">pad_skeleton</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>                <span class="n">skel_copy</span><span class="p">[</span><span class="n">most_8_con</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>                <span class="n">sub_cnv8</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">skel_copy</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>                <span class="n">sub_cnv8</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>                <span class="n">sub_cnv4</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">skel_copy</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>                <span class="n">sub_cnv4</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>                <span class="n">v_to_remove</span> <span class="o">=</span> <span class="n">sub_v_grp</span> <span class="o">*</span> <span class="p">(</span><span class="n">sub_cnv8</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">&lt;=</span> <span class="n">sub_cnv4</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>                <span class="n">c4</span> <span class="o">=</span> <span class="n">cnv4</span><span class="o">.</span><span class="n">equal_neighbor_nb</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>                <span class="c1"># 1. # Find the most 4-connected one:</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>                <span class="n">vertices_group_4</span> <span class="o">=</span> <span class="n">c4</span> <span class="o">*</span> <span class="n">sub_v_grp</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>                <span class="n">max_con</span> <span class="o">=</span> <span class="n">vertices_group_4</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>                <span class="n">most_con</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">vertices_group_4</span> <span class="o">==</span> <span class="n">max_con</span><span class="p">)</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">most_con</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">sub_v_grp</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>                    <span class="c1"># 2. Check its 4-connected neighbors and remove those having only 1 other 8-connexion</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>                    <span class="n">skel_copy</span> <span class="o">=</span> <span class="n">pad_skeleton</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>                    <span class="n">skel_copy</span><span class="p">[</span><span class="n">most_con</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>                    <span class="n">skel_copy</span><span class="p">[</span><span class="n">most_con</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">most_con</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>                    <span class="n">skel_copy</span><span class="p">[</span><span class="n">most_con</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">most_con</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>                    <span class="n">skel_copy</span><span class="p">[</span><span class="n">most_con</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">most_con</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>                    <span class="n">skel_copy</span><span class="p">[</span><span class="n">most_con</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">most_con</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>                    <span class="n">sub_cnv8</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">skel_copy</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>                    <span class="n">sub_cnv8</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>                    <span class="c1"># There are:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>                    <span class="n">v_to_remove</span> <span class="o">=</span> <span class="p">((</span><span class="n">vertices_group_4</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sub_cnv8</span><span class="o">.</span><span class="n">equal_neighbor_nb</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>                    <span class="n">v_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sub_v_grp</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>            <span class="n">pad_vertices</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]][</span><span class="n">v_to_remove</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>    <span class="c1"># Other vertices to remove:</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>    <span class="c1"># - Those that are forming a cross with 0 at the center while the skeleton contains 1</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>    <span class="n">cnv4_false</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">pad_vertices</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>    <span class="n">cnv4_false</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>    <span class="n">cross_vertices</span> <span class="o">=</span> <span class="n">cnv4_false</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">==</span> <span class="mi">4</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>    <span class="n">wrong_cross_vertices</span> <span class="o">=</span> <span class="n">cross_vertices</span> <span class="o">*</span> <span class="n">pad_skeleton</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>    <span class="k">if</span> <span class="n">wrong_cross_vertices</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>        <span class="n">pad_vertices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">wrong_cross_vertices</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>        <span class="n">cross_fix</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">wrong_cross_vertices</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">cross_33</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="c1"># Remove the 4-connected vertices that have no more than 4 8-connected neighbors</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="c1"># i.e. the three on the side of the surrounded 0 and only one on edge on the other side</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span class="n">cross_fix</span> <span class="o">=</span> <span class="p">((</span><span class="n">cnv8</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">*</span> <span class="n">cross_fix</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">wrong_cross_vertices</span><span class="p">)</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="n">pad_vertices</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cross_fix</span><span class="p">)</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>    <span class="k">return</span> <span class="n">pad_vertices</span><span class="p">,</span> <span class="n">potential_tips</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_kurtosis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_kurtosis</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the kurtosis of a binary image.</p>
<p>The function calculates the fourth moment (kurtosis) of the given
binary image around the specified center coordinates with an option
to specify the size of the square window.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mo</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing moments of binary image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>binary_image</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 2D numpy ndarray representing a binary image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cx</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The x-coordinate of the center point of the square window.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cy</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The y-coordinate of the center point of the square window.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sx</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The x-length of the square window (width).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sy</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The y-length of the square window (height).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The kurtosis value calculated from the moments.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cx</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cy</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">sx</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">sy</span> <span class="o">=</span> <span class="mi">6</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">get_kurtosis</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go">expected output</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_kurtosis</span><span class="p">(</span><span class="n">mo</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">cx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">cy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sy</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    Calculate the kurtosis of a binary image.</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">    The function calculates the fourth moment (kurtosis) of the given</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">    binary image around the specified center coordinates with an option</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    to specify the size of the square window.</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">    mo : dict</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">        Dictionary containing moments of binary image.</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">    binary_image : np.ndarray</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">        A 2D numpy ndarray representing a binary image.</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">    cx : int or float</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        The x-coordinate of the center point of the square window.</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">    cy : int or float</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">        The y-coordinate of the center point of the square window.</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">    sx : int or float</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">        The x-length of the square window (width).</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">    sy : int or float</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">        The y-length of the square window (height).</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">    -------</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">    float</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">        The kurtosis value calculated from the moments.</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">    --------</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">    &gt;&gt;&gt; mo = np.array([[0, 1], [2, 3]])</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    &gt;&gt;&gt; binary_image = np.array([[1, 0], [0, 1]])</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">    &gt;&gt;&gt; cx = 2</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">    &gt;&gt;&gt; cy = 3</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">    &gt;&gt;&gt; sx = 5</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">    &gt;&gt;&gt; sy = 6</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">    &gt;&gt;&gt; result = get_kurtosis(mo, binary_image, cx, cy, sx, sy)</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">    expected output</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">get_power_dists</span><span class="p">(</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="n">X4</span><span class="p">,</span> <span class="n">Y4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>    <span class="n">m4x</span><span class="p">,</span> <span class="n">m4y</span> <span class="o">=</span> <span class="n">get_var</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">,</span> <span class="n">X4</span><span class="p">,</span> <span class="n">Y4</span><span class="p">)</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="k">return</span> <span class="n">get_skewness_kurtosis</span><span class="p">(</span><span class="n">m4x</span><span class="p">,</span> <span class="n">m4y</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_min_or_max_euclidean_pair" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_min_or_max_euclidean_pair</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">min_or_max</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find the pair of points in a given set with the minimum or maximum Euclidean distance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>coords</code>
            </td>
            <td>
                  <code><span title="Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, <span title="typing.Tuple">Tuple</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An Nx2 numpy array or a tuple of two arrays, each containing the x and y coordinates of points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_or_max</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to find the 'min' or 'max' distance pair. Default is 'max'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;max&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the coordinates of the two points that form the minimum or maximum distance pair.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>min_or_max</code> is not 'min' or 'max'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>The function first computes all pairwise distances in condensed form using <code>pdist</code>.</li>
<li>Then, it finds the index of the minimum or maximum distance.</li>
<li>Finally, it maps this index to the actual point indices using a binary search method.</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">point1</span><span class="p">,</span> <span class="n">point2</span> <span class="o">=</span> <span class="n">get_min_or_max_euclidean_pair</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">min_or_max</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">point1</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">[0 1]</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">point2</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">[4 5]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">point1</span><span class="p">,</span> <span class="n">point2</span> <span class="o">=</span> <span class="n">get_min_or_max_euclidean_pair</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">min_or_max</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">point1</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="go">[0 0]</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">point2</span><span class="p">)</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="go">[1 0]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/morphological_operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_min_or_max_euclidean_pair</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">min_or_max</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">    Find the pair of points in a given set with the minimum or maximum Euclidean distance.</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">    coords : Union[np.ndarray, Tuple]</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">        An Nx2 numpy array or a tuple of two arrays, each containing the x and y coordinates of points.</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">    min_or_max : str, optional</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">        Whether to find the &#39;min&#39; or &#39;max&#39; distance pair. Default is &#39;max&#39;.</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="sd">    -------</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">    Tuple[np.ndarray, np.ndarray]</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a><span class="sd">        A tuple containing the coordinates of the two points that form the minimum or maximum distance pair.</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a><span class="sd">    ------</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">        If `min_or_max` is not &#39;min&#39; or &#39;max&#39;.</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">    -----</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">    - The function first computes all pairwise distances in condensed form using `pdist`.</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">    - Then, it finds the index of the minimum or maximum distance.</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="sd">    - Finally, it maps this index to the actual point indices using a binary search method.</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="sd">    --------</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="sd">    &gt;&gt;&gt; coords = np.array([[0, 1], [2, 3], [4, 5]])</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">    &gt;&gt;&gt; point1, point2 = get_min_or_max_euclidean_pair(coords, min_or_max=&quot;max&quot;)</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="sd">    &gt;&gt;&gt; print(point1)</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">    [0 1]</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">    &gt;&gt;&gt; print(point2)</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">    [4 5]</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a><span class="sd">    &gt;&gt;&gt; coords = (np.array([0, 2, 4, 8, 1, 5]), np.array([0, 2, 4, 8, 0, 5]))</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a><span class="sd">    &gt;&gt;&gt; point1, point2 = get_min_or_max_euclidean_pair(coords, min_or_max=&quot;min&quot;)</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="sd">    &gt;&gt;&gt; print(point1)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a><span class="sd">    [0 0]</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="sd">    &gt;&gt;&gt; print(point2)</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">    [1 0]</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">):</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>    <span class="n">N</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>    <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>    <span class="c1"># Step 1: Compute all pairwise distances in condensed form</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>    <span class="n">distances</span> <span class="o">=</span> <span class="n">pdist</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>    <span class="c1"># Step 2: Find the index of the maximum distance</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>    <span class="k">if</span> <span class="n">min_or_max</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>    <span class="k">elif</span> <span class="n">min_or_max</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>        <span class="k">raise</span> <span class="ne">ValueError</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>    <span class="c1"># Step 3: Map this index to (i, j) using a binary search method</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_pair_index</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>        <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">N</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>        <span class="k">while</span> <span class="n">low</span> <span class="o">&lt;</span> <span class="n">high</span><span class="p">:</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>            <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>            <span class="n">total</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span> <span class="o">-</span> <span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>            <span class="k">if</span> <span class="n">total</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">:</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>                <span class="n">low</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                <span class="n">high</span> <span class="o">=</span> <span class="n">mid</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">low</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>        <span class="n">prev_sum</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>        <span class="n">j_index_in_row</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">prev_sum</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>        <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j_index_in_row</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Ensure j &gt; i</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">get_pair_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>    <span class="k">return</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_mpl_colormap" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_mpl_colormap</span><span class="p">(</span><span class="n">cmap_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns a linear color range array for the given matplotlib colormap.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cmap_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the colormap to get.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 256x1x3 array of bytes representing the linear color range.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">get_mpl_colormap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">(256, 1, 3)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_mpl_colormap</span><span class="p">(</span><span class="n">cmap_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="sd">    Returns a linear color range array for the given matplotlib colormap.</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="sd">    cmap_name : str</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a><span class="sd">        The name of the colormap to get.</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a><span class="sd">    -------</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a><span class="sd">    numpy.ndarray</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">        A 256x1x3 array of bytes representing the linear color range.</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a><span class="sd">    --------</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a><span class="sd">    &gt;&gt;&gt; result = get_mpl_colormap(&#39;viridis&#39;)</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="sd">    &gt;&gt;&gt; print(result.shape)</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a><span class="sd">    (256, 1, 3)</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap_name</span><span class="p">)</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>    <span class="c1"># Initialize the matplotlib color map</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>    <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>    <span class="c1"># Obtain linear color range</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>    <span class="n">color_range</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span> <span class="nb">bytes</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:,</span> <span class="mi">2</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>    <span class="k">return</span> <span class="n">color_range</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_neighbor_comparisons" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_neighbor_comparisons</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get neighbor comparisons for a padded skeleton.</p>
<p>This function creates two <code>CompareNeighborsWithValue</code> objects with different
neighborhood sizes (4 and 8) and checks if the neighbors are equal to 1. It
returns both comparison objects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pad_skeleton</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input padded skeleton array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>tuple of CompareNeighborsWithValue, CompareNeighborsWithValue</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Two comparison objects for 4 and 8 neighbors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cnv4</span><span class="p">,</span> <span class="n">cnv8</span> <span class="o">=</span> <span class="n">get_neighbor_comparisons</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_neighbor_comparisons</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">    Get neighbor comparisons for a padded skeleton.</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">    This function creates two `CompareNeighborsWithValue` objects with different</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">    neighborhood sizes (4 and 8) and checks if the neighbors are equal to 1. It</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">    returns both comparison objects.</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">    pad_skeleton : ndarray of uint8</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a><span class="sd">        The input padded skeleton array.</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="sd">    -------</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="sd">    out : tuple of CompareNeighborsWithValue, CompareNeighborsWithValue</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">        Two comparison objects for 4 and 8 neighbors.</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">    --------</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">    &gt;&gt;&gt; cnv4, cnv8 = get_neighbor_comparisons(pad_skeleton)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>    <span class="n">cnv4</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>    <span class="n">cnv4</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>    <span class="n">cnv8</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>    <span class="n">cnv8</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>    <span class="k">return</span> <span class="n">cnv4</span><span class="p">,</span> <span class="n">cnv8</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_newly_explored_area" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_newly_explored_area</span><span class="p">(</span><span class="n">binary_vid</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get newly explored area in a binary video.</p>
<p>Calculate the number of new pixels that have become active (==1) from
the previous frame in a binary video representation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>binary_vid</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current frame of the binary video.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array containing the number of new active pixels for each row.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function uses Numba's @njit decorator for performance.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_vid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_vid</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_vid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_vid</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_vid</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">get_newly_explored_area</span><span class="p">(</span><span class="n">binary_vid</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go">array([0, 1, 1, 1])</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_vid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">get_newly_explored_area</span><span class="p">(</span><span class="n">binary_vid</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">array([0])</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_newly_explored_area</span><span class="p">(</span><span class="n">binary_vid</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">    Get newly explored area in a binary video.</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">    Calculate the number of new pixels that have become active (==1) from</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">    the previous frame in a binary video representation.</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="sd">    binary_vid : np.ndarray</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a><span class="sd">        The current frame of the binary video.</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a><span class="sd">    -------</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a><span class="sd">    np.ndarray</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a><span class="sd">        An array containing the number of new active pixels for each row.</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="sd">    -----</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">    This function uses Numba&#39;s @njit decorator for performance.</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="sd">    --------</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">    &gt;&gt;&gt; binary_vid=np.zeros((4, 5, 5), dtype=np.uint8)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">    &gt;&gt;&gt; binary_vid[:2, 3, 3] = 1</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">    &gt;&gt;&gt; binary_vid[1, 4, 3] = 1</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">    &gt;&gt;&gt; binary_vid[2, 3, 4] = 1</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">    &gt;&gt;&gt; binary_vid[3, 2, 3] = 1</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">    &gt;&gt;&gt; get_newly_explored_area(binary_vid)</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">    array([0, 1, 1, 1])</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">    &gt;&gt;&gt; binary_vid=np.zeros((5, 5), dtype=np.uint8)[None, :, :]</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">    &gt;&gt;&gt; get_newly_explored_area(binary_vid)</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">    array([0])</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>    <span class="k">return</span> <span class="p">((</span><span class="n">binary_vid</span> <span class="o">-</span> <span class="n">binary_vid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">binary_vid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_power_dists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_power_dists</span><span class="p">(</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the power distributions based on the given center coordinates and exponent.</p>
<p>This function computes the <code>n</code>th powers of x and y distances from
a given center point <code>(cx, cy)</code> for each pixel in the binary image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>binary_image</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 2D array (binary image) where the power distributions are calculated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cx</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The x-coordinate of the center point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cy</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The y-coordinate of the center point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The exponent for power distribution calculation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing two arrays:
- The first array contains the <code>n</code>th power of x distances from the center.
- The second array contains the <code>n</code>th power of y distances from the center.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function uses Numba's <code>@njit</code> decorator for performance optimization.
Ensure that <code>binary_image</code> is a NumPy ndarray to avoid type issues.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">xn</span><span class="p">,</span> <span class="n">yn</span> <span class="o">=</span> <span class="n">get_power_dists</span><span class="p">(</span><span class="n">binary_image</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">xn</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">print</span><span class="p">(</span><span class="n">yn</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">(10,) (10,)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_power_dists</span><span class="p">(</span><span class="n">binary_image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">cx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">cy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    Calculate the power distributions based on the given center coordinates and exponent.</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    This function computes the `n`th powers of x and y distances from</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    a given center point `(cx, cy)` for each pixel in the binary image.</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    binary_image : np.ndarray</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        A 2D array (binary image) where the power distributions are calculated.</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    cx : float</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        The x-coordinate of the center point.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    cy : float</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        The y-coordinate of the center point.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    n : int</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        The exponent for power distribution calculation.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    -------</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    tuple[np.ndarray, np.ndarray]</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        A tuple containing two arrays:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        - The first array contains the `n`th power of x distances from the center.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        - The second array contains the `n`th power of y distances from the center.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    -----</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    This function uses Numba&#39;s `@njit` decorator for performance optimization.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    Ensure that `binary_image` is a NumPy ndarray to avoid type issues.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    --------</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    &gt;&gt;&gt; binary_image = np.zeros((10, 10))</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    &gt;&gt;&gt; xn, yn = get_power_dists(binary_image, 5.0, 5.0, 2)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    &gt;&gt;&gt; print(xn.shape), print(yn.shape)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">    (10,) (10,)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="n">xn</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">binary_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">yn</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">binary_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">cy</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">return</span> <span class="n">xn</span><span class="p">,</span> <span class="n">yn</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_skeleton_and_widths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_skeleton_and_widths</span><span class="p">(</span><span class="n">pad_network</span><span class="p">,</span> <span class="n">pad_origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pad_origin_centroid</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get skeleton and widths from a network.</p>
<p>This function computes the morphological skeleton of a network and calculates
the distances to the closest zero pixel for each non-zero pixel using medial_axis.
If pad_origin is provided, it adds a central contour. Finally, the function
removes small loops and keeps only one connected component.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pad_network</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The binary pad network image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pad_origin</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array indicating the origin for adding central contour.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pad_origin_centroid</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The centroid of the pad origin. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>tuple(ndarray of uint8, ndarray of uint8, ndarray of uint8)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- pad_skeleton: The skeletonized image.
- pad_distances: The distances to the closest zero pixel.
- pad_origin_contours: The contours of the central origin, or None if not
  used.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">pad_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">skeleton</span><span class="p">,</span> <span class="n">distances</span><span class="p">,</span> <span class="n">contours</span> <span class="o">=</span> <span class="n">get_skeleton_and_widths</span><span class="p">(</span><span class="n">pad_network</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_skeleton_and_widths</span><span class="p">(</span><span class="n">pad_network</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">pad_origin</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pad_origin_centroid</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]:</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">    Get skeleton and widths from a network.</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">    This function computes the morphological skeleton of a network and calculates</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">    the distances to the closest zero pixel for each non-zero pixel using medial_axis.</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">    If pad_origin is provided, it adds a central contour. Finally, the function</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    removes small loops and keeps only one connected component.</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">    pad_network : ndarray of uint8</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">        The binary pad network image.</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">    pad_origin : ndarray of uint8, optional</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">        An array indicating the origin for adding central contour.</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">    pad_origin_centroid : ndarray, optional</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">        The centroid of the pad origin. Defaults to None.</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">    -------</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">    out : tuple(ndarray of uint8, ndarray of uint8, ndarray of uint8)</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">        A tuple containing:</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="sd">        - pad_skeleton: The skeletonized image.</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">        - pad_distances: The distances to the closest zero pixel.</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">        - pad_origin_contours: The contours of the central origin, or None if not</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">          used.</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">    --------</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">    &gt;&gt;&gt; pad_network = np.array([[0, 1], [1, 0]])</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">    &gt;&gt;&gt; skeleton, distances, contours = get_skeleton_and_widths(pad_network)</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">    &gt;&gt;&gt; print(skeleton)</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>    <span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">pad_distances</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">medial_axis</span><span class="p">(</span><span class="n">pad_network</span><span class="p">,</span> <span class="n">return_distance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>    <span class="n">pad_skeleton</span> <span class="o">=</span> <span class="n">pad_skeleton</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>    <span class="k">if</span> <span class="n">pad_origin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>        <span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">pad_distances</span><span class="p">,</span> <span class="n">pad_origin_contours</span> <span class="o">=</span> <span class="n">_add_central_contour</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">pad_distances</span><span class="p">,</span> <span class="n">pad_origin</span><span class="p">,</span> <span class="n">pad_network</span><span class="p">,</span> <span class="n">pad_origin_centroid</span><span class="p">)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="n">pad_origin_contours</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>    <span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">pad_distances</span> <span class="o">=</span> <span class="n">remove_small_loops</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">pad_distances</span><span class="p">)</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>    <span class="n">pad_skeleton</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>    <span class="n">pad_distances</span> <span class="o">*=</span> <span class="n">pad_skeleton</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>    <span class="k">return</span> <span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">pad_distances</span><span class="p">,</span> <span class="n">pad_origin_contours</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_skewness" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_skewness</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate skewness of the given moment.</p>
<p>This function computes the skewness based on the third moments
and the central moments of a binary image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mo</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing moments of binary image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>binary_image</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binary image as a 2D numpy array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cx</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of parameter <code>cx</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cy</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of parameter <code>cy</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sx</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of parameter <code>sx</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sy</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of parameter <code>sy</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="float">float</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple containing skewness values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">get_skewness</span><span class="p">(</span><span class="n">mo</span><span class="o">=</span><span class="n">example_mo</span><span class="p">,</span> <span class="n">binary_image</span><span class="o">=</span><span class="n">binary_img</span><span class="p">,</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">... </span><span class="n">cx</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">cy</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">sx</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sy</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">(skewness_x, skewness_y)  # Example output</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_skewness</span><span class="p">(</span><span class="n">mo</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">cx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">cy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sy</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate skewness of the given moment.</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">    This function computes the skewness based on the third moments</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">    and the central moments of a binary image.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">    mo : dict</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">        Dictionary containing moments of binary image.</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">    binary_image : ndarray</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">        Binary image as a 2D numpy array.</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">    cx : float</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">        Description of parameter `cx`.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">    cy : float</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">        Description of parameter `cy`.</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">    sx : float</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">        Description of parameter `sx`.</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">    sy : float</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">        Description of parameter `sy`.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">    -------</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    Tuple[float, float]</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">        Tuple containing skewness values.</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    --------</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">    &gt;&gt;&gt; result = get_skewness(mo=example_mo, binary_image=binary_img,</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">    ... cx=0.5, cy=0.5, sx=1.0, sy=1.0)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">    (skewness_x, skewness_y)  # Example output</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">get_power_dists</span><span class="p">(</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="n">X3</span><span class="p">,</span> <span class="n">Y3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="n">m3x</span><span class="p">,</span> <span class="n">m3y</span> <span class="o">=</span> <span class="n">get_var</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">,</span> <span class="n">X3</span><span class="p">,</span> <span class="n">Y3</span><span class="p">)</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="k">return</span> <span class="n">get_skewness_kurtosis</span><span class="p">(</span><span class="n">m3x</span><span class="p">,</span> <span class="n">m3y</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_skewness_kurtosis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_skewness_kurtosis</span><span class="p">(</span><span class="n">mnx</span><span class="p">,</span> <span class="n">mny</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculates skewness and kurtosis of a distribution.</p>
<p>This function computes the skewness and kurtosis from given statistical
moments, standard deviations, and order of moments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mnx</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The third moment about the mean for x.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mny</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The fourth moment about the mean for y.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sx</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The standard deviation of x.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sy</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The standard deviation of y.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Order of the moment (3 for skewness, 4 for kurtosis).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>skewness</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The computed skewness.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>kurtosis</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The computed kurtosis.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function uses Numba's <code>@njit</code> decorator for performance.
Ensure that the values of <code>mnx</code>, <code>mny</code>, <code>sx</code>, and <code>sy</code> are non-zero to avoid division by zero.
If <code>n = 3</code>, the function calculates skewness. If <code>n = 4</code>, it calculates kurtosis.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">skewness</span><span class="p">,</span> <span class="n">kurtosis</span> <span class="o">=</span> <span class="n">get_skewness_kurtosis</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skewness:&quot;</span><span class="p">,</span> <span class="n">skewness</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">Skewness: 8.0</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kurtosis:&quot;</span><span class="p">,</span> <span class="n">kurtosis</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">Kurtosis: nan</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_skewness_kurtosis</span><span class="p">(</span><span class="n">mnx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mny</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    Calculates skewness and kurtosis of a distribution.</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    This function computes the skewness and kurtosis from given statistical</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">    moments, standard deviations, and order of moments.</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">    mnx : float</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">        The third moment about the mean for x.</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">    mny : float</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">        The fourth moment about the mean for y.</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">    sx : float</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        The standard deviation of x.</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">    sy : float</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">        The standard deviation of y.</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">    n : int</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">        Order of the moment (3 for skewness, 4 for kurtosis).</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    -------</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">    skewness : float</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        The computed skewness.</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    kurtosis : float</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        The computed kurtosis.</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">    -----</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    This function uses Numba&#39;s `@njit` decorator for performance.</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">    Ensure that the values of `mnx`, `mny`, `sx`, and `sy` are non-zero to avoid division by zero.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    If `n = 3`, the function calculates skewness. If `n = 4`, it calculates kurtosis.</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    --------</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    &gt;&gt;&gt; skewness, kurtosis = get_skewness_kurtosis(1.5, 2.0, 0.5, 0.75, 3)</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    &gt;&gt;&gt; print(&quot;Skewness:&quot;, skewness)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    Skewness: 8.0</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    &gt;&gt;&gt; print(&quot;Kurtosis:&quot;, kurtosis)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">    Kurtosis: nan</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="k">if</span> <span class="n">sx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="n">fx</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">fx</span> <span class="o">=</span> <span class="n">mnx</span> <span class="o">/</span> <span class="n">sx</span> <span class="o">**</span> <span class="n">n</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="k">if</span> <span class="n">sy</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">fy</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">fy</span> <span class="o">=</span> <span class="n">mny</span> <span class="o">/</span> <span class="n">sy</span> <span class="o">**</span> <span class="n">n</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="k">return</span> <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_standard_deviations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_standard_deviations</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return spatial standard deviations for a given moment and binary image.</p>
<p>This function computes the square root of variances along <code>x</code> (horizontal)
and <code>y</code> (vertical) axes for the given binary image and moment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mo</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing moments of binary image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>binary_image</code>
            </td>
            <td>
                  <code>ndarray of bool or int8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The binary input image where the moments are computed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cx</code>
            </td>
            <td>
                  <code><span title="float64">float64</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>X-coordinate of center of mass (horizontal position).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cy</code>
            </td>
            <td>
                  <code><span title="float64">float64</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Y-coordinate of center of mass (vertical position).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[ndarray of float64, ndarray of float64]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple containing the standard deviations along the x and y axes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>binary_image</code> is not a binary image or has an invalid datatype.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function uses the <code>get_power_dists</code> and <code>get_var</code> functions to compute
the distributed variances, which are then transformed into standard deviations.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">binary_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">]])</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">stdx</span><span class="p">,</span> <span class="n">stdy</span> <span class="o">=</span> <span class="n">get_standard_deviations</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stdx</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go">[1.1]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stdy</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go">[0.8366600265...]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_standard_deviations</span><span class="p">(</span><span class="n">mo</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">cx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">cy</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">    Return spatial standard deviations for a given moment and binary image.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    This function computes the square root of variances along `x` (horizontal)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    and `y` (vertical) axes for the given binary image and moment.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    mo : dict</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        Dictionary containing moments of binary image.</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">    binary_image : ndarray of bool or int8</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">        The binary input image where the moments are computed.</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">    cx : float64</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        X-coordinate of center of mass (horizontal position).</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">    cy : float64</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        Y-coordinate of center of mass (vertical position).</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    -------</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">    tuple[ndarray of float64, ndarray of float64]</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        Tuple containing the standard deviations along the x and y axes.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">    ------</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        If `binary_image` is not a binary image or has an invalid datatype.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">    -----</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">    This function uses the `get_power_dists` and `get_var` functions to compute</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">    the distributed variances, which are then transformed into standard deviations.</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">    --------</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">    &gt;&gt;&gt; binary_image = np.array([[0, 1], [1, 0]], dtype=np.int8)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    &gt;&gt;&gt; mo = np.array([[2.0], [3.0]])</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">    &gt;&gt;&gt; cx, cy = 1.5, 1.5</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">    &gt;&gt;&gt; stdx, stdy = get_standard_deviations(mo, binary_image, cx, cy)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    &gt;&gt;&gt; print(stdx)</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">    [1.1]</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">    &gt;&gt;&gt; print(stdy)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">    [0.8366600265...]</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">get_power_dists</span><span class="p">(</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>    <span class="n">X2</span><span class="p">,</span> <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span> <span class="o">=</span> <span class="n">get_var</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">Y2</span><span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_terminations_and_their_connected_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_terminations_and_their_connected_nodes</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">cnv4</span><span class="p">,</span> <span class="n">cnv8</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get terminations in a skeleton and their connected nodes.</p>
<p>This function identifies termination points in a padded skeleton array
based on pixel connectivity, marking them and their connected nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pad_skeleton</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The padded skeleton array where terminations are to be identified.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cnv4</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Convolution object with 4-connectivity for neighbor comparison.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cnv8</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Convolution object with 8-connectivity for neighbor comparison.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array containing marked terminations and their connected nodes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">get_terminations_and_their_connected_nodes</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">cnv4</span><span class="p">,</span> <span class="n">cnv8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_terminations_and_their_connected_nodes</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">cnv4</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">cnv8</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">    Get terminations in a skeleton and their connected nodes.</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">    This function identifies termination points in a padded skeleton array</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">    based on pixel connectivity, marking them and their connected nodes.</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="sd">    pad_skeleton : ndarray of uint8</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="sd">        The padded skeleton array where terminations are to be identified.</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a><span class="sd">    cnv4 : object</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a><span class="sd">        Convolution object with 4-connectivity for neighbor comparison.</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">    cnv8 : object</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="sd">        Convolution object with 8-connectivity for neighbor comparison.</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">    -------</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">    out : ndarray of uint8</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">        Array containing marked terminations and their connected nodes.</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">    --------</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">    &gt;&gt;&gt; result = get_terminations_and_their_connected_nodes(pad_skeleton, cnv4, cnv8)</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>    <span class="c1"># All pixels having only one neighbor, and containing the value 1, are terminations for sure</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>    <span class="n">potential_tips</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>    <span class="n">potential_tips</span><span class="p">[</span><span class="n">cnv8</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>    <span class="c1"># Add more terminations using 4-connectivity</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>    <span class="c1"># If a pixel is 1 (in 4) and all its neighbors are neighbors (in 4), it is a termination</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>    <span class="n">coord1_4</span> <span class="o">=</span> <span class="n">cnv4</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">==</span> <span class="mi">1</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">coord1_4</span><span class="p">):</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>        <span class="n">coord1_4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">coord1_4</span><span class="p">)</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>        <span class="k">for</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coord1_4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord1_4</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span> <span class="c1"># y1, x1 = 3,5</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>            <span class="c1"># If, in the neighborhood of the 1 (in 4), all (in 8) its neighbors are 4-connected together, and none of them are terminations, the 1 is a termination</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>            <span class="n">is_4neigh</span> <span class="o">=</span> <span class="n">cnv4</span><span class="o">.</span><span class="n">equal_neighbor_nb</span><span class="p">[(</span><span class="n">y1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">y1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">!=</span> <span class="mi">0</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>            <span class="n">all_4_connected</span> <span class="o">=</span> <span class="n">pad_skeleton</span><span class="p">[(</span><span class="n">y1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">y1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">==</span> <span class="n">is_4neigh</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>            <span class="n">is_not_term</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">potential_tips</span><span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="p">]</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">all_4_connected</span> <span class="o">*</span> <span class="n">is_not_term</span><span class="p">):</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                <span class="n">is_4neigh</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                <span class="n">is_4neigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">is_4neigh</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>                <span class="n">cnv_4con</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">is_4neigh</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                <span class="n">cnv_4con</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                <span class="n">all_connected</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_4neigh</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="n">cnv_4con</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>                <span class="c1"># If they are connected, it can be a termination</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>                <span class="k">if</span> <span class="n">all_connected</span><span class="p">:</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>                    <span class="c1"># If its closest neighbor is above 3 (in 8), this one is also a node</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>                    <span class="n">is_closest_above_3</span> <span class="o">=</span> <span class="n">cnv8</span><span class="o">.</span><span class="n">equal_neighbor_nb</span><span class="p">[(</span><span class="n">y1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">y1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">*</span> <span class="n">cross_33</span> <span class="o">&gt;</span> <span class="mi">3</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">is_closest_above_3</span><span class="p">):</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                        <span class="n">Y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">is_closest_above_3</span><span class="p">)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>                        <span class="n">Y</span> <span class="o">+=</span> <span class="n">y1</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>                        <span class="n">X</span> <span class="o">+=</span> <span class="n">x1</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>                        <span class="n">potential_tips</span><span class="p">[</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>                    <span class="n">potential_tips</span><span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>    <span class="k">return</span> <span class="n">potential_tips</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_var" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_var</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">,</span> <span class="n">Xn</span><span class="p">,</span> <span class="n">Yn</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute the center of mass in 2D space.</p>
<p>This function calculates the weighted average position (centroid) of
a binary image using given pixel coordinates and moments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mo</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing moments of binary image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>binary_image</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D binary image where non-zero pixels are considered.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Xn</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of x-coordinates for each pixel in <code>binary_image</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Yn</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of y-coordinates for each pixel in <code>binary_image</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple of two floats <code>(vx, vy)</code> representing the centroid coordinates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ZeroDivisionError">ZeroDivisionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>mo['m00']</code> is zero, indicating no valid pixels in the image.
The function raises a <code>ZeroDivisionError</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Performance considerations: This function uses Numba's <code>@njit</code> decorator for performance.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_var</span><span class="p">(</span><span class="n">mo</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">binary_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">Xn</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">Yn</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    Compute the center of mass in 2D space.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    This function calculates the weighted average position (centroid) of</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    a binary image using given pixel coordinates and moments.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    mo : dict</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        Dictionary containing moments of binary image.</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    binary_image : ndarray</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        2D binary image where non-zero pixels are considered.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    Xn : ndarray</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        Array of x-coordinates for each pixel in `binary_image`.</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    Yn : ndarray</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        Array of y-coordinates for each pixel in `binary_image`.</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    -------</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        A tuple of two floats `(vx, vy)` representing the centroid coordinates.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    ------</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    ZeroDivisionError</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        If `mo[&#39;m00&#39;]` is zero, indicating no valid pixels in the image.</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        The function raises a `ZeroDivisionError`.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    -----</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    Performance considerations: This function uses Numba&#39;s `@njit` decorator for performance.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="k">if</span> <span class="n">mo</span><span class="p">[</span><span class="s1">&#39;m00&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">vx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">binary_image</span> <span class="o">*</span> <span class="n">Xn</span><span class="p">)</span> <span class="o">/</span> <span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m00&quot;</span><span class="p">]</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">binary_image</span> <span class="o">*</span> <span class="n">Yn</span><span class="p">)</span> <span class="o">/</span> <span class="n">mo</span><span class="p">[</span><span class="s2">&quot;m00&quot;</span><span class="p">]</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="k">return</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.get_vertices_and_tips_from_skeleton" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_vertices_and_tips_from_skeleton</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get vertices and tips from a padded skeleton.</p>
<p>This function identifies the vertices and tips of a skeletonized image.
Tips are endpoints of the skeleton while vertices include tips and points where three or more edges meet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pad_skeleton</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input skeleton image that has been padded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>tuple (ndarray of uint8, ndarray of uint8)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple containing arrays of vertex points and tip points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_vertices_and_tips_from_skeleton</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]:</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a><span class="sd">    Get vertices and tips from a padded skeleton.</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">    This function identifies the vertices and tips of a skeletonized image.</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">    Tips are endpoints of the skeleton while vertices include tips and points where three or more edges meet.</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">    pad_skeleton : ndarray of uint8</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">        Input skeleton image that has been padded.</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">    -------</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">    out : tuple (ndarray of uint8, ndarray of uint8)</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">        Tuple containing arrays of vertex points and tip points.</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>    <span class="n">cnv4</span><span class="p">,</span> <span class="n">cnv8</span> <span class="o">=</span> <span class="n">get_neighbor_comparisons</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>    <span class="n">potential_tips</span> <span class="o">=</span> <span class="n">get_terminations_and_their_connected_nodes</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">cnv4</span><span class="p">,</span> <span class="n">cnv8</span><span class="p">)</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>    <span class="n">pad_vertices</span><span class="p">,</span> <span class="n">pad_tips</span> <span class="o">=</span> <span class="n">get_inner_vertices</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">potential_tips</span><span class="p">,</span> <span class="n">cnv4</span><span class="p">,</span> <span class="n">cnv8</span><span class="p">)</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>    <span class="k">return</span> <span class="n">pad_vertices</span><span class="p">,</span> <span class="n">pad_tips</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.image_borders" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">image_borders</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;rectangular&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create an image with borders, either rectangular or circular.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dimensions</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dimensions of the image (height, width).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shape</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The shape of the borders. Options are "rectangular" or "circular".
Defaults to "rectangular".</p>
              </div>
            </td>
            <td>
                  <code>&#39;rectangular&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The image with borders. If the shape is "circular", an ellipse border;
if "rectangular", a rectangular border.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">borders</span> <span class="o">=</span> <span class="n">image_borders</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;rectangular&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">borders</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">[[0 0 0]</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go"> [0 1 0]</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go"> [0 0 0]]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/morphological_operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1271" name="__codelineno-0-1271"></a><span class="k">def</span><span class="w"> </span><span class="nf">image_borders</span><span class="p">(</span><span class="n">dimensions</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;rectangular&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a><span class="sd">    Create an image with borders, either rectangular or circular.</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a><span class="sd">    dimensions : tuple</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a><span class="sd">        The dimensions of the image (height, width).</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a><span class="sd">    shape : str, optional</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a><span class="sd">        The shape of the borders. Options are &quot;rectangular&quot; or &quot;circular&quot;.</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a><span class="sd">        Defaults to &quot;rectangular&quot;.</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a><span class="sd">    out : ndarray of uint8</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a><span class="sd">        The image with borders. If the shape is &quot;circular&quot;, an ellipse border;</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a><span class="sd">        if &quot;rectangular&quot;, a rectangular border.</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a><span class="sd">    &gt;&gt;&gt; borders = image_borders((3, 3), &quot;rectangular&quot;)</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a><span class="sd">    &gt;&gt;&gt; print(borders)</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a><span class="sd">    [[0 0 0]</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a><span class="sd">     [0 1 0]</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a><span class="sd">     [0 0 0]]</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>    <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="s2">&quot;circular&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>        <span class="n">borders</span> <span class="o">=</span> <span class="n">create_ellipse</span><span class="p">(</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>        <span class="n">img_contours</span> <span class="o">=</span> <span class="n">image_borders</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>        <span class="n">borders</span> <span class="o">=</span> <span class="n">borders</span> <span class="o">*</span> <span class="n">img_contours</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>        <span class="n">borders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>        <span class="n">borders</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>        <span class="n">borders</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>        <span class="n">borders</span><span class="p">[</span><span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>        <span class="n">borders</span><span class="p">[:,</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>    <span class="k">return</span> <span class="n">borders</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.is_raw_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_raw_image</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Determine if the image path corresponds to a raw image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path of the image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the image is considered raw, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">is_raw_image</span><span class="p">(</span><span class="s2">&quot;image.jpg&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">False</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_raw_image</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">    Determine if the image path corresponds to a raw image.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">    image_path : str</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        The file path of the image.</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">    -------</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    bool</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">        True if the image is considered raw, False otherwise.</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">    --------</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">    &gt;&gt;&gt; result = is_raw_image(&quot;image.jpg&quot;)</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">    False</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>    <span class="n">ext</span> <span class="o">=</span> <span class="n">image_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">opencv_accepted_formats</span><span class="p">):</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="n">raw_image</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="n">raw_image</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>    <span class="k">return</span> <span class="n">raw_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.keep_one_connected_component" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">keep_one_connected_component</span><span class="p">(</span><span class="n">binary_image</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Keep only one connected component in a binary image.</p>
<p>This function filters out all but the largest connected component in
a binary image, effectively isolating it from other noise or objects.
The function ensures the input is in uint8 format before processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>binary_image</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binary image containing one or more connected components.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Image with only the largest connected component retained.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">all_shapes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">all_shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">all_shapes</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="n">all_shapes</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">[[1 1 0 0 0]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go"> [1 1 0 0 0]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go"> [0 0 0 0 0]</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go"> [0 0 0 0 0]</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="go"> [0 0 0 0 0]]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/morphological_operations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2012" name="__codelineno-0-2012"></a><span class="k">def</span><span class="w"> </span><span class="nf">keep_one_connected_component</span><span class="p">(</span><span class="n">binary_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">])</span><span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>
<a id="__codelineno-0-2013" name="__codelineno-0-2013"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2014" name="__codelineno-0-2014"></a><span class="sd">    Keep only one connected component in a binary image.</span>
<a id="__codelineno-0-2015" name="__codelineno-0-2015"></a>
<a id="__codelineno-0-2016" name="__codelineno-0-2016"></a><span class="sd">    This function filters out all but the largest connected component in</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017"></a><span class="sd">    a binary image, effectively isolating it from other noise or objects.</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018"></a><span class="sd">    The function ensures the input is in uint8 format before processing.</span>
<a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>
<a id="__codelineno-0-2020" name="__codelineno-0-2020"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-2021" name="__codelineno-0-2021"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-2022" name="__codelineno-0-2022"></a><span class="sd">    binary_image : ndarray of uint8</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023"></a><span class="sd">        Binary image containing one or more connected components.</span>
<a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>
<a id="__codelineno-0-2025" name="__codelineno-0-2025"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-2026" name="__codelineno-0-2026"></a><span class="sd">    -------</span>
<a id="__codelineno-0-2027" name="__codelineno-0-2027"></a><span class="sd">    ndarray of uint8</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028"></a><span class="sd">        Image with only the largest connected component retained.</span>
<a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>
<a id="__codelineno-0-2030" name="__codelineno-0-2030"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031"></a><span class="sd">    -------</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032"></a><span class="sd">    &gt;&gt;&gt; all_shapes = np.zeros((5, 5), dtype=np.uint8)</span>
<a id="__codelineno-0-2033" name="__codelineno-0-2033"></a><span class="sd">    &gt;&gt;&gt; all_shapes[0:2, 0:2] = 1</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034"></a><span class="sd">    &gt;&gt;&gt; all_shapes[3:4, 3:4] = 1</span>
<a id="__codelineno-0-2035" name="__codelineno-0-2035"></a><span class="sd">    &gt;&gt;&gt; res = keep_one_connected_component(all_shapes)</span>
<a id="__codelineno-0-2036" name="__codelineno-0-2036"></a><span class="sd">    &gt;&gt;&gt; print(res)</span>
<a id="__codelineno-0-2037" name="__codelineno-0-2037"></a><span class="sd">    [[1 1 0 0 0]</span>
<a id="__codelineno-0-2038" name="__codelineno-0-2038"></a><span class="sd">     [1 1 0 0 0]</span>
<a id="__codelineno-0-2039" name="__codelineno-0-2039"></a><span class="sd">     [0 0 0 0 0]</span>
<a id="__codelineno-0-2040" name="__codelineno-0-2040"></a><span class="sd">     [0 0 0 0 0]</span>
<a id="__codelineno-0-2041" name="__codelineno-0-2041"></a><span class="sd">     [0 0 0 0 0]]</span>
<a id="__codelineno-0-2042" name="__codelineno-0-2042"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2043" name="__codelineno-0-2043"></a>    <span class="k">if</span> <span class="n">binary_image</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
<a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>        <span class="n">binary_image</span> <span class="o">=</span> <span class="n">binary_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2045" name="__codelineno-0-2045"></a>    <span class="n">num_labels</span><span class="p">,</span> <span class="n">sh</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponents</span><span class="p">(</span><span class="n">binary_image</span><span class="p">)</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046"></a>    <span class="k">if</span> <span class="n">num_labels</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047"></a>        <span class="k">return</span> <span class="n">binary_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2049" name="__codelineno-0-2049"></a>        <span class="k">return</span> <span class="n">keep_largest_shape</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.linear_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">linear_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Perform a linear transformation on input data using slope and intercept.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>a</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Slope coefficient.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>b</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intercept.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resulting value from linear transformation: <code>a</code> * <code>x</code> + <code>b</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">11.5</span>
</code></pre></div>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function uses Numba's @njit decorator for performance.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="k">def</span><span class="w"> </span><span class="nf">linear_model</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    Perform a linear transformation on input data using slope and intercept.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    x : array_like</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        Input data.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    a : float</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        Slope coefficient.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">    b : float</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        Intercept.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    -------</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    float</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        Resulting value from linear transformation: `a` * `x` + `b`.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">    --------</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    &gt;&gt;&gt; result = linear_model(5, 2.0, 1.5)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    &gt;&gt;&gt; print(result)  # doctest: +SKIP</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    11.5</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    -----</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    This function uses Numba&#39;s @njit decorator for performance.</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">b</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.movie" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">movie</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="n">increase_contrast</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<details class="summary" open>
  <summary>Summary</summary>
  <p>Processes a video to display each frame with optional contrast increase and resizing.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>video</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input video represented as a 3D NumPy array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>increase_contrast</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to increase the contrast of each frame (default is True).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Other Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>keyboard</code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Key to wait for during the display of each frame.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>increase_contrast</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to increase contrast for the displayed frames.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>video</code> is not a 3D NumPy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function uses OpenCV's <code>imshow</code> to display each frame. Ensure that the required
OpenCV dependencies are met.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">movie</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="go">Processes and displays a video with default settings.</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">movie</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="n">keyboard</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">Processes and displays a video waiting for the SPACE key between frames.</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">movie</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="n">increase_contrast</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">Processes and displays a video without increasing contrast.</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="k">def</span><span class="w"> </span><span class="nf">movie</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="n">increase_contrast</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    Summary</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    -------</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    Processes a video to display each frame with optional contrast increase and resizing.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">    video : numpy.ndarray</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        The input video represented as a 3D NumPy array.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    increase_contrast : bool, optional</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">        Flag to increase the contrast of each frame (default is True).</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">    Other Parameters</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">    ----------------</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">    keyboard : int, optional</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">        Key to wait for during the display of each frame.</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">    increase_contrast : bool, optional</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">        Whether to increase contrast for the displayed frames.</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    -------</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    None</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    ------</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">        If `video` is not a 3D NumPy array.</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">    -----</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">    This function uses OpenCV&#39;s `imshow` to display each frame. Ensure that the required</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">    OpenCV dependencies are met.</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">    --------</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">    &gt;&gt;&gt; movie(video)</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">    Processes and displays a video with default settings.</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">    &gt;&gt;&gt; movie(video, keyboard=0)</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">    Processes and displays a video waiting for the SPACE key between frames.</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">    &gt;&gt;&gt; movie(video, increase_contrast=False)</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">    Processes and displays a video without increasing contrast.</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">video</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>            <span class="k">if</span> <span class="n">increase_contrast</span><span class="p">:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="n">final_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Motion analysis&#39;</span><span class="p">,</span> <span class="n">final_img</span><span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                <span class="k">break</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.moving_average" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">moving_average</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the moving average of a given vector with specified step size.</p>
<p>Computes the moving average of input <code>vector</code> using specified <code>step</code>
size. NaN values are treated as zeros in the calculation to allow
for continuous averaging.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vector</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input vector for which to calculate the moving average.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of the window for computing the moving average.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vector containing the moving averages of the input vector.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>step</code> is less than 1.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the input vector has no valid (non-NaN) elements.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>The function considers NaN values as zeros during the averaging process.</li>
<li>If <code>step</code> is greater than or equal to the length of the vector, a warning will be raised.</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">step</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">[1.5 2.33333333 3.66666667 4.         nan]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="k">def</span><span class="w"> </span><span class="nf">moving_average</span><span class="p">(</span><span class="n">vector</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">    Calculate the moving average of a given vector with specified step size.</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">    Computes the moving average of input `vector` using specified `step`</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">    size. NaN values are treated as zeros in the calculation to allow</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">    for continuous averaging.</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">    vector : ndarray</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">        Input vector for which to calculate the moving average.</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">    step : int</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">        Size of the window for computing the moving average.</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">    -------</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">    numpy.ndarray</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">        Vector containing the moving averages of the input vector.</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    ------</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">        If `step` is less than 1.</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">        If the input vector has no valid (non-NaN) elements.</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">    -----</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">    - The function considers NaN values as zeros during the averaging process.</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    - If `step` is greater than or equal to the length of the vector, a warning will be raised.</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">    --------</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">    &gt;&gt;&gt; vector = np.array([1.0, 2.0, np.nan, 4.0, 5.0])</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">    &gt;&gt;&gt; step = 3</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">    &gt;&gt;&gt; result = moving_average(vector, step)</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    [1.5 2.33333333 3.66666667 4.         nan]</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>    <span class="n">substep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))))</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>    <span class="n">sums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">vector</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="n">n_okays</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">sums</span><span class="p">)</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>    <span class="n">true_numbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vector</span><span class="p">))</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="n">vector</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">true_numbers</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="k">for</span> <span class="n">step_i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">substep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="n">sums</span><span class="p">[</span><span class="n">step_i</span><span class="p">:</span> <span class="p">(</span><span class="n">sums</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">step_i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sums</span><span class="p">[</span><span class="n">step_i</span><span class="p">:</span> <span class="p">(</span><span class="n">sums</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">step_i</span><span class="p">)]</span> <span class="o">+</span> <span class="n">vector</span><span class="p">[(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">step_i</span><span class="p">):]</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="n">n_okays</span><span class="p">[</span><span class="n">step_i</span><span class="p">:</span> <span class="p">(</span><span class="n">sums</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">step_i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">n_okays</span><span class="p">[</span><span class="n">step_i</span><span class="p">:</span> <span class="p">(</span><span class="n">sums</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">step_i</span><span class="p">)]</span> <span class="o">+</span> <span class="n">true_numbers</span><span class="p">[(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">step_i</span><span class="p">):]</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">step_i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">step_i</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">substep</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="n">sums</span><span class="p">[</span><span class="n">step_i</span><span class="p">:</span> <span class="p">(</span><span class="n">sums</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">step_i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sums</span><span class="p">[</span><span class="n">step_i</span><span class="p">:</span> <span class="p">(</span><span class="n">sums</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">step_i</span><span class="p">)]</span> <span class="o">+</span> <span class="n">vector</span><span class="p">[:(</span><span class="n">sums</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">step_i</span><span class="p">)):]</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="n">n_okays</span><span class="p">[</span><span class="n">step_i</span><span class="p">:</span> <span class="p">(</span><span class="n">sums</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">step_i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">n_okays</span><span class="p">[</span><span class="n">step_i</span><span class="p">:</span> <span class="p">(</span><span class="n">sums</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">step_i</span><span class="p">)]</span> <span class="o">+</span> <span class="n">true_numbers</span><span class="p">[:(</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>                        <span class="n">true_numbers</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">step_i</span><span class="p">))]</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>    <span class="n">vector</span> <span class="o">=</span> <span class="n">sums</span> <span class="o">/</span> <span class="n">n_okays</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>    <span class="k">return</span> <span class="n">vector</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.njit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">njit</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>numba.njit decorator that can be disabled. Useful for testing.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/decorators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">njit</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; numba.njit decorator that can be disabled. Useful for testing.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="k">if</span> <span class="n">USE_NUMBA</span><span class="p">:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>        <span class="k">return</span> <span class="n">_real_njit</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="c1"># test mode: return identity decorator</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">deco</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>        <span class="k">return</span> <span class="n">func</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="k">return</span> <span class="n">deco</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.read_and_rotate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_and_rotate</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span> <span class="n">prev_img</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw_images</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_landscape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop_coord</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read and rotate an image based on specified parameters.</p>
<p>This function reads an image from the given file name, optionally rotates
it by 90 degrees clockwise or counterclockwise based on its dimensions and
the <code>is_landscape</code> flag, and applies cropping if specified. It also compares
rotated images against a previous image to choose the best rotation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the image file to read.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prev_img</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Previous image for comparison. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw_images</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to read raw images. Default is <code>False</code>.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_landscape</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to determine if the image should be considered in landscape mode.
Default is <code>True</code>.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_coord</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinates for cropping the image. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rotated and optionally cropped image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified image file does not exist.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">pathway</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;experiment&quot;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image_name</span> <span class="o">=</span> <span class="s1">&#39;image1.tif&#39;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">read_and_rotate</span><span class="p">(</span><span class="n">pathway</span> <span class="o">/</span><span class="n">image_name</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">(245, 300, 3)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="k">def</span><span class="w"> </span><span class="nf">read_and_rotate</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span> <span class="n">prev_img</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw_images</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_landscape</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop_coord</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">    Read and rotate an image based on specified parameters.</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">    This function reads an image from the given file name, optionally rotates</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">    it by 90 degrees clockwise or counterclockwise based on its dimensions and</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">    the `is_landscape` flag, and applies cropping if specified. It also compares</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">    rotated images against a previous image to choose the best rotation.</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">    image_name : str</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="sd">        Name of the image file to read.</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">    prev_img : ndarray, optional</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">        Previous image for comparison. Default is `None`.</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">    raw_images : bool, optional</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">        Flag to read raw images. Default is `False`.</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">    is_landscape : bool, optional</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">        Flag to determine if the image should be considered in landscape mode.</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">        Default is `True`.</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">    crop_coord : ndarray, optional</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">        Coordinates for cropping the image. Default is `None`.</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a><span class="sd">    -------</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">    ndarray</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">        Rotated and optionally cropped image.</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">    ------</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">    FileNotFoundError</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">        If the specified image file does not exist.</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">    ------</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    &gt;&gt;&gt; pathway = Path(__name__).resolve().parents[0] / &quot;data&quot; / &quot;experiment&quot;</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">    &gt;&gt;&gt; image_name = &#39;image1.tif&#39;</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">    &gt;&gt;&gt; image = read_and_rotate(pathway /image_name)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">    &gt;&gt;&gt; print(image.shape)</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    (245, 300, 3)</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">image_name</span><span class="p">):</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>    <span class="n">img</span> <span class="o">=</span> <span class="n">readim</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span> <span class="n">raw_images</span><span class="p">)</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">is_landscape</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_landscape</span><span class="p">):</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>        <span class="n">clockwise</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ROTATE_90_CLOCKWISE</span><span class="p">)</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>        <span class="k">if</span> <span class="n">crop_coord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>            <span class="n">clockwise</span> <span class="o">=</span> <span class="n">clockwise</span><span class="p">[</span><span class="n">crop_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">crop_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">crop_coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">crop_coord</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="k">if</span> <span class="n">prev_img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>            <span class="n">prev_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="n">prev_img</span><span class="p">)</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>            <span class="n">clock_diff</span> <span class="o">=</span> <span class="n">sum_of_abs_differences</span><span class="p">(</span><span class="n">prev_img</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="n">clockwise</span><span class="p">))</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>            <span class="n">counter_clockwise</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ROTATE_90_COUNTERCLOCKWISE</span><span class="p">)</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>            <span class="k">if</span> <span class="n">crop_coord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>                <span class="n">counter_clockwise</span> <span class="o">=</span> <span class="n">counter_clockwise</span><span class="p">[</span><span class="n">crop_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">crop_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">crop_coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">crop_coord</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>            <span class="n">counter_clock_diff</span> <span class="o">=</span> <span class="n">sum_of_abs_differences</span><span class="p">(</span><span class="n">prev_img</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="n">counter_clockwise</span><span class="p">))</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>            <span class="k">if</span> <span class="n">clock_diff</span> <span class="o">&gt;</span> <span class="n">counter_clock_diff</span><span class="p">:</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">counter_clockwise</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">clockwise</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">clockwise</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>        <span class="k">if</span> <span class="n">crop_coord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">crop_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">crop_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">crop_coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">crop_coord</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.read_h5_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_h5_array</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read data array from an HDF5 file.</p>
<p>This function reads a specific dataset from an HDF5 file using the provided key.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the HDF5 file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset name within the HDF5 file.</p>
              </div>
            </td>
            <td>
                  <code>&#39;data&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data array from the specified dataset in the HDF5 file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="k">def</span><span class="w"> </span><span class="nf">read_h5_array</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">    Read data array from an HDF5 file.</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">    This function reads a specific dataset from an HDF5 file using the provided key.</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">    file_name : str</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">        The path to the HDF5 file.</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">    key : str, optional, default: &#39;data&#39;</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">        The dataset name within the HDF5 file.</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">    -------</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">    ndarray</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">        The data array from the specified dataset in the HDF5 file.</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5f</span><span class="p">:</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">h5f</span><span class="p">:</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">h5f</span><span class="p">[</span><span class="n">key</span><span class="p">][:]</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>                <span class="k">return</span> <span class="n">data</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; not found in file &#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.read_one_arena" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_one_arena</span><span class="p">(</span><span class="n">arena_label</span><span class="p">,</span> <span class="n">already_greyscale</span><span class="p">,</span> <span class="n">csc_dict</span><span class="p">,</span> <span class="n">videos_already_in_ram</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">true_frame_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vid_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background2</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read a single arena's video data, potentially converting it from color to greyscale.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arena_label</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The label of the arena.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>already_greyscale</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the video is already in greyscale format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>csc_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing color space conversion settings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>videos_already_in_ram</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-loaded video frames in memory. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>true_frame_width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The true width of the video frames. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vid_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the video file. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>background</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Background image for subtractions. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>background2</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second background image for subtractions. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
    - visu: np.ndarray or None, the visual frame.
    - converted_video: np.ndarray or None, the video data converted as needed.
    - converted_video2: np.ndarray or None, additional video data if necessary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified video file does not exist.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the video data shape is invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function assumes that <code>video2numpy</code> is a helper function available in the scope.
For optimal performance, ensure all video data fits in RAM.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="k">def</span><span class="w"> </span><span class="nf">read_one_arena</span><span class="p">(</span><span class="n">arena_label</span><span class="p">,</span> <span class="n">already_greyscale</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="n">csc_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">videos_already_in_ram</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>                   <span class="n">true_frame_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vid_name</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background2</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><span class="sd">    Read a single arena&#39;s video data, potentially converting it from color to greyscale.</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a><span class="sd">    arena_label : int</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><span class="sd">        The label of the arena.</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a><span class="sd">    already_greyscale : bool</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><span class="sd">        Whether the video is already in greyscale format.</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a><span class="sd">    csc_dict : dict</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a><span class="sd">        Dictionary containing color space conversion settings.</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a><span class="sd">    videos_already_in_ram : np.ndarray, optional</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a><span class="sd">        Pre-loaded video frames in memory. Default is None.</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a><span class="sd">    true_frame_width : int, optional</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a><span class="sd">        The true width of the video frames. Default is None.</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a><span class="sd">    vid_name : str, optional</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><span class="sd">        Name of the video file. Default is None.</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a><span class="sd">    background : np.ndarray, optional</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a><span class="sd">        Background image for subtractions. Default is None.</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a><span class="sd">    background2 : np.ndarray, optional</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a><span class="sd">        Second background image for subtractions. Default is None.</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><span class="sd">        A tuple containing:</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a><span class="sd">            - visu: np.ndarray or None, the visual frame.</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><span class="sd">            - converted_video: np.ndarray or None, the video data converted as needed.</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><span class="sd">            - converted_video2: np.ndarray or None, additional video data if necessary.</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a><span class="sd">    ------</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a><span class="sd">    FileNotFoundError</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a><span class="sd">        If the specified video file does not exist.</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a><span class="sd">        If the video data shape is invalid.</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a><span class="sd">    This function assumes that `video2numpy` is a helper function available in the scope.</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a><span class="sd">    For optimal performance, ensure all video data fits in RAM.</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>    <span class="n">visu</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">,</span> <span class="n">converted_video2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arena n</span><span class="si">{</span><span class="n">arena_label</span><span class="si">}</span><span class="s2">. Load images and videos&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>    <span class="k">if</span> <span class="n">videos_already_in_ram</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>        <span class="k">if</span> <span class="n">already_greyscale</span><span class="p">:</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>            <span class="n">converted_video</span> <span class="o">=</span> <span class="n">videos_already_in_ram</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>            <span class="k">if</span> <span class="n">csc_dict</span><span class="p">[</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>                <span class="n">visu</span><span class="p">,</span> <span class="n">converted_video</span> <span class="o">=</span> <span class="n">videos_already_in_ram</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>                <span class="n">visu</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">,</span> <span class="n">converted_video2</span> <span class="o">=</span> <span class="n">videos_already_in_ram</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>        <span class="k">if</span> <span class="n">vid_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>            <span class="k">if</span> <span class="n">already_greyscale</span><span class="p">:</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>                <span class="n">converted_video</span> <span class="o">=</span> <span class="n">video2numpy</span><span class="p">(</span><span class="n">vid_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="n">background2</span><span class="p">,</span> <span class="n">true_frame_width</span><span class="p">)</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>                    <span class="n">converted_video</span> <span class="o">=</span> <span class="n">converted_video</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>                <span class="n">visu</span> <span class="o">=</span> <span class="n">video2numpy</span><span class="p">(</span><span class="n">vid_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="n">background2</span><span class="p">,</span> <span class="n">true_frame_width</span><span class="p">)</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>            <span class="n">vid_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ind_</span><span class="si">{</span><span class="n">arena_label</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">vid_name</span><span class="p">):</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>                <span class="k">if</span> <span class="n">already_greyscale</span><span class="p">:</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>                    <span class="n">converted_video</span> <span class="o">=</span> <span class="n">video2numpy</span><span class="p">(</span><span class="n">vid_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="n">background2</span><span class="p">,</span> <span class="n">true_frame_width</span><span class="p">)</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">converted_video</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                        <span class="n">converted_video</span> <span class="o">=</span> <span class="n">converted_video</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                    <span class="n">visu</span> <span class="o">=</span> <span class="n">video2numpy</span><span class="p">(</span><span class="n">vid_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="n">background2</span><span class="p">,</span> <span class="n">true_frame_width</span><span class="p">)</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>    <span class="k">return</span> <span class="n">visu</span><span class="p">,</span> <span class="n">converted_video</span><span class="p">,</span> <span class="n">converted_video2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.readim" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readim</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">raw_image</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read an image from a file and optionally process it.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the image file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw_image</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, logs an error message indicating that the raw image format cannot be processed. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The decoded image represented as a NumPy array of shape (height, width, channels).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>raw_image</code> is set to True, logs an error indicating that the raw image format cannot be processed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Although <code>raw_image</code> is set to False by default, currently it does not perform any raw image processing.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;example.jpg&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="go">array([[[255, 0, 0],</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">        [255, 0, 0]],</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code>   [[  0, 255, 0],
    [  0, 255, 0]],

   [[  0,   0, 255],
    [  0,   0, 255]]], dtype=np.uint8)
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="k">def</span><span class="w"> </span><span class="nf">readim</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">raw_image</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">    Read an image from a file and optionally process it.</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">    image_path : str</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">        Path to the image file.</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">    raw_image : bool, optional</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">        If True, logs an error message indicating that the raw image format cannot be processed. Default is False.</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">    -------</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">    ndarray</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">        The decoded image represented as a NumPy array of shape (height, width, channels).</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">    ------</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    RuntimeError</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">        If `raw_image` is set to True, logs an error indicating that the raw image format cannot be processed.</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">    -----</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">    Although `raw_image` is set to False by default, currently it does not perform any raw image processing.</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">    --------</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    &gt;&gt;&gt; cv2.imread(&quot;example.jpg&quot;)</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    array([[[255, 0, 0],</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">            [255, 0, 0]],</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">           [[  0, 255, 0],</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">            [  0, 255, 0]],</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">           [[  0,   0, 255],</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">            [  0,   0, 255]]], dtype=np.uint8)</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>    <span class="k">if</span> <span class="n">raw_image</span><span class="p">:</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cannot read this image format. If the rawpy package can, ask for a version of Cellects using it.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="c1"># import rawpy</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="c1"># raw = rawpy.imread(image_path)</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="c1"># raw = raw.postprocess()</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="c1"># return cv2.cvtColor(raw, COLOR_RGB2BGR)</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.remove_coordinates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_coordinates</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Remove coordinates from <code>arr1</code> that are present in <code>arr2</code>.</p>
<p>Given two arrays of coordinates, remove rows from the first array
that match any row in the second array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arr1</code>
            </td>
            <td>
                  <code>ndarray of shape (n, 2)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array containing coordinates to filter.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>arr2</code>
            </td>
            <td>
                  <code>ndarray of shape (m, 2)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array containing coordinates to match for removal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ndarray of shape (k, 2)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array with coordinates from <code>arr1</code> that are not in <code>arr2</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">remove_coordinates</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">array([[1, 2],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">       [3, 4]])</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">remove_coordinates</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">array([[1, 2],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">       [3, 4]])</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">remove_coordinates</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">array([[3, 4]])</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">196</span><span class="p">,</span> <span class="mi">197</span><span class="p">],</span> <span class="p">[</span><span class="mi">198</span><span class="p">,</span> <span class="mi">199</span><span class="p">]])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">new_arr1</span> <span class="o">=</span> <span class="n">remove_coordinates</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">new_arr1</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">(98, 2)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/utilitarian.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="k">def</span><span class="w"> </span><span class="nf">remove_coordinates</span><span class="p">(</span><span class="n">arr1</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">arr2</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">    Remove coordinates from `arr1` that are present in `arr2`.</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">    Given two arrays of coordinates, remove rows from the first array</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">    that match any row in the second array.</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    arr1 : ndarray of shape (n, 2)</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">        Array containing coordinates to filter.</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    arr2 : ndarray of shape (m, 2)</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">        Array containing coordinates to match for removal.</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">    -------</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">    ndarray of shape (k, 2)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">        Array with coordinates from `arr1` that are not in `arr2`.</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    --------</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">    &gt;&gt;&gt; arr1 = np.array([[1, 2], [3, 4]])</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">    &gt;&gt;&gt; arr2 = np.array([[3, 4]])</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">    &gt;&gt;&gt; remove_coordinates(arr1, arr2)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    array([[1, 2],</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">           [3, 4]])</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">    &gt;&gt;&gt; arr1 = np.array([[1, 2], [3, 4]])</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">    &gt;&gt;&gt; arr2 = np.array([[3, 2], [1, 4]])</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">    &gt;&gt;&gt; remove_coordinates(arr1, arr2)</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    array([[1, 2],</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">           [3, 4]])</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    &gt;&gt;&gt; arr1 = np.array([[1, 2], [3, 4]])</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">    &gt;&gt;&gt; arr2 = np.array([[3, 2], [1, 2]])</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">    &gt;&gt;&gt; remove_coordinates(arr1, arr2)</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">    array([[3, 4]])</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">    &gt;&gt;&gt; arr1 = np.arange(200).reshape(100, 2)</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">    &gt;&gt;&gt; arr2 = np.array([[196, 197], [198, 199]])</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">    &gt;&gt;&gt; new_arr1 = remove_coordinates(arr1, arr2)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    &gt;&gt;&gt; new_arr1.shape</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">    (98, 2)</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>    <span class="k">if</span> <span class="n">arr2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="k">return</span> <span class="n">arr1</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="k">if</span> <span class="n">arr1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">arr2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both arrays must have shape (n, 2)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="n">c_to_keep</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">arr1</span> <span class="o">==</span> <span class="n">arr2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">arr2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="n">c_to_keep</span> <span class="o">*=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">arr1</span> <span class="o">==</span> <span class="n">row</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="k">return</span> <span class="n">arr1</span><span class="p">[</span><span class="n">c_to_keep</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.remove_h5_key" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_h5_key</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Remove a specified key from an HDF5 file.</p>
<p>This function opens an HDF5 file in append mode and deletes the specified
key if it exists. It handles exceptions related to file not found
and other runtime errors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the HDF5 file from which the key should be removed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the dataset or group to delete from the HDF5 file.
Default is "data".</p>
              </div>
            </td>
            <td>
                  <code>&#39;data&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified file does not exist.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If any other error occurs during file operations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function modifies the HDF5 file in place. Ensure you have a backup if necessary.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="k">def</span><span class="w"> </span><span class="nf">remove_h5_key</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">    Remove a specified key from an HDF5 file.</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">    This function opens an HDF5 file in append mode and deletes the specified</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">    key if it exists. It handles exceptions related to file not found</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">    and other runtime errors.</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">    file_name : str</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">        The path to the HDF5 file from which the key should be removed.</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">    key : str, optional</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">        The name of the dataset or group to delete from the HDF5 file.</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">        Default is &quot;data&quot;.</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">    -------</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">    None</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="sd">    ------</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="sd">    FileNotFoundError</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a><span class="sd">        If the specified file does not exist.</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a><span class="sd">    RuntimeError</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">        If any other error occurs during file operations.</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="sd">    -----</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">    This function modifies the HDF5 file in place. Ensure you have a backup if necessary.</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5f</span><span class="p">:</span>  <span class="c1"># Open in append mode to modify the file</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">h5f</span><span class="p">:</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>                <span class="k">del</span> <span class="n">h5f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.remove_padding" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_padding</span><span class="p">(</span><span class="n">array_list</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Remove padding from a list of 2D arrays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array_list</code>
            </td>
            <td>
                  <code>list of ndarrays</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of 2D NumPy arrays to be processed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>list of ndarrays</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of 2D NumPy arrays with the padding removed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">remove_padding</span><span class="p">([</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">])</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">[array([[1]]), array([[0]])]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1984" name="__codelineno-0-1984"></a><span class="k">def</span><span class="w"> </span><span class="nf">remove_padding</span><span class="p">(</span><span class="n">array_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a><span class="sd">    Remove padding from a list of 2D arrays.</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1989" name="__codelineno-0-1989"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1990" name="__codelineno-0-1990"></a><span class="sd">    array_list : list of ndarrays</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991"></a><span class="sd">        List of 2D NumPy arrays to be processed.</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a><span class="sd">    out : list of ndarrays</span>
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a><span class="sd">        List of 2D NumPy arrays with the padding removed.</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a><span class="sd">    --------</span>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a><span class="sd">    &gt;&gt;&gt; arr1 = np.array([[0, 0, 0], [0, 1, 0], [0, 0, 0]])</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a><span class="sd">    &gt;&gt;&gt; arr2 = np.array([[1, 1, 1], [1, 0, 1], [1, 1, 1]])</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a><span class="sd">    &gt;&gt;&gt; remove_padding([arr1, arr2])</span>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a><span class="sd">    [array([[1]]), array([[0]])]</span>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>    <span class="n">new_array_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>    <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">array_list</span><span class="p">:</span>
<a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>        <span class="n">new_array_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">un_pad</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>    <span class="k">return</span> <span class="n">new_array_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.remove_small_loops" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_small_loops</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">pad_distances</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Remove small loops from a skeletonized image.</p>
<p>This function identifies and removes small loops in a skeletonized image, returning the modified skeleton.
If distance information is provided, it updates that as well.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pad_skeleton</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The skeletonized image with potential small loops.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pad_distances</code>
            </td>
            <td>
                  <code>ndarray of float64</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The distance map corresponding to the skeleton image. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>ndarray of uint8 or tuple(ndarray of uint8, ndarray of float64)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>pad_distances</code> is None, returns the modified skeleton. Otherwise,
returns a tuple of the modified skeleton and updated distances.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="k">def</span><span class="w"> </span><span class="nf">remove_small_loops</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">pad_distances</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">    Remove small loops from a skeletonized image.</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">    This function identifies and removes small loops in a skeletonized image, returning the modified skeleton.</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">    If distance information is provided, it updates that as well.</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">    pad_skeleton : ndarray of uint8</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">        The skeletonized image with potential small loops.</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">    pad_distances : ndarray of float64, optional</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">        The distance map corresponding to the skeleton image. Default is `None`.</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">    -------</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="sd">    out : ndarray of uint8 or tuple(ndarray of uint8, ndarray of float64)</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">        If `pad_distances` is None, returns the modified skeleton. Otherwise,</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">        returns a tuple of the modified skeleton and updated distances.</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>    <span class="n">cnv4</span><span class="p">,</span> <span class="n">cnv8</span> <span class="o">=</span> <span class="n">get_neighbor_comparisons</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>    <span class="c1"># potential_tips = get_terminations_and_their_connected_nodes(pad_skeleton, cnv4, cnv8)</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>    <span class="n">cnv_diag_0</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>    <span class="n">cnv_diag_0</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>    <span class="n">cnv4_false</span> <span class="o">=</span> <span class="n">CompareNeighborsWithValue</span><span class="p">(</span><span class="n">pad_skeleton</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>    <span class="n">cnv4_false</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">and_itself</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>    <span class="n">loop_centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">((</span><span class="n">cnv4_false</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">==</span> <span class="mi">4</span><span class="p">),</span> <span class="n">cnv_diag_0</span><span class="o">.</span><span class="n">equal_neighbor_nb</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>    <span class="n">surrounding</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">loop_centers</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">square_33</span><span class="p">)</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="n">surrounding</span> <span class="o">-=</span> <span class="n">loop_centers</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>    <span class="n">surrounding</span> <span class="o">=</span> <span class="n">surrounding</span> <span class="o">*</span> <span class="n">cnv8</span><span class="o">.</span><span class="n">equal_neighbor_nb</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>    <span class="c1"># Every 2 can be replaced by 0 if the loop center becomes 1</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>    <span class="n">filled_loops</span> <span class="o">=</span> <span class="n">pad_skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>    <span class="n">filled_loops</span><span class="p">[</span><span class="n">surrounding</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>    <span class="n">filled_loops</span> <span class="o">+=</span> <span class="n">loop_centers</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>    <span class="n">new_pad_skeleton</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">skeletonize</span><span class="p">(</span><span class="n">filled_loops</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;lee&#39;</span><span class="p">)</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>    <span class="c1"># Put the new pixels in pad_distances</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>    <span class="n">new_pixels</span> <span class="o">=</span> <span class="n">new_pad_skeleton</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pad_skeleton</span><span class="p">)</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>    <span class="n">pad_skeleton</span> <span class="o">=</span> <span class="n">new_pad_skeleton</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>    <span class="k">if</span> <span class="n">pad_distances</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>        <span class="k">return</span> <span class="n">pad_skeleton</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="n">pad_distances</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">new_pixels</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1"># 2. # Put nearest value instead?</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>        <span class="n">pad_distances</span> <span class="o">*=</span> <span class="n">pad_skeleton</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>        <span class="c1"># for yi, xi in zip(npY, npX): # yi, xi = npY[0], npX[0]</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>        <span class="c1">#     distances[yi, xi] = 2.</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>        <span class="k">return</span> <span class="n">pad_skeleton</span><span class="p">,</span> <span class="n">pad_distances</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.rolling_window_segmentation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rolling_window_segmentation</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Perform rolling window segmentation on a greyscale image, using potentially filled pixels and a specified patch size.</p>
<p>The function divides the input greyscale image into overlapping patches defined by <code>patch_size</code>,
and applies Otsu's thresholding method to each patch. The thresholds can be optionally
refined using a minimization algorithm.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>greyscale_image</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input greyscale image to segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>possibly_filled_pixels</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array indicating which pixels are possibly filled.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patch_size</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dimensions of the patches to segment. Default is (10, 10).
Must be superior to (1, 1).</p>
              </div>
            </td>
            <td>
                  <code>(10, 10)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>output</code></td>            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The segmented binary image where the network is marked as True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">possibly_filled_pixels</span> <span class="o">=</span> <span class="n">greyscale_image</span> <span class="o">&gt;</span> <span class="mi">1</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">patch_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">rolling_window_segmentation</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">[[0 1 0 0]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go"> [0 1 1 0]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go"> [0 1 1 0]</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go"> [0 0 1 0]]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="k">def</span><span class="w"> </span><span class="nf">rolling_window_segmentation</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">:</span> <span class="nb">tuple</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">    Perform rolling window segmentation on a greyscale image, using potentially filled pixels and a specified patch size.</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">    The function divides the input greyscale image into overlapping patches defined by `patch_size`,</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">    and applies Otsu&#39;s thresholding method to each patch. The thresholds can be optionally</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">    refined using a minimization algorithm.</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">    greyscale_image : ndarray of uint8</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">        The input greyscale image to segment.</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">    possibly_filled_pixels : ndarray of uint8</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">        An array indicating which pixels are possibly filled.</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">    patch_size : tuple, optional</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">        The dimensions of the patches to segment. Default is (10, 10).</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">        Must be superior to (1, 1).</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="sd">    -------</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="sd">    output : ndarray of uint8</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="sd">        The segmented binary image where the network is marked as True.</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">    --------</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="sd">    &gt;&gt;&gt; greyscale_image = np.array([[1, 2, 1, 1], [1, 3, 4, 1], [2, 4, 3, 1], [2, 1, 2, 1]])</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="sd">    &gt;&gt;&gt; possibly_filled_pixels = greyscale_image &gt; 1</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="sd">    &gt;&gt;&gt; patch_size = (2, 2)</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">    &gt;&gt;&gt; result = rolling_window_segmentation(greyscale_image, possibly_filled_pixels, patch_size)</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">    [[0 1 0 0]</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">     [0 1 1 0]</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">     [0 1 1 0]</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">     [0 0 1 0]]</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>    <span class="n">patch_centers</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="n">p</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">-</span> <span class="n">p</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>        <span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">greyscale_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">)</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>    <span class="p">]</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>    <span class="n">patch_centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">patch_centers</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>    <span class="n">patch_slices</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>        <span class="nb">tuple</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">p</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="n">p</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>              <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p_c</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">))</span> <span class="k">for</span> <span class="n">p_c</span> <span class="ow">in</span> <span class="n">patch_centers</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>    <span class="p">]</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>    <span class="n">maximize_parameter</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>    <span class="n">network_patches</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>    <span class="n">patch_thresholds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>    <span class="c1"># for patch in tqdm(patch_slices):</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>    <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">patch_slices</span><span class="p">:</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">greyscale_image</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span> <span class="o">*</span> <span class="n">possibly_filled_pixels</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>            <span class="n">t</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>            <span class="k">if</span> <span class="n">maximize_parameter</span><span class="p">:</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>                <span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">_network_perimeter</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">v</span><span class="p">,),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">)</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>                <span class="n">t</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>            <span class="n">network_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">)</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>            <span class="n">patch_thresholds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>            <span class="n">network_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>            <span class="n">patch_thresholds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>    <span class="n">network_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">greyscale_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>    <span class="n">count_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">)</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>    <span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">network_patch</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">patch_slices</span><span class="p">,</span> <span class="n">network_patches</span><span class="p">,</span> <span class="n">patch_thresholds</span><span class="p">):</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>        <span class="n">network_img</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span> <span class="o">+=</span> <span class="n">network_patch</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>        <span class="n">count_img</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">network_patch</span><span class="p">)</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>    <span class="c1"># Safe in-place division: zeros remain where count_img == 0</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>    <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">network_img</span><span class="p">,</span> <span class="n">count_img</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">network_img</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">count_img</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">network_img</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.save_fig" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_fig</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">full_path</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Save an image figure to a file with specified options.</p>
<p>This function creates a matplotlib figure from the given image,
optionally applies a colormap, displays it briefly, saves the
figure to disk at high resolution, and closes the figure.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>img</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span>(<span title="M">M</span>, <span title="N">N</span>, 3)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input image to be saved as a figure. Expected to be in RGB format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complete file path where the figure will be saved. Must include
extension (e.g., '.png', '.jpg').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cmap</code>
            </td>
            <td>
                  <code><span title="str">str</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Colormap to be applied if the image should be displayed with a specific
color map. If <code>None</code>, no colormap is applied.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This function does not return any value. It saves the figure to disk
at the specified location.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the directory in <code>full_path</code> does not exist.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">save_fig</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s1">&#39;test.png&#39;</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">Creates and saves a figure from the random image to &#39;test.png&#39;.</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">save_fig</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s1">&#39;colored_test.png&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="go">Creates and saves a figure from the random image with &#39;viridis&#39; colormap</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">to &#39;colored_test.png&#39;.</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_fig</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">full_path</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">    Save an image figure to a file with specified options.</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">    This function creates a matplotlib figure from the given image,</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">    optionally applies a colormap, displays it briefly, saves the</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">    figure to disk at high resolution, and closes the figure.</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a><span class="sd">    img : array_like (M, N, 3)</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="sd">        Input image to be saved as a figure. Expected to be in RGB format.</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">    full_path : str</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a><span class="sd">        The complete file path where the figure will be saved. Must include</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a><span class="sd">        extension (e.g., &#39;.png&#39;, &#39;.jpg&#39;).</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a><span class="sd">    cmap : str or None, optional</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a><span class="sd">        Colormap to be applied if the image should be displayed with a specific</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="sd">        color map. If `None`, no colormap is applied.</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="sd">    -------</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="sd">    None</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">        This function does not return any value. It saves the figure to disk</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">        at the specified location.</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="sd">    ------</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">    FileNotFoundError</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">        If the directory in `full_path` does not exist.</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">    --------</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a><span class="sd">    &gt;&gt;&gt; img = np.random.rand(100, 100, 3) * 255</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a><span class="sd">    &gt;&gt;&gt; save_fig(img, &#39;test.png&#39;)</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="sd">    Creates and saves a figure from the random image to &#39;test.png&#39;.</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><span class="sd">    &gt;&gt;&gt; save_fig(img, &#39;colored_test.png&#39;, cmap=&#39;viridis&#39;)</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="sd">    Creates and saves a figure from the random image with &#39;viridis&#39; colormap</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="sd">    to &#39;colored_test.png&#39;.</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>    <span class="n">sizes</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span>  <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.scale_coordinates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Scale coordinates based on given scale factors and dimensions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>coord</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 2x2 array of coordinates to be scaled.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale</code>
            </td>
            <td>
                  <code>tuple of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scaling factors for the x and y coordinates, respectively.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dims</code>
            </td>
            <td>
                  <code>tuple of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum dimensions (height, width) for the scaled coordinates.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scaled and rounded coordinates.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum y-coordinate.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum y-coordinate.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum x-coordinate.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum x-coordinate.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(((</span><span class="mi">47</span><span class="p">,</span> <span class="mi">38</span><span class="p">),</span> <span class="p">(</span><span class="mi">59</span><span class="p">,</span> <span class="mi">37</span><span class="p">)))</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">scale</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="mi">245</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">scaled_coord</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">scale_coordinates</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">scaled_coord</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">array([[43, 33],</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go">       [54, 32]])</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go">(np.int64(43), np.int64(54))</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="go">(np.int64(32), np.int64(33))</span>
</code></pre></div>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function assumes that the input coordinates are in a specific format
and will fail if not. The scaling factors should be positive.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="k">def</span><span class="w"> </span><span class="nf">scale_coordinates</span><span class="p">(</span><span class="n">coord</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">dims</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]:</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">    Scale coordinates based on given scale factors and dimensions.</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">    coord : numpy.ndarray</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">        A 2x2 array of coordinates to be scaled.</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">    scale : tuple of float</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">        Scaling factors for the x and y coordinates, respectively.</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="sd">    dims : tuple of int</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">        Maximum dimensions (height, width) for the scaled coordinates.</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a><span class="sd">    -------</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="sd">    numpy.ndarray</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a><span class="sd">        Scaled and rounded coordinates.</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a><span class="sd">    int</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="sd">        Minimum y-coordinate.</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">    int</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">        Maximum y-coordinate.</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">    int</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">        Minimum x-coordinate.</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">    int</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">        Maximum x-coordinate.</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">    --------</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">    &gt;&gt;&gt; coord = np.array(((47, 38), (59, 37)))</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">    &gt;&gt;&gt; scale = (0.92, 0.87)</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">    &gt;&gt;&gt; dims = (245, 300, 3)</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">    &gt;&gt;&gt; scaled_coord, min_y, max_y, min_x, max_x = scale_coordinates(coord, scale, dims)</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">    &gt;&gt;&gt; scaled_coord</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">    array([[43, 33],</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a><span class="sd">           [54, 32]])</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">    &gt;&gt;&gt; min_y, max_y</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">    (np.int64(43), np.int64(54))</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">    &gt;&gt;&gt; min_x, max_x</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">    (np.int64(32), np.int64(33))</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">    -----</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">    This function assumes that the input coordinates are in a specific format</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">    and will fail if not. The scaling factors should be positive.</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>    <span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>                    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]))),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>    <span class="n">min_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])))</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>    <span class="n">max_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])))</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>    <span class="n">min_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])))</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>    <span class="n">max_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])))</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>    <span class="k">return</span> <span class="n">coord</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.show" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Display an image using Matplotlib with optional interactivity and colormap.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>img</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The image data to be displayed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interactive</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, turn on interactive mode. Default is <code>True</code>.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cmap</code>
            </td>
            <td>
                  <code><span title="str">str</span> or <span title="Colormap">Colormap</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colormap to be used. If <code>None</code>, the default colormap will
be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Other Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>interactive</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, turn on interactive mode. Default is <code>True</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cmap</code></td>
            <td>
                  <code><span title="str">str</span> or <span title="Colormap">Colormap</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colormap to be used. If <code>None</code>, the default colormap will
be used.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>fig</code></td>            <td>
                  <code><span title="Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Matplotlib figure object containing the displayed image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>ax</code></td>            <td>
                  <code><span title="AxesSubplot">AxesSubplot</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The axes on which the image is plotted.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>cmap</code> is not a recognized colormap name or object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>If interactive mode is enabled, the user can manipulate the figure
window interactively.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">show</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">&lt;Figure size ... with ... Axes&gt;</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">show</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">&lt;Figure size ... with ... Axes&gt;</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">show</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">&lt;Figure size ... with .... Axes&gt;</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">    Display an image using Matplotlib with optional interactivity and colormap.</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="sd">    img : ndarray</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">        The image data to be displayed.</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">    interactive : bool, optional</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="sd">        If ``True``, turn on interactive mode. Default is ``True``.</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a><span class="sd">    cmap : str or Colormap, optional</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a><span class="sd">        The colormap to be used. If ``None``, the default colormap will</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a><span class="sd">        be used.</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">    Other Parameters</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a><span class="sd">    ----------------</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a><span class="sd">    interactive : bool, optional</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a><span class="sd">        If ``True``, turn on interactive mode. Default is ``True``.</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="sd">    cmap : str or Colormap, optional</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="sd">        The colormap to be used. If ``None``, the default colormap will</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a><span class="sd">        be used.</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="sd">    -------</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a><span class="sd">    fig : Figure</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a><span class="sd">        The Matplotlib figure object containing the displayed image.</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a><span class="sd">    ax : AxesSubplot</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a><span class="sd">        The axes on which the image is plotted.</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a><span class="sd">    ------</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a><span class="sd">        If `cmap` is not a recognized colormap name or object.</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a><span class="sd">    -----</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="sd">    If interactive mode is enabled, the user can manipulate the figure</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a><span class="sd">    window interactively.</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">    --------</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a><span class="sd">    &gt;&gt;&gt; img = np.random.rand(100, 50)</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a><span class="sd">    &gt;&gt;&gt; fig, ax = show(img)</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">    &gt;&gt;&gt; print(fig) # doctest: +SKIP</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="sd">    &lt;Figure size ... with ... Axes&gt;</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">    &gt;&gt;&gt; fig, ax = show(img, interactive=False)</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">    &gt;&gt;&gt; print(fig) # doctest: +SKIP</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">    &lt;Figure size ... with ... Axes&gt;</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">    &gt;&gt;&gt; fig, ax = show(img, cmap=&#39;gray&#39;)</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">    &gt;&gt;&gt; print(fig) # doctest: +SKIP</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">    &lt;Figure size ... with .... Axes&gt;</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>    <span class="n">sizes</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span>  <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>    <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.split_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split_dict</span><span class="p">(</span><span class="n">c_space_dict</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Split a dictionary into two dictionaries based on specific criteria and return their keys.</p>
<p>Split the input dictionary <code>c_space_dict</code> into two dictionaries: one for items not
ending with '2' and another where the key is truncated by removing its last
character if it does end with '2'. Additionally, return the keys that have been
processed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>c_space_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary to be split. Expected keys are strings and values can be any type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>first_dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing items from <code>c_space_dict</code> whose keys do not end with '2'.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>second_dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing items from <code>c_space_dict</code> whose keys end with '2',
where the key is truncated by removing its last character.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>c_spaces</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of keys from <code>c_space_dict</code> that have been processed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>No critical information to share.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">c_space_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;logical&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">first_dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="p">,</span> <span class="n">c_spaces</span> <span class="o">=</span> <span class="n">split_dict</span><span class="p">(</span><span class="n">c_space_dict</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">first_dict</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">{&#39;key1&#39;: 10}</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">second_dict</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">{&#39;key&#39;: 20}</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c_spaces</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">[&#39;key1&#39;, &#39;key&#39;]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/utilitarian.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="k">def</span><span class="w"> </span><span class="nf">split_dict</span><span class="p">(</span><span class="n">c_space_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">    Split a dictionary into two dictionaries based on specific criteria and return their keys.</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    Split the input dictionary `c_space_dict` into two dictionaries: one for items not</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    ending with &#39;2&#39; and another where the key is truncated by removing its last</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    character if it does end with &#39;2&#39;. Additionally, return the keys that have been</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    processed.</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">    c_space_dict : dict</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        The dictionary to be split. Expected keys are strings and values can be any type.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    -------</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    first_dict : dict</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        Dictionary containing items from `c_space_dict` whose keys do not end with &#39;2&#39;.</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    second_dict : dict</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        Dictionary containing items from `c_space_dict` whose keys end with &#39;2&#39;,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        where the key is truncated by removing its last character.</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    c_spaces : list</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        List of keys from `c_space_dict` that have been processed.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    ------</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    None</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    -----</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    No critical information to share.</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    --------</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    &gt;&gt;&gt; c_space_dict = {&#39;key1&#39;: 10, &#39;key2&#39;: 20, &#39;logical&#39;: 30}</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    &gt;&gt;&gt; first_dict, second_dict, c_spaces = split_dict(c_space_dict)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    &gt;&gt;&gt; print(first_dict)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    {&#39;key1&#39;: 10}</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    &gt;&gt;&gt; print(second_dict)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    {&#39;key&#39;: 20}</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    &gt;&gt;&gt; print(c_spaces)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    [&#39;key1&#39;, &#39;key&#39;]</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="n">first_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="n">second_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="n">c_spaces</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">c_space_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;PCA&#39;</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;logical&#39;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                <span class="n">first_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>                <span class="n">c_spaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                <span class="n">second_dict</span><span class="p">[</span><span class="n">k</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="n">c_spaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="k">return</span> <span class="n">first_dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="p">,</span> <span class="n">c_spaces</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.sum_of_abs_differences" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sum_of_abs_differences</span><span class="p">(</span><span class="n">array1</span><span class="p">,</span> <span class="n">array2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute the sum of absolute differences between two arrays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array1</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first input array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>array2</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The second input array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sum of absolute differences between elements of <code>array1</code> and <code>array2</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7</span><span class="p">])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">37</span><span class="p">])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">sum_of_abs_differences</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">66.6</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="k">def</span><span class="w"> </span><span class="nf">sum_of_abs_differences</span><span class="p">(</span><span class="n">array1</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">array2</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">):</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    Compute the sum of absolute differences between two arrays.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    array1 : NDArray</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        The first input array.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    array2 : NDArray</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        The second input array.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    -------</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    int</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        Sum of absolute differences between elements of `array1` and `array2`.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    --------</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    &gt;&gt;&gt; arr1 = np.array([1.2, 2.5, -3.7])</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    &gt;&gt;&gt; arr2 = np.array([12, 25, -37])</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    &gt;&gt;&gt; result = sum_of_abs_differences(arr1, arr2)</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    66.6</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">array1</span> <span class="o">-</span> <span class="n">array2</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.to_uint8" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_uint8</span><span class="p">(</span><span class="n">an_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert an array to unsigned 8-bit integers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>an_array</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input array to be converted. It can be of any numeric dtype.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input array rounded to the nearest integer and then cast to
unsigned 8-bit integers.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>an_array</code> is not a ndarray.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function uses Numba's <code>@njit</code> decorator for performance optimization.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">to_uint8</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7</span><span class="p">]))</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">[1 3 0]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/formulas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span>
<span class="normal"><a href="#__codelineno-0-98">98</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="k">def</span><span class="w"> </span><span class="nf">to_uint8</span><span class="p">(</span><span class="n">an_array</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">):</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    Convert an array to unsigned 8-bit integers.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    an_array : ndarray</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Input array to be converted. It can be of any numeric dtype.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    -------</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    ndarray</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        The input array rounded to the nearest integer and then cast to</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        unsigned 8-bit integers.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    ------</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    TypeError</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        If `an_array` is not a ndarray.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    -----</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    This function uses Numba&#39;s `@njit` decorator for performance optimization.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    --------</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    &gt;&gt;&gt; result = to_uint8(np.array([1.2, 2.5, -3.7]))</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    [1 3 0]</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">an_array</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">an_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.translate_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">translate_dict</span><span class="p">(</span><span class="n">old_dict</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Translate a dictionary to a typed dictionary and filter out non-string values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>old_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input dictionary that may contain non-string values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>numba_dict</code></td>            <td>
                  <code><span title="numba.typed.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A typed dictionary containing only the items from <code>old_dict</code> where the value is not a string</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">translate_dict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">})</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">{a: 1.0, c: 2.0}</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/utilitarian.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="k">def</span><span class="w"> </span><span class="nf">translate_dict</span><span class="p">(</span><span class="n">old_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Translate a dictionary to a typed dictionary and filter out non-string values.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    old_dict : dict</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        The input dictionary that may contain non-string values</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    -------</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    numba_dict : Dict</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        A typed dictionary containing only the items from `old_dict` where the value is not a string</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    --------</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    &gt;&gt;&gt; result = translate_dict({&#39;a&#39;: 1., &#39;b&#39;: &#39;string&#39;, &#39;c&#39;: 2.0})</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    {a: 1.0, c: 2.0}</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">numba_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">old_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">numba_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="k">return</span> <span class="n">numba_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.un_pad" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">un_pad</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Unpads a 2D NumPy array by removing the first and last row/column.</p>


<details class="extended-description" open>
  <summary>Extended Description</summary>
  <p>Reduces the size of a 2D array by removing the outermost rows and columns.
Useful for trimming boundaries added during padding operations.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arr</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input 2D array to be unpadded. Shape (n,m) is expected.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unpadded 2D array with shape (n-2, m-2).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">un_pad</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">array([[4]])</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/network_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1925" name="__codelineno-0-1925"></a><span class="k">def</span><span class="w"> </span><span class="nf">un_pad</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a><span class="sd">    Unpads a 2D NumPy array by removing the first and last row/column.</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a><span class="sd">    Extended Description</span>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a><span class="sd">    --------------------</span>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a><span class="sd">    Reduces the size of a 2D array by removing the outermost rows and columns.</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a><span class="sd">    Useful for trimming boundaries added during padding operations.</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a><span class="sd">    arr : ndarray</span>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a><span class="sd">        Input 2D array to be unpadded. Shape (n,m) is expected.</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a><span class="sd">    ndarray</span>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a><span class="sd">        Unpadded 2D array with shape (n-2, m-2).</span>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a><span class="sd">    --------</span>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a><span class="sd">    &gt;&gt;&gt; arr = np.array([[0, 0, 0],</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a><span class="sd">    &gt;&gt;&gt;                 [0, 4, 0],</span>
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a><span class="sd">    &gt;&gt;&gt;                 [0, 0, 0]])</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a><span class="sd">    &gt;&gt;&gt; un_pad(arr)</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a><span class="sd">    array([[4]])</span>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>    <span class="k">return</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.video2numpy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">video2numpy</span><span class="p">(</span><span class="n">vid_name</span><span class="p">,</span> <span class="n">conversion_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">true_frame_width</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert a video file to a NumPy array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vid_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the video file. Can be a <code>.mp4</code> or <code>.npy</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conversion_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing color space conversion parameters.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>background</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Background image for processing.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>background2</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second background image for processing.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>true_frame_width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True width of the frame. If specified and the current width is double this value,
adjusts to true_frame_width.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>NDArray or tuple of NDArrays</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If conversion_dict is None, returns the video as a NumPy array.
Otherwise, returns a tuple containing the original video and converted video.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function uses OpenCV to read the contents of a <code>.mp4</code> video file.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="k">def</span><span class="w"> </span><span class="nf">video2numpy</span><span class="p">(</span><span class="n">vid_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversion_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background2</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>                <span class="n">true_frame_width</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">    Convert a video file to a NumPy array.</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">    vid_name : str</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        The path to the video file. Can be a `.mp4` or `.npy`.</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    conversion_dict : dict, optional</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        Dictionary containing color space conversion parameters.</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">    background : NDArray, optional</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        Background image for processing.</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">    background2 : NDArray, optional</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        Second background image for processing.</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">    true_frame_width : int, optional</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        True width of the frame. If specified and the current width is double this value,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">        adjusts to true_frame_width.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    -------</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    NDArray or tuple of NDArrays</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        If conversion_dict is None, returns the video as a NumPy array.</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">        Otherwise, returns a tuple containing the original video and converted video.</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">    -----</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">    This function uses OpenCV to read the contents of a `.mp4` video file.</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="n">np_loading</span> <span class="o">=</span> <span class="n">vid_name</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;.npy&quot;</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="k">if</span> <span class="n">np_loading</span><span class="p">:</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="n">video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">vid_name</span><span class="p">)</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">dims</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">vid_name</span><span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">))]</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="k">if</span> <span class="n">true_frame_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="k">if</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">true_frame_width</span><span class="p">:</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>            <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">true_frame_width</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="k">if</span> <span class="n">conversion_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="n">first_dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="p">,</span> <span class="n">c_spaces</span> <span class="o">=</span> <span class="n">split_dict</span><span class="p">(</span><span class="n">conversion_dict</span><span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="n">converted_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">dims</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="k">if</span> <span class="n">conversion_dict</span><span class="p">[</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="n">converted_video2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">dims</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="k">if</span> <span class="n">np_loading</span><span class="p">:</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="k">for</span> <span class="n">counter</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">video</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">:]</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>                <span class="n">greyscale_image</span><span class="p">,</span> <span class="n">greyscale_image2</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="n">generate_color_space_combination</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">c_spaces</span><span class="p">,</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>                                                                                     <span class="n">first_dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="n">background</span><span class="p">,</span><span class="n">background2</span><span class="o">=</span><span class="n">background2</span><span class="p">,</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>                                                                                     <span class="n">convert_to_uint8</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="n">converted_video</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">greyscale_image</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="k">if</span> <span class="n">conversion_dict</span><span class="p">[</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                    <span class="n">converted_video2</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">greyscale_image2</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>            <span class="n">video</span> <span class="o">=</span> <span class="n">video</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">np_loading</span><span class="p">:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>        <span class="c1"># 2) Create empty arrays to store video analysis data</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="n">video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>        <span class="c1"># 3) Read and convert the video frame by frame</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="k">while</span> <span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>            <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[:,</span> <span class="p">:</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="n">video</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="k">if</span> <span class="n">conversion_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                <span class="n">greyscale_image</span><span class="p">,</span> <span class="n">greyscale_image2</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="n">generate_color_space_combination</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">c_spaces</span><span class="p">,</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                                                                                     <span class="n">first_dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="n">background</span><span class="p">,</span><span class="n">background2</span><span class="o">=</span><span class="n">background2</span><span class="p">,</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>                                                                                     <span class="n">convert_to_uint8</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>                <span class="n">converted_video</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">greyscale_image</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                <span class="k">if</span> <span class="n">conversion_dict</span><span class="p">[</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                    <span class="n">converted_video2</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">greyscale_image2</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="k">if</span> <span class="n">conversion_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="k">return</span> <span class="n">video</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="k">return</span> <span class="n">video</span><span class="p">,</span> <span class="n">converted_video</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.vstack_h5_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vstack_h5_array</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Stack tables vertically in an HDF5 file.</p>
<p>This function either appends the input table to an existing dataset
in the specified HDF5 file or creates a new dataset if the key doesn't exist.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the HDF5 file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The table to be stacked vertically with the existing data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Key under which the dataset will be stored. Defaults to 'data'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;data&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">vstack_h5_array</span><span class="p">(</span><span class="s1">&#39;example.h5&#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="k">def</span><span class="w"> </span><span class="nf">vstack_h5_array</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">    Stack tables vertically in an HDF5 file.</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">    This function either appends the input table to an existing dataset</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">    in the specified HDF5 file or creates a new dataset if the key doesn&#39;t exist.</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">    file_name : str</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">        Path to the HDF5 file.</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">    table : NDArray[np.uint8]</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">        The table to be stacked vertically with the existing data.</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">    key : str, optional</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">        Key under which the dataset will be stored. Defaults to &#39;data&#39;.</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">    --------</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">    &gt;&gt;&gt; table = np.array([[1, 2], [3, 4]], dtype=np.uint8)</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">    &gt;&gt;&gt; vstack_h5_array(&#39;example.h5&#39;, table)</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="c1"># Open the file in append mode</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5f</span><span class="p">:</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">h5f</span><span class="p">:</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>                <span class="c1"># Append to the existing dataset</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>                <span class="n">existing_data</span> <span class="o">=</span> <span class="n">h5f</span><span class="p">[</span><span class="n">key</span><span class="p">][:]</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">existing_data</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>                <span class="k">del</span> <span class="n">h5f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                <span class="n">h5f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">new_data</span><span class="p">)</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                <span class="c1"># Create a new dataset if the key doesn&#39;t exist</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                <span class="n">h5f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">table</span><span class="p">)</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5f</span><span class="p">:</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>            <span class="n">h5f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">table</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.write_video" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_video</span><span class="p">(</span><span class="n">np_array</span><span class="p">,</span> <span class="n">vid_name</span><span class="p">,</span> <span class="n">is_color</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Write video from numpy array.</p>
<p>Save a numpy array as a video file. Supports .npy format for saving raw
numpy arrays and various video formats (mp4, avi, mkv) using OpenCV.
For video formats, automatically selects a suitable codec and handles
file extensions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>np_array</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input array containing video frames.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vid_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename for the output video. Can include extension or not (defaults to .mp4).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_color</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the video should be written in color. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frame rate for the video in frames per second. Defaults to 40.</p>
              </div>
            </td>
            <td>
                  <code>40</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">video_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">write_video</span><span class="p">(</span><span class="n">video_array</span><span class="p">,</span> <span class="s1">&#39;output.mp4&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">Saves `video_array` as a color video &#39;output.mp4&#39; with FPS 30.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">video_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">write_video</span><span class="p">(</span><span class="n">video_array</span><span class="p">,</span> <span class="s1">&#39;raw_data.npy&#39;</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">Saves `video_array` as a raw numpy array file without frame rate.</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="k">def</span><span class="w"> </span><span class="nf">write_video</span><span class="p">(</span><span class="n">np_array</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">vid_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_color</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">40</span><span class="p">):</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">    Write video from numpy array.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    Save a numpy array as a video file. Supports .npy format for saving raw</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    numpy arrays and various video formats (mp4, avi, mkv) using OpenCV.</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">    For video formats, automatically selects a suitable codec and handles</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    file extensions.</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">    np_array : ndarray of uint8</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">        Input array containing video frames.</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">    vid_name : str</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">        Filename for the output video. Can include extension or not (defaults to .mp4).</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    is_color : bool, optional</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">        Whether the video should be written in color. Defaults to True.</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">    fps : int, optional</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        Frame rate for the video in frames per second. Defaults to 40.</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">    --------</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    &gt;&gt;&gt; video_array = np.random.randint(0, 255, size=(10, 100, 100, 3), dtype=np.uint8)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">    &gt;&gt;&gt; write_video(video_array, &#39;output.mp4&#39;, True, 30)</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    Saves `video_array` as a color video &#39;output.mp4&#39; with FPS 30.</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">    &gt;&gt;&gt; video_array = np.random.randint(0, 255, size=(10, 100, 100), dtype=np.uint8)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">    &gt;&gt;&gt; write_video(video_array, &#39;raw_data.npy&#39;)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    Saves `video_array` as a raw numpy array file without frame rate.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="c1">#h265 ou h265 (mp4)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="c1"># linux: fourcc = 0x00000021 -&gt; don&#39;t forget to change it bellow as well</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="k">if</span> <span class="n">vid_name</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.npy&#39;</span><span class="p">:</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">vid_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>             <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">np_array</span><span class="p">)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="n">valid_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;.avi&#39;</span><span class="p">,</span> <span class="s1">&#39;.mkv&#39;</span><span class="p">]</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="n">vid_ext</span> <span class="o">=</span> <span class="n">vid_name</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="k">if</span> <span class="n">vid_ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_extensions</span><span class="p">:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">vid_name</span> <span class="o">=</span> <span class="n">vid_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="n">vid_name</span> <span class="o">+=</span> <span class="s1">&#39;.mp4&#39;</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="n">vid_ext</span> <span class="o">=</span> <span class="s1">&#39;.mp4&#39;</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="k">if</span> <span class="n">vid_ext</span> <span class="o">==</span><span class="s1">&#39;.mp4&#39;</span><span class="p">:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="n">fourcc</span> <span class="o">=</span> <span class="mh">0x7634706d</span><span class="c1"># VideoWriter_fourcc(*&#39;FMP4&#39;) #(*&#39;MP4V&#39;) (*&#39;h265&#39;) (*&#39;x264&#39;) (*&#39;DIVX&#39;)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>  <span class="c1"># lossless</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="n">size</span> <span class="o">=</span> <span class="n">np_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">np_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="n">vid</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="n">vid_name</span><span class="p">,</span> <span class="n">fourcc</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">fps</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="n">is_color</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="k">for</span> <span class="n">image_i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">np_array</span><span class="p">[</span><span class="n">image_i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="n">vid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="n">vid</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.write_video_sets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_video_sets</span><span class="p">(</span><span class="n">img_list</span><span class="p">,</span> <span class="n">sizes</span><span class="p">,</span> <span class="n">vid_names</span><span class="p">,</span> <span class="n">crop_coord</span><span class="p">,</span> <span class="n">bounding_boxes</span><span class="p">,</span> <span class="n">bunch_nb</span><span class="p">,</span> <span class="n">video_nb_per_bunch</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">raw_images</span><span class="p">,</span> <span class="n">is_landscape</span><span class="p">,</span> <span class="n">use_list_of_vid</span><span class="p">,</span> <span class="n">in_colors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reduce_image_dim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pathway</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Write video sets from a list of images, applying cropping and optional rotation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>img_list</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of image file names.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sizes</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array containing the dimensions of each video frame.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vid_names</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of video file names to be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_coord</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> or <span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinates for cropping regions of interest in images/videos.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bounding_boxes</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bounding box coordinates to extract sub-images from the original images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bunch_nb</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bunches to divide the videos into.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>video_nb_per_bunch</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of videos per bunch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>remaining</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of videos remaining after the last full bunch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw_images</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the images are in raw format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_landscape</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If true, rotate the images to landscape orientation before processing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_list_of_vid</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating if the output should be a list of videos.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>in_colors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If true, process images with color information. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reduce_image_dim</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If true, reduce image dimensions. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pathway</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path where the videos should be saved. Default is an empty string.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="k">def</span><span class="w"> </span><span class="nf">write_video_sets</span><span class="p">(</span><span class="n">img_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">sizes</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">vid_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">crop_coord</span><span class="p">,</span> <span class="n">bounding_boxes</span><span class="p">,</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                      <span class="n">bunch_nb</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">video_nb_per_bunch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">remaining</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                      <span class="n">raw_images</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">is_landscape</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">use_list_of_vid</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                      <span class="n">in_colors</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reduce_image_dim</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pathway</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    Write video sets from a list of images, applying cropping and optional rotation.</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    img_list : list</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        List of image file names.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    sizes : NDArray</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        Array containing the dimensions of each video frame.</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    vid_names : list</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        List of video file names to be saved.</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">    crop_coord : dict or tuple</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        Coordinates for cropping regions of interest in images/videos.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">    bounding_boxes : tuple</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">        Bounding box coordinates to extract sub-images from the original images.</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">    bunch_nb : int</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">        Number of bunches to divide the videos into.</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">    video_nb_per_bunch : int</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        Number of videos per bunch.</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">    remaining : int</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">        Number of videos remaining after the last full bunch.</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">    raw_images : bool</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        Whether the images are in raw format.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">    is_landscape : bool</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        If true, rotate the images to landscape orientation before processing.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">    use_list_of_vid : bool</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        Flag indicating if the output should be a list of videos.</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">    in_colors : bool, optional</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        If true, process images with color information. Default is False.</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">    reduce_image_dim : bool, optional</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        If true, reduce image dimensions. Default is False.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">    pathway : str, optional</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        Path where the videos should be saved. Default is an empty string.</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">top</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">bounding_boxes</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="k">for</span> <span class="n">bunch</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">bunch_nb</span><span class="p">):</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Saving the bunch n: </span><span class="si">{</span><span class="n">bunch</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="n">bunch_nb</span><span class="si">}</span><span class="s1"> of videos:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="k">if</span> <span class="n">bunch</span> <span class="o">==</span> <span class="p">(</span><span class="n">bunch_nb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">remaining</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="n">arenas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">bunch</span> <span class="o">*</span> <span class="n">video_nb_per_bunch</span><span class="p">,</span> <span class="n">bunch</span> <span class="o">*</span> <span class="n">video_nb_per_bunch</span> <span class="o">+</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="n">arenas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">bunch</span> <span class="o">*</span> <span class="n">video_nb_per_bunch</span><span class="p">,</span> <span class="p">(</span><span class="n">bunch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">video_nb_per_bunch</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="k">if</span> <span class="n">use_list_of_vid</span><span class="p">:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="n">video_bunch</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sizes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arenas</span><span class="p">]</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="n">video_bunch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="nb">len</span><span class="p">(</span><span class="n">arenas</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">prev_img</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="n">images_done</span> <span class="o">=</span> <span class="n">bunch</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="k">for</span> <span class="n">image_i</span><span class="p">,</span> <span class="n">image_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">img_list</span><span class="p">):</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">read_and_rotate</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span> <span class="n">prev_img</span><span class="p">,</span> <span class="n">raw_images</span><span class="p">,</span> <span class="n">is_landscape</span><span class="p">,</span> <span class="n">crop_coord</span><span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="n">prev_img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_colors</span> <span class="ow">and</span> <span class="n">reduce_image_dim</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="k">for</span> <span class="n">arena_i</span><span class="p">,</span> <span class="n">arena_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arenas</span><span class="p">):</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="c1"># arena_i = 0; arena_name = arena[arena_i]</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="n">sub_img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">top</span><span class="p">[</span><span class="n">arena_name</span><span class="p">]:</span> <span class="p">(</span><span class="n">bot</span><span class="p">[</span><span class="n">arena_name</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">left</span><span class="p">[</span><span class="n">arena_name</span><span class="p">]:</span> <span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="n">arena_name</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="k">if</span> <span class="n">use_list_of_vid</span><span class="p">:</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                    <span class="n">video_bunch</span><span class="p">[</span><span class="n">arena_i</span><span class="p">][</span><span class="n">image_i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_img</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_bunch</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                        <span class="n">video_bunch</span><span class="p">[</span><span class="n">image_i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">arena_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_img</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                        <span class="n">video_bunch</span><span class="p">[</span><span class="n">image_i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">arena_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_img</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="k">for</span> <span class="n">arena_i</span><span class="p">,</span> <span class="n">arena_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arenas</span><span class="p">):</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="k">if</span> <span class="n">use_list_of_vid</span><span class="p">:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                 <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pathway</span> <span class="o">+</span> <span class="n">vid_names</span><span class="p">[</span><span class="n">arena_name</span><span class="p">],</span> <span class="n">video_bunch</span><span class="p">[</span><span class="n">arena_i</span><span class="p">])</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_bunch</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                     <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pathway</span> <span class="o">+</span> <span class="n">vid_names</span><span class="p">[</span><span class="n">arena_name</span><span class="p">],</span> <span class="n">video_bunch</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">arena_i</span><span class="p">])</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                     <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pathway</span> <span class="o">+</span> <span class="n">vid_names</span><span class="p">[</span><span class="n">arena_name</span><span class="p">],</span> <span class="n">video_bunch</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">arena_i</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.core.motion_analysis.zoom_on_nonzero" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">zoom_on_nonzero</span><span class="p">(</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">return_coord</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Crops a binary image around non-zero elements with optional padding and returns either coordinates or cropped region.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>binary_image</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D NumPy array containing binary values (0/1)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amount of zero-padding to add around the minimum bounding box</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_coord</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return slice coordinates instead of cropped image</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    If `return_coord` is True: [y_min, y_max, x_min, x_max] as 4-element Tuple.</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If False: 2D binary array representing the cropped region defined by non-zero elements plus padding.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">zoom_on_nonzero</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">[1 8 2 7]</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cropped</span> <span class="o">=</span> <span class="n">zoom_on_nonzero</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">return_coord</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cropped</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">(6, 5)</span>
</code></pre></div>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>Returns empty slice coordinates if input contains no non-zero elements.</li>
<li>Coordinate indices are 0-based and compatible with NumPy array slicing syntax.</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/utils/load_display_save.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="k">def</span><span class="w"> </span><span class="nf">zoom_on_nonzero</span><span class="p">(</span><span class="n">binary_image</span><span class="p">:</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">padding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">return_coord</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="sd">    Crops a binary image around non-zero elements with optional padding and returns either coordinates or cropped region.</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a><span class="sd">    binary_image : NDArray</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="sd">        2D NumPy array containing binary values (0/1)</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="sd">    padding : int, default=2</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="sd">        Amount of zero-padding to add around the minimum bounding box</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">    return_coord : bool, default=True</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">        If True, return slice coordinates instead of cropped image</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="sd">    -------</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="sd">        If `return_coord` is True: [y_min, y_max, x_min, x_max] as 4-element Tuple.</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="sd">        If False: 2D binary array representing the cropped region defined by non-zero elements plus padding.</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">    --------</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="sd">    &gt;&gt;&gt; img = np.zeros((10,10))</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">    &gt;&gt;&gt; img[3:7,4:6] = 1</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">    &gt;&gt;&gt; result = zoom_on_nonzero(img)</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">    [1 8 2 7]</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">    &gt;&gt;&gt; cropped = zoom_on_nonzero(img, return_coord=False)</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">    &gt;&gt;&gt; print(cropped.shape)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">    (6, 5)</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a><span class="sd">    -----</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a><span class="sd">    - Returns empty slice coordinates if input contains no non-zero elements.</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="sd">    - Coordinate indices are 0-based and compatible with NumPy array slicing syntax.</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>    <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">binary_image</span><span class="p">)</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>    <span class="n">cy_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">padding</span><span class="p">))</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>    <span class="n">cy_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">binary_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">padding</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>    <span class="n">cx_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">padding</span><span class="p">))</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>    <span class="n">cx_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">binary_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">padding</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>    <span class="k">if</span> <span class="n">return_coord</span><span class="p">:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>        <span class="k">return</span> <span class="n">cy_min</span><span class="p">,</span> <span class="n">cy_max</span><span class="p">,</span> <span class="n">cx_min</span><span class="p">,</span> <span class="n">cx_max</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>        <span class="k">return</span> <span class="n">binary_image</span><span class="p">[</span><span class="n">cy_min</span><span class="p">:</span><span class="n">cy_max</span><span class="p">,</span> <span class="n">cx_min</span><span class="p">:</span><span class="n">cx_max</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.instant", "navigation.tabs", "navigation.sections", "navigation.top", "toc.integrate", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>