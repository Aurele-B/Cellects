
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
        
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>cellects.core.program_organizer - Cellects Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../static/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cellectscoreprogram_organizer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Cellects Documentation" class="md-header__button md-logo" aria-label="Cellects Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cellects Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              cellects.core.program_organizer
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Aurele-B/Cellects" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../getting-started/" class="md-tabs__link">
          
  
  
  User guide

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../use-cases/" class="md-tabs__link">
        
  
  
    
  
  Use cases

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../license/" class="md-tabs__link">
        
  
  
    
  
  License & Citation

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Cellects Documentation" class="md-nav__button md-logo" aria-label="Cellects Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Cellects Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Aurele-B/Cellects" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    User guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_1" >
        
          
          <label class="md-nav__link" for="__nav_1_1" id="__nav_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../what-is-cellects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is Cellects?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Setting up a first analysis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Setting up a first analysis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/data-localisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data localisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/image-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/video-tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Video tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Improving the analysis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Improving the analysis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced parameters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/outputs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Required outputs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/multiple-folders/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multiple folders
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../use-cases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use cases
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License & Citation
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="cellectscoreprogram_organizer"><code>cellects.core.program_organizer</code></h1>


<div class="doc doc-object doc-module">



<a id="cellects.core.program_organizer"></a>
    <div class="doc doc-contents first">

        <p>This file contains the class constituting the link between the graphical interface and the computations.
First, Cellects analyze one image in order to get a color space combination maximizing the contrast between the specimens
and the background.
Second, Cellects automatically delineate each arena.
Third, Cellects write one video for each arena.
Fourth, Cellects segments the video and apply post-processing algorithms to improve the segmentation.
Fifth, Cellects extract variables and store them in .csv files.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="cellects.core.program_organizer.ProgramOrganizer" class="doc doc-heading">
            <code>ProgramOrganizer</code>


</h2>


    <div class="doc doc-contents ">



        <p>Organizes and manages variables, configuration settings, and processing workflows for motion analysis in a Cellects project.</p>
<p>This class maintains global state and analysis-specific data structures, handles file operations,
processes image/video inputs, and generates output tables. It provides methods to load/save configurations,
segment images, track objects across frames, and export results with metadata.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.one_arena_done">one_arena_done</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating whether a single arena has been processed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.reduce_image_dim">reduce_image_dim</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether image dimensions should be reduced (e.g., from color to grayscale).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.first_exp_ready_to_run">first_exp_ready_to_run</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicates if the initial experiment setup is complete and ready for execution.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.data_to_save">data_to_save</span></code></td>
            <td>
                  <code>dict of {str: bool}</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies which data types (first image, coordinates, EXIF) require saving.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.videos">videos</span></code></td>
            <td>
                  <code><span title="OneVideoPerBlob">OneVideoPerBlob</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Video processing container instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.motion">motion</span></code></td>
            <td>
                  <code><span title="MotionAnalysis">MotionAnalysis</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Motion tracking and analysis module.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.all">all</span></code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Global configuration parameters for the entire workflow.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.vars">vars</span></code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Analysis-specific variables used by <code>MotionAnalysis</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.first_im, last_im">first_im, last_im</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First and last images of the dataset for preprocessing.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.data_list">data_list</span></code></td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of video/image file paths in the working directory.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.computed_video_options">computed_video_options</span></code></td>
            <td>
                  <code>np.ndarray of bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flags indicating which video processing options have been applied.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.one_row_per_arena, one_row_per_frame">one_row_per_arena, one_row_per_frame</span></code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Result tables for different levels of analysis (per arena, per frame, and oscillating clusters).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="methods:" open>
  <summary>Methods:</summary>
  <p>save_variable_dict() : Save configuration dictionaries to file.
load_variable_dict() : Load saved configuration or initialize defaults.
look_for_data() : Discover video/image files in the working directory.
update_folder_id(...) : Update folder-specific metadata based on file structure.
...</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41">  41</a></span>
<span class="normal"><a href="#__codelineno-0-42">  42</a></span>
<span class="normal"><a href="#__codelineno-0-43">  43</a></span>
<span class="normal"><a href="#__codelineno-0-44">  44</a></span>
<span class="normal"><a href="#__codelineno-0-45">  45</a></span>
<span class="normal"><a href="#__codelineno-0-46">  46</a></span>
<span class="normal"><a href="#__codelineno-0-47">  47</a></span>
<span class="normal"><a href="#__codelineno-0-48">  48</a></span>
<span class="normal"><a href="#__codelineno-0-49">  49</a></span>
<span class="normal"><a href="#__codelineno-0-50">  50</a></span>
<span class="normal"><a href="#__codelineno-0-51">  51</a></span>
<span class="normal"><a href="#__codelineno-0-52">  52</a></span>
<span class="normal"><a href="#__codelineno-0-53">  53</a></span>
<span class="normal"><a href="#__codelineno-0-54">  54</a></span>
<span class="normal"><a href="#__codelineno-0-55">  55</a></span>
<span class="normal"><a href="#__codelineno-0-56">  56</a></span>
<span class="normal"><a href="#__codelineno-0-57">  57</a></span>
<span class="normal"><a href="#__codelineno-0-58">  58</a></span>
<span class="normal"><a href="#__codelineno-0-59">  59</a></span>
<span class="normal"><a href="#__codelineno-0-60">  60</a></span>
<span class="normal"><a href="#__codelineno-0-61">  61</a></span>
<span class="normal"><a href="#__codelineno-0-62">  62</a></span>
<span class="normal"><a href="#__codelineno-0-63">  63</a></span>
<span class="normal"><a href="#__codelineno-0-64">  64</a></span>
<span class="normal"><a href="#__codelineno-0-65">  65</a></span>
<span class="normal"><a href="#__codelineno-0-66">  66</a></span>
<span class="normal"><a href="#__codelineno-0-67">  67</a></span>
<span class="normal"><a href="#__codelineno-0-68">  68</a></span>
<span class="normal"><a href="#__codelineno-0-69">  69</a></span>
<span class="normal"><a href="#__codelineno-0-70">  70</a></span>
<span class="normal"><a href="#__codelineno-0-71">  71</a></span>
<span class="normal"><a href="#__codelineno-0-72">  72</a></span>
<span class="normal"><a href="#__codelineno-0-73">  73</a></span>
<span class="normal"><a href="#__codelineno-0-74">  74</a></span>
<span class="normal"><a href="#__codelineno-0-75">  75</a></span>
<span class="normal"><a href="#__codelineno-0-76">  76</a></span>
<span class="normal"><a href="#__codelineno-0-77">  77</a></span>
<span class="normal"><a href="#__codelineno-0-78">  78</a></span>
<span class="normal"><a href="#__codelineno-0-79">  79</a></span>
<span class="normal"><a href="#__codelineno-0-80">  80</a></span>
<span class="normal"><a href="#__codelineno-0-81">  81</a></span>
<span class="normal"><a href="#__codelineno-0-82">  82</a></span>
<span class="normal"><a href="#__codelineno-0-83">  83</a></span>
<span class="normal"><a href="#__codelineno-0-84">  84</a></span>
<span class="normal"><a href="#__codelineno-0-85">  85</a></span>
<span class="normal"><a href="#__codelineno-0-86">  86</a></span>
<span class="normal"><a href="#__codelineno-0-87">  87</a></span>
<span class="normal"><a href="#__codelineno-0-88">  88</a></span>
<span class="normal"><a href="#__codelineno-0-89">  89</a></span>
<span class="normal"><a href="#__codelineno-0-90">  90</a></span>
<span class="normal"><a href="#__codelineno-0-91">  91</a></span>
<span class="normal"><a href="#__codelineno-0-92">  92</a></span>
<span class="normal"><a href="#__codelineno-0-93">  93</a></span>
<span class="normal"><a href="#__codelineno-0-94">  94</a></span>
<span class="normal"><a href="#__codelineno-0-95">  95</a></span>
<span class="normal"><a href="#__codelineno-0-96">  96</a></span>
<span class="normal"><a href="#__codelineno-0-97">  97</a></span>
<span class="normal"><a href="#__codelineno-0-98">  98</a></span>
<span class="normal"><a href="#__codelineno-0-99">  99</a></span>
<span class="normal"><a href="#__codelineno-0-100"> 100</a></span>
<span class="normal"><a href="#__codelineno-0-101"> 101</a></span>
<span class="normal"><a href="#__codelineno-0-102"> 102</a></span>
<span class="normal"><a href="#__codelineno-0-103"> 103</a></span>
<span class="normal"><a href="#__codelineno-0-104"> 104</a></span>
<span class="normal"><a href="#__codelineno-0-105"> 105</a></span>
<span class="normal"><a href="#__codelineno-0-106"> 106</a></span>
<span class="normal"><a href="#__codelineno-0-107"> 107</a></span>
<span class="normal"><a href="#__codelineno-0-108"> 108</a></span>
<span class="normal"><a href="#__codelineno-0-109"> 109</a></span>
<span class="normal"><a href="#__codelineno-0-110"> 110</a></span>
<span class="normal"><a href="#__codelineno-0-111"> 111</a></span>
<span class="normal"><a href="#__codelineno-0-112"> 112</a></span>
<span class="normal"><a href="#__codelineno-0-113"> 113</a></span>
<span class="normal"><a href="#__codelineno-0-114"> 114</a></span>
<span class="normal"><a href="#__codelineno-0-115"> 115</a></span>
<span class="normal"><a href="#__codelineno-0-116"> 116</a></span>
<span class="normal"><a href="#__codelineno-0-117"> 117</a></span>
<span class="normal"><a href="#__codelineno-0-118"> 118</a></span>
<span class="normal"><a href="#__codelineno-0-119"> 119</a></span>
<span class="normal"><a href="#__codelineno-0-120"> 120</a></span>
<span class="normal"><a href="#__codelineno-0-121"> 121</a></span>
<span class="normal"><a href="#__codelineno-0-122"> 122</a></span>
<span class="normal"><a href="#__codelineno-0-123"> 123</a></span>
<span class="normal"><a href="#__codelineno-0-124"> 124</a></span>
<span class="normal"><a href="#__codelineno-0-125"> 125</a></span>
<span class="normal"><a href="#__codelineno-0-126"> 126</a></span>
<span class="normal"><a href="#__codelineno-0-127"> 127</a></span>
<span class="normal"><a href="#__codelineno-0-128"> 128</a></span>
<span class="normal"><a href="#__codelineno-0-129"> 129</a></span>
<span class="normal"><a href="#__codelineno-0-130"> 130</a></span>
<span class="normal"><a href="#__codelineno-0-131"> 131</a></span>
<span class="normal"><a href="#__codelineno-0-132"> 132</a></span>
<span class="normal"><a href="#__codelineno-0-133"> 133</a></span>
<span class="normal"><a href="#__codelineno-0-134"> 134</a></span>
<span class="normal"><a href="#__codelineno-0-135"> 135</a></span>
<span class="normal"><a href="#__codelineno-0-136"> 136</a></span>
<span class="normal"><a href="#__codelineno-0-137"> 137</a></span>
<span class="normal"><a href="#__codelineno-0-138"> 138</a></span>
<span class="normal"><a href="#__codelineno-0-139"> 139</a></span>
<span class="normal"><a href="#__codelineno-0-140"> 140</a></span>
<span class="normal"><a href="#__codelineno-0-141"> 141</a></span>
<span class="normal"><a href="#__codelineno-0-142"> 142</a></span>
<span class="normal"><a href="#__codelineno-0-143"> 143</a></span>
<span class="normal"><a href="#__codelineno-0-144"> 144</a></span>
<span class="normal"><a href="#__codelineno-0-145"> 145</a></span>
<span class="normal"><a href="#__codelineno-0-146"> 146</a></span>
<span class="normal"><a href="#__codelineno-0-147"> 147</a></span>
<span class="normal"><a href="#__codelineno-0-148"> 148</a></span>
<span class="normal"><a href="#__codelineno-0-149"> 149</a></span>
<span class="normal"><a href="#__codelineno-0-150"> 150</a></span>
<span class="normal"><a href="#__codelineno-0-151"> 151</a></span>
<span class="normal"><a href="#__codelineno-0-152"> 152</a></span>
<span class="normal"><a href="#__codelineno-0-153"> 153</a></span>
<span class="normal"><a href="#__codelineno-0-154"> 154</a></span>
<span class="normal"><a href="#__codelineno-0-155"> 155</a></span>
<span class="normal"><a href="#__codelineno-0-156"> 156</a></span>
<span class="normal"><a href="#__codelineno-0-157"> 157</a></span>
<span class="normal"><a href="#__codelineno-0-158"> 158</a></span>
<span class="normal"><a href="#__codelineno-0-159"> 159</a></span>
<span class="normal"><a href="#__codelineno-0-160"> 160</a></span>
<span class="normal"><a href="#__codelineno-0-161"> 161</a></span>
<span class="normal"><a href="#__codelineno-0-162"> 162</a></span>
<span class="normal"><a href="#__codelineno-0-163"> 163</a></span>
<span class="normal"><a href="#__codelineno-0-164"> 164</a></span>
<span class="normal"><a href="#__codelineno-0-165"> 165</a></span>
<span class="normal"><a href="#__codelineno-0-166"> 166</a></span>
<span class="normal"><a href="#__codelineno-0-167"> 167</a></span>
<span class="normal"><a href="#__codelineno-0-168"> 168</a></span>
<span class="normal"><a href="#__codelineno-0-169"> 169</a></span>
<span class="normal"><a href="#__codelineno-0-170"> 170</a></span>
<span class="normal"><a href="#__codelineno-0-171"> 171</a></span>
<span class="normal"><a href="#__codelineno-0-172"> 172</a></span>
<span class="normal"><a href="#__codelineno-0-173"> 173</a></span>
<span class="normal"><a href="#__codelineno-0-174"> 174</a></span>
<span class="normal"><a href="#__codelineno-0-175"> 175</a></span>
<span class="normal"><a href="#__codelineno-0-176"> 176</a></span>
<span class="normal"><a href="#__codelineno-0-177"> 177</a></span>
<span class="normal"><a href="#__codelineno-0-178"> 178</a></span>
<span class="normal"><a href="#__codelineno-0-179"> 179</a></span>
<span class="normal"><a href="#__codelineno-0-180"> 180</a></span>
<span class="normal"><a href="#__codelineno-0-181"> 181</a></span>
<span class="normal"><a href="#__codelineno-0-182"> 182</a></span>
<span class="normal"><a href="#__codelineno-0-183"> 183</a></span>
<span class="normal"><a href="#__codelineno-0-184"> 184</a></span>
<span class="normal"><a href="#__codelineno-0-185"> 185</a></span>
<span class="normal"><a href="#__codelineno-0-186"> 186</a></span>
<span class="normal"><a href="#__codelineno-0-187"> 187</a></span>
<span class="normal"><a href="#__codelineno-0-188"> 188</a></span>
<span class="normal"><a href="#__codelineno-0-189"> 189</a></span>
<span class="normal"><a href="#__codelineno-0-190"> 190</a></span>
<span class="normal"><a href="#__codelineno-0-191"> 191</a></span>
<span class="normal"><a href="#__codelineno-0-192"> 192</a></span>
<span class="normal"><a href="#__codelineno-0-193"> 193</a></span>
<span class="normal"><a href="#__codelineno-0-194"> 194</a></span>
<span class="normal"><a href="#__codelineno-0-195"> 195</a></span>
<span class="normal"><a href="#__codelineno-0-196"> 196</a></span>
<span class="normal"><a href="#__codelineno-0-197"> 197</a></span>
<span class="normal"><a href="#__codelineno-0-198"> 198</a></span>
<span class="normal"><a href="#__codelineno-0-199"> 199</a></span>
<span class="normal"><a href="#__codelineno-0-200"> 200</a></span>
<span class="normal"><a href="#__codelineno-0-201"> 201</a></span>
<span class="normal"><a href="#__codelineno-0-202"> 202</a></span>
<span class="normal"><a href="#__codelineno-0-203"> 203</a></span>
<span class="normal"><a href="#__codelineno-0-204"> 204</a></span>
<span class="normal"><a href="#__codelineno-0-205"> 205</a></span>
<span class="normal"><a href="#__codelineno-0-206"> 206</a></span>
<span class="normal"><a href="#__codelineno-0-207"> 207</a></span>
<span class="normal"><a href="#__codelineno-0-208"> 208</a></span>
<span class="normal"><a href="#__codelineno-0-209"> 209</a></span>
<span class="normal"><a href="#__codelineno-0-210"> 210</a></span>
<span class="normal"><a href="#__codelineno-0-211"> 211</a></span>
<span class="normal"><a href="#__codelineno-0-212"> 212</a></span>
<span class="normal"><a href="#__codelineno-0-213"> 213</a></span>
<span class="normal"><a href="#__codelineno-0-214"> 214</a></span>
<span class="normal"><a href="#__codelineno-0-215"> 215</a></span>
<span class="normal"><a href="#__codelineno-0-216"> 216</a></span>
<span class="normal"><a href="#__codelineno-0-217"> 217</a></span>
<span class="normal"><a href="#__codelineno-0-218"> 218</a></span>
<span class="normal"><a href="#__codelineno-0-219"> 219</a></span>
<span class="normal"><a href="#__codelineno-0-220"> 220</a></span>
<span class="normal"><a href="#__codelineno-0-221"> 221</a></span>
<span class="normal"><a href="#__codelineno-0-222"> 222</a></span>
<span class="normal"><a href="#__codelineno-0-223"> 223</a></span>
<span class="normal"><a href="#__codelineno-0-224"> 224</a></span>
<span class="normal"><a href="#__codelineno-0-225"> 225</a></span>
<span class="normal"><a href="#__codelineno-0-226"> 226</a></span>
<span class="normal"><a href="#__codelineno-0-227"> 227</a></span>
<span class="normal"><a href="#__codelineno-0-228"> 228</a></span>
<span class="normal"><a href="#__codelineno-0-229"> 229</a></span>
<span class="normal"><a href="#__codelineno-0-230"> 230</a></span>
<span class="normal"><a href="#__codelineno-0-231"> 231</a></span>
<span class="normal"><a href="#__codelineno-0-232"> 232</a></span>
<span class="normal"><a href="#__codelineno-0-233"> 233</a></span>
<span class="normal"><a href="#__codelineno-0-234"> 234</a></span>
<span class="normal"><a href="#__codelineno-0-235"> 235</a></span>
<span class="normal"><a href="#__codelineno-0-236"> 236</a></span>
<span class="normal"><a href="#__codelineno-0-237"> 237</a></span>
<span class="normal"><a href="#__codelineno-0-238"> 238</a></span>
<span class="normal"><a href="#__codelineno-0-239"> 239</a></span>
<span class="normal"><a href="#__codelineno-0-240"> 240</a></span>
<span class="normal"><a href="#__codelineno-0-241"> 241</a></span>
<span class="normal"><a href="#__codelineno-0-242"> 242</a></span>
<span class="normal"><a href="#__codelineno-0-243"> 243</a></span>
<span class="normal"><a href="#__codelineno-0-244"> 244</a></span>
<span class="normal"><a href="#__codelineno-0-245"> 245</a></span>
<span class="normal"><a href="#__codelineno-0-246"> 246</a></span>
<span class="normal"><a href="#__codelineno-0-247"> 247</a></span>
<span class="normal"><a href="#__codelineno-0-248"> 248</a></span>
<span class="normal"><a href="#__codelineno-0-249"> 249</a></span>
<span class="normal"><a href="#__codelineno-0-250"> 250</a></span>
<span class="normal"><a href="#__codelineno-0-251"> 251</a></span>
<span class="normal"><a href="#__codelineno-0-252"> 252</a></span>
<span class="normal"><a href="#__codelineno-0-253"> 253</a></span>
<span class="normal"><a href="#__codelineno-0-254"> 254</a></span>
<span class="normal"><a href="#__codelineno-0-255"> 255</a></span>
<span class="normal"><a href="#__codelineno-0-256"> 256</a></span>
<span class="normal"><a href="#__codelineno-0-257"> 257</a></span>
<span class="normal"><a href="#__codelineno-0-258"> 258</a></span>
<span class="normal"><a href="#__codelineno-0-259"> 259</a></span>
<span class="normal"><a href="#__codelineno-0-260"> 260</a></span>
<span class="normal"><a href="#__codelineno-0-261"> 261</a></span>
<span class="normal"><a href="#__codelineno-0-262"> 262</a></span>
<span class="normal"><a href="#__codelineno-0-263"> 263</a></span>
<span class="normal"><a href="#__codelineno-0-264"> 264</a></span>
<span class="normal"><a href="#__codelineno-0-265"> 265</a></span>
<span class="normal"><a href="#__codelineno-0-266"> 266</a></span>
<span class="normal"><a href="#__codelineno-0-267"> 267</a></span>
<span class="normal"><a href="#__codelineno-0-268"> 268</a></span>
<span class="normal"><a href="#__codelineno-0-269"> 269</a></span>
<span class="normal"><a href="#__codelineno-0-270"> 270</a></span>
<span class="normal"><a href="#__codelineno-0-271"> 271</a></span>
<span class="normal"><a href="#__codelineno-0-272"> 272</a></span>
<span class="normal"><a href="#__codelineno-0-273"> 273</a></span>
<span class="normal"><a href="#__codelineno-0-274"> 274</a></span>
<span class="normal"><a href="#__codelineno-0-275"> 275</a></span>
<span class="normal"><a href="#__codelineno-0-276"> 276</a></span>
<span class="normal"><a href="#__codelineno-0-277"> 277</a></span>
<span class="normal"><a href="#__codelineno-0-278"> 278</a></span>
<span class="normal"><a href="#__codelineno-0-279"> 279</a></span>
<span class="normal"><a href="#__codelineno-0-280"> 280</a></span>
<span class="normal"><a href="#__codelineno-0-281"> 281</a></span>
<span class="normal"><a href="#__codelineno-0-282"> 282</a></span>
<span class="normal"><a href="#__codelineno-0-283"> 283</a></span>
<span class="normal"><a href="#__codelineno-0-284"> 284</a></span>
<span class="normal"><a href="#__codelineno-0-285"> 285</a></span>
<span class="normal"><a href="#__codelineno-0-286"> 286</a></span>
<span class="normal"><a href="#__codelineno-0-287"> 287</a></span>
<span class="normal"><a href="#__codelineno-0-288"> 288</a></span>
<span class="normal"><a href="#__codelineno-0-289"> 289</a></span>
<span class="normal"><a href="#__codelineno-0-290"> 290</a></span>
<span class="normal"><a href="#__codelineno-0-291"> 291</a></span>
<span class="normal"><a href="#__codelineno-0-292"> 292</a></span>
<span class="normal"><a href="#__codelineno-0-293"> 293</a></span>
<span class="normal"><a href="#__codelineno-0-294"> 294</a></span>
<span class="normal"><a href="#__codelineno-0-295"> 295</a></span>
<span class="normal"><a href="#__codelineno-0-296"> 296</a></span>
<span class="normal"><a href="#__codelineno-0-297"> 297</a></span>
<span class="normal"><a href="#__codelineno-0-298"> 298</a></span>
<span class="normal"><a href="#__codelineno-0-299"> 299</a></span>
<span class="normal"><a href="#__codelineno-0-300"> 300</a></span>
<span class="normal"><a href="#__codelineno-0-301"> 301</a></span>
<span class="normal"><a href="#__codelineno-0-302"> 302</a></span>
<span class="normal"><a href="#__codelineno-0-303"> 303</a></span>
<span class="normal"><a href="#__codelineno-0-304"> 304</a></span>
<span class="normal"><a href="#__codelineno-0-305"> 305</a></span>
<span class="normal"><a href="#__codelineno-0-306"> 306</a></span>
<span class="normal"><a href="#__codelineno-0-307"> 307</a></span>
<span class="normal"><a href="#__codelineno-0-308"> 308</a></span>
<span class="normal"><a href="#__codelineno-0-309"> 309</a></span>
<span class="normal"><a href="#__codelineno-0-310"> 310</a></span>
<span class="normal"><a href="#__codelineno-0-311"> 311</a></span>
<span class="normal"><a href="#__codelineno-0-312"> 312</a></span>
<span class="normal"><a href="#__codelineno-0-313"> 313</a></span>
<span class="normal"><a href="#__codelineno-0-314"> 314</a></span>
<span class="normal"><a href="#__codelineno-0-315"> 315</a></span>
<span class="normal"><a href="#__codelineno-0-316"> 316</a></span>
<span class="normal"><a href="#__codelineno-0-317"> 317</a></span>
<span class="normal"><a href="#__codelineno-0-318"> 318</a></span>
<span class="normal"><a href="#__codelineno-0-319"> 319</a></span>
<span class="normal"><a href="#__codelineno-0-320"> 320</a></span>
<span class="normal"><a href="#__codelineno-0-321"> 321</a></span>
<span class="normal"><a href="#__codelineno-0-322"> 322</a></span>
<span class="normal"><a href="#__codelineno-0-323"> 323</a></span>
<span class="normal"><a href="#__codelineno-0-324"> 324</a></span>
<span class="normal"><a href="#__codelineno-0-325"> 325</a></span>
<span class="normal"><a href="#__codelineno-0-326"> 326</a></span>
<span class="normal"><a href="#__codelineno-0-327"> 327</a></span>
<span class="normal"><a href="#__codelineno-0-328"> 328</a></span>
<span class="normal"><a href="#__codelineno-0-329"> 329</a></span>
<span class="normal"><a href="#__codelineno-0-330"> 330</a></span>
<span class="normal"><a href="#__codelineno-0-331"> 331</a></span>
<span class="normal"><a href="#__codelineno-0-332"> 332</a></span>
<span class="normal"><a href="#__codelineno-0-333"> 333</a></span>
<span class="normal"><a href="#__codelineno-0-334"> 334</a></span>
<span class="normal"><a href="#__codelineno-0-335"> 335</a></span>
<span class="normal"><a href="#__codelineno-0-336"> 336</a></span>
<span class="normal"><a href="#__codelineno-0-337"> 337</a></span>
<span class="normal"><a href="#__codelineno-0-338"> 338</a></span>
<span class="normal"><a href="#__codelineno-0-339"> 339</a></span>
<span class="normal"><a href="#__codelineno-0-340"> 340</a></span>
<span class="normal"><a href="#__codelineno-0-341"> 341</a></span>
<span class="normal"><a href="#__codelineno-0-342"> 342</a></span>
<span class="normal"><a href="#__codelineno-0-343"> 343</a></span>
<span class="normal"><a href="#__codelineno-0-344"> 344</a></span>
<span class="normal"><a href="#__codelineno-0-345"> 345</a></span>
<span class="normal"><a href="#__codelineno-0-346"> 346</a></span>
<span class="normal"><a href="#__codelineno-0-347"> 347</a></span>
<span class="normal"><a href="#__codelineno-0-348"> 348</a></span>
<span class="normal"><a href="#__codelineno-0-349"> 349</a></span>
<span class="normal"><a href="#__codelineno-0-350"> 350</a></span>
<span class="normal"><a href="#__codelineno-0-351"> 351</a></span>
<span class="normal"><a href="#__codelineno-0-352"> 352</a></span>
<span class="normal"><a href="#__codelineno-0-353"> 353</a></span>
<span class="normal"><a href="#__codelineno-0-354"> 354</a></span>
<span class="normal"><a href="#__codelineno-0-355"> 355</a></span>
<span class="normal"><a href="#__codelineno-0-356"> 356</a></span>
<span class="normal"><a href="#__codelineno-0-357"> 357</a></span>
<span class="normal"><a href="#__codelineno-0-358"> 358</a></span>
<span class="normal"><a href="#__codelineno-0-359"> 359</a></span>
<span class="normal"><a href="#__codelineno-0-360"> 360</a></span>
<span class="normal"><a href="#__codelineno-0-361"> 361</a></span>
<span class="normal"><a href="#__codelineno-0-362"> 362</a></span>
<span class="normal"><a href="#__codelineno-0-363"> 363</a></span>
<span class="normal"><a href="#__codelineno-0-364"> 364</a></span>
<span class="normal"><a href="#__codelineno-0-365"> 365</a></span>
<span class="normal"><a href="#__codelineno-0-366"> 366</a></span>
<span class="normal"><a href="#__codelineno-0-367"> 367</a></span>
<span class="normal"><a href="#__codelineno-0-368"> 368</a></span>
<span class="normal"><a href="#__codelineno-0-369"> 369</a></span>
<span class="normal"><a href="#__codelineno-0-370"> 370</a></span>
<span class="normal"><a href="#__codelineno-0-371"> 371</a></span>
<span class="normal"><a href="#__codelineno-0-372"> 372</a></span>
<span class="normal"><a href="#__codelineno-0-373"> 373</a></span>
<span class="normal"><a href="#__codelineno-0-374"> 374</a></span>
<span class="normal"><a href="#__codelineno-0-375"> 375</a></span>
<span class="normal"><a href="#__codelineno-0-376"> 376</a></span>
<span class="normal"><a href="#__codelineno-0-377"> 377</a></span>
<span class="normal"><a href="#__codelineno-0-378"> 378</a></span>
<span class="normal"><a href="#__codelineno-0-379"> 379</a></span>
<span class="normal"><a href="#__codelineno-0-380"> 380</a></span>
<span class="normal"><a href="#__codelineno-0-381"> 381</a></span>
<span class="normal"><a href="#__codelineno-0-382"> 382</a></span>
<span class="normal"><a href="#__codelineno-0-383"> 383</a></span>
<span class="normal"><a href="#__codelineno-0-384"> 384</a></span>
<span class="normal"><a href="#__codelineno-0-385"> 385</a></span>
<span class="normal"><a href="#__codelineno-0-386"> 386</a></span>
<span class="normal"><a href="#__codelineno-0-387"> 387</a></span>
<span class="normal"><a href="#__codelineno-0-388"> 388</a></span>
<span class="normal"><a href="#__codelineno-0-389"> 389</a></span>
<span class="normal"><a href="#__codelineno-0-390"> 390</a></span>
<span class="normal"><a href="#__codelineno-0-391"> 391</a></span>
<span class="normal"><a href="#__codelineno-0-392"> 392</a></span>
<span class="normal"><a href="#__codelineno-0-393"> 393</a></span>
<span class="normal"><a href="#__codelineno-0-394"> 394</a></span>
<span class="normal"><a href="#__codelineno-0-395"> 395</a></span>
<span class="normal"><a href="#__codelineno-0-396"> 396</a></span>
<span class="normal"><a href="#__codelineno-0-397"> 397</a></span>
<span class="normal"><a href="#__codelineno-0-398"> 398</a></span>
<span class="normal"><a href="#__codelineno-0-399"> 399</a></span>
<span class="normal"><a href="#__codelineno-0-400"> 400</a></span>
<span class="normal"><a href="#__codelineno-0-401"> 401</a></span>
<span class="normal"><a href="#__codelineno-0-402"> 402</a></span>
<span class="normal"><a href="#__codelineno-0-403"> 403</a></span>
<span class="normal"><a href="#__codelineno-0-404"> 404</a></span>
<span class="normal"><a href="#__codelineno-0-405"> 405</a></span>
<span class="normal"><a href="#__codelineno-0-406"> 406</a></span>
<span class="normal"><a href="#__codelineno-0-407"> 407</a></span>
<span class="normal"><a href="#__codelineno-0-408"> 408</a></span>
<span class="normal"><a href="#__codelineno-0-409"> 409</a></span>
<span class="normal"><a href="#__codelineno-0-410"> 410</a></span>
<span class="normal"><a href="#__codelineno-0-411"> 411</a></span>
<span class="normal"><a href="#__codelineno-0-412"> 412</a></span>
<span class="normal"><a href="#__codelineno-0-413"> 413</a></span>
<span class="normal"><a href="#__codelineno-0-414"> 414</a></span>
<span class="normal"><a href="#__codelineno-0-415"> 415</a></span>
<span class="normal"><a href="#__codelineno-0-416"> 416</a></span>
<span class="normal"><a href="#__codelineno-0-417"> 417</a></span>
<span class="normal"><a href="#__codelineno-0-418"> 418</a></span>
<span class="normal"><a href="#__codelineno-0-419"> 419</a></span>
<span class="normal"><a href="#__codelineno-0-420"> 420</a></span>
<span class="normal"><a href="#__codelineno-0-421"> 421</a></span>
<span class="normal"><a href="#__codelineno-0-422"> 422</a></span>
<span class="normal"><a href="#__codelineno-0-423"> 423</a></span>
<span class="normal"><a href="#__codelineno-0-424"> 424</a></span>
<span class="normal"><a href="#__codelineno-0-425"> 425</a></span>
<span class="normal"><a href="#__codelineno-0-426"> 426</a></span>
<span class="normal"><a href="#__codelineno-0-427"> 427</a></span>
<span class="normal"><a href="#__codelineno-0-428"> 428</a></span>
<span class="normal"><a href="#__codelineno-0-429"> 429</a></span>
<span class="normal"><a href="#__codelineno-0-430"> 430</a></span>
<span class="normal"><a href="#__codelineno-0-431"> 431</a></span>
<span class="normal"><a href="#__codelineno-0-432"> 432</a></span>
<span class="normal"><a href="#__codelineno-0-433"> 433</a></span>
<span class="normal"><a href="#__codelineno-0-434"> 434</a></span>
<span class="normal"><a href="#__codelineno-0-435"> 435</a></span>
<span class="normal"><a href="#__codelineno-0-436"> 436</a></span>
<span class="normal"><a href="#__codelineno-0-437"> 437</a></span>
<span class="normal"><a href="#__codelineno-0-438"> 438</a></span>
<span class="normal"><a href="#__codelineno-0-439"> 439</a></span>
<span class="normal"><a href="#__codelineno-0-440"> 440</a></span>
<span class="normal"><a href="#__codelineno-0-441"> 441</a></span>
<span class="normal"><a href="#__codelineno-0-442"> 442</a></span>
<span class="normal"><a href="#__codelineno-0-443"> 443</a></span>
<span class="normal"><a href="#__codelineno-0-444"> 444</a></span>
<span class="normal"><a href="#__codelineno-0-445"> 445</a></span>
<span class="normal"><a href="#__codelineno-0-446"> 446</a></span>
<span class="normal"><a href="#__codelineno-0-447"> 447</a></span>
<span class="normal"><a href="#__codelineno-0-448"> 448</a></span>
<span class="normal"><a href="#__codelineno-0-449"> 449</a></span>
<span class="normal"><a href="#__codelineno-0-450"> 450</a></span>
<span class="normal"><a href="#__codelineno-0-451"> 451</a></span>
<span class="normal"><a href="#__codelineno-0-452"> 452</a></span>
<span class="normal"><a href="#__codelineno-0-453"> 453</a></span>
<span class="normal"><a href="#__codelineno-0-454"> 454</a></span>
<span class="normal"><a href="#__codelineno-0-455"> 455</a></span>
<span class="normal"><a href="#__codelineno-0-456"> 456</a></span>
<span class="normal"><a href="#__codelineno-0-457"> 457</a></span>
<span class="normal"><a href="#__codelineno-0-458"> 458</a></span>
<span class="normal"><a href="#__codelineno-0-459"> 459</a></span>
<span class="normal"><a href="#__codelineno-0-460"> 460</a></span>
<span class="normal"><a href="#__codelineno-0-461"> 461</a></span>
<span class="normal"><a href="#__codelineno-0-462"> 462</a></span>
<span class="normal"><a href="#__codelineno-0-463"> 463</a></span>
<span class="normal"><a href="#__codelineno-0-464"> 464</a></span>
<span class="normal"><a href="#__codelineno-0-465"> 465</a></span>
<span class="normal"><a href="#__codelineno-0-466"> 466</a></span>
<span class="normal"><a href="#__codelineno-0-467"> 467</a></span>
<span class="normal"><a href="#__codelineno-0-468"> 468</a></span>
<span class="normal"><a href="#__codelineno-0-469"> 469</a></span>
<span class="normal"><a href="#__codelineno-0-470"> 470</a></span>
<span class="normal"><a href="#__codelineno-0-471"> 471</a></span>
<span class="normal"><a href="#__codelineno-0-472"> 472</a></span>
<span class="normal"><a href="#__codelineno-0-473"> 473</a></span>
<span class="normal"><a href="#__codelineno-0-474"> 474</a></span>
<span class="normal"><a href="#__codelineno-0-475"> 475</a></span>
<span class="normal"><a href="#__codelineno-0-476"> 476</a></span>
<span class="normal"><a href="#__codelineno-0-477"> 477</a></span>
<span class="normal"><a href="#__codelineno-0-478"> 478</a></span>
<span class="normal"><a href="#__codelineno-0-479"> 479</a></span>
<span class="normal"><a href="#__codelineno-0-480"> 480</a></span>
<span class="normal"><a href="#__codelineno-0-481"> 481</a></span>
<span class="normal"><a href="#__codelineno-0-482"> 482</a></span>
<span class="normal"><a href="#__codelineno-0-483"> 483</a></span>
<span class="normal"><a href="#__codelineno-0-484"> 484</a></span>
<span class="normal"><a href="#__codelineno-0-485"> 485</a></span>
<span class="normal"><a href="#__codelineno-0-486"> 486</a></span>
<span class="normal"><a href="#__codelineno-0-487"> 487</a></span>
<span class="normal"><a href="#__codelineno-0-488"> 488</a></span>
<span class="normal"><a href="#__codelineno-0-489"> 489</a></span>
<span class="normal"><a href="#__codelineno-0-490"> 490</a></span>
<span class="normal"><a href="#__codelineno-0-491"> 491</a></span>
<span class="normal"><a href="#__codelineno-0-492"> 492</a></span>
<span class="normal"><a href="#__codelineno-0-493"> 493</a></span>
<span class="normal"><a href="#__codelineno-0-494"> 494</a></span>
<span class="normal"><a href="#__codelineno-0-495"> 495</a></span>
<span class="normal"><a href="#__codelineno-0-496"> 496</a></span>
<span class="normal"><a href="#__codelineno-0-497"> 497</a></span>
<span class="normal"><a href="#__codelineno-0-498"> 498</a></span>
<span class="normal"><a href="#__codelineno-0-499"> 499</a></span>
<span class="normal"><a href="#__codelineno-0-500"> 500</a></span>
<span class="normal"><a href="#__codelineno-0-501"> 501</a></span>
<span class="normal"><a href="#__codelineno-0-502"> 502</a></span>
<span class="normal"><a href="#__codelineno-0-503"> 503</a></span>
<span class="normal"><a href="#__codelineno-0-504"> 504</a></span>
<span class="normal"><a href="#__codelineno-0-505"> 505</a></span>
<span class="normal"><a href="#__codelineno-0-506"> 506</a></span>
<span class="normal"><a href="#__codelineno-0-507"> 507</a></span>
<span class="normal"><a href="#__codelineno-0-508"> 508</a></span>
<span class="normal"><a href="#__codelineno-0-509"> 509</a></span>
<span class="normal"><a href="#__codelineno-0-510"> 510</a></span>
<span class="normal"><a href="#__codelineno-0-511"> 511</a></span>
<span class="normal"><a href="#__codelineno-0-512"> 512</a></span>
<span class="normal"><a href="#__codelineno-0-513"> 513</a></span>
<span class="normal"><a href="#__codelineno-0-514"> 514</a></span>
<span class="normal"><a href="#__codelineno-0-515"> 515</a></span>
<span class="normal"><a href="#__codelineno-0-516"> 516</a></span>
<span class="normal"><a href="#__codelineno-0-517"> 517</a></span>
<span class="normal"><a href="#__codelineno-0-518"> 518</a></span>
<span class="normal"><a href="#__codelineno-0-519"> 519</a></span>
<span class="normal"><a href="#__codelineno-0-520"> 520</a></span>
<span class="normal"><a href="#__codelineno-0-521"> 521</a></span>
<span class="normal"><a href="#__codelineno-0-522"> 522</a></span>
<span class="normal"><a href="#__codelineno-0-523"> 523</a></span>
<span class="normal"><a href="#__codelineno-0-524"> 524</a></span>
<span class="normal"><a href="#__codelineno-0-525"> 525</a></span>
<span class="normal"><a href="#__codelineno-0-526"> 526</a></span>
<span class="normal"><a href="#__codelineno-0-527"> 527</a></span>
<span class="normal"><a href="#__codelineno-0-528"> 528</a></span>
<span class="normal"><a href="#__codelineno-0-529"> 529</a></span>
<span class="normal"><a href="#__codelineno-0-530"> 530</a></span>
<span class="normal"><a href="#__codelineno-0-531"> 531</a></span>
<span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">class</span><span class="w"> </span><span class="nc">ProgramOrganizer</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Organizes and manages variables, configuration settings, and processing workflows for motion analysis in a Cellects project.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    This class maintains global state and analysis-specific data structures, handles file operations,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    processes image/video inputs, and generates output tables. It provides methods to load/save configurations,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    segment images, track objects across frames, and export results with metadata.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    one_arena_done : bool</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        Flag indicating whether a single arena has been processed.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    reduce_image_dim : bool</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        Whether image dimensions should be reduced (e.g., from color to grayscale).</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    first_exp_ready_to_run : bool</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        Indicates if the initial experiment setup is complete and ready for execution.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    data_to_save : dict of {str: bool}</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        Specifies which data types (first image, coordinates, EXIF) require saving.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    videos : OneVideoPerBlob or None</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        Video processing container instance.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    motion : MotionAnalysis or None</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        Motion tracking and analysis module.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    all : dict</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        Global configuration parameters for the entire workflow.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    vars : dict</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        Analysis-specific variables used by `MotionAnalysis`.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    first_im, last_im : np.ndarray or None</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        First and last images of the dataset for preprocessing.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    data_list : list of str</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        List of video/image file paths in the working directory.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    computed_video_options : np.ndarray of bool</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        Flags indicating which video processing options have been applied.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    one_row_per_arena, one_row_per_frame : pd.DataFrame or None</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Result tables for different levels of analysis (per arena, per frame, and oscillating clusters).</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    Methods:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    --------</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    save_variable_dict() : Save configuration dictionaries to file.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    load_variable_dict() : Load saved configuration or initialize defaults.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    look_for_data() : Discover video/image files in the working directory.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    update_folder_id(...) : Update folder-specific metadata based on file structure.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    ...</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            This class stores all variables required for analysis as well as</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            methods to process it.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            Global variables (i.e. that does not concern the MotionAnalysis)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            are directly stored in self.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            Variables used in the MotionAnalysis class are stored in a dict</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            called self.vars</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;PickleRick.pkl&#39;</span><span class="p">):</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;PickleRick.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;PickleRick0.pkl&#39;</span><span class="p">):</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;PickleRick0.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_arena_done</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_to_save</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;first_image&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;exif&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;vars&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">computed_video_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starting_blob_hsize_in_pixels</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">visualize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_variable_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        Update the `all` and `vars` dictionaries with new data from `DefaultDicts`.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        This method updates the `all` and `vars` dictionaries of the current object with</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        data from a new instance of `DefaultDicts`. It checks if any keys or descriptors</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        are missing and adds them accordingly.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        --------</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        &gt;&gt;&gt; organizer = ProgramOrganizer()</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        &gt;&gt;&gt; organizer.update_variable_dict()</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">dd</span> <span class="o">=</span> <span class="n">DefaultDicts</span><span class="p">()</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="nb">all</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">all</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="nb">vars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">vars</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">all_desc</span> <span class="o">=</span> <span class="ow">not</span> <span class="s1">&#39;descriptors&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">])</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">vars_desc</span> <span class="o">=</span> <span class="ow">not</span> <span class="s1">&#39;descriptors&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">])</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">if</span> <span class="nb">vars</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">if</span> <span class="n">all_desc</span><span class="p">:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="k">if</span> <span class="n">vars_desc</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_analyzed_individuals</span><span class="p">()</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_variable_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        Saves the configuration dictionaries (`self.all` and `self.vars`) to a pickle file.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        If bio_mask or back_mask are not required for all folders, they are excluded from the saved data.</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        -----</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        This method is used to preserve state between Cellects sessions or restart scenarios.</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Save the parameters dictionaries in the Cellects folder&quot;</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">all_vars</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;keep_cell_and_back_for_all_folders&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="n">all_vars</span><span class="p">[</span><span class="s1">&#39;bio_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="n">all_vars</span><span class="p">[</span><span class="s1">&#39;back_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">pickle_rick</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">all_vars</span><span class="p">,</span> <span class="n">ALL_VARS_PKL_FILE</span><span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_variable_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        Loads configuration dictionaries from a pickle file if available, otherwise initializes defaults.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Tries to load saved parameters. If the file doesn&#39;t exist or loading fails due to corruption,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        default values are used instead (logging relevant warnings).</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        ------</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        FileNotFoundError</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">            If no valid configuration file is found and default initialization fails.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        -----</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        This method ensures robust operation by handling missing or corrupted configuration files gracefully.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ALL_VARS_PKL_FILE</span><span class="p">):</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Load the parameters from all_vars.pkl in the config of the Cellects folder&quot;</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ALL_VARS_PKL_FILE</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileopen</span><span class="p">:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fileopen</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_variable_dict</span><span class="p">()</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Success to load the parameters dictionaries from the Cellects folder&quot;</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initialize default parameters because error: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="n">default_dicts</span> <span class="o">=</span> <span class="n">DefaultDicts</span><span class="p">()</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="n">default_dicts</span><span class="o">.</span><span class="n">all</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="n">default_dicts</span><span class="o">.</span><span class="n">vars</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialize default parameters&quot;</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">default_dicts</span> <span class="o">=</span> <span class="n">DefaultDicts</span><span class="p">()</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="n">default_dicts</span><span class="o">.</span><span class="n">all</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="n">default_dicts</span><span class="o">.</span><span class="n">vars</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;cores&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">look_for_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        Discovers all relevant video/image data in the working directory.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        Uses natural sorting to handle filenames with numeric suffixes. Validates file consistency and logs warnings</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        if filename patterns are inconsistent across folders.</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        ------</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        ValueError</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">            If no files match the specified naming convention.</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        -----</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        This method assumes all data files follow a predictable pattern with numeric extensions. Use caution in</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        unpredictable directory structures where this may fail silently or produce incorrect results.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        --------</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        &gt;&gt;&gt; organizer.look_for_data()</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        &gt;&gt;&gt; print(organizer.data_list)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        [&#39;/path/to/video1.avi&#39;, &#39;/path/to/video2.avi&#39;]</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dir: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="n">insensitive_glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;radical&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">])</span>  <span class="c1"># Provides a list ordered by last modification date</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_sort_data_list</span><span class="p">()</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;first_folder_sample_number&#39;</span><span class="p">]</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                    <span class="n">data_list</span> <span class="o">=</span> <span class="n">insensitive_glob</span><span class="p">(</span><span class="n">obj</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;radical&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">])</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_number&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">])</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">],</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                                                              <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_number&#39;</span><span class="p">])</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_sort_data_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">        Sorts the data list using natural sorting.</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">        Extended Description</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        --------------------</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        This function sorts the `data_list` attribute of an instance using the natsort library,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">        which is useful when filenames have a mixture of numbers and letters.</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="n">lengths</span> <span class="o">=</span> <span class="n">vectorized_len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lengths</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)):</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File names present strong variations and cannot be correctly sorted.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="n">wrong_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">,</span> <span class="s2">&quot;Analysis efficiency, &quot;</span><span class="p">,</span> <span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="k">for</span> <span class="n">w_im</span> <span class="ow">in</span> <span class="n">wrong_images</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">w_im</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="n">natsort</span><span class="o">.</span><span class="n">natsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;im_or_vid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;video_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;video_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_folder_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">folder_name</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        Update the current working directory and data list based on the given sample number</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        and optional folder name.</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        sample_number : int</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">            The number of samples to analyze.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        folder_name : str, optional</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">            The name of the folder to change to. Default is an empty string.</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        -----</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        This function changes the current working directory to the specified folder name</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">        and updates the data list based on the file names in that directory. It also performs</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        sorting of the data list and checks for strong variations in file names.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">folder_name</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="n">insensitive_glob</span><span class="p">(</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;radical&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">])</span>  <span class="c1"># Provides a list ordered by last modification date</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="c1"># Sorting is necessary when some modifications (like rotation) modified the last modification date</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sort_data_list</span><span class="p">()</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;im_or_vid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="n">sample_number</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="n">sample_number</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;analyzed_individuals&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_analyzed_individuals</span><span class="p">()</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_set_analyzed_individuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        Set the analyzed individuals variable in the dataset.</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">],</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>                                                       <span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_data_to_run_cellects_quickly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        Load data from a pickle file and update the current state of the object.</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">        Summarizes, loads, and validates data needed to run Cellects,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        updating the object&#39;s state accordingly. If the necessary data</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">        are not present or valid, it ensures the experiment is marked as</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        not ready to run.</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        self : CellectsObject</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">            The instance of the class (assumed to be a subclass of</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">            CellectsObject) that this method belongs to.</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">        -------</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">        None</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">        -----</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        This function relies on the presence of a pickle file &#39;Data to run Cellects quickly.pkl&#39;.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        It updates the state of various attributes based on the loaded data</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">        and logs appropriate messages.</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="n">current_global_pathway</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">folder_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_number&#39;</span><span class="p">]</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="k">if</span> <span class="n">folder_number</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="n">folder_list</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">])</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="n">sample_number_per_folder</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">])</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">):</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">()</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="n">pickle_rick</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="k">if</span> <span class="n">data_to_run_cellects_quickly</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;validated_shapes&#39;</span> <span class="ow">in</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;coordinates&#39;</span> <span class="ow">in</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">):</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Success to load Data to run Cellects quickly.pkl from the user chosen directory&quot;</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                <span class="c1"># If you want to add a new variable, first run an updated version of all_vars_dict,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                <span class="c1"># then put a breakpoint here and run the following + self.save_data_to_run_cellects_quickly() :</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_variable_dict</span><span class="p">()</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>                <span class="n">folder_changed</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                <span class="k">if</span> <span class="n">current_global_pathway</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                    <span class="n">folder_changed</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                        <span class="s2">&quot;Although the folder is ready, it is not at the same place as it was during creation, updating&quot;</span><span class="p">)</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_global_pathway</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                <span class="k">if</span> <span class="n">folder_number</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_global_pathway</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">folder_list</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">folder_number</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_number_per_folder</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">look_for_data</span><span class="p">()</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                    <span class="k">if</span> <span class="n">folder_changed</span> <span class="ow">and</span> <span class="n">folder_number</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">update_folder_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_first_image</span><span class="p">()</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_last_image</span><span class="p">()</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>                <span class="p">(</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">)</span> <span class="o">=</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                    <span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;automatically_crop&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">=</span> <span class="p">[</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">]</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Crop first image&quot;</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">automatically_crop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Crop last image&quot;</span><span class="p">)</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">automatically_crop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span><span class="p">)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span> <span class="o">=</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;validated_shapes&#39;</span><span class="p">]</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;csc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;binary_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;shape_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;shape_number&#39;</span><span class="p">]</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;subtract_background&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span><span class="p">:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The current (or the first) folder is ready to run&quot;</span><span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The current (or the first) folder is not ready to run&quot;</span><span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_data_to_run_cellects_quickly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_one_if_does_not_exist</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">        Save data to a pickled file if it does not exist or update existing data.</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">        new_one_if_does_not_exist : bool, optional</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">            Whether to create a new data file if it does not already exist.</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">            Default is True.</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">        -----</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">        This method logs various information about its operations and handles the writing of data to a pickled file.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">):</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Update -Data to run Cellects quickly.pkl- in the user chosen directory&quot;</span><span class="p">)</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>            <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">()</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>            <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="n">pickle_rick</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="k">if</span> <span class="n">data_to_run_cellects_quickly</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to load Data to run Cellects quickly.pkl before update. Remove pre existing.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>            <span class="k">if</span> <span class="n">new_one_if_does_not_exist</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create Data to run Cellects quickly.pkl in the user chosen directory&quot;</span><span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="k">if</span> <span class="n">data_to_run_cellects_quickly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_to_save</span><span class="p">[</span><span class="s1">&#39;first_image&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>                <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;validated_shapes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;binary_image&#39;</span><span class="p">]</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;shape_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;shape_number&#39;</span><span class="p">]</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                    <span class="c1"># data_to_run_cellects_quickly[&#39;converted_image&#39;] = self.first_image.im_combinations[self.current_combination_id][&#39;converted_image&#39;]</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_to_save</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>                <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_coordinates</span><span class="p">()</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;When they exist, do overwrite unaltered video&quot;</span><span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;overwrite_unaltered_videos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_to_save</span><span class="p">[</span><span class="s1">&#39;exif&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;exif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_exif</span><span class="p">()</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">()</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="n">pickle_rick</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">data_to_run_cellects_quickly</span><span class="p">,</span> <span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_list_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        Summarize the coordinates of images and video.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">        Combine the crop coordinates from the first image with additional</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">        coordinates for left, right, top, and bottom boundaries to form a list of</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        video coordinates. If the crop coordinates are not already set, initialize</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">        them to cover the entire image.</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        -------</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        list of int</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">            A list containing the coordinates [left, right, top, bottom] for video.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>                                                       <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">videos_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">]</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="k">return</span> <span class="n">videos_coordinates</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_first_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_im</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_number</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">        Load and process the first image or frame from a video.</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">        This method handles loading the first image or the first frame of a video</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">        depending on whether the data is an image or a video. It performs necessary</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">        preprocessing and initializes relevant attributes for subsequent analysis.</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="k">if</span> <span class="n">first_im</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="n">first_im</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>            <span class="k">if</span> <span class="n">sample_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="n">sample_number</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Load first image&quot;</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="n">just_read_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>            <span class="c1"># just_read_image = self.analysis_instance is not None</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;im_or_vid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>                <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">just_read_image</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">))</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                        <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">)),</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                         <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">)),</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                    <span class="k">while</span> <span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>                        <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="n">frame</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                            <span class="k">break</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>                    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                    <span class="k">while</span> <span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>                        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>                    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;dims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;raw_images&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_raw_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="n">readim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;raw_images&#39;</span><span class="p">])</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;dims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]))</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">])):</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span><span class="p">:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;im_or_vid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span> <span class="o">=</span> <span class="n">OneImageAnalysis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">)</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;already_greyscale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">already_greyscale</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;already_greyscale&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;convert_for_origin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bgr&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">}</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;convert_for_motion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bgr&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">}</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="o">...</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="o">...</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">...</span><span class="p">])))</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;invisible&#39;</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_last_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_im</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">        Load the last image from a video or image list and process it based on given parameters.</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">        last_im : NDArray, optional</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">            The last image to be loaded. If not provided, the last image will be loaded from the data list.</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Load last image&quot;</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="k">if</span> <span class="n">last_im</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="o">=</span> <span class="n">last_im</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;im_or_vid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>                <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>                <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>                <span class="k">while</span> <span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>                    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span><span class="p">:</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>                        <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="o">=</span> <span class="n">frame</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>                <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>                <span class="n">is_landscape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="o">=</span> <span class="n">read_and_rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;raw_images&#39;</span><span class="p">],</span> <span class="n">is_landscape</span><span class="p">)</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span><span class="p">:</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span> <span class="o">=</span> <span class="n">OneImageAnalysis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_im</span><span class="p">)</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_exif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">        Extract EXIF data from image or video files.</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">        -----</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        If `extract_time_interval` is True and unsuccessful, arbitrary time steps will be used.</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">        Timings are normalized to minutes for consistency across different files.</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step_is_arbitrary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;im_or_vid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;dims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>            <span class="n">timings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;dims&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>            <span class="n">timings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">))</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>                <span class="n">pathway</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>                <span class="n">pathway</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;extract_time_interval&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">:</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extract_time_interval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extract_time_interval&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>                    <span class="n">timings</span> <span class="o">=</span> <span class="n">extract_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">,</span> <span class="n">pathway</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;raw_images&#39;</span><span class="p">])</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                    <span class="n">timings</span> <span class="o">=</span> <span class="n">timings</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>                    <span class="n">timings</span> <span class="o">=</span> <span class="n">timings</span> <span class="o">/</span> <span class="mi">60</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>                    <span class="n">time_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">timings</span><span class="p">)</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time_step</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>                        <span class="n">time_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">time_step</span><span class="p">)</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>                        <span class="n">digit_nb</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_step</span><span class="p">):</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>                            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;.&#39;</span><span class="p">}:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                                <span class="k">pass</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                            <span class="k">elif</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;0&#39;</span><span class="p">}:</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                                <span class="n">digit_nb</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>                            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>                                <span class="k">break</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">time_step</span><span class="p">,</span> <span class="n">digit_nb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step_is_arbitrary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>                <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>                    <span class="k">pass</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>                <span class="n">timings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">])</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step_is_arbitrary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="k">return</span> <span class="n">timings</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fast_first_image_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">        Segment the first or subsequent image in a series for biological and background masks.</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">        -----</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">        This function processes the first or subsequent image in a sequence, applying biological and background masks,</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">        segmenting the image, and updating internal data structures accordingly. The function is specific to handling</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">        image sequences for biological analysis</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;color_number&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_variable_dict</span><span class="p">()</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s2">&quot;PCA&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)}</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">convert_and_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;color_number&quot;</span><span class="p">],</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>                                             <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;bio_mask&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;back_mask&quot;</span><span class="p">],</span> <span class="n">subtract_background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>                                             <span class="n">subtract_background2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>                                             <span class="n">rolling_window_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;rolling_window_segmentation&quot;</span><span class="p">],</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                                             <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;filter_spec&quot;</span><span class="p">])</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">drift_correction_already_adjusted</span><span class="p">:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">check_if_image_border_attest_drift_correction</span><span class="p">()</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cellects detected that the images have already been corrected for drift&quot;</span><span class="p">)</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">convert_and_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;color_number&quot;</span><span class="p">],</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>                                                     <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;bio_mask&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;back_mask&quot;</span><span class="p">],</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>                                                     <span class="n">subtract_background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subtract_background2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                                                     <span class="n">rolling_window_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;rolling_window_segmentation&quot;</span><span class="p">],</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                                                     <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;filter_spec&quot;</span><span class="p">],</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                                                     <span class="n">allowed_window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">)</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>        <span class="n">shapes_features</span> <span class="o">=</span> <span class="n">shape_selection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">true_shape_number</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span><span class="p">,</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                                          <span class="n">horizontal_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">starting_blob_hsize_in_pixels</span><span class="p">,</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>                                          <span class="n">spot_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;starting_blob_shape&#39;</span><span class="p">],</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>                                          <span class="n">several_blob_per_arena</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">],</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>                                          <span class="n">bio_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;bio_mask&quot;</span><span class="p">],</span> <span class="n">back_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;back_mask&quot;</span><span class="p">])</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">,</span> <span class="n">shape_number</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centroids</span> <span class="o">=</span> <span class="n">shapes_features</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">=</span> <span class="n">shape_number</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;csc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;binary_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">greyscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>            <span class="n">greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">greyscale</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>            <span class="n">greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;converted_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">greyscale</span><span class="p">)</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;shape_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape_number</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fast_last_image_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">biomask</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">backmask</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        Segment the first or subsequent image in a series for biological and background masks.</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">        biomask : NDArray[np.uint8], optional</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">            The biological mask to be applied to the image.</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">        backmask : NDArray[np.uint8], optional</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">            The background mask to be applied to the image.</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="sd">        -------</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">        None</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">        -----</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">        This function processes the first or subsequent image in a sequence, applying biological and background masks,</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">        segmenting the image, and updating internal data structures accordingly. The function is specific to handling</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">        image sequences for biological analysis</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s2">&quot;PCA&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)}</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">(</span><span class="n">is_first_image</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">convert_and_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;color_number&quot;</span><span class="p">],</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                                            <span class="n">biomask</span><span class="p">,</span> <span class="n">backmask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background</span><span class="p">,</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                                            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background2</span><span class="p">,</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                                            <span class="n">rolling_window_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;rolling_window_segmentation&quot;</span><span class="p">],</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                                            <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;filter_spec&quot;</span><span class="p">])</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">drift_correction_already_adjusted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;rolling_window_segmentation&quot;</span><span class="p">][</span><span class="s1">&#39;do&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">check_if_image_border_attest_drift_correction</span><span class="p">()</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">convert_and_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;color_number&quot;</span><span class="p">],</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                                                <span class="n">biomask</span><span class="p">,</span> <span class="n">backmask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background</span><span class="p">,</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                                                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background2</span><span class="p">,</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                                                <span class="n">allowed_window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">,</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                                                <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;filter_spec&quot;</span><span class="p">])</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;csc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;binary_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">greyscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>            <span class="n">greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">greyscale</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>            <span class="n">greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">image</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;converted_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">greyscale</span><span class="p">)</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cropping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_first_image</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">        Crops the image based on specified conditions and settings.</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">        This method checks if drift correction has already been applied.</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">        If the image is the first one and hasn&#39;t been cropped yet, it will attempt</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">        to use pre-stored coordinates or compute new crop coordinates. If automatic</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">        cropping is enabled, it will apply the cropping process.</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a><span class="sd">        is_first_image : bool</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="sd">            Indicates whether the image being processed is the first one in the sequence.</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>            <span class="k">if</span> <span class="n">is_first_image</span><span class="p">:</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">cropped</span><span class="p">:</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;overwrite_unaltered_videos&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)):</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>                        <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">()</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>                        <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="n">pickle_rick</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                        <span class="k">if</span> <span class="n">data_to_run_cellects_quickly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>                            <span class="k">if</span> <span class="s1">&#39;coordinates&#39;</span> <span class="ow">in</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">:</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>                                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get crop coordinates from Data to run Cellects quickly.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>                                <span class="p">(</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">)</span> <span class="o">=</span> \
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>                                    <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">=</span> <span class="p">[</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">]</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>                            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">get_crop_coordinates</span><span class="p">()</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">get_crop_coordinates</span><span class="p">()</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">get_crop_coordinates</span><span class="p">()</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;automatically_crop&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">automatically_crop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span><span class="p">)</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">cropped</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;automatically_crop&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">automatically_crop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span><span class="p">)</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_average_pixel_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">        Calculate the average pixel size and related variables.</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">        Logs information about calculation steps, computes the average</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">        pixel size based on image or cell scaling settings,</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">        and sets initial thresholds for object detection.</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">        -----</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">        - The average pixel size is determined by either image dimensions or blob sizes.</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">        - Thresholds for automatic detection are set based on configuration settings.</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting average pixel size&quot;</span><span class="p">)</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">,</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shapes</span><span class="p">,</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>            <span class="n">centroids</span><span class="p">)</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">,</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>                <span class="n">connectivity</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;scale_with_image_or_cells&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;image_horizontal_size_in_mm&#39;</span><span class="p">]</span> <span class="o">/</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;starting_blob_hsize_in_mm&#39;</span><span class="p">]</span> <span class="o">/</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">2</span><span class="p">]))</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;set_spot_size&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">starting_blob_hsize_in_pixels</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;starting_blob_hsize_in_mm&#39;</span><span class="p">]</span> <span class="o">/</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">starting_blob_hsize_in_pixels</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;automatic_size_thresholding&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;first_move_threshold_in_mm&#39;</span><span class="p">]</span> <span class="o">/</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The average pixel size is: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">)</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_background_to_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a><span class="sd">        Determine if background subtraction should be applied to the image.</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">        Extended Description</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a><span class="sd">        --------------------</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a><span class="sd">        This function checks whether background subtraction should be applied.</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">        It utilizes the &#39;subtract_background&#39; flag and potentially converts</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a><span class="sd">        the image for motion estimation.</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="sd">        self : object</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a><span class="sd">            The instance of the class containing this method.</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a><span class="sd">            Must have attributes `vars` and `first_image`.</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;subtract_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">generate_subtract_background</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">])</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_if_lighter_background</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="sd">        Determines whether the background is lighter or darker than the cells.</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="sd">        This function analyzes images to determine if their backgrounds are lighter</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="sd">        or darker relative to the cells, updating attributes accordingly for analysis and display purposes.</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="sd">        -----</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="sd">        This function modifies instance variables and does not return any value.</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">        The analysis involves comparing mean pixel values in specific areas of the image.</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Find if the background is lighter or darker than the cells&quot;</span><span class="p">)</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>        <span class="n">are_dicts_equal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>                <span class="n">are_dicts_equal</span> <span class="o">=</span> <span class="n">are_dicts_equal</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>                <span class="n">are_dicts_equal</span> <span class="o">=</span> <span class="n">are_dicts_equal</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s2">&quot;PCA&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)}</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>            <span class="n">are_dicts_equal</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>        <span class="k">if</span> <span class="n">are_dicts_equal</span><span class="p">:</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_first_image</span><span class="p">()</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fast_first_image_segmentation</span><span class="p">()</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">(</span><span class="n">is_first_image</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>            <span class="n">among</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">)</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>            <span class="n">not_among</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">)</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>            <span class="c1"># Use the converted image to tell if the background is lighter, for analysis purposes</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">among</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">not_among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">not_among</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>            <span class="c1"># Use the original image to tell if the background is lighter, for display purposes</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">[</span><span class="n">among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">among</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">[</span><span class="n">not_among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">not_among</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_last_image</span><span class="p">()</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>                <span class="c1"># self.cropping(is_first_image=False)</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fast_last_image_segmentation</span><span class="p">()</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fast_last_image_segmentation</span><span class="p">()</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>            <span class="n">among</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span><span class="p">)</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>            <span class="n">not_among</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span><span class="p">)</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>            <span class="c1"># Use the converted image to tell if the background is lighter, for analysis purposes</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">among</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">not_among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">not_among</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>            <span class="c1"># Use the original image to tell if the background is lighter, for display purposes</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">[</span><span class="n">among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">among</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">[</span><span class="n">not_among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">not_among</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;invisible&quot;</span><span class="p">:</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>            <span class="n">binary_image</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">binary_image</span><span class="p">)</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">convert_and_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;color_number&quot;</span><span class="p">],</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>                                                 <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">subtract_background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>                                                 <span class="n">subtract_background2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>                                                 <span class="n">rolling_window_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;rolling_window_segmentation&#39;</span><span class="p">],</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                                                 <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;filter_spec&quot;</span><span class="p">])</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>            <span class="n">covered_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">binary_image</span><span class="p">)]</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;luminosity_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">covered_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covered_values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">:</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;luminosity_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covered_values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covered_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;luminosity_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covered_values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delineate_each_arena</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a><span class="sd">        Determine the coordinates of each arena for video analysis.</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a><span class="sd">        The function processes video frames to identify bounding boxes around</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a><span class="sd">        specimens and determines valid arenas for analysis. In case of existing data,</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a><span class="sd">        it uses previously computed coordinates if available and valid.</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a><span class="sd">        -------</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="sd">        analysis_status : dict</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="sd">            A dictionary containing flags and messages indicating the status of</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="sd">            the analysis.</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a><span class="sd">            - &#39;continue&#39; (bool): Whether to continue processing.</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="sd">            - &#39;message&#39; (str): Informational or error message.</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="sd">        ------</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="sd">        None</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">        -----</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a><span class="sd">        This function relies on the existence of certain attributes and variables</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="sd">        defined in the class instance.</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="sd">        --------</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">        &gt;&gt;&gt; self.delineate_each_arena()</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">        {&#39;continue&#39;: True, &#39;message&#39;: &#39;&#39;}</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>        <span class="n">analysis_status</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;continue&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>            <span class="n">compute_get_bb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;overwrite_unaltered_videos&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)):</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>                <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">()</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>                <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="n">pickle_rick</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>                <span class="k">if</span> <span class="n">data_to_run_cellects_quickly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>                    <span class="k">if</span> <span class="s1">&#39;coordinates&#39;</span> <span class="ow">in</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">:</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>                        <span class="p">(</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">)</span> <span class="o">=</span> \
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>                            <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">=</span> <span class="p">[</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">]</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>                        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">ccy2</span> <span class="o">-</span> <span class="n">ccy1</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">ccx2</span> <span class="o">-</span> <span class="n">ccx1</span><span class="p">)):</span>  <span class="c1"># maybe useless now</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>                            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get the coordinates of all arenas from Data to run Cellects quickly.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>                            <span class="n">compute_get_bb</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>            <span class="k">if</span> <span class="n">compute_get_bb</span><span class="p">:</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>                <span class="n">motion_list</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;are_gravity_centers_moving&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>                    <span class="n">motion_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segment_blob_motion</span><span class="p">(</span><span class="n">sample_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>                <span class="c1"># if self.all[&#39;im_or_vid&#39;] == 1:</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_bounding_boxes</span><span class="p">(</span><span class="n">are_gravity_centers_moving</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;are_gravity_centers_moving&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>                    <span class="n">motion_list</span><span class="o">=</span><span class="n">motion_list</span><span class="p">,</span> <span class="n">all_specimens_have_same_direction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;all_specimens_have_same_direction&#39;</span><span class="p">])</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">])):</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>                    <span class="n">analysis_status</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;A specimen is at least 100 times larger: click previous and retry by specifying &#39;back&#39; areas.&quot;</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>                    <span class="n">analysis_status</span><span class="p">[</span><span class="s1">&#39;continue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">])):</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>                    <span class="n">analysis_status</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;A specimen is at least 100 times smaller: click previous and retry by specifying &#39;back&#39; areas.&quot;</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>                    <span class="n">analysis_status</span><span class="p">[</span><span class="s1">&#39;continue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; individuals are out of picture scope and cannot be analyzed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_analyzed_individuals</span><span class="p">()</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>        <span class="k">return</span> <span class="n">analysis_status</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_segment_blob_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="sd">        Segment blob motion from the data list at specified sample sizes.</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">        sample_size : int</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">            Number of samples to take from the data list.</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="sd">        -------</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">        list</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">            List containing segmented binary images at sampled frames.</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">        -----</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a><span class="sd">        This function uses numpy for handling array operations and assumes the presence of certain attributes in the object, namely `data_list`, `first_image`, and `vars`.</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a><span class="sd">        --------</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><span class="sd">        &gt;&gt;&gt; motion_samples = _segment_blob_motion(10)</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="sd">        &gt;&gt;&gt; print(len(motion_samples))  # Expected output: 10</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>        <span class="n">motion_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>            <span class="n">frame_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>            <span class="n">frame_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>        <span class="n">sample_numbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_number</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;lighter_background&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_if_lighter_background</span><span class="p">()</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>        <span class="k">for</span> <span class="n">frame_idx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sample_size</span><span class="p">):</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>            <span class="k">if</span> <span class="n">frame_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>                <span class="n">motion_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">frame_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">)</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>                    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="n">sample_numbers</span><span class="p">[</span><span class="n">frame_idx</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>                    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="n">sample_numbers</span><span class="p">[</span><span class="n">frame_idx</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>                    <span class="n">is_landscape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>                    <span class="n">image</span> <span class="o">=</span> <span class="n">read_and_rotate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;raw_images&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>                                            <span class="n">is_landscape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span><span class="p">)</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>                    <span class="c1"># image = readim(image)</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>                <span class="n">In</span> <span class="o">=</span> <span class="n">OneImageAnalysis</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>                    <span class="n">In</span><span class="o">.</span><span class="n">check_if_image_border_attest_drift_correction</span><span class="p">()</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>                    <span class="c1"># In.adjust_to_drift_correction(self.vars[&#39;convert_for_motion&#39;][&#39;logical&#39;])</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>                <span class="n">In</span><span class="o">.</span><span class="n">convert_and_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;color_number&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>                                       <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background2</span><span class="p">,</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>                                       <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;rolling_window_segmentation&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>                                       <span class="n">allowed_window</span><span class="o">=</span><span class="n">In</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">,</span> <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;filter_spec&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>                <span class="n">motion_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">frame_idx</span><span class="p">,</span> <span class="n">In</span><span class="o">.</span><span class="n">binary_image</span><span class="p">)</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>        <span class="k">return</span> <span class="n">motion_list</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_bounding_boxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">are_gravity_centers_moving</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">motion_list</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="p">(),</span> <span class="n">all_specimens_have_same_direction</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">original_shape_hsize</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the coordinates of arenas using bounding boxes.</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">        are_gravity_centers_moving : bool</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="sd">            Flag indicating whether gravity centers are moving or not.</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><span class="sd">        motion_list : list</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="sd">            List of motion information for the specimens.</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a><span class="sd">        all_specimens_have_same_direction : bool, optional</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="sd">            Flag indicating whether all specimens have the same direction,</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">            by default True.</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">        This method uses various internal methods and variables to determine the bounding boxes.</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>        <span class="c1"># 7) Create required empty arrays: especially the bounding box coordinates of each video</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shapes_to_remove</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">get_crop_coordinates</span><span class="p">()</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get the coordinates of all arenas using the get_bounding_boxes method of the VideoMaker class&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">,</span> <span class="n">ordered_centroids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">=</span> <span class="n">rank_from_top_to_bottom_from_left_to_right</span><span class="p">(</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">y_boundaries</span><span class="p">,</span> <span class="n">get_ordered_image</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unchanged_ordered_fimg</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="p">)</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">)</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">standard</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>            <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">)</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">)</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>                <span class="k">if</span> <span class="n">are_gravity_centers_moving</span><span class="p">:</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">=</span> <span class="n">get_bb_with_moving_centers</span><span class="p">(</span><span class="n">motion_list</span><span class="p">,</span> <span class="n">all_specimens_have_same_direction</span><span class="p">,</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>                                                     <span class="n">original_shape_hsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">,</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>                                                     <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">y_boundaries</span><span class="p">)</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>                    <span class="n">new_ordered_first_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>                        <span class="n">previous_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>                        <span class="n">previous_shape</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unchanged_ordered_fimg</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>                        <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>                        <span class="n">new_potentials</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>                        <span class="n">new_potentials</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unchanged_ordered_fimg</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                        <span class="n">pads</span> <span class="o">=</span> <span class="n">ProgressivelyAddDistantShapes</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">,</span> <span class="n">previous_shape</span><span class="p">,</span> <span class="n">max_distance</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                        <span class="n">pads</span><span class="o">.</span><span class="n">consider_shapes_sizes</span><span class="p">(</span><span class="n">min_shape_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                        <span class="n">pads</span><span class="o">.</span><span class="n">connect_shapes</span><span class="p">(</span><span class="n">only_keep_connected_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rank_connecting_pixels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                        <span class="n">new_ordered_first_image</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">pads</span><span class="o">.</span><span class="n">expanded_shape</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">=</span> <span class="n">new_ordered_first_image</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">,</span> <span class="n">ordered_centroids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">=</span> <span class="n">rank_from_top_to_bottom_from_left_to_right</span><span class="p">(</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">y_boundaries</span><span class="p">,</span> <span class="n">get_ordered_image</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">get_quick_bounding_boxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">)</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">get_quick_bounding_boxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">)</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_standardize_video_sizes</span><span class="p">()</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>            <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">unchanged_ordered_fimg</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes_to_remove</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_standardize_video_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a><span class="sd">        Standardize video sizes by adjusting bounding boxes.</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a><span class="sd">        Extended Description</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a><span class="sd">        --------------------</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a><span class="sd">        This function adjusts the bounding boxes of detected shapes in a video frame.</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a><span class="sd">        It ensures that all bounding boxes are within the frame&#39;s boundaries and</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><span class="sd">        standardizes their sizes to avoid issues with odd dimensions during video writing.</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">        None</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">            The function modifies the following attributes of the class instance:</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><span class="sd">        Attributes Modified</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">        ------------------</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="sd">        standard : numpy.ndarray</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="sd">            Standardized bounding boxes.</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><span class="sd">        shapes_to_remove : numpy.ndarray</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a><span class="sd">            Indices of shapes to be removed from the image.</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><span class="sd">        modif_validated_shapes : numpy.ndarray</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a><span class="sd">            Modified validated shapes after removing out-of-picture areas.</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a><span class="sd">        ordered_stats : list of float</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><span class="sd">            Updated order statistics for the shapes.</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a><span class="sd">        ordered_centroids : numpy.ndarray</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><span class="sd">            Centroids of the ordered shapes.</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a><span class="sd">        ordered_first_image : numpy.ndarray</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a><span class="sd">            First image with updated order statistics and centroids.</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a><span class="sd">        first_image.shape_number : int</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a><span class="sd">            Updated number of shapes in the first image.</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a><span class="sd">        not_analyzed_individuals : numpy.ndarray</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a><span class="sd">            Indices of individuals not analyzed after modifications.</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>        <span class="n">distance_threshold_to_consider_an_arena_out_of_the_picture</span> <span class="o">=</span> <span class="kc">None</span><span class="c1"># in pixels, worked nicely with - 50</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>        <span class="c1"># The modifications allowing to not make videos of setups out of view, do not work for moving centers</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>        <span class="n">y_diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>        <span class="n">x_diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>        <span class="n">add_to_y</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_diffs</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_diffs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>        <span class="n">add_to_x</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_diffs</span><span class="p">)</span> <span class="o">-</span> <span class="n">x_diffs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">standard</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">),</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">add_to_y</span><span class="p">))</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">add_to_y</span><span class="p">))</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">add_to_x</span><span class="p">))</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">add_to_x</span><span class="p">))</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>        <span class="c1"># Monitor if one bounding box gets out of picture shape</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>        <span class="n">out_of_pic</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">)</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>        <span class="n">out_of_pic</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">out_of_pic</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>        <span class="n">out_of_pic</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">out_of_pic</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>        <span class="k">if</span> <span class="n">distance_threshold_to_consider_an_arena_out_of_the_picture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>            <span class="n">distance_threshold_to_consider_an_arena_out_of_the_picture</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">out_of_pic</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>        <span class="c1"># If it occurs at least one time, apply a correction, otherwise, continue and write videos</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>        <span class="c1"># If the overflow is strong, remove the corresponding individuals and remake bounding_box finding</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">out_of_pic</span><span class="p">,</span> <span class="n">distance_threshold_to_consider_an_arena_out_of_the_picture</span><span class="p">)):</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>            <span class="c1"># Remove shapes</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">standard</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">shapes_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">out_of_pic</span><span class="p">,</span> <span class="o">-</span> <span class="mi">20</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>            <span class="k">for</span> <span class="n">shape_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes_to_remove</span><span class="p">:</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">==</span> <span class="p">(</span><span class="n">shape_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">,</span> <span class="n">ordered_centroids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">=</span> <span class="n">rank_from_top_to_bottom_from_left_to_right</span><span class="p">(</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">y_boundaries</span><span class="p">,</span> <span class="n">get_ordered_image</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes_to_remove</span><span class="p">)</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unchanged_ordered_fimg</span> <span class="o">-</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>                                                      <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unchanged_ordered_fimg</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="p">))[</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>            <span class="c1"># Reduce all box sizes if necessary and proceed</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">out_of_pic</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>                <span class="c1"># When the overflow is weak, remake standardization with lower &quot;add_to_y&quot; and &quot;add_to_x&quot;</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>                <span class="n">overflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">out_of_pic</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">(</span><span class="n">out_of_pic</span><span class="p">,</span> <span class="n">distance_threshold_to_consider_an_arena_out_of_the_picture</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>                <span class="c1"># Look if overflow occurs on the y axis</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">out_of_pic</span><span class="p">[</span><span class="n">overflow</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">)):</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>                    <span class="n">add_to_top_and_bot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">out_of_pic</span><span class="p">[</span><span class="n">overflow</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">add_to_top_and_bot</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">add_to_top_and_bot</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>                <span class="c1"># Look if overflow occurs on the x axis</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">out_of_pic</span><span class="p">[</span><span class="n">overflow</span><span class="p">,</span> <span class="mi">2</span><span class="p">:],</span> <span class="mi">0</span><span class="p">)):</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                    <span class="n">add_to_left_and_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">out_of_pic</span><span class="p">[</span><span class="n">overflow</span><span class="p">,</span> <span class="mi">2</span><span class="p">:])</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">add_to_left_and_right</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">add_to_left_and_right</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>            <span class="c1"># If x or y sizes are odd, make them even :</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>            <span class="c1"># Don&#39;t know why, but opencv remove 1 to odd shapes when writing videos</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_origins_and_backgrounds_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a><span class="sd">        Create origins and background lists for image processing.</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="sd">        Extended Description</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a><span class="sd">        --------------------</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">        This method generates the origin and background lists by slicing the first image</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a><span class="sd">        and its background subtraction based on predefined boundaries. It handles cases where</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="sd">        the top, bottom, left, and right boundaries are not yet initialized.</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">        This method directly modifies the input image data. The `self.vars` dictionary is populated</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a><span class="sd">        with lists of sliced arrays from the first image and its background.</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">        Attributes</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a><span class="sd">        self.vars : dict</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a><span class="sd">            Dictionary to store processed data.</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a><span class="sd">        self.first_image : ImageObject</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a><span class="sd">            The first image object containing validated shapes and background subtraction arrays.</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create origins and background lists&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>        <span class="n">first_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>        <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">])):</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_im</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="n">rep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">rep</span><span class="p">]])</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;subtract_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>            <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">])):</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="n">rep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">rep</span><span class="p">]])</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>                                                         <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="n">rep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">rep</span><span class="p">]])</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">complete_image_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualize</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;binary_image&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;converted_image&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instantiate_tables</span><span class="p">()</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;exif&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;exif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;exif&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">all_c_spaces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">all_c_spaces</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;bio_mask&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;bio_mask&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;back_mask&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;back_mask&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arena</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>            <span class="n">binary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>            <span class="n">efficiency_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">all_c_spaces</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">:]</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>                <span class="n">binary</span> <span class="o">=</span> <span class="n">keep_one_connected_component</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>                <span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="n">compute_one_descriptor_per_frame</span><span class="p">(</span><span class="n">binary</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>                                                                     <span class="n">arena</span><span class="p">,</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;exif&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;output_in_mm&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_specimen&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>                <span class="n">coord_network</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>                <span class="n">coord_pseudopods</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_graph&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>                    <span class="k">if</span> <span class="n">coord_network</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>                        <span class="n">coord_network</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">binary</span><span class="p">))</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>                    <span class="n">extract_graph_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">coord_network</span><span class="p">,</span> <span class="n">arena</span><span class="p">,</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>                                           <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">coord_pseudopods</span><span class="p">)</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>                <span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="n">compute_one_descriptor_per_colony</span><span class="p">(</span><span class="n">binary</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>                                                                      <span class="n">arena</span><span class="p">,</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;exif&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;output_in_mm&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_specimen&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_analysis&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>                <span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span> <span class="o">=</span> <span class="n">prepare_box_counting</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>                                                                   <span class="n">min_mesh_side</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>                                                                       <span class="s1">&#39;fractal_box_side_threshold&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>                                                                   <span class="n">zoom_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;fractal_zoom_step&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>                                                                   <span class="n">contours</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>                <span class="n">box_counting_dimensions</span> <span class="o">=</span> <span class="n">box_counting_dimension</span><span class="p">(</span><span class="n">zoomed_binary</span><span class="p">,</span> <span class="n">side_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>                <span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_dimension&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>                <span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_box_nb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>                <span class="n">one_row_per_frame</span><span class="p">[</span><span class="s2">&quot;fractal_r_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_counting_dimensions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>            <span class="n">one_descriptor_per_arena</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>            <span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;arena&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arena</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>            <span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;first_move&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>            <span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;final_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binary</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>            <span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;iso_digi_transi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>            <span class="n">one_descriptor_per_arena</span><span class="p">[</span><span class="s2">&quot;is_growth_isotropic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_one_row_per_arena</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">one_descriptor_per_arena</span><span class="p">)</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_one_row_per_frame</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">one_row_per_frame</span><span class="p">)</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>            <span class="n">contours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">get_contours</span><span class="p">(</span><span class="n">binary</span><span class="p">))</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>            <span class="n">efficiency_test</span><span class="p">[</span><span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contours</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">94</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">213</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_analysis_visualization_to_first_and_last_images</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">efficiency_test</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_tables</span><span class="p">(</span><span class="n">with_last_image</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_video_writing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">min_ram_free</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">in_colors</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pathway</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a><span class="sd">        Prepare the raw video (.npy) writing process for Cellects.</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a><span class="sd">        img_list : list</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a><span class="sd">            List of images to be processed.</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a><span class="sd">        min_ram_free : float</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a><span class="sd">            Minimum amount of RAM in GB that should remain free.</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a><span class="sd">        in_colors : bool, optional</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a><span class="sd">            Whether the images are in color. Default is False.</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a><span class="sd">        pathway : str, optional</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a><span class="sd">            Path to save the video files. Default is an empty string.</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a><span class="sd">        tuple</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a><span class="sd">            A tuple containing:</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a><span class="sd">            - bunch_nb: int, number of bunches needed for video writing.</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a><span class="sd">            - video_nb_per_bunch: int, number of videos per bunch.</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a><span class="sd">            - sizes: ndarray, dimensions of each video.</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a><span class="sd">            - video_bunch: list or ndarray, initialized video arrays.</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a><span class="sd">            - vid_names: list, names of the video files.</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a><span class="sd">            - rom_memory_required: None or float, required ROM memory.</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a><span class="sd">            - analysis_status: dict, status and message of the analysis process.</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a><span class="sd">            - remaining: int, remainder videos that do not fit in a complete bunch.</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a><span class="sd">        - The function calculates necessary memory and ensures 10% extra to avoid issues.</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a><span class="sd">        - It checks for available RAM and adjusts the number of bunches accordingly.</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a><span class="sd">        - If using color images, memory requirements are tripled.</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a><span class="sd">        expected output depends on the provided images and RAM availability</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>        <span class="c1"># 1) Create a list of video names</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>            <span class="n">number_to_add</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span><span class="p">)</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>            <span class="n">number_to_add</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>        <span class="n">vid_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>        <span class="n">ind_i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>        <span class="k">while</span> <span class="n">ind_i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">+</span> <span class="n">number_to_add</span><span class="p">):</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>            <span class="n">ind_i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>            <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span><span class="p">,</span> <span class="n">ind_i</span><span class="p">)):</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>                <span class="n">ind_i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>            <span class="n">vid_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span> <span class="o">+</span> <span class="s2">&quot;ind_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind_i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.npy&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>        <span class="n">img_nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>        <span class="c1"># 2) Create a table of the dimensions of each video</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>        <span class="c1"># Add 10% to the necessary memory to avoid problems</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>        <span class="n">necessary_memory</span> <span class="o">=</span> <span class="n">img_nb</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="mf">1.16415e-10</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>        <span class="k">if</span> <span class="n">in_colors</span><span class="p">:</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>            <span class="n">sizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">img_nb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>                 <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">)))</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>            <span class="n">necessary_memory</span> <span class="o">*=</span> <span class="mi">3</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>            <span class="n">sizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">img_nb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">))</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>        <span class="n">use_list_of_vid</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">sizes</span><span class="p">):</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>            <span class="n">use_list_of_vid</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>        <span class="n">available_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">available</span> <span class="o">&gt;&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-</span> <span class="n">min_ram_free</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>        <span class="k">if</span> <span class="n">available_memory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>            <span class="n">analysis_status</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;continue&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;There are not enough RAM available&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>            <span class="n">bunch_nb</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>            <span class="n">bunch_nb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">necessary_memory</span> <span class="o">/</span> <span class="n">available_memory</span><span class="p">))</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>            <span class="k">if</span> <span class="n">bunch_nb</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>                <span class="c1"># The program will need twice the memory to create the second bunch.</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>                <span class="n">bunch_nb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">necessary_memory</span> <span class="o">/</span> <span class="n">available_memory</span><span class="p">))</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>        <span class="n">video_nb_per_bunch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">/</span> <span class="n">bunch_nb</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>        <span class="n">analysis_status</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;continue&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>        <span class="n">video_bunch</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>            <span class="k">if</span> <span class="n">use_list_of_vid</span><span class="p">:</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>                <span class="n">video_bunch</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sizes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">video_nb_per_bunch</span><span class="p">)]</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>                <span class="n">video_bunch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">video_nb_per_bunch</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">v_err</span><span class="p">:</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>            <span class="n">analysis_status</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;continue&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Probably failed to detect the right cell(s) number, do the first image analysis manually.&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">analysis_status</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> error is: </span><span class="si">{</span><span class="n">v_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>        <span class="c1"># Check for available ROM memory</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">necessary_memory</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>            <span class="n">rom_memory_required</span> <span class="o">=</span> <span class="n">necessary_memory</span> <span class="o">+</span> <span class="mi">2</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>            <span class="n">rom_memory_required</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>        <span class="n">remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">%</span> <span class="n">bunch_nb</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>        <span class="k">if</span> <span class="n">remaining</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>            <span class="n">bunch_nb</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>        <span class="n">is_landscape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cellects will start writing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="si">}</span><span class="s2"> videos. Given available memory, it will do it in </span><span class="si">{</span><span class="n">bunch_nb</span><span class="si">}</span><span class="s2"> time(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>        <span class="k">return</span> <span class="n">bunch_nb</span><span class="p">,</span> <span class="n">video_nb_per_bunch</span><span class="p">,</span> <span class="n">sizes</span><span class="p">,</span> <span class="n">video_bunch</span><span class="p">,</span> <span class="n">vid_names</span><span class="p">,</span> <span class="n">rom_memory_required</span><span class="p">,</span> <span class="n">analysis_status</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">use_list_of_vid</span><span class="p">,</span> <span class="n">is_landscape</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_output_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a><span class="sd">        Update the output list with various descriptors from the analysis results.</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a><span class="sd">        This method processes different types of descriptors and assigns them to</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a><span class="sd">        the `self.vars[&#39;descriptors&#39;]` dictionary. It handles special cases for</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a><span class="sd">        descriptors related to &#39;xy&#39; dimensions and ensures that all relevant metrics</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a><span class="sd">        are stored in the output list.</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>        <span class="k">for</span> <span class="n">descriptor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>            <span class="k">if</span> <span class="n">descriptor</span> <span class="o">==</span> <span class="s1">&#39;standard_deviation_xy&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;standard_deviation_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;standard_deviation_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>            <span class="k">elif</span> <span class="n">descriptor</span> <span class="o">==</span> <span class="s1">&#39;skewness_xy&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;skewness_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;skewness_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>            <span class="k">elif</span> <span class="n">descriptor</span> <span class="o">==</span> <span class="s1">&#39;kurtosis_xy&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;kurtosis_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;kurtosis_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>            <span class="k">elif</span> <span class="n">descriptor</span> <span class="o">==</span> <span class="s1">&#39;major_axes_len_and_angle&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;major_axis_len&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;minor_axis_len&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;axes_orientation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">from_shape_descriptors_class</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;newly_explored_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_available_core_nb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_bit_number</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">video_bit_number</span><span class="o">=</span><span class="mi">140</span><span class="p">):</span><span class="c1"># video_bit_number=176</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a><span class="sd">        Update available computation resources based on memory and processing constraints.</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a><span class="sd">        image_bit_number : int, optional</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a><span class="sd">            Number of bits per image pixel (default is 256).</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a><span class="sd">        video_bit_number : int, optional</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a><span class="sd">            Number of bits per video frame pixel (default is 140).</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a><span class="sd">        Other Parameters</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a><span class="sd">        ----------------</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a><span class="sd">        lose_accuracy_to_save_memory : bool</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a><span class="sd">            Flag to reduce accuracy for memory savings.</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a><span class="sd">        convert_for_motion : dict</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a><span class="sd">            Conversion settings for motion analysis.</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a><span class="sd">        already_greyscale : bool</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a><span class="sd">            Flag indicating if the image is already greyscale.</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a><span class="sd">        save_coord_thickening_slimming : bool</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a><span class="sd">            Flag to save coordinates for thickening and slimming.</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a><span class="sd">        oscilacyto_analysis : bool</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a><span class="sd">            Flag indicating if oscilacyto analysis is enabled.</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a><span class="sd">        save_coord_network : bool</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a><span class="sd">            Flag to save coordinates for network analysis.</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a><span class="sd">        float</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a><span class="sd">            Rounded absolute difference between available memory and necessary memory in GB.</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a><span class="sd">        Performance considerations and limitations should be noted here if applicable.</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>            <span class="n">video_bit_number</span> <span class="o">-=</span> <span class="mi">56</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>            <span class="n">video_bit_number</span> <span class="o">+=</span> <span class="mi">64</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>                <span class="n">video_bit_number</span> <span class="o">-=</span> <span class="mi">56</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;already_greyscale&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>            <span class="n">video_bit_number</span> <span class="o">-=</span> <span class="mi">64</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_thickening_slimming&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;oscilacyto_analysis&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>            <span class="n">video_bit_number</span> <span class="o">+=</span> <span class="mi">16</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>            <span class="n">image_bit_number</span> <span class="o">+=</span> <span class="mi">128</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>            <span class="n">video_bit_number</span> <span class="o">+=</span> <span class="mi">8</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>            <span class="n">image_bit_number</span> <span class="o">+=</span> <span class="mi">64</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>            <span class="n">one_image_memory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>                                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>            <span class="n">one_image_memory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">),</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>                                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>        <span class="n">one_video_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">one_image_memory</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>        <span class="n">necessary_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">one_image_memory</span> <span class="o">*</span> <span class="n">image_bit_number</span> <span class="o">+</span> <span class="n">one_video_memory</span> <span class="o">*</span> <span class="n">video_bit_number</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.16415e-10</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>        <span class="n">available_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">available</span> <span class="o">&gt;&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;min_ram_free&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>        <span class="n">max_repeat_in_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">available_memory</span> <span class="o">//</span> <span class="n">necessary_memory</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>        <span class="k">if</span> <span class="n">max_repeat_in_memory</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>            <span class="n">max_repeat_in_memory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(((</span><span class="n">available_memory</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">necessary_memory</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;cores&#39;</span><span class="p">],</span> <span class="n">max_repeat_in_memory</span><span class="p">))</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cores</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span><span class="p">:</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">available_memory</span> <span class="o">-</span> <span class="n">necessary_memory</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_one_row_per_arena</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">table_to_add</span><span class="p">):</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a><span class="sd">        Update one row of the dataframe per arena.</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a><span class="sd">        Add a row to a DataFrame for each arena, based on the provided table_to_add. If no previous rows exist,</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a><span class="sd">        initialize a new DataFrame with zeros.</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a><span class="sd">        i : int</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a><span class="sd">            Index of the arena to update.</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a><span class="sd">        table_to_add : dict</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a><span class="sd">            Dictionary containing values to add. Keys are column names, values are the data.</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_to_add</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>                                            <span class="n">columns</span><span class="o">=</span><span class="n">table_to_add</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">table_to_add</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_one_row_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">table_to_add</span><span class="p">):</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a><span class="sd">        Update a range of rows in `self.one_row_per_frame` DataFrame with values from</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a><span class="sd">        `table_to_add`.</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a><span class="sd">        i : int</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a><span class="sd">            The starting row index to update in `self.one_row_per_frame`.</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a><span class="sd">        j : int</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a><span class="sd">            The ending row index (exclusive) to update in `self.one_row_per_frame`.</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a><span class="sd">        table_to_add : dict</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a><span class="sd">            A dictionary where keys are column labels and values are lists or arrays of</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a><span class="sd">            data to insert into `self.one_row_per_frame`.</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a><span class="sd">        Ensures that one row per arena is being updated. If `self.one_row_per_frame` is</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a><span class="sd">        None, it initializes a DataFrame to hold the data.</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">])</span> <span class="o">*</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]),</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>                                            <span class="n">columns</span><span class="o">=</span><span class="n">table_to_add</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">table_to_add</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">instantiate_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a><span class="sd">        Update output list and prepare results tables and validation images.</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a><span class="sd">        Extended Description</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a><span class="sd">        --------------------</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a><span class="sd">        This method performs necessary preparations for processing image sequences,</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a><span class="sd">        including updating the output list and initializing key attributes required</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a><span class="sd">        for subsequent operations.</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_output_list</span><span class="p">()</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Instantiate results tables and validation images&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fractal_box_sizes</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;already_greyscale&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;convert_for_motion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bgr&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_analysis_visualization_to_first_and_last_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">first_visualization</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">last_visualization</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a><span class="sd">        Adds analysis visualizations to the first and last images of a sequence.</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a><span class="sd">        i : int</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a><span class="sd">            Index of the image in the sequence.</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a><span class="sd">        first_visualization : NDArray[np.uint8]</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a><span class="sd">            The visualization to add to the first image.</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a><span class="sd">        last_visualization : NDArray[np.uint8]</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a><span class="sd">            The visualization to add to the last image.</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a><span class="sd">        Other Parameters</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a><span class="sd">        ----------------</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a><span class="sd">        vars : dict</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a><span class="sd">            Dictionary containing various parameters.</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a><span class="sd">        arena_shape : str, optional</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a><span class="sd">            The shape of the arena. Either &#39;circle&#39; or other shapes.</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a><span class="sd">        If `arena_shape` is &#39;circle&#39;, the visualization will be masked by an ellipse.</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>        <span class="n">minmax</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span> <span class="o">=</span> <span class="n">draw_img_with_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">minmax</span><span class="p">,</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                                                  <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;arena_shape&#39;</span><span class="p">],</span> <span class="n">first_visualization</span><span class="p">)</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>        <span class="k">if</span> <span class="n">last_visualization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span> <span class="o">=</span> <span class="n">draw_img_with_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">minmax</span><span class="p">,</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>                                                      <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;arena_shape&#39;</span><span class="p">],</span> <span class="n">last_visualization</span><span class="p">)</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>        <span class="c1"># cr = ((self.top[i], self.bot[i]),</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>        <span class="c1">#       (self.left[i], self.right[i]))</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>        <span class="c1"># if self.vars[&#39;arena_shape&#39;] == &#39;circle&#39;:</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>        <span class="c1">#     ellipse = create_ellipse(cr[0][1] - cr[0][0], cr[1][1] - cr[1][0])</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>        <span class="c1">#     ellipse = np.stack((ellipse, ellipse, ellipse), axis=2).astype(np.uint8)</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>        <span class="c1">#     first_visualization *= ellipse</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>        <span class="c1">#     self.first_image.bgr[cr[0][0]:cr[0][1], cr[1][0]:cr[1][1], ...] *= (1 - ellipse)</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>        <span class="c1">#     self.first_image.bgr[cr[0][0]:cr[0][1], cr[1][0]:cr[1][1], ...] += first_visualization</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>        <span class="c1">#     if last_visualization is not None:</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>        <span class="c1">#         last_visualization *= ellipse</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>        <span class="c1">#         self.last_image.bgr[cr[0][0]:cr[0][1], cr[1][0]:cr[1][1], ...] *= (1 - ellipse)</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>        <span class="c1">#         self.last_image.bgr[cr[0][0]:cr[0][1], cr[1][0]:cr[1][1], ...] += last_visualization</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>        <span class="c1"># else:</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>        <span class="c1">#     self.first_image.bgr[cr[0][0]:cr[0][1], cr[1][0]:cr[1][1], ...] = first_visualization</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>        <span class="c1">#     if last_visualization is not None:</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>        <span class="c1">#         self.last_image.bgr[cr[0][0]:cr[0][1], cr[1][0]:cr[1][1], ...] = last_visualization</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_last_image</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a><span class="sd">        Exports analysis results to CSV files and saves visualization outputs.</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a><span class="sd">        Generates the following output:</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a><span class="sd">        - one_row_per_arena.csv, one_row_per_frame.csv : Tracking data per arena/frame.</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a><span class="sd">        - software_settings.csv : Full configuration settings for reproducibility.</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a><span class="sd">        ------</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a><span class="sd">        PermissionError</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a><span class="sd">            If any output file is already open in an external program (logged and re-raised).</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a><span class="sd">        Ensure no exported CSV files are open while running this method to avoid permission errors. This</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a><span class="sd">        function will fail gracefully if the files cannot be overwritten.</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Save results tables and validation images&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>            <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">message_from_thread</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;one_row_per_frame.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>            <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_frame.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">message_from_thread</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Never let one_row_per_frame.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.JPG&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>            <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.PNG&#39;</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>            <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.JPG&#39;</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>        <span class="k">if</span> <span class="n">with_last_image</span><span class="p">:</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analysis efficiency, last image</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">)</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>            <span class="sa">f</span><span class="s2">&quot;Analysis efficiency, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span><span class="si">}</span><span class="s2">th image</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">)</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>        <span class="n">software_settings</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">)</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">,</span> <span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">,</span> <span class="s1">&#39;exif&#39;</span><span class="p">,</span> <span class="s1">&#39;dims&#39;</span><span class="p">,</span> <span class="s1">&#39;origin_list&#39;</span><span class="p">,</span> <span class="s1">&#39;background_list&#39;</span><span class="p">,</span> <span class="s1">&#39;background_list2&#39;</span><span class="p">,</span> <span class="s1">&#39;descriptors&#39;</span><span class="p">,</span> <span class="s1">&#39;folder_list&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>            <span class="n">software_settings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>        <span class="n">global_settings</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">,</span> <span class="s1">&#39;night_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;expert_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;is_auto&#39;</span><span class="p">,</span> <span class="s1">&#39;arena&#39;</span><span class="p">,</span> <span class="s1">&#39;video_option&#39;</span><span class="p">,</span> <span class="s1">&#39;compute_all_options&#39;</span><span class="p">,</span> <span class="s1">&#39;vars&#39;</span><span class="p">,</span> <span class="s1">&#39;dims&#39;</span><span class="p">,</span> <span class="s1">&#39;origin_list&#39;</span><span class="p">,</span> <span class="s1">&#39;background_list&#39;</span><span class="p">,</span> <span class="s1">&#39;background_list2&#39;</span><span class="p">,</span> <span class="s1">&#39;descriptors&#39;</span><span class="p">,</span> <span class="s1">&#39;folder_list&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>            <span class="n">global_settings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>        <span class="n">software_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">global_settings</span><span class="p">)</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>        <span class="n">software_settings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">software_settings</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Setting&quot;</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>            <span class="n">software_settings</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;software_settings.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let software_settings.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">message_from_thread</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Never let software_settings.csv open when Cellects runs&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>This class stores all variables required for analysis as well as
methods to process it.
Global variables (i.e. that does not concern the MotionAnalysis)
are directly stored in self.
Variables used in the MotionAnalysis class are stored in a dict
called self.vars</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        This class stores all variables required for analysis as well as</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        methods to process it.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        Global variables (i.e. that does not concern the MotionAnalysis)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        are directly stored in self.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        Variables used in the MotionAnalysis class are stored in a dict</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        called self.vars</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;PickleRick.pkl&#39;</span><span class="p">):</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;PickleRick.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;PickleRick0.pkl&#39;</span><span class="p">):</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;PickleRick0.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">one_arena_done</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">data_to_save</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;first_image&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;exif&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;vars&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">motion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">computed_video_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">starting_blob_hsize_in_pixels</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">visualize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.add_analysis_visualization_to_first_and_last_images" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_analysis_visualization_to_first_and_last_images</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">first_visualization</span><span class="p">,</span> <span class="n">last_visualization</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Adds analysis visualizations to the first and last images of a sequence.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>i</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the image in the sequence.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>first_visualization</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The visualization to add to the first image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>last_visualization</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The visualization to add to the last image.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Other Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>vars</code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing various parameters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>arena_shape</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The shape of the arena. Either 'circle' or other shapes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>If <code>arena_shape</code> is 'circle', the visualization will be masked by an ellipse.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1600" name="__codelineno-0-1600"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_analysis_visualization_to_first_and_last_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">first_visualization</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">last_visualization</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a><span class="sd">    Adds analysis visualizations to the first and last images of a sequence.</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a><span class="sd">    i : int</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a><span class="sd">        Index of the image in the sequence.</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a><span class="sd">    first_visualization : NDArray[np.uint8]</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a><span class="sd">        The visualization to add to the first image.</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a><span class="sd">    last_visualization : NDArray[np.uint8]</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a><span class="sd">        The visualization to add to the last image.</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a><span class="sd">    Other Parameters</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a><span class="sd">    ----------------</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a><span class="sd">    vars : dict</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a><span class="sd">        Dictionary containing various parameters.</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a><span class="sd">    arena_shape : str, optional</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a><span class="sd">        The shape of the arena. Either &#39;circle&#39; or other shapes.</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a><span class="sd">    If `arena_shape` is &#39;circle&#39;, the visualization will be masked by an ellipse.</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>    <span class="n">minmax</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span> <span class="o">=</span> <span class="n">draw_img_with_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">minmax</span><span class="p">,</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                                              <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;arena_shape&#39;</span><span class="p">],</span> <span class="n">first_visualization</span><span class="p">)</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>    <span class="k">if</span> <span class="n">last_visualization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span> <span class="o">=</span> <span class="n">draw_img_with_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">minmax</span><span class="p">,</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>                                                  <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;arena_shape&#39;</span><span class="p">],</span> <span class="n">last_visualization</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.cropping" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cropping</span><span class="p">(</span><span class="n">is_first_image</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Crops the image based on specified conditions and settings.</p>
<p>This method checks if drift correction has already been applied.
If the image is the first one and hasn't been cropped yet, it will attempt
to use pre-stored coordinates or compute new crop coordinates. If automatic
cropping is enabled, it will apply the cropping process.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_first_image</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicates whether the image being processed is the first one in the sequence.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="k">def</span><span class="w"> </span><span class="nf">cropping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_first_image</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">    Crops the image based on specified conditions and settings.</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">    This method checks if drift correction has already been applied.</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">    If the image is the first one and hasn&#39;t been cropped yet, it will attempt</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">    to use pre-stored coordinates or compute new crop coordinates. If automatic</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">    cropping is enabled, it will apply the cropping process.</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a><span class="sd">    is_first_image : bool</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="sd">        Indicates whether the image being processed is the first one in the sequence.</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>        <span class="k">if</span> <span class="n">is_first_image</span><span class="p">:</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">cropped</span><span class="p">:</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;overwrite_unaltered_videos&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)):</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>                    <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">()</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>                    <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="n">pickle_rick</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                    <span class="k">if</span> <span class="n">data_to_run_cellects_quickly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>                        <span class="k">if</span> <span class="s1">&#39;coordinates&#39;</span> <span class="ow">in</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">:</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>                            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get crop coordinates from Data to run Cellects quickly.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>                            <span class="p">(</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">)</span> <span class="o">=</span> \
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>                                <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">=</span> <span class="p">[</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">]</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">get_crop_coordinates</span><span class="p">()</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">get_crop_coordinates</span><span class="p">()</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">get_crop_coordinates</span><span class="p">()</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;automatically_crop&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">automatically_crop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span><span class="p">)</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">cropped</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;automatically_crop&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">automatically_crop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.delineate_each_arena" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delineate_each_arena</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine the coordinates of each arena for video analysis.</p>
<p>The function processes video frames to identify bounding boxes around
specimens and determines valid arenas for analysis. In case of existing data,
it uses previously computed coordinates if available and valid.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>analysis_status</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing flags and messages indicating the status of
the analysis.
- 'continue' (bool): Whether to continue processing.
- 'message' (str): Informational or error message.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function relies on the existence of certain attributes and variables
defined in the class instance.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">delineate_each_arena</span><span class="p">()</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="go">{&#39;continue&#39;: True, &#39;message&#39;: &#39;&#39;}</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span>
<span class="normal"><a href="#__codelineno-0-975">975</a></span>
<span class="normal"><a href="#__codelineno-0-976">976</a></span>
<span class="normal"><a href="#__codelineno-0-977">977</a></span>
<span class="normal"><a href="#__codelineno-0-978">978</a></span>
<span class="normal"><a href="#__codelineno-0-979">979</a></span>
<span class="normal"><a href="#__codelineno-0-980">980</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-911" name="__codelineno-0-911"></a><span class="k">def</span><span class="w"> </span><span class="nf">delineate_each_arena</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a><span class="sd">    Determine the coordinates of each arena for video analysis.</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a><span class="sd">    The function processes video frames to identify bounding boxes around</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a><span class="sd">    specimens and determines valid arenas for analysis. In case of existing data,</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a><span class="sd">    it uses previously computed coordinates if available and valid.</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a><span class="sd">    -------</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="sd">    analysis_status : dict</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="sd">        A dictionary containing flags and messages indicating the status of</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="sd">        the analysis.</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a><span class="sd">        - &#39;continue&#39; (bool): Whether to continue processing.</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="sd">        - &#39;message&#39; (str): Informational or error message.</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="sd">    ------</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="sd">    None</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">    -----</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a><span class="sd">    This function relies on the existence of certain attributes and variables</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="sd">    defined in the class instance.</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="sd">    --------</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">    &gt;&gt;&gt; self.delineate_each_arena()</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">    {&#39;continue&#39;: True, &#39;message&#39;: &#39;&#39;}</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="n">analysis_status</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;continue&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>        <span class="n">compute_get_bb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;overwrite_unaltered_videos&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)):</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>            <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">()</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>            <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="n">pickle_rick</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>            <span class="k">if</span> <span class="n">data_to_run_cellects_quickly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>                <span class="k">if</span> <span class="s1">&#39;coordinates&#39;</span> <span class="ow">in</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">:</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>                    <span class="p">(</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">)</span> <span class="o">=</span> \
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>                        <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">=</span> <span class="p">[</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">]</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">ccy2</span> <span class="o">-</span> <span class="n">ccy1</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">ccx2</span> <span class="o">-</span> <span class="n">ccx1</span><span class="p">)):</span>  <span class="c1"># maybe useless now</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get the coordinates of all arenas from Data to run Cellects quickly.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>                        <span class="n">compute_get_bb</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="k">if</span> <span class="n">compute_get_bb</span><span class="p">:</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>            <span class="n">motion_list</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;are_gravity_centers_moving&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>                <span class="n">motion_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segment_blob_motion</span><span class="p">(</span><span class="n">sample_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>            <span class="c1"># if self.all[&#39;im_or_vid&#39;] == 1:</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_bounding_boxes</span><span class="p">(</span><span class="n">are_gravity_centers_moving</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;are_gravity_centers_moving&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>                <span class="n">motion_list</span><span class="o">=</span><span class="n">motion_list</span><span class="p">,</span> <span class="n">all_specimens_have_same_direction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;all_specimens_have_same_direction&#39;</span><span class="p">])</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">])):</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>                <span class="n">analysis_status</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;A specimen is at least 100 times larger: click previous and retry by specifying &#39;back&#39; areas.&quot;</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>                <span class="n">analysis_status</span><span class="p">[</span><span class="s1">&#39;continue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">])):</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>                <span class="n">analysis_status</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;A specimen is at least 100 times smaller: click previous and retry by specifying &#39;back&#39; areas.&quot;</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>                <span class="n">analysis_status</span><span class="p">[</span><span class="s1">&#39;continue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; individuals are out of picture scope and cannot be analyzed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_set_analyzed_individuals</span><span class="p">()</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>    <span class="k">return</span> <span class="n">analysis_status</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.extract_exif" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_exif</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract EXIF data from image or video files.</p>


<details class="note" open>
  <summary>Notes</summary>
  <p>If <code>extract_time_interval</code> is True and unsuccessful, arbitrary time steps will be used.
Timings are normalized to minutes for consistency across different files.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_exif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">    Extract EXIF data from image or video files.</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">    -----</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    If `extract_time_interval` is True and unsuccessful, arbitrary time steps will be used.</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">    Timings are normalized to minutes for consistency across different files.</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step_is_arbitrary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;im_or_vid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;dims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="n">timings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;dims&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="n">timings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">))</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>            <span class="n">pathway</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="n">pathway</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;extract_time_interval&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">:</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extract_time_interval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extract_time_interval&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>                <span class="n">timings</span> <span class="o">=</span> <span class="n">extract_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">,</span> <span class="n">pathway</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;raw_images&#39;</span><span class="p">])</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                <span class="n">timings</span> <span class="o">=</span> <span class="n">timings</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>                <span class="n">timings</span> <span class="o">=</span> <span class="n">timings</span> <span class="o">/</span> <span class="mi">60</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>                <span class="n">time_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">timings</span><span class="p">)</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time_step</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>                    <span class="n">time_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">time_step</span><span class="p">)</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>                    <span class="n">digit_nb</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_step</span><span class="p">):</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>                        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;.&#39;</span><span class="p">}:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                            <span class="k">pass</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                        <span class="k">elif</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;0&#39;</span><span class="p">}:</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                            <span class="n">digit_nb</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>                            <span class="k">break</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">time_step</span><span class="p">,</span> <span class="n">digit_nb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step_is_arbitrary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>            <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>                <span class="k">pass</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="n">timings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">])</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;time_step_is_arbitrary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>    <span class="k">return</span> <span class="n">timings</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.fast_first_image_segmentation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fast_first_image_segmentation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Segment the first or subsequent image in a series for biological and background masks.</p>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function processes the first or subsequent image in a sequence, applying biological and background masks,
segmenting the image, and updating internal data structures accordingly. The function is specific to handling
image sequences for biological analysis</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="k">def</span><span class="w"> </span><span class="nf">fast_first_image_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">    Segment the first or subsequent image in a series for biological and background masks.</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">    -----</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    This function processes the first or subsequent image in a sequence, applying biological and background masks,</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">    segmenting the image, and updating internal data structures accordingly. The function is specific to handling</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">    image sequences for biological analysis</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;color_number&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_variable_dict</span><span class="p">()</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s2">&quot;PCA&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)}</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">convert_and_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;color_number&quot;</span><span class="p">],</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>                                         <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;bio_mask&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;back_mask&quot;</span><span class="p">],</span> <span class="n">subtract_background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>                                         <span class="n">subtract_background2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>                                         <span class="n">rolling_window_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;rolling_window_segmentation&quot;</span><span class="p">],</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                                         <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;filter_spec&quot;</span><span class="p">])</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">drift_correction_already_adjusted</span><span class="p">:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">check_if_image_border_attest_drift_correction</span><span class="p">()</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cellects detected that the images have already been corrected for drift&quot;</span><span class="p">)</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">convert_and_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;color_number&quot;</span><span class="p">],</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>                                                 <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;bio_mask&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;back_mask&quot;</span><span class="p">],</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>                                                 <span class="n">subtract_background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subtract_background2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                                                 <span class="n">rolling_window_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;rolling_window_segmentation&quot;</span><span class="p">],</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                                                 <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;filter_spec&quot;</span><span class="p">],</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                                                 <span class="n">allowed_window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">)</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>    <span class="n">shapes_features</span> <span class="o">=</span> <span class="n">shape_selection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">binary_image</span><span class="p">,</span> <span class="n">true_shape_number</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span><span class="p">,</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                                      <span class="n">horizontal_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">starting_blob_hsize_in_pixels</span><span class="p">,</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>                                      <span class="n">spot_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;starting_blob_shape&#39;</span><span class="p">],</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>                                      <span class="n">several_blob_per_arena</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">],</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>                                      <span class="n">bio_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;bio_mask&quot;</span><span class="p">],</span> <span class="n">back_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&quot;back_mask&quot;</span><span class="p">])</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">,</span> <span class="n">shape_number</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centroids</span> <span class="o">=</span> <span class="n">shapes_features</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">=</span> <span class="n">shape_number</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;csc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;binary_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">greyscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="n">greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">greyscale</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="n">greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;converted_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">greyscale</span><span class="p">)</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;shape_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape_number</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.fast_last_image_segmentation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fast_last_image_segmentation</span><span class="p">(</span><span class="n">biomask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backmask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Segment the first or subsequent image in a series for biological and background masks.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>biomask</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The biological mask to be applied to the image.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>backmask</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The background mask to be applied to the image.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function processes the first or subsequent image in a sequence, applying biological and background masks,
segmenting the image, and updating internal data structures accordingly. The function is specific to handling
image sequences for biological analysis</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="k">def</span><span class="w"> </span><span class="nf">fast_last_image_segmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">biomask</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">backmask</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">    Segment the first or subsequent image in a series for biological and background masks.</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">    biomask : NDArray[np.uint8], optional</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">        The biological mask to be applied to the image.</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">    backmask : NDArray[np.uint8], optional</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">        The background mask to be applied to the image.</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="sd">    -------</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">    None</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">    -----</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">    This function processes the first or subsequent image in a sequence, applying biological and background masks,</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">    segmenting the image, and updating internal data structures accordingly. The function is specific to handling</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">    image sequences for biological analysis</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s2">&quot;PCA&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)}</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">(</span><span class="n">is_first_image</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">convert_and_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;color_number&quot;</span><span class="p">],</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                                        <span class="n">biomask</span><span class="p">,</span> <span class="n">backmask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background</span><span class="p">,</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background2</span><span class="p">,</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                                        <span class="n">rolling_window_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;rolling_window_segmentation&quot;</span><span class="p">],</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                                        <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;filter_spec&quot;</span><span class="p">])</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">drift_correction_already_adjusted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;rolling_window_segmentation&quot;</span><span class="p">][</span><span class="s1">&#39;do&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">check_if_image_border_attest_drift_correction</span><span class="p">()</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">convert_and_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;color_number&quot;</span><span class="p">],</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                                            <span class="n">biomask</span><span class="p">,</span> <span class="n">backmask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background</span><span class="p">,</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                                            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background2</span><span class="p">,</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                                            <span class="n">allowed_window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">drift_mask_coord</span><span class="p">,</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                                            <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;filter_spec&quot;</span><span class="p">])</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;csc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;binary_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">greyscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>        <span class="n">greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">greyscale</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>        <span class="n">greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">image</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;converted_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">greyscale</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.find_if_lighter_background" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_if_lighter_background</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determines whether the background is lighter or darker than the cells.</p>
<p>This function analyzes images to determine if their backgrounds are lighter
or darker relative to the cells, updating attributes accordingly for analysis and display purposes.</p>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function modifies instance variables and does not return any value.
The analysis involves comparing mean pixel values in specific areas of the image.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="k">def</span><span class="w"> </span><span class="nf">find_if_lighter_background</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="sd">    Determines whether the background is lighter or darker than the cells.</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="sd">    This function analyzes images to determine if their backgrounds are lighter</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="sd">    or darker relative to the cells, updating attributes accordingly for analysis and display purposes.</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="sd">    -----</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="sd">    This function modifies instance variables and does not return any value.</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">    The analysis involves comparing mean pixel values in specific areas of the image.</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Find if the background is lighter or darker than the cells&quot;</span><span class="p">)</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>    <span class="n">are_dicts_equal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>            <span class="n">are_dicts_equal</span> <span class="o">=</span> <span class="n">are_dicts_equal</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>            <span class="n">are_dicts_equal</span> <span class="o">=</span> <span class="n">are_dicts_equal</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s2">&quot;PCA&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)}</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>        <span class="n">are_dicts_equal</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>    <span class="k">if</span> <span class="n">are_dicts_equal</span><span class="p">:</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_first_image</span><span class="p">()</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fast_first_image_segmentation</span><span class="p">()</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cropping</span><span class="p">(</span><span class="n">is_first_image</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>        <span class="n">among</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">)</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>        <span class="n">not_among</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">)</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>        <span class="c1"># Use the converted image to tell if the background is lighter, for analysis purposes</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">among</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">not_among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">not_among</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>        <span class="c1"># Use the original image to tell if the background is lighter, for display purposes</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">[</span><span class="n">among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">among</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">[</span><span class="n">not_among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">not_among</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_last_image</span><span class="p">()</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>            <span class="c1"># self.cropping(is_first_image=False)</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fast_last_image_segmentation</span><span class="p">()</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fast_last_image_segmentation</span><span class="p">()</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>        <span class="n">among</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span><span class="p">)</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>        <span class="n">not_among</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">binary_image</span><span class="p">)</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>        <span class="c1"># Use the converted image to tell if the background is lighter, for analysis purposes</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">among</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">not_among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">not_among</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>        <span class="c1"># Use the original image to tell if the background is lighter, for display purposes</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">[</span><span class="n">among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">among</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">[</span><span class="n">not_among</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">not_among</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;invisible&quot;</span><span class="p">:</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>        <span class="n">binary_image</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">binary_image</span><span class="p">)</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">convert_and_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;color_number&quot;</span><span class="p">],</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>                                             <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">subtract_background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>                                             <span class="n">subtract_background2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>                                             <span class="n">rolling_window_segmentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;rolling_window_segmentation&#39;</span><span class="p">],</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                                             <span class="n">filter_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;filter_spec&quot;</span><span class="p">])</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>        <span class="n">covered_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">binary_image</span><span class="p">)]</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;luminosity_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">covered_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lighter_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covered_values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">:</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;luminosity_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">covered_values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covered_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;luminosity_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">covered_values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.get_average_pixel_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_average_pixel_size</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the average pixel size and related variables.</p>
<p>Logs information about calculation steps, computes the average
pixel size based on image or cell scaling settings,
and sets initial thresholds for object detection.</p>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>The average pixel size is determined by either image dimensions or blob sizes.</li>
<li>Thresholds for automatic detection are set based on configuration settings.</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_average_pixel_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">    Calculate the average pixel size and related variables.</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">    Logs information about calculation steps, computes the average</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">    pixel size based on image or cell scaling settings,</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">    and sets initial thresholds for object detection.</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">    -----</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">    - The average pixel size is determined by either image dimensions or blob sizes.</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">    - Thresholds for automatic detection are set based on configuration settings.</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Getting average pixel size&quot;</span><span class="p">)</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">,</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shapes</span><span class="p">,</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="n">centroids</span><span class="p">)</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">,</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>            <span class="n">connectivity</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;scale_with_image_or_cells&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;image_horizontal_size_in_mm&#39;</span><span class="p">]</span> <span class="o">/</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;starting_blob_hsize_in_mm&#39;</span><span class="p">]</span> <span class="o">/</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>            <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">2</span><span class="p">]))</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;set_spot_size&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starting_blob_hsize_in_pixels</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;starting_blob_hsize_in_mm&#39;</span><span class="p">]</span> <span class="o">/</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starting_blob_hsize_in_pixels</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;automatic_size_thresholding&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_move_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;first_move_threshold_in_mm&#39;</span><span class="p">]</span> <span class="o">/</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The average pixel size is: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;average_pixel_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.get_background_to_subtract" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_background_to_subtract</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine if background subtraction should be applied to the image.</p>


<details class="extended-description" open>
  <summary>Extended Description</summary>
  <p>This function checks whether background subtraction should be applied.
It utilizes the 'subtract_background' flag and potentially converts
the image for motion estimation.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>self</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The instance of the class containing this method.
Must have attributes <code>vars</code> and <code>first_image</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_background_to_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a><span class="sd">    Determine if background subtraction should be applied to the image.</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">    Extended Description</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a><span class="sd">    --------------------</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a><span class="sd">    This function checks whether background subtraction should be applied.</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">    It utilizes the &#39;subtract_background&#39; flag and potentially converts</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a><span class="sd">    the image for motion estimation.</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="sd">    self : object</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a><span class="sd">        The instance of the class containing this method.</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a><span class="sd">        Must have attributes `vars` and `first_image`.</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;subtract_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">generate_subtract_background</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;drift_already_corrected&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.get_bounding_boxes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_bounding_boxes</span><span class="p">(</span><span class="n">are_gravity_centers_moving</span><span class="p">,</span> <span class="n">motion_list</span><span class="o">=</span><span class="p">(),</span> <span class="n">all_specimens_have_same_direction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">original_shape_hsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the coordinates of arenas using bounding boxes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>are_gravity_centers_moving</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating whether gravity centers are moving or not.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>motion_list</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of motion information for the specimens.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_specimens_have_same_direction</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating whether all specimens have the same direction,
by default True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method uses various internal methods and variables to determine the bounding boxes.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_bounding_boxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">are_gravity_centers_moving</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">motion_list</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="p">(),</span> <span class="n">all_specimens_have_same_direction</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">original_shape_hsize</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the coordinates of arenas using bounding boxes.</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">    are_gravity_centers_moving : bool</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="sd">        Flag indicating whether gravity centers are moving or not.</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><span class="sd">    motion_list : list</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="sd">        List of motion information for the specimens.</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a><span class="sd">    all_specimens_have_same_direction : bool, optional</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="sd">        Flag indicating whether all specimens have the same direction,</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">        by default True.</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">    This method uses various internal methods and variables to determine the bounding boxes.</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>    <span class="c1"># 7) Create required empty arrays: especially the bounding box coordinates of each video</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">shapes_to_remove</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">get_crop_coordinates</span><span class="p">()</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Get the coordinates of all arenas using the get_bounding_boxes method of the VideoMaker class&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">,</span> <span class="n">ordered_centroids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">=</span> <span class="n">rank_from_top_to_bottom_from_left_to_right</span><span class="p">(</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">y_boundaries</span><span class="p">,</span> <span class="n">get_ordered_image</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unchanged_ordered_fimg</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="p">)</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">)</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">standard</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>        <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">standard</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">)</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">)</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>            <span class="k">if</span> <span class="n">are_gravity_centers_moving</span><span class="p">:</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">=</span> <span class="n">get_bb_with_moving_centers</span><span class="p">(</span><span class="n">motion_list</span><span class="p">,</span> <span class="n">all_specimens_have_same_direction</span><span class="p">,</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>                                                 <span class="n">original_shape_hsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span><span class="p">,</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>                                                 <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">y_boundaries</span><span class="p">)</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>                <span class="n">new_ordered_first_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>                    <span class="n">previous_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>                    <span class="n">previous_shape</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unchanged_ordered_fimg</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>                    <span class="n">new_potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>                    <span class="n">new_potentials</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>                    <span class="n">new_potentials</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unchanged_ordered_fimg</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                    <span class="n">pads</span> <span class="o">=</span> <span class="n">ProgressivelyAddDistantShapes</span><span class="p">(</span><span class="n">new_potentials</span><span class="p">,</span> <span class="n">previous_shape</span><span class="p">,</span> <span class="n">max_distance</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                    <span class="n">pads</span><span class="o">.</span><span class="n">consider_shapes_sizes</span><span class="p">(</span><span class="n">min_shape_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                    <span class="n">pads</span><span class="o">.</span><span class="n">connect_shapes</span><span class="p">(</span><span class="n">only_keep_connected_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rank_connecting_pixels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                    <span class="n">new_ordered_first_image</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">pads</span><span class="o">.</span><span class="n">expanded_shape</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">=</span> <span class="n">new_ordered_first_image</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">,</span> <span class="n">ordered_centroids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span> <span class="o">=</span> <span class="n">rank_from_top_to_bottom_from_left_to_right</span><span class="p">(</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">y_boundaries</span><span class="p">,</span> <span class="n">get_ordered_image</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">get_quick_bounding_boxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">)</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">get_quick_bounding_boxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_stats</span><span class="p">)</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_standardize_video_sizes</span><span class="p">()</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>        <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_first_image</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">unchanged_ordered_fimg</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">modif_validated_shapes</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes_to_remove</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.get_first_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_first_image</span><span class="p">(</span><span class="n">first_im</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_number</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load and process the first image or frame from a video.</p>
<p>This method handles loading the first image or the first frame of a video
depending on whether the data is an image or a video. It performs necessary
preprocessing and initializes relevant attributes for subsequent analysis.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_first_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_im</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_number</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    Load and process the first image or frame from a video.</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    This method handles loading the first image or the first frame of a video</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    depending on whether the data is an image or a video. It performs necessary</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    preprocessing and initializes relevant attributes for subsequent analysis.</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="k">if</span> <span class="n">first_im</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="n">first_im</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="k">if</span> <span class="n">sample_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="n">sample_number</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Load first image&quot;</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="n">just_read_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>        <span class="c1"># just_read_image = self.analysis_instance is not None</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;im_or_vid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">just_read_image</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">))</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                    <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">)),</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                     <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">)),</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                <span class="k">while</span> <span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>                    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="n">frame</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                        <span class="k">break</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>                <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                <span class="k">while</span> <span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>                    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>                <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;dims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;raw_images&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_raw_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="n">readim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;raw_images&#39;</span><span class="p">])</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;dims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]))</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>                <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">])):</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span><span class="p">:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;im_or_vid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span> <span class="o">=</span> <span class="n">OneImageAnalysis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">)</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;already_greyscale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">already_greyscale</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;already_greyscale&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;convert_for_origin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bgr&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">}</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;convert_for_motion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bgr&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">}</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="o">...</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="o">...</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">...</span><span class="p">])))</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;contour_color&#39;</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;first_detection_frame&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;invisible&#39;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.get_last_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_last_image</span><span class="p">(</span><span class="n">last_im</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load the last image from a video or image list and process it based on given parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>last_im</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The last image to be loaded. If not provided, the last image will be loaded from the data list.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_last_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_im</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">    Load the last image from a video or image list and process it based on given parameters.</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">    last_im : NDArray, optional</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">        The last image to be loaded. If not provided, the last image will be loaded from the data list.</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Load last image&quot;</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="k">if</span> <span class="n">last_im</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="o">=</span> <span class="n">last_im</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;im_or_vid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>            <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>            <span class="k">while</span> <span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>                <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span><span class="p">:</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>                    <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_instance</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="o">=</span> <span class="n">frame</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>            <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>            <span class="n">is_landscape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="o">=</span> <span class="n">read_and_rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;raw_images&#39;</span><span class="p">],</span> <span class="n">is_landscape</span><span class="p">)</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_image_dim</span><span class="p">:</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_im</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span> <span class="o">=</span> <span class="n">OneImageAnalysis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_im</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.get_origins_and_backgrounds_lists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_origins_and_backgrounds_lists</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create origins and background lists for image processing.</p>


<details class="extended-description" open>
  <summary>Extended Description</summary>
  <p>This method generates the origin and background lists by slicing the first image
and its background subtraction based on predefined boundaries. It handles cases where
the top, bottom, left, and right boundaries are not yet initialized.</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <p>This method directly modifies the input image data. The <code>self.vars</code> dictionary is populated
with lists of sliced arrays from the first image and its background.</p>
</details>

<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.get_origins_and_backgrounds_lists.self.vars">self.vars</span></code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary to store processed data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cellects.core.program_organizer.ProgramOrganizer.get_origins_and_backgrounds_lists.self.first_image">self.first_image</span></code></td>
            <td>
                  <code><span title="ImageObject">ImageObject</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first image object containing validated shapes and background subtraction arrays.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1217" name="__codelineno-0-1217"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_origins_and_backgrounds_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a><span class="sd">    Create origins and background lists for image processing.</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="sd">    Extended Description</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a><span class="sd">    --------------------</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">    This method generates the origin and background lists by slicing the first image</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a><span class="sd">    and its background subtraction based on predefined boundaries. It handles cases where</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="sd">    the top, bottom, left, and right boundaries are not yet initialized.</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">    This method directly modifies the input image data. The `self.vars` dictionary is populated</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a><span class="sd">    with lists of sliced arrays from the first image and its background.</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a><span class="sd">    self.vars : dict</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a><span class="sd">        Dictionary to store processed data.</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a><span class="sd">    self.first_image : ImageObject</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a><span class="sd">        The first image object containing validated shapes and background subtraction arrays.</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create origins and background lists&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">first_im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>    <span class="n">first_im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>    <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">])):</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;origin_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_im</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="n">rep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">rep</span><span class="p">]])</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;subtract_background&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>        <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">])):</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="n">rep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">rep</span><span class="p">]])</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">subtract_background2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>                                                     <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="n">rep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">rep</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">rep</span><span class="p">]])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.instantiate_tables" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">instantiate_tables</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update output list and prepare results tables and validation images.</p>


<details class="extended-description" open>
  <summary>Extended Description</summary>
  <p>This method performs necessary preparations for processing image sequences,
including updating the output list and initializing key attributes required
for subsequent operations.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1577" name="__codelineno-0-1577"></a><span class="k">def</span><span class="w"> </span><span class="nf">instantiate_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a><span class="sd">    Update output list and prepare results tables and validation images.</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a><span class="sd">    Extended Description</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a><span class="sd">    --------------------</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a><span class="sd">    This method performs necessary preparations for processing image sequences,</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a><span class="sd">    including updating the output list and initializing key attributes required</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a><span class="sd">    for subsequent operations.</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">update_output_list</span><span class="p">()</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Instantiate results tables and validation images&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">fractal_box_sizes</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;already_greyscale&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s2">&quot;convert_for_motion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bgr&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="s2">&quot;logical&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.load_data_to_run_cellects_quickly" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_data_to_run_cellects_quickly</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load data from a pickle file and update the current state of the object.</p>
<p>Summarizes, loads, and validates data needed to run Cellects,
updating the object's state accordingly. If the necessary data
are not present or valid, it ensures the experiment is marked as
not ready to run.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>self</code>
            </td>
            <td>
                  <code><span title="CellectsObject">CellectsObject</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The instance of the class (assumed to be a subclass of
CellectsObject) that this method belongs to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function relies on the presence of a pickle file 'Data to run Cellects quickly.pkl'.
It updates the state of various attributes based on the loaded data
and logs appropriate messages.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_data_to_run_cellects_quickly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">    Load data from a pickle file and update the current state of the object.</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">    Summarizes, loads, and validates data needed to run Cellects,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">    updating the object&#39;s state accordingly. If the necessary data</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">    are not present or valid, it ensures the experiment is marked as</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    not ready to run.</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">    self : CellectsObject</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        The instance of the class (assumed to be a subclass of</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        CellectsObject) that this method belongs to.</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">    -------</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">    None</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">    -----</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">    This function relies on the presence of a pickle file &#39;Data to run Cellects quickly.pkl&#39;.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    It updates the state of various attributes based on the loaded data</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">    and logs appropriate messages.</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="n">current_global_pathway</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="n">folder_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_number&#39;</span><span class="p">]</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="k">if</span> <span class="n">folder_number</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="n">folder_list</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">])</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="n">sample_number_per_folder</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">])</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">):</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">()</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="n">pickle_rick</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="k">if</span> <span class="n">data_to_run_cellects_quickly</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;validated_shapes&#39;</span> <span class="ow">in</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;coordinates&#39;</span> <span class="ow">in</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">):</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Success to load Data to run Cellects quickly.pkl from the user chosen directory&quot;</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="c1"># If you want to add a new variable, first run an updated version of all_vars_dict,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="c1"># then put a breakpoint here and run the following + self.save_data_to_run_cellects_quickly() :</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_variable_dict</span><span class="p">()</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="n">folder_changed</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="k">if</span> <span class="n">current_global_pathway</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                <span class="n">folder_changed</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                    <span class="s2">&quot;Although the folder is ready, it is not at the same place as it was during creation, updating&quot;</span><span class="p">)</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_global_pathway</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="k">if</span> <span class="n">folder_number</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_global_pathway</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">folder_list</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">folder_number</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_number_per_folder</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">look_for_data</span><span class="p">()</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                <span class="k">if</span> <span class="n">folder_changed</span> <span class="ow">and</span> <span class="n">folder_number</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">update_folder_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_first_image</span><span class="p">()</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_last_image</span><span class="p">()</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="p">(</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">)</span> <span class="o">=</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                <span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;automatically_crop&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">=</span> <span class="p">[</span><span class="n">ccy1</span><span class="p">,</span> <span class="n">ccy2</span><span class="p">,</span> <span class="n">ccx1</span><span class="p">,</span> <span class="n">ccx2</span><span class="p">]</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Crop first image&quot;</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">automatically_crop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Crop last image&quot;</span><span class="p">)</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">automatically_crop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span><span class="p">)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">crop_coord</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span> <span class="o">=</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;validated_shapes&#39;</span><span class="p">]</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;csc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_origin&#39;</span><span class="p">]</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;binary_image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">validated_shapes</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;shape_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;shape_number&#39;</span><span class="p">]</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;subtract_background&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;background_list&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_exp_ready_to_run</span><span class="p">:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The current (or the first) folder is ready to run&quot;</span><span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The current (or the first) folder is not ready to run&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.load_variable_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_variable_dict</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Loads configuration dictionaries from a pickle file if available, otherwise initializes defaults.</p>
<p>Tries to load saved parameters. If the file doesn't exist or loading fails due to corruption,
default values are used instead (logging relevant warnings).</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no valid configuration file is found and default initialization fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method ensures robust operation by handling missing or corrupted configuration files gracefully.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_variable_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    Loads configuration dictionaries from a pickle file if available, otherwise initializes defaults.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    Tries to load saved parameters. If the file doesn&#39;t exist or loading fails due to corruption,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    default values are used instead (logging relevant warnings).</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    ------</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    FileNotFoundError</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        If no valid configuration file is found and default initialization fails.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    -----</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    This method ensures robust operation by handling missing or corrupted configuration files gracefully.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ALL_VARS_PKL_FILE</span><span class="p">):</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Load the parameters from all_vars.pkl in the config of the Cellects folder&quot;</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ALL_VARS_PKL_FILE</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fileopen</span><span class="p">:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fileopen</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_variable_dict</span><span class="p">()</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Success to load the parameters dictionaries from the Cellects folder&quot;</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initialize default parameters because error: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="n">default_dicts</span> <span class="o">=</span> <span class="n">DefaultDicts</span><span class="p">()</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="n">default_dicts</span><span class="o">.</span><span class="n">all</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="n">default_dicts</span><span class="o">.</span><span class="n">vars</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialize default parameters&quot;</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="n">default_dicts</span> <span class="o">=</span> <span class="n">DefaultDicts</span><span class="p">()</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="n">default_dicts</span><span class="o">.</span><span class="n">all</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="n">default_dicts</span><span class="o">.</span><span class="n">vars</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;cores&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;cores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.look_for_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">look_for_data</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Discovers all relevant video/image data in the working directory.</p>
<p>Uses natural sorting to handle filenames with numeric suffixes. Validates file consistency and logs warnings
if filename patterns are inconsistent across folders.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no files match the specified naming convention.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method assumes all data files follow a predictable pattern with numeric extensions. Use caution in
unpredictable directory structures where this may fail silently or produce incorrect results.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">organizer</span><span class="o">.</span><span class="n">look_for_data</span><span class="p">()</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">organizer</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">[&#39;/path/to/video1.avi&#39;, &#39;/path/to/video2.avi&#39;]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="k">def</span><span class="w"> </span><span class="nf">look_for_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    Discovers all relevant video/image data in the working directory.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    Uses natural sorting to handle filenames with numeric suffixes. Validates file consistency and logs warnings</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    if filename patterns are inconsistent across folders.</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    ------</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        If no files match the specified naming convention.</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    -----</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    This method assumes all data files follow a predictable pattern with numeric extensions. Use caution in</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    unpredictable directory structures where this may fail silently or produce incorrect results.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    --------</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    &gt;&gt;&gt; organizer.look_for_data()</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    &gt;&gt;&gt; print(organizer.data_list)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    [&#39;/path/to/video1.avi&#39;, &#39;/path/to/video2.avi&#39;]</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]))</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dir: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="n">insensitive_glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;radical&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">])</span>  <span class="c1"># Provides a list ordered by last modification date</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sort_data_list</span><span class="p">()</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;first_folder_sample_number&#39;</span><span class="p">]</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                <span class="n">data_list</span> <span class="o">=</span> <span class="n">insensitive_glob</span><span class="p">(</span><span class="n">obj</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;radical&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">])</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_number&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_list&#39;</span><span class="p">])</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">],</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                                                          <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;folder_number&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.prepare_video_writing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_video_writing</span><span class="p">(</span><span class="n">img_list</span><span class="p">,</span> <span class="n">min_ram_free</span><span class="p">,</span> <span class="n">in_colors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pathway</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Prepare the raw video (.npy) writing process for Cellects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>img_list</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of images to be processed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_ram_free</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum amount of RAM in GB that should remain free.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>in_colors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the images are in color. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pathway</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the video files. Default is an empty string.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- bunch_nb: int, number of bunches needed for video writing.
- video_nb_per_bunch: int, number of videos per bunch.
- sizes: ndarray, dimensions of each video.
- video_bunch: list or ndarray, initialized video arrays.
- vid_names: list, names of the video files.
- rom_memory_required: None or float, required ROM memory.
- analysis_status: dict, status and message of the analysis process.
- remaining: int, remainder videos that do not fit in a complete bunch.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>The function calculates necessary memory and ensures 10% extra to avoid issues.</li>
<li>It checks for available RAM and adjusts the number of bunches accordingly.</li>
<li>If using color images, memory requirements are tripled.</li>
</ul>
<p>expected output depends on the provided images and RAM availability</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1324" name="__codelineno-0-1324"></a><span class="k">def</span><span class="w"> </span><span class="nf">prepare_video_writing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">min_ram_free</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">in_colors</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pathway</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a><span class="sd">    Prepare the raw video (.npy) writing process for Cellects.</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a><span class="sd">    img_list : list</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a><span class="sd">        List of images to be processed.</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a><span class="sd">    min_ram_free : float</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a><span class="sd">        Minimum amount of RAM in GB that should remain free.</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a><span class="sd">    in_colors : bool, optional</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a><span class="sd">        Whether the images are in color. Default is False.</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a><span class="sd">    pathway : str, optional</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a><span class="sd">        Path to save the video files. Default is an empty string.</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a><span class="sd">        A tuple containing:</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a><span class="sd">        - bunch_nb: int, number of bunches needed for video writing.</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a><span class="sd">        - video_nb_per_bunch: int, number of videos per bunch.</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a><span class="sd">        - sizes: ndarray, dimensions of each video.</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a><span class="sd">        - video_bunch: list or ndarray, initialized video arrays.</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a><span class="sd">        - vid_names: list, names of the video files.</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a><span class="sd">        - rom_memory_required: None or float, required ROM memory.</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a><span class="sd">        - analysis_status: dict, status and message of the analysis process.</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a><span class="sd">        - remaining: int, remainder videos that do not fit in a complete bunch.</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a><span class="sd">    - The function calculates necessary memory and ensures 10% extra to avoid issues.</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a><span class="sd">    - It checks for available RAM and adjusts the number of bunches accordingly.</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a><span class="sd">    - If using color images, memory requirements are tripled.</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a><span class="sd">    expected output depends on the provided images and RAM availability</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>    <span class="c1"># 1) Create a list of video names</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>        <span class="n">number_to_add</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span><span class="p">)</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>        <span class="n">number_to_add</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>    <span class="n">vid_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>    <span class="n">ind_i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>    <span class="k">while</span> <span class="n">ind_i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">+</span> <span class="n">number_to_add</span><span class="p">):</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>        <span class="n">ind_i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>        <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">not_analyzed_individuals</span><span class="p">,</span> <span class="n">ind_i</span><span class="p">)):</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>            <span class="n">ind_i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>        <span class="n">vid_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span> <span class="o">+</span> <span class="s2">&quot;ind_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind_i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.npy&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>    <span class="n">img_nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>    <span class="c1"># 2) Create a table of the dimensions of each video</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>    <span class="c1"># Add 10% to the necessary memory to avoid problems</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>    <span class="n">necessary_memory</span> <span class="o">=</span> <span class="n">img_nb</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="mf">1.16415e-10</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>    <span class="k">if</span> <span class="n">in_colors</span><span class="p">:</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>        <span class="n">sizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">img_nb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>             <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">)))</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>        <span class="n">necessary_memory</span> <span class="o">*=</span> <span class="mi">3</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>        <span class="n">sizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">img_nb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">))</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>    <span class="n">use_list_of_vid</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">sizes</span><span class="p">):</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>        <span class="n">use_list_of_vid</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>    <span class="n">available_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">available</span> <span class="o">&gt;&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-</span> <span class="n">min_ram_free</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>    <span class="k">if</span> <span class="n">available_memory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>        <span class="n">analysis_status</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;continue&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;There are not enough RAM available&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>        <span class="n">bunch_nb</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>        <span class="n">bunch_nb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">necessary_memory</span> <span class="o">/</span> <span class="n">available_memory</span><span class="p">))</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>        <span class="k">if</span> <span class="n">bunch_nb</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>            <span class="c1"># The program will need twice the memory to create the second bunch.</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>            <span class="n">bunch_nb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">necessary_memory</span> <span class="o">/</span> <span class="n">available_memory</span><span class="p">))</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>    <span class="n">video_nb_per_bunch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">/</span> <span class="n">bunch_nb</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>    <span class="n">analysis_status</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;continue&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>    <span class="n">video_bunch</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>        <span class="k">if</span> <span class="n">use_list_of_vid</span><span class="p">:</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>            <span class="n">video_bunch</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sizes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">video_nb_per_bunch</span><span class="p">)]</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>            <span class="n">video_bunch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">video_nb_per_bunch</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">v_err</span><span class="p">:</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>        <span class="n">analysis_status</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;continue&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Probably failed to detect the right cell(s) number, do the first image analysis manually.&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">analysis_status</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> error is: </span><span class="si">{</span><span class="n">v_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>    <span class="c1"># Check for available ROM memory</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">necessary_memory</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>        <span class="n">rom_memory_required</span> <span class="o">=</span> <span class="n">necessary_memory</span> <span class="o">+</span> <span class="mi">2</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>        <span class="n">rom_memory_required</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>    <span class="n">remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span> <span class="o">%</span> <span class="n">bunch_nb</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>    <span class="k">if</span> <span class="n">remaining</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>        <span class="n">bunch_nb</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>    <span class="n">is_landscape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cellects will start writing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">shape_number</span><span class="si">}</span><span class="s2"> videos. Given available memory, it will do it in </span><span class="si">{</span><span class="n">bunch_nb</span><span class="si">}</span><span class="s2"> time(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>    <span class="k">return</span> <span class="n">bunch_nb</span><span class="p">,</span> <span class="n">video_nb_per_bunch</span><span class="p">,</span> <span class="n">sizes</span><span class="p">,</span> <span class="n">video_bunch</span><span class="p">,</span> <span class="n">vid_names</span><span class="p">,</span> <span class="n">rom_memory_required</span><span class="p">,</span> <span class="n">analysis_status</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">use_list_of_vid</span><span class="p">,</span> <span class="n">is_landscape</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.save_data_to_run_cellects_quickly" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_data_to_run_cellects_quickly</span><span class="p">(</span><span class="n">new_one_if_does_not_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Save data to a pickled file if it does not exist or update existing data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>new_one_if_does_not_exist</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to create a new data file if it does not already exist.
Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method logs various information about its operations and handles the writing of data to a pickled file.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_data_to_run_cellects_quickly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_one_if_does_not_exist</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">    Save data to a pickled file if it does not exist or update existing data.</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">    new_one_if_does_not_exist : bool, optional</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">        Whether to create a new data file if it does not already exist.</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">        Default is True.</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    -----</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">    This method logs various information about its operations and handles the writing of data to a pickled file.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">):</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Update -Data to run Cellects quickly.pkl- in the user chosen directory&quot;</span><span class="p">)</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">()</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="n">pickle_rick</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>        <span class="k">if</span> <span class="n">data_to_run_cellects_quickly</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to load Data to run Cellects quickly.pkl before update. Remove pre existing.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="k">if</span> <span class="n">new_one_if_does_not_exist</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create Data to run Cellects quickly.pkl in the user chosen directory&quot;</span><span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="n">data_to_run_cellects_quickly</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>    <span class="k">if</span> <span class="n">data_to_run_cellects_quickly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_to_save</span><span class="p">[</span><span class="s1">&#39;first_image&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;validated_shapes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;binary_image&#39;</span><span class="p">]</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;shape_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">im_combinations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_combination_id</span><span class="p">][</span><span class="s1">&#39;shape_number&#39;</span><span class="p">]</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                <span class="c1"># data_to_run_cellects_quickly[&#39;converted_image&#39;] = self.first_image.im_combinations[self.current_combination_id][&#39;converted_image&#39;]</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_to_save</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_coordinates</span><span class="p">()</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;When they exist, do overwrite unaltered video&quot;</span><span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;overwrite_unaltered_videos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_to_save</span><span class="p">[</span><span class="s1">&#39;exif&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;exif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_exif</span><span class="p">()</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="n">data_to_run_cellects_quickly</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">()</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>        <span class="n">pickle_rick</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">data_to_run_cellects_quickly</span><span class="p">,</span> <span class="s1">&#39;Data to run Cellects quickly.pkl&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.save_tables" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_tables</span><span class="p">(</span><span class="n">with_last_image</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Exports analysis results to CSV files and saves visualization outputs.</p>
<p>Generates the following output:
- one_row_per_arena.csv, one_row_per_frame.csv : Tracking data per arena/frame.
- software_settings.csv : Full configuration settings for reproducibility.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="PermissionError">PermissionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If any output file is already open in an external program (logged and re-raised).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Ensure no exported CSV files are open while running this method to avoid permission errors. This
function will fail gracefully if the files cannot be overwritten.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1650" name="__codelineno-0-1650"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_last_image</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a><span class="sd">    Exports analysis results to CSV files and saves visualization outputs.</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a><span class="sd">    Generates the following output:</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a><span class="sd">    - one_row_per_arena.csv, one_row_per_frame.csv : Tracking data per arena/frame.</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a><span class="sd">    - software_settings.csv : Full configuration settings for reproducibility.</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a><span class="sd">    ------</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a><span class="sd">    PermissionError</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a><span class="sd">        If any output file is already open in an external program (logged and re-raised).</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a><span class="sd">    Ensure no exported CSV files are open while running this method to avoid permission errors. This</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a><span class="sd">    function will fail gracefully if the files cannot be overwritten.</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Save results tables and validation images&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;one_row_per_arena.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">message_from_thread</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Never let one_row_per_arena.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;one_row_per_frame.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let one_row_per_frame.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">message_from_thread</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Never let one_row_per_frame.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.JPG&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>        <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.PNG&#39;</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>        <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.JPG&#39;</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>    <span class="k">if</span> <span class="n">with_last_image</span><span class="p">:</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analysis efficiency, last image</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">)</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>        <span class="sa">f</span><span class="s2">&quot;Analysis efficiency, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span><span class="si">}</span><span class="s2">th image</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_image</span><span class="o">.</span><span class="n">bgr</span><span class="p">)</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>    <span class="n">software_settings</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">)</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">,</span> <span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">,</span> <span class="s1">&#39;exif&#39;</span><span class="p">,</span> <span class="s1">&#39;dims&#39;</span><span class="p">,</span> <span class="s1">&#39;origin_list&#39;</span><span class="p">,</span> <span class="s1">&#39;background_list&#39;</span><span class="p">,</span> <span class="s1">&#39;background_list2&#39;</span><span class="p">,</span> <span class="s1">&#39;descriptors&#39;</span><span class="p">,</span> <span class="s1">&#39;folder_list&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>        <span class="n">software_settings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>    <span class="n">global_settings</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">,</span> <span class="s1">&#39;night_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;expert_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;is_auto&#39;</span><span class="p">,</span> <span class="s1">&#39;arena&#39;</span><span class="p">,</span> <span class="s1">&#39;video_option&#39;</span><span class="p">,</span> <span class="s1">&#39;compute_all_options&#39;</span><span class="p">,</span> <span class="s1">&#39;vars&#39;</span><span class="p">,</span> <span class="s1">&#39;dims&#39;</span><span class="p">,</span> <span class="s1">&#39;origin_list&#39;</span><span class="p">,</span> <span class="s1">&#39;background_list&#39;</span><span class="p">,</span> <span class="s1">&#39;background_list2&#39;</span><span class="p">,</span> <span class="s1">&#39;descriptors&#39;</span><span class="p">,</span> <span class="s1">&#39;folder_list&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_number_per_folder&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>        <span class="n">global_settings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>    <span class="n">software_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">global_settings</span><span class="p">)</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>    <span class="n">software_settings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">software_settings</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Setting&quot;</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>        <span class="n">software_settings</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;software_settings.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>    <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Never let software_settings.csv open when Cellects runs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">message_from_thread</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Never let software_settings.csv open when Cellects runs&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.save_variable_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_variable_dict</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Saves the configuration dictionaries (<code>self.all</code> and <code>self.vars</code>) to a pickle file.</p>
<p>If bio_mask or back_mask are not required for all folders, they are excluded from the saved data.</p>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method is used to preserve state between Cellects sessions or restart scenarios.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_variable_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    Saves the configuration dictionaries (`self.all` and `self.vars`) to a pickle file.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    If bio_mask or back_mask are not required for all folders, they are excluded from the saved data.</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    -----</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    This method is used to preserve state between Cellects sessions or restart scenarios.</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Save the parameters dictionaries in the Cellects folder&quot;</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="n">all_vars</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;keep_cell_and_back_for_all_folders&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="n">all_vars</span><span class="p">[</span><span class="s1">&#39;bio_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">all_vars</span><span class="p">[</span><span class="s1">&#39;back_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="n">pickle_rick</span> <span class="o">=</span> <span class="n">PickleRick</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="n">pickle_rick</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">all_vars</span><span class="p">,</span> <span class="n">ALL_VARS_PKL_FILE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.update_available_core_nb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_available_core_nb</span><span class="p">(</span><span class="n">image_bit_number</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">video_bit_number</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update available computation resources based on memory and processing constraints.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_bit_number</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bits per image pixel (default is 256).</p>
              </div>
            </td>
            <td>
                  <code>256</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>video_bit_number</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bits per video frame pixel (default is 140).</p>
              </div>
            </td>
            <td>
                  <code>140</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Other Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lose_accuracy_to_save_memory</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to reduce accuracy for memory savings.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>convert_for_motion</code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Conversion settings for motion analysis.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>already_greyscale</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating if the image is already greyscale.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>save_coord_thickening_slimming</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to save coordinates for thickening and slimming.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>oscilacyto_analysis</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating if oscilacyto analysis is enabled.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>save_coord_network</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to save coordinates for network analysis.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rounded absolute difference between available memory and necessary memory in GB.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Performance considerations and limitations should be noted here if applicable.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1456" name="__codelineno-0-1456"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_available_core_nb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_bit_number</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">video_bit_number</span><span class="o">=</span><span class="mi">140</span><span class="p">):</span><span class="c1"># video_bit_number=176</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a><span class="sd">    Update available computation resources based on memory and processing constraints.</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a><span class="sd">    image_bit_number : int, optional</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a><span class="sd">        Number of bits per image pixel (default is 256).</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a><span class="sd">    video_bit_number : int, optional</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a><span class="sd">        Number of bits per video frame pixel (default is 140).</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a><span class="sd">    Other Parameters</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a><span class="sd">    ----------------</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a><span class="sd">    lose_accuracy_to_save_memory : bool</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a><span class="sd">        Flag to reduce accuracy for memory savings.</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a><span class="sd">    convert_for_motion : dict</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a><span class="sd">        Conversion settings for motion analysis.</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a><span class="sd">    already_greyscale : bool</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a><span class="sd">        Flag indicating if the image is already greyscale.</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a><span class="sd">    save_coord_thickening_slimming : bool</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a><span class="sd">        Flag to save coordinates for thickening and slimming.</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a><span class="sd">    oscilacyto_analysis : bool</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a><span class="sd">        Flag indicating if oscilacyto analysis is enabled.</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a><span class="sd">    save_coord_network : bool</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a><span class="sd">        Flag to save coordinates for network analysis.</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a><span class="sd">    float</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a><span class="sd">        Rounded absolute difference between available memory and necessary memory in GB.</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a><span class="sd">    Performance considerations and limitations should be noted here if applicable.</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>        <span class="n">video_bit_number</span> <span class="o">-=</span> <span class="mi">56</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;convert_for_motion&#39;</span><span class="p">][</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>        <span class="n">video_bit_number</span> <span class="o">+=</span> <span class="mi">64</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;lose_accuracy_to_save_memory&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>            <span class="n">video_bit_number</span> <span class="o">-=</span> <span class="mi">56</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;already_greyscale&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>        <span class="n">video_bit_number</span> <span class="o">-=</span> <span class="mi">64</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_thickening_slimming&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;oscilacyto_analysis&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>        <span class="n">video_bit_number</span> <span class="o">+=</span> <span class="mi">16</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>        <span class="n">image_bit_number</span> <span class="o">+=</span> <span class="mi">128</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;save_coord_network&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>        <span class="n">video_bit_number</span> <span class="o">+=</span> <span class="mi">8</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>        <span class="n">image_bit_number</span> <span class="o">+=</span> <span class="mi">64</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>        <span class="n">one_image_memory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>        <span class="n">one_image_memory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">),</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>    <span class="n">one_video_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">one_image_memory</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>    <span class="n">necessary_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">one_image_memory</span> <span class="o">*</span> <span class="n">image_bit_number</span> <span class="o">+</span> <span class="n">one_video_memory</span> <span class="o">*</span> <span class="n">video_bit_number</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.16415e-10</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>    <span class="n">available_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">available</span> <span class="o">&gt;&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;min_ram_free&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>    <span class="n">max_repeat_in_memory</span> <span class="o">=</span> <span class="p">(</span><span class="n">available_memory</span> <span class="o">//</span> <span class="n">necessary_memory</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>    <span class="k">if</span> <span class="n">max_repeat_in_memory</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>        <span class="n">max_repeat_in_memory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(((</span><span class="n">available_memory</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">necessary_memory</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;cores&#39;</span><span class="p">],</span> <span class="n">max_repeat_in_memory</span><span class="p">))</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cores</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span><span class="p">:</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">available_memory</span> <span class="o">-</span> <span class="n">necessary_memory</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.update_folder_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_folder_id</span><span class="p">(</span><span class="n">sample_number</span><span class="p">,</span> <span class="n">folder_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the current working directory and data list based on the given sample number
and optional folder name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sample_number</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of samples to analyze.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>folder_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the folder to change to. Default is an empty string.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function changes the current working directory to the specified folder name
and updates the data list based on the file names in that directory. It also performs
sorting of the data list and checks for strong variations in file names.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_folder_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">folder_name</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    Update the current working directory and data list based on the given sample number</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    and optional folder name.</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    sample_number : int</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        The number of samples to analyze.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">    folder_name : str, optional</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        The name of the folder to change to. Default is an empty string.</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    -----</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">    This function changes the current working directory to the specified folder name</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">    and updates the data list based on the file names in that directory. It also performs</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">    sorting of the data list and checks for strong variations in file names.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;global_pathway&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">folder_name</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="n">insensitive_glob</span><span class="p">(</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;radical&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">])</span>  <span class="c1"># Provides a list ordered by last modification date</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="c1"># Sorting is necessary when some modifications (like rotation) modified the last modification date</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_sort_data_list</span><span class="p">()</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;im_or_vid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="n">sample_number</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sample_number</span> <span class="o">=</span> <span class="n">sample_number</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;analyzed_individuals&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_analyzed_individuals</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.update_one_row_per_arena" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_one_row_per_arena</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">table_to_add</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update one row of the dataframe per arena.</p>
<p>Add a row to a DataFrame for each arena, based on the provided table_to_add. If no previous rows exist,
initialize a new DataFrame with zeros.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>i</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the arena to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>table_to_add</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing values to add. Keys are column names, values are the data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1527" name="__codelineno-0-1527"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_one_row_per_arena</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">table_to_add</span><span class="p">):</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a><span class="sd">    Update one row of the dataframe per arena.</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a><span class="sd">    Add a row to a DataFrame for each arena, based on the provided table_to_add. If no previous rows exist,</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a><span class="sd">    initialize a new DataFrame with zeros.</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a><span class="sd">    i : int</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a><span class="sd">        Index of the arena to update.</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a><span class="sd">    table_to_add : dict</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a><span class="sd">        Dictionary containing values to add. Keys are column names, values are the data.</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_to_add</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>                                        <span class="n">columns</span><span class="o">=</span><span class="n">table_to_add</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_arena</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">table_to_add</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.update_one_row_per_frame" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_one_row_per_frame</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">table_to_add</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update a range of rows in <code>self.one_row_per_frame</code> DataFrame with values from
<code>table_to_add</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>i</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The starting row index to update in <code>self.one_row_per_frame</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>j</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ending row index (exclusive) to update in <code>self.one_row_per_frame</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>table_to_add</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary where keys are column labels and values are lists or arrays of
data to insert into <code>self.one_row_per_frame</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Ensures that one row per arena is being updated. If <code>self.one_row_per_frame</code> is
None, it initializes a DataFrame to hold the data.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1549" name="__codelineno-0-1549"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_one_row_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">table_to_add</span><span class="p">):</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a><span class="sd">    Update a range of rows in `self.one_row_per_frame` DataFrame with values from</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a><span class="sd">    `table_to_add`.</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a><span class="sd">    i : int</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a><span class="sd">        The starting row index to update in `self.one_row_per_frame`.</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a><span class="sd">    j : int</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a><span class="sd">        The ending row index (exclusive) to update in `self.one_row_per_frame`.</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a><span class="sd">    table_to_add : dict</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a><span class="sd">        A dictionary where keys are column labels and values are lists or arrays of</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a><span class="sd">        data to insert into `self.one_row_per_frame`.</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a><span class="sd">    Ensures that one row per arena is being updated. If `self.one_row_per_frame` is</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a><span class="sd">    None, it initializes a DataFrame to hold the data.</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;several_blob_per_arena&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;analyzed_individuals&#39;</span><span class="p">])</span> <span class="o">*</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;img_number&#39;</span><span class="p">]),</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>                                        <span class="n">columns</span><span class="o">=</span><span class="n">table_to_add</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">one_row_per_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">table_to_add</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.update_output_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_output_list</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the output list with various descriptors from the analysis results.</p>
<p>This method processes different types of descriptors and assigns them to
the <code>self.vars['descriptors']</code> dictionary. It handles special cases for
descriptors related to 'xy' dimensions and ensures that all relevant metrics
are stored in the output list.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1426" name="__codelineno-0-1426"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_output_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a><span class="sd">    Update the output list with various descriptors from the analysis results.</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a><span class="sd">    This method processes different types of descriptors and assigns them to</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a><span class="sd">    the `self.vars[&#39;descriptors&#39;]` dictionary. It handles special cases for</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a><span class="sd">    descriptors related to &#39;xy&#39; dimensions and ensures that all relevant metrics</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a><span class="sd">    are stored in the output list.</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>    <span class="k">for</span> <span class="n">descriptor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>        <span class="k">if</span> <span class="n">descriptor</span> <span class="o">==</span> <span class="s1">&#39;standard_deviation_xy&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;standard_deviation_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;standard_deviation_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>        <span class="k">elif</span> <span class="n">descriptor</span> <span class="o">==</span> <span class="s1">&#39;skewness_xy&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;skewness_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;skewness_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>        <span class="k">elif</span> <span class="n">descriptor</span> <span class="o">==</span> <span class="s1">&#39;kurtosis_xy&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;kurtosis_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;kurtosis_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>        <span class="k">elif</span> <span class="n">descriptor</span> <span class="o">==</span> <span class="s1">&#39;major_axes_len_and_angle&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;major_axis_len&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;minor_axis_len&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;axes_orientation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">from_shape_descriptors_class</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">descriptor</span><span class="p">]</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="s1">&#39;newly_explored_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;do_fading&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cellects.core.program_organizer.ProgramOrganizer.update_variable_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_variable_dict</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the <code>all</code> and <code>vars</code> dictionaries with new data from <code>DefaultDicts</code>.</p>
<p>This method updates the <code>all</code> and <code>vars</code> dictionaries of the current object with
data from a new instance of <code>DefaultDicts</code>. It checks if any keys or descriptors
are missing and adds them accordingly.</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">organizer</span> <span class="o">=</span> <span class="n">ProgramOrganizer</span><span class="p">()</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">organizer</span><span class="o">.</span><span class="n">update_variable_dict</span><span class="p">()</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/core/program_organizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_variable_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    Update the `all` and `vars` dictionaries with new data from `DefaultDicts`.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    This method updates the `all` and `vars` dictionaries of the current object with</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    data from a new instance of `DefaultDicts`. It checks if any keys or descriptors</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    are missing and adds them accordingly.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    --------</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    &gt;&gt;&gt; organizer = ProgramOrganizer()</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    &gt;&gt;&gt; organizer.update_variable_dict()</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">dd</span> <span class="o">=</span> <span class="n">DefaultDicts</span><span class="p">()</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="nb">all</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">all</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="nb">vars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">vars</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">all_desc</span> <span class="o">=</span> <span class="ow">not</span> <span class="s1">&#39;descriptors&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">])</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">vars_desc</span> <span class="o">=</span> <span class="ow">not</span> <span class="s1">&#39;descriptors&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">])</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">if</span> <span class="nb">vars</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="k">if</span> <span class="n">all_desc</span><span class="p">:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="k">if</span> <span class="n">vars_desc</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;descriptors&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_set_analyzed_individuals</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.instant", "navigation.tabs", "navigation.sections", "navigation.top", "toc.integrate", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>