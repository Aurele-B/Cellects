
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../cell_leaving_detection/">
      
      
        <link rel="next" href="../morphological_operations/">
      
      
        
      
      
      <link rel="icon" href="../../../../static/icon-128.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>image_segmentation - Cellects Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../static/extra.css">
    
      <link rel="stylesheet" href="../../../../static/notebooks.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cellectsimage_analysisimage_segmentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Cellects Documentation" class="md-header__button md-logo" aria-label="Cellects Documentation" data-md-component="logo">
      
  <img src="../../../../static/icon-256.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cellects Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              image_segmentation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Aurele-B/Cellects" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../getting-started/" class="md-tabs__link">
          
  
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../first-analysis/" class="md-tabs__link">
          
  
  
  User guide

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../use-cases/" class="md-tabs__link">
        
  
  
    
  
  Use cases

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../license/" class="md-tabs__link">
        
  
  
    
  
  License & Citation

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Cellects Documentation" class="md-nav__button md-logo" aria-label="Cellects Documentation" data-md-component="logo">
      
  <img src="../../../../static/icon-256.png" alt="logo">

    </a>
    Cellects Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Aurele-B/Cellects" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../what-is-cellects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is Cellects?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Setting up a first analysis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Setting up a first analysis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/data-localisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data localisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/image-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../first-analysis/video-tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Video tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Improving the analysis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Improving the analysis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced parameters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/outputs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Required outputs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced/multiple-folders/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multiple folders
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../use-cases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use cases
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    cellects
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    cellects
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../core/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    core
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_1" id="__nav_5_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/cellects_paths/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cellects_paths
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/cellects_threads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cellects_threads
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/motion_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    motion_analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/one_image_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    one_image_analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/program_organizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    program_organizer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/script_based_run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    script_based_run
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../gui/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    gui
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_2" id="__nav_5_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    gui
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/advanced_parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    advanced_parameters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/cellects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cellects
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/custom_widgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    custom_widgets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/first_window/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    first_window
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/if_several_folders_window/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    if_several_folders_window
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/image_analysis_window/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    image_analysis_window
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/required_output/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    required_output
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/ui_strings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ui_strings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/video_analysis_window/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    video_analysis_window
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    image_analysis
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_3" id="__nav_5_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    image_analysis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cell_leaving_detection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cell_leaving_detection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    image_segmentation
  

    
  </span>
  
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../morphological_operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    morphological_operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../network_functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    network_functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../one_image_analysis_threads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    one_image_analysis_threads
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../oscillations_functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    oscillations_functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../progressively_add_distant_shapes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    progressively_add_distant_shapes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shape_descriptors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    shape_descriptors
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    utils
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_4" id="__nav_5_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    utils
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/decorators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    decorators
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/formulas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    formulas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/load_display_save/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    load_display_save
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/utilitarian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    utilitarian
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License & Citation
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="cellectsimage_analysisimage_segmentation"><code>cellects.image_analysis.image_segmentation</code></h1>


<div class="doc doc-object doc-module">



<h1 id="cellects.image_analysis.image_segmentation" class="doc doc-heading">
            <code>cellects.image_analysis.image_segmentation</code>


</h1>

    <div class="doc doc-contents first">

        <p>Module for image segmentation operations including filtering, color space conversion, thresholding, and quality assessment.</p>
<p>This module provides tools to process images through grayscale conversion, apply various filters (e.g., Gaussian, Median, Butterworth), perform thresholding methods like Otsu's algorithm, combine color spaces for enhanced segmentation, and evaluate binary image quality. Key functionalities include dynamic background subtraction, rolling window segmentation with localized thresholds, and optimization of segmentation masks using shape descriptors.</p>
<p>Functions
apply_filter : Apply skimage or OpenCV-based filters to grayscale images.
get_color_spaces : Convert BGR images into specified color space representations (e.g., LAB, HSV).
combine_color_spaces : Merge multiple color channels with coefficients to produce a segmented image.
generate_color_space_combination : Create custom grayscale combinations using two sets of channel weights and backgrounds.
otsu_thresholding : Binarize an image using histogram-based Otsu thresholding.
segment_with_lum_value : Segment video frames using luminance thresholds adjusted for background variation.
rolling_window_segmentation : Apply localized Otsu thresholding across overlapping patches to improve segmentation accuracy.
binary_quality_index : Calculate a quality metric based on perimeter and connected components in binary images.
find_threshold_given_mask : Binary search optimization to determine optimal threshold between masked regions.</p>
<p>Notes
Uses Numba's @njit decorator for JIT compilation of performance-critical functions like combine_color_spaces and _get_counts_jit.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.apply_filter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_filter</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">rescale_to_uint8</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Apply various filters to an image based on the specified filter type.</p>
<p>This function applies a filter to the input image according to the
specified <code>filter_type</code> and associated parameters. Supported filters
include Gaussian, Median, Butterworth, Frangi, Sato, Meijering,
Hessian, Laplace, Mexican hat, Farid, Prewitt, Roberts, Scharr, and Sobel.
Except from Sharpen and Mexican hat, these filters are implemented using the skimage.filters module.
Additionally, the function can rescale the output image to uint8
format if specified.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input image to which the filter will be applied.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of filter to apply. Supported values include:
"Gaussian", "Median", "Butterworth", "Frangi",
"Sato", "Meijering", "Hessian", "Laplace", "Mexican hat",
"Sharpen", "Farid", "Prewitt", "Roberts", "Scharr", and "Sobel".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>param</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters specific to the filter type. The structure of <code>param</code>
depends on the chosen filter.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rescale_to_uint8</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to rescale the output image to uint8 format. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The Sharpen filter is implemented through:
cv2.filter2D(image, -1, np.array([[-1, -1, -1], [-1, 9, -1], [-1, -1, -1]]))
The Maxican hat filter is implemented through:
cv2.filter2D(image, -1, np.array(
        [[0, 0, -1, 0, 0], [0, -1, -2, -1, 0], [-1, -2, 16, -2, -1], [0, -1, -2, -1, 0], [0, 0, -1, 0, 0]]))
All other filters are skimage filters.</p>
</details>

    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filtered image. If <code>rescale_to_uint8</code> is True and the output
image's dtype is not uint8, it will be rescaled accordingly.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_image</span> <span class="o">=</span> <span class="n">apply_filter</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">])</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">[[0.05855018 0.09653293 0.05855018]</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go"> [0.09653293 0.15915589 0.09653293]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go"> [0.05855018 0.09653293 0.05855018]]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">Filtered image with Gaussian filter.</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_image</span> <span class="o">=</span> <span class="n">apply_filter</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;Median&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">[[0. 0. 0.]</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go"> [0. 0. 0.]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go"> [0. 0. 0.]]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">Filtered image with Median filter.</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_image</span> <span class="o">=</span> <span class="n">apply_filter</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;Butterworth&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">[[-0.1111111  -0.11111111 -0.1111111 ]</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">[-0.11111111  0.88888886 -0.11111111]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go">[-0.1111111  -0.11111111 -0.1111111 ]]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">Filtered image with Butterworth filter.</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_filter</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">rescale_to_uint8</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Apply various filters to an image based on the specified filter type.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    This function applies a filter to the input image according to the</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    specified `filter_type` and associated parameters. Supported filters</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    include Gaussian, Median, Butterworth, Frangi, Sato, Meijering,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    Hessian, Laplace, Mexican hat, Farid, Prewitt, Roberts, Scharr, and Sobel.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    Except from Sharpen and Mexican hat, these filters are implemented using the skimage.filters module.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    Additionally, the function can rescale the output image to uint8</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    format if specified.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    image : NDArray</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        The input image to which the filter will be applied.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    filter_type : str</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        The type of filter to apply. Supported values include:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        &quot;Gaussian&quot;, &quot;Median&quot;, &quot;Butterworth&quot;, &quot;Frangi&quot;,</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        &quot;Sato&quot;, &quot;Meijering&quot;, &quot;Hessian&quot;, &quot;Laplace&quot;, &quot;Mexican hat&quot;,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        &quot;Sharpen&quot;, &quot;Farid&quot;, &quot;Prewitt&quot;, &quot;Roberts&quot;, &quot;Scharr&quot;, and &quot;Sobel&quot;.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    param : list or tuple</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Parameters specific to the filter type. The structure of `param`</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        depends on the chosen filter.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    rescale_to_uint8 : bool, optional</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Whether to rescale the output image to uint8 format. Default is False.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    -----</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    The Sharpen filter is implemented through:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    cv2.filter2D(image, -1, np.array([[-1, -1, -1], [-1, 9, -1], [-1, -1, -1]]))</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    The Maxican hat filter is implemented through:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    cv2.filter2D(image, -1, np.array(</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            [[0, 0, -1, 0, 0], [0, -1, -2, -1, 0], [-1, -2, 16, -2, -1], [0, -1, -2, -1, 0], [0, 0, -1, 0, 0]]))</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    All other filters are skimage filters.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    -------</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    NDArray</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        The filtered image. If `rescale_to_uint8` is True and the output</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        image&#39;s dtype is not uint8, it will be rescaled accordingly.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    --------</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    &gt;&gt;&gt; image = np.zeros((3, 3))</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    &gt;&gt;&gt; image[1, 1] = 1</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    &gt;&gt;&gt; filtered_image = apply_filter(image, &quot;Gaussian&quot;, [1.0])</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    &gt;&gt;&gt; print(filtered_image)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    [[0.05855018 0.09653293 0.05855018]</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">     [0.09653293 0.15915589 0.09653293]</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">     [0.05855018 0.09653293 0.05855018]]</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    Filtered image with Gaussian filter.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    &gt;&gt;&gt; image = np.zeros((3, 3))</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    &gt;&gt;&gt; image[1, 1] = 1</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    &gt;&gt;&gt; filtered_image = apply_filter(image, &quot;Median&quot;, [])</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    &gt;&gt;&gt; print(filtered_image)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    [[0. 0. 0.]</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">     [0. 0. 0.]</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">     [0. 0. 0.]]</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Filtered image with Median filter.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    &gt;&gt;&gt; image = np.zeros((3, 3))</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    &gt;&gt;&gt; image[1, 1] = 1</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    &gt;&gt;&gt; filtered_image = apply_filter(image, &quot;Butterworth&quot;, [0.005, 2])</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    &gt;&gt;&gt; print(filtered_image)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    [[-0.1111111  -0.11111111 -0.1111111 ]</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    [-0.11111111  0.88888886 -0.11111111]</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    [-0.1111111  -0.11111111 -0.1111111 ]]</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    Filtered image with Butterworth filter.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">if</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Median&quot;</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Butterworth&quot;</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">butterworth</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cutoff_frequency_ratio</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Frangi&quot;</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">frangi</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Sato&quot;</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">sato</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Meijering&quot;</span><span class="p">:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">meijering</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Hessian&quot;</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">hessian</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Laplace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">laplace</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">ksize</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])))))</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Sharpen&quot;</span><span class="p">:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">filter2D</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]))</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Mexican hat&quot;</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">filter2D</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]))</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Farid&quot;</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">farid</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Prewitt&quot;</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">prewitt</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Roberts&quot;</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">roberts</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Scharr&quot;</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">scharr</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="k">elif</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">&quot;Sobel&quot;</span><span class="p">:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">sobel</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="k">if</span> <span class="n">rescale_to_uint8</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.binary_quality_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">binary_quality_index</span><span class="p">(</span><span class="n">binary_img</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the binary quality index for a binary image.</p>
<p>The binary quality index is computed based on the perimeter of the largest
connected component in the binary image, normalized by the total number of
pixels.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>binary_img</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input binary image array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The binary quality index value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-799" name="__codelineno-0-799"></a><span class="k">def</span><span class="w"> </span><span class="nf">binary_quality_index</span><span class="p">(</span><span class="n">binary_img</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="sd">    Calculate the binary quality index for a binary image.</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="sd">    The binary quality index is computed based on the perimeter of the largest</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">    connected component in the binary image, normalized by the total number of</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">    pixels.</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">    binary_img : ndarray of uint8</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">        Input binary image array.</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a><span class="sd">    -------</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="sd">    out : float</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a><span class="sd">        The binary quality index value.</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">binary_img</span><span class="p">):</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>        <span class="c1"># SD = ShapeDescriptors(binary_img, [&quot;euler_number&quot;])</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>        <span class="c1"># index = - SD.descriptors[&#39;euler_number&#39;]</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>        <span class="n">size</span><span class="p">,</span> <span class="n">largest_cc</span> <span class="o">=</span> <span class="n">get_largest_connected_component</span><span class="p">(</span><span class="n">binary_img</span><span class="p">)</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">perimeter</span><span class="p">(</span><span class="n">largest_cc</span><span class="p">))</span> <span class="o">/</span> <span class="n">binary_img</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>        <span class="c1"># index = (largest_cc.sum() * perimeter(largest_cc)) / binary_img.sum()</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>        <span class="n">index</span> <span class="o">=</span> <span class="mf">0.</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>    <span class="k">return</span> <span class="n">index</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.combine_color_spaces" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">combine_color_spaces</span><span class="p">(</span><span class="n">c_space_dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">subtract_background</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Combine color spaces from a dictionary and generate an analyzable image.</p>
<p>This function processes multiple color spaces defined in <code>c_space_dict</code>, combines
them according to given coefficients, and produces a normalized image that can be
converted to uint8. Optionally subtracts background from the resultant image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>c_space_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing color spaces and their respective coefficients.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_c_spaces</code>
            </td>
            <td>
                  <code><span title="numba.typed.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of all available color spaces in the image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subtract_background</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Background image to subtract from the resultant image. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processed and normalized image in float64 format, ready for uint8 conversion.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">c_space_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">c_space_dict</span><span class="p">[</span><span class="s1">&#39;hsv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">all_c_spaces</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">all_c_spaces</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">all_c_spaces</span><span class="p">[</span><span class="s1">&#39;hsv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">combine_color_spaces</span><span class="p">(</span><span class="n">c_space_dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go">(5, 5)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="k">def</span><span class="w"> </span><span class="nf">combine_color_spaces</span><span class="p">(</span><span class="n">c_space_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">subtract_background</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    Combine color spaces from a dictionary and generate an analyzable image.</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    This function processes multiple color spaces defined in `c_space_dict`, combines</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    them according to given coefficients, and produces a normalized image that can be</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    converted to uint8. Optionally subtracts background from the resultant image.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    c_space_dict : dict</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        Dictionary containing color spaces and their respective coefficients.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    all_c_spaces : Dict</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        Dictionary of all available color spaces in the image.</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    subtract_background : NDArray, optional</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">        Background image to subtract from the resultant image. Defaults to None.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    -------</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    out : NDArray</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        Processed and normalized image in float64 format, ready for uint8 conversion.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    --------</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    &gt;&gt;&gt; c_space_dict = Dict()</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    &gt;&gt;&gt; c_space_dict[&#39;hsv&#39;] = [0, 1, 1]</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    &gt;&gt;&gt; all_c_spaces = Dict()</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    &gt;&gt;&gt; all_c_spaces[&#39;bgr&#39;] = list(np.random.rand(5, 5, 3))</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">    &gt;&gt;&gt; all_c_spaces[&#39;hsv&#39;] = list(np.random.rand(5, 5, 3))</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    &gt;&gt;&gt; background = np.zeros((5, 5))</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">    &gt;&gt;&gt; result = combine_color_spaces(c_space_dict, all_c_spaces)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    &gt;&gt;&gt; print(result.shape)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    (5, 5)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">all_c_spaces</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">all_c_spaces</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="k">for</span> <span class="n">space</span><span class="p">,</span> <span class="n">channels</span> <span class="ow">in</span> <span class="n">c_space_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">image</span> <span class="o">+=</span> <span class="n">c_space_dict</span><span class="p">[</span><span class="n">space</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">all_c_spaces</span><span class="p">[</span><span class="n">space</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_space_dict</span><span class="p">[</span><span class="n">space</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> \
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                 <span class="n">all_c_spaces</span><span class="p">[</span><span class="n">space</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">c_space_dict</span><span class="p">[</span><span class="n">space</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">all_c_spaces</span><span class="p">[</span><span class="n">space</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="k">if</span> <span class="n">subtract_background</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="c1"># add (resp. subtract) the most negative (resp. smallest) value to the whole matrix to get a min = 0</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">image</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="c1"># Make analysable this image by bracketing its values between 0 and 255 and converting it to uint8</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">max_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="k">if</span> <span class="n">max_im</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="n">image</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">subtract_background</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="n">image</span> <span class="o">-=</span> <span class="n">subtract_background</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">subtract_background</span> <span class="o">-</span> <span class="n">image</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="c1"># add (resp. subtract) the most negative (resp. smallest) value to the whole matrix to get a min = 0</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="n">image</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="c1"># Make analysable this image by bracketing its values between 0 and 255</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">max_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="k">if</span> <span class="n">max_im</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="n">image</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span> <span class="o">/</span> <span class="n">max_im</span><span class="p">)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.convert_subtract_and_filter_video" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_subtract_and_filter_video</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="n">color_space_combination</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lose_accuracy_to_save_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filter_spec</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert a video to grayscale, subtract the background, and apply filters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>video</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input video as a 4D NumPy array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>color_space_combination</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the combinations of color space transformations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>background</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first background image for subtraction. If <code>None</code>, no subtraction is performed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>background2</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The second background image for subtraction. If <code>None</code>, no subtraction is performed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lose_accuracy_to_save_memory</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to reduce accuracy and save memory by using <code>uint8</code> instead of <code>float64</code>.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter_spec</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the specifications for filters to apply.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.typing.NDArray">NDArray</span>, <span title="numpy.typing.NDArray">NDArray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- <code>converted_video</code>: The converted grayscale video.
- <code>converted_video2</code>: The second converted grayscale video if logical operation is not 'None'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <div class="highlight"><pre><span></span><code>- The function reduces accuracy of the converted video when `lose_accuracy_to_save_memory` is set to True.
- If `color_space_combination[&#39;logical&#39;]` is not &#39;None&#39;, a second converted video will be created.
- This function uses the `generate_color_space_combination` and `apply_filter` functions internally.
</code></pre></div>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="k">def</span><span class="w"> </span><span class="nf">convert_subtract_and_filter_video</span><span class="p">(</span><span class="n">video</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">color_space_combination</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">background</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>                                      <span class="n">background2</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lose_accuracy_to_save_memory</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>                                      <span class="n">filter_spec</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><span class="sd">    Convert a video to grayscale, subtract the background, and apply filters.</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><span class="sd">    video : NDArray</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="sd">        The input video as a 4D NumPy array.</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="sd">    color_space_combination : dict</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><span class="sd">        A dictionary containing the combinations of color space transformations.</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="sd">    background : NDArray, optional</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><span class="sd">        The first background image for subtraction. If `None`, no subtraction is performed.</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><span class="sd">    background2 : NDArray, optional</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><span class="sd">        The second background image for subtraction. If `None`, no subtraction is performed.</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a><span class="sd">    lose_accuracy_to_save_memory : bool</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a><span class="sd">        Flag to reduce accuracy and save memory by using `uint8` instead of `float64`.</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a><span class="sd">    filter_spec : dict</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><span class="sd">        A dictionary containing the specifications for filters to apply.</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a><span class="sd">    Tuple[NDArray, NDArray]</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a><span class="sd">        A tuple containing:</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a><span class="sd">        - `converted_video`: The converted grayscale video.</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a><span class="sd">        - `converted_video2`: The second converted grayscale video if logical operation is not &#39;None&#39;.</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="sd">        - The function reduces accuracy of the converted video when `lose_accuracy_to_save_memory` is set to True.</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">        - If `color_space_combination[&#39;logical&#39;]` is not &#39;None&#39;, a second converted video will be created.</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="sd">        - This function uses the `generate_color_space_combination` and `apply_filter` functions internally.</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>    <span class="n">converted_video2</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>        <span class="n">converted_video</span> <span class="o">=</span> <span class="n">video</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>        <span class="k">if</span> <span class="n">lose_accuracy_to_save_memory</span><span class="p">:</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>            <span class="n">array_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>            <span class="n">array_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>        <span class="n">first_dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="p">,</span> <span class="n">c_spaces</span> <span class="o">=</span> <span class="n">split_dict</span><span class="p">(</span><span class="n">color_space_combination</span><span class="p">)</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>        <span class="k">if</span> <span class="s1">&#39;PCA&#39;</span> <span class="ow">in</span> <span class="n">first_dict</span><span class="p">:</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>            <span class="n">greyscale_image</span><span class="p">,</span> <span class="n">var_ratio</span><span class="p">,</span> <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="n">extract_first_pc</span><span class="p">(</span><span class="n">video</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>            <span class="n">first_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>            <span class="n">first_dict</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">first_pc_vector</span><span class="p">))</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>            <span class="n">c_spaces</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>        <span class="k">if</span> <span class="s1">&#39;PCA&#39;</span> <span class="ow">in</span> <span class="n">second_dict</span><span class="p">:</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>            <span class="n">greyscale_image</span><span class="p">,</span> <span class="n">var_ratio</span><span class="p">,</span> <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="n">extract_first_pc</span><span class="p">(</span><span class="n">video</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>            <span class="n">second_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>            <span class="n">second_dict</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">first_pc_vector</span><span class="p">))</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>            <span class="n">c_spaces</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>        <span class="n">converted_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">array_type</span><span class="p">)</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>        <span class="k">if</span> <span class="n">color_space_combination</span><span class="p">[</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>            <span class="n">converted_video2</span> <span class="o">=</span> <span class="n">converted_video</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>        <span class="k">for</span> <span class="n">im_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>            <span class="k">if</span> <span class="n">im_i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">background</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>                <span class="c1"># when doing background subtraction, the first and the second image are equal</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>                <span class="n">image_i</span> <span class="o">=</span> <span class="n">video</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>                <span class="n">image_i</span> <span class="o">=</span> <span class="n">video</span><span class="p">[</span><span class="n">im_i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">generate_color_space_combination</span><span class="p">(</span><span class="n">image_i</span><span class="p">,</span> <span class="n">c_spaces</span><span class="p">,</span> <span class="n">first_dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>                                                       <span class="n">background2</span><span class="p">,</span> <span class="n">lose_accuracy_to_save_memory</span><span class="p">)</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>            <span class="n">greyscale_image</span><span class="p">,</span> <span class="n">greyscale_image2</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="n">results</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>            <span class="k">if</span> <span class="n">filter_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">filter_spec</span><span class="p">[</span><span class="s1">&#39;filter1_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>                <span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">apply_filter</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">filter_spec</span><span class="p">[</span><span class="s1">&#39;filter1_type&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>                                               <span class="n">filter_spec</span><span class="p">[</span><span class="s1">&#39;filter1_param&#39;</span><span class="p">],</span><span class="n">lose_accuracy_to_save_memory</span><span class="p">)</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>                <span class="k">if</span> <span class="n">greyscale_image2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">filter_spec</span><span class="p">[</span><span class="s1">&#39;filter2_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>                    <span class="n">greyscale_image2</span> <span class="o">=</span> <span class="n">apply_filter</span><span class="p">(</span><span class="n">greyscale_image2</span><span class="p">,</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>                                                    <span class="n">filter_spec</span><span class="p">[</span><span class="s1">&#39;filter2_type&#39;</span><span class="p">],</span> <span class="n">filter_spec</span><span class="p">[</span><span class="s1">&#39;filter2_param&#39;</span><span class="p">],</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>                                                    <span class="n">lose_accuracy_to_save_memory</span><span class="p">)</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>            <span class="n">converted_video</span><span class="p">[</span><span class="n">im_i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">greyscale_image</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>            <span class="k">if</span> <span class="n">color_space_combination</span><span class="p">[</span><span class="s1">&#39;logical&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>                <span class="n">converted_video2</span><span class="p">[</span><span class="n">im_i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">greyscale_image2</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>    <span class="k">return</span> <span class="n">converted_video</span><span class="p">,</span> <span class="n">converted_video2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.extract_first_pc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_first_pc</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract the first principal component from a BGR image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bgr_image</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 3D or 2D array representing the BGR image. Expected shape is either
(height, width, 3) or (3, height, width).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>standardize</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, standardizes the image pixel values by subtracting the mean and
dividing by the standard deviation before computing the principal
components. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first principal component image, reshaped to the original image height and width.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The explained variance ratio of the first principal component.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first principal component vector.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The principal component analysis (PCA) is performed using Singular Value Decomposition (SVD).
Standardization helps in scenarios where the pixel values have different scales.
Pixels with zero standard deviation are handled by setting their standardization
denominator to 1.0 to avoid division by zero.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">bgr_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># Example BGR image</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">first_pc_image</span><span class="p">,</span> <span class="n">explained_variance_ratio</span><span class="p">,</span> <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="n">extract_first_pc</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">first_pc_image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">(100, 200)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">0.339</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">first_pc_vector</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">(3,)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_first_pc</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">standardize</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">    Extract the first principal component from a BGR image.</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="sd">    bgr_image : numpy.ndarray</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="sd">        A 3D or 2D array representing the BGR image. Expected shape is either</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">        (height, width, 3) or (3, height, width).</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">    standardize : bool, optional</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">        If True, standardizes the image pixel values by subtracting the mean and</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="sd">        dividing by the standard deviation before computing the principal</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">        components. Default is True.</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">    -------</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">    numpy.ndarray</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">        The first principal component image, reshaped to the original image height and width.</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">    float</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="sd">        The explained variance ratio of the first principal component.</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">    numpy.ndarray</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a><span class="sd">        The first principal component vector.</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a><span class="sd">    -----</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="sd">    The principal component analysis (PCA) is performed using Singular Value Decomposition (SVD).</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">    Standardization helps in scenarios where the pixel values have different scales.</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a><span class="sd">    Pixels with zero standard deviation are handled by setting their standardization</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">    denominator to 1.0 to avoid division by zero.</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">    --------</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="sd">    &gt;&gt;&gt; bgr_image = np.random.rand(100, 200, 3)  # Example BGR image</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">    &gt;&gt;&gt; first_pc_image, explained_variance_ratio, first_pc_vector = extract_first_pc(bgr_image)</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">    &gt;&gt;&gt; print(first_pc_image.shape)</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="sd">    (100, 200)</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="sd">    &gt;&gt;&gt; print(explained_variance_ratio)</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">    0.339</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="sd">    &gt;&gt;&gt; print(first_pc_vector.shape)</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">    (3,)</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>    <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">bgr_image</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>    <span class="n">pixels</span> <span class="o">=</span> <span class="n">bgr_image</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>  <span class="c1"># Flatten to Nx3 matrix</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>    <span class="k">if</span> <span class="n">standardize</span><span class="p">:</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pixels</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">pixels</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span class="n">std</span><span class="p">[</span><span class="n">std</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Avoid division by zero</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="n">pixels_scaled</span> <span class="o">=</span> <span class="p">(</span><span class="n">pixels</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>        <span class="n">pixels_scaled</span> <span class="o">=</span> <span class="n">pixels</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>    <span class="c1"># Perform SVD on standardized data to get principal components</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>    <span class="n">U</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">Vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">pixels_scaled</span><span class="p">,</span> <span class="n">full_matrices</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>    <span class="c1"># First PC is the projection of each pixel onto first right singular vector (Vt[0])</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>    <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="n">Vt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Shape: (3,)</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>    <span class="n">eigen</span> <span class="o">=</span> <span class="n">d</span> <span class="o">**</span> <span class="mi">2</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>    <span class="n">total_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eigen</span><span class="p">)</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>    <span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">eigen</span><span class="p">)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>    <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">eigen</span><span class="p">,</span> <span class="n">total_variance</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">explained_variance_ratio</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">total_variance</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>    <span class="c1"># Compute first principal component scores</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>    <span class="n">first_pc_scores</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>    <span class="c1"># Reshape to image shape and threshold negative values</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>    <span class="n">first_pc_image</span> <span class="o">=</span> <span class="n">first_pc_scores</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>    <span class="c1"># first_pc_thresholded = np.maximum(first_pc_image, 0)</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>    <span class="k">return</span> <span class="n">first_pc_image</span><span class="p">,</span> <span class="n">explained_variance_ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">first_pc_vector</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.find_threshold_given_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_threshold_given_mask</span><span class="p">(</span><span class="n">greyscale</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">min_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find the optimal threshold value for a greyscale image given a mask.</p>
<p>This function performs a binary search to find the optimal threshold
that maximizes the separation between two regions defined by the mask.
The search is bounded by a minimum threshold value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>greyscale</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The greyscale image array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The binary mask array where positive values define region A and zero values define region B.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_threshold</code>
            </td>
            <td>
                  <code><span title="uint8">uint8</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum threshold value for the search. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="uint8">uint8</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optimal threshold value found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">greyscale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">54</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">20</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">find_threshold_given_mask</span><span class="p">(</span><span class="n">greyscale</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">54</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="k">def</span><span class="w"> </span><span class="nf">find_threshold_given_mask</span><span class="p">(</span><span class="n">greyscale</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">min_threshold</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a><span class="sd">    Find the optimal threshold value for a greyscale image given a mask.</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a><span class="sd">    This function performs a binary search to find the optimal threshold</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="sd">    that maximizes the separation between two regions defined by the mask.</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a><span class="sd">    The search is bounded by a minimum threshold value.</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a><span class="sd">    greyscale : ndarray of uint8</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a><span class="sd">        The greyscale image array.</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="sd">    mask : ndarray of uint8</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="sd">        The binary mask array where positive values define region A and zero values define region B.</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="sd">    min_threshold : uint8, optional</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a><span class="sd">        The minimum threshold value for the search. Defaults to 0.</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="sd">    -------</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">    out : uint8</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">        The optimal threshold value found.</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">    --------</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">    &gt;&gt;&gt; greyscale = np.array([[255, 128, 54], [0, 64, 20]], dtype=np.uint8)</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">    &gt;&gt;&gt; mask = np.array([[1, 1, 0], [0, 0, 0]], dtype=np.uint8)</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">    &gt;&gt;&gt; find_threshold_given_mask(greyscale, mask)</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="sd">    54</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>    <span class="n">region_a</span> <span class="o">=</span> <span class="n">greyscale</span><span class="p">[</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">region_a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>    <span class="n">region_b</span> <span class="o">=</span> <span class="n">greyscale</span><span class="p">[</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">region_b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>        <span class="k">return</span> <span class="n">min_threshold</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>        <span class="n">low</span> <span class="o">=</span> <span class="n">min_threshold</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>        <span class="n">high</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>        <span class="n">best_thresh</span> <span class="o">=</span> <span class="n">low</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>        <span class="k">while</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">low</span> <span class="o">&lt;=</span> <span class="n">high</span><span class="p">:</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>            <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>            <span class="n">count_a</span><span class="p">,</span> <span class="n">count_b</span> <span class="o">=</span> <span class="n">_get_counts_jit</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">region_a</span><span class="p">,</span> <span class="n">region_b</span><span class="p">)</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>            <span class="k">if</span> <span class="n">count_a</span> <span class="o">&gt;</span> <span class="n">count_b</span><span class="p">:</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>                <span class="c1"># Try to find a lower threshold that still satisfies the condition</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>                <span class="n">best_thresh</span> <span class="o">=</span> <span class="n">mid</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>                <span class="n">high</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>                <span class="k">if</span> <span class="n">count_a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">count_b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>                    <span class="n">best_thresh</span> <span class="o">=</span> <span class="n">greyscale</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>                    <span class="k">break</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                <span class="c1"># Need higher threshold</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                <span class="n">low</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>    <span class="k">return</span> <span class="n">best_thresh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.generate_color_space_combination" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_color_space_combination</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">c_spaces</span><span class="p">,</span> <span class="n">first_dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="o">=</span><span class="n">Dict</span><span class="p">(),</span> <span class="n">background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">convert_to_uint8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="o">=</span><span class="p">{})</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate color space combinations for an input image.</p>
<p>This function generates a grayscale image by combining multiple color spaces
from an input BGR image and provided dictionaries. Optionally, it can also generate
a second grayscale image using another dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bgr_image</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input image in BGR color space.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>c_spaces</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of color spaces to consider for combination.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>first_dict</code>
            </td>
            <td>
                  <code><span title="numba.typed.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing color space and transformation details for the first grayscale image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>second_dict</code>
            </td>
            <td>
                  <code><span title="numba.typed.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing color space and transformation details for the second grayscale image.</p>
              </div>
            </td>
            <td>
                  <code><span title="numba.typed.Dict">Dict</span>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>background</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Background image to be used. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>background2</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second background image to be used for the second grayscale image. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_uint8</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating whether to convert the output images to uint8. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>tuple of ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the first and second grayscale images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">bgr_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">c_spaces</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">,</span> <span class="s1">&#39;hsv&#39;</span><span class="p">]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">first_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">first_dict</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">second_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">second_dict</span><span class="p">[</span><span class="s1">&#39;hsv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">greyscale_image1</span><span class="p">,</span> <span class="n">greyscale_image2</span> <span class="o">=</span> <span class="n">generate_color_space_combination</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">c_spaces</span><span class="p">,</span> <span class="n">first_dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">greyscale_image1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go">(100, 100)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_color_space_combination</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">c_spaces</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">first_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">second_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="o">=</span><span class="n">Dict</span><span class="p">(),</span> <span class="n">background</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background2</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">convert_to_uint8</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    Generate color space combinations for an input image.</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">    This function generates a grayscale image by combining multiple color spaces</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    from an input BGR image and provided dictionaries. Optionally, it can also generate</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">    a second grayscale image using another dictionary.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    bgr_image : ndarray of uint8</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        The input image in BGR color space.</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    c_spaces : list</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        List of color spaces to consider for combination.</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    first_dict : Dict</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        Dictionary containing color space and transformation details for the first grayscale image.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">    second_dict : Dict, optional</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        Dictionary containing color space and transformation details for the second grayscale image.</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">    background : ndarray, optional</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        Background image to be used. Default is None.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    background2 : ndarray, optional</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        Second background image to be used for the second grayscale image. Default is None.</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">    convert_to_uint8 : bool, optional</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        Flag indicating whether to convert the output images to uint8. Default is False.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">    -------</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    out : tuple of ndarray of uint8</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        A tuple containing the first and second grayscale images.</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    --------</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">    &gt;&gt;&gt; bgr_image = np.random.randint(0, 256, (100, 100, 3), dtype=np.uint8)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">    &gt;&gt;&gt; c_spaces = [&#39;bgr&#39;, &#39;hsv&#39;]</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    &gt;&gt;&gt; first_dict = Dict()</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    &gt;&gt;&gt; first_dict[&#39;bgr&#39;] = [0, 1, 1]</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    &gt;&gt;&gt; second_dict = Dict()</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    &gt;&gt;&gt; second_dict[&#39;hsv&#39;] = [0, 0, 1]</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    &gt;&gt;&gt; greyscale_image1, greyscale_image2 = generate_color_space_combination(bgr_image, c_spaces, first_dict, second_dict)</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    &gt;&gt;&gt; print(greyscale_image1.shape)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    (100, 100)</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="n">greyscale_image2</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="k">if</span> <span class="s2">&quot;PCA&quot;</span> <span class="ow">in</span> <span class="n">c_spaces</span><span class="p">:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">greyscale_image</span><span class="p">,</span> <span class="n">var_ratio</span><span class="p">,</span> <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="n">extract_first_pc</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="n">first_pc_vector</span> <span class="o">=</span> <span class="n">first_pc_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_c_spaces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="n">all_c_spaces</span> <span class="o">=</span> <span class="n">get_color_spaces</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">c_spaces</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">combine_color_spaces</span><span class="p">(</span><span class="n">first_dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="n">first_dict</span> <span class="o">=</span> <span class="n">translate_dict</span><span class="p">(</span><span class="n">first_dict</span><span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">combine_color_spaces</span><span class="p">(</span><span class="n">first_dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">second_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="n">greyscale_image2</span> <span class="o">=</span> <span class="n">combine_color_spaces</span><span class="p">(</span><span class="n">second_dict</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">background2</span><span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="k">if</span> <span class="n">convert_to_uint8</span><span class="p">:</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="k">if</span> <span class="n">greyscale_image2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">second_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="n">greyscale_image2</span> <span class="o">=</span> <span class="n">bracket_to_uint8_image_contrast</span><span class="p">(</span><span class="n">greyscale_image2</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="k">return</span> <span class="n">greyscale_image</span><span class="p">,</span> <span class="n">greyscale_image2</span><span class="p">,</span> <span class="n">all_c_spaces</span><span class="p">,</span> <span class="n">first_pc_vector</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.get_color_spaces" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_color_spaces</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">space_names</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert a BGR image into various color spaces.</p>
<p>Converts the input BGR image to specified color spaces and returns them
as a dictionary. If no space names are provided, converts to all default
color spaces (LAB, HSV, LUV, HLS, YUV). If 'logical' is in the space names,
it will be removed before conversion.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bgr_image</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input image in BGR color space.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>space_names</code>
            </td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of color spaces to convert the image to. Defaults to none.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with keys as color space names and values as the converted images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">bgr_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">c_spaces</span> <span class="o">=</span> <span class="n">get_color_spaces</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;lab&#39;</span><span class="p">,</span> <span class="s1">&#39;hsv&#39;</span><span class="p">])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">c_spaces</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">[&#39;bgr&#39;, &#39;lab&#39;, &#39;hsv&#39;]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_color_spaces</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">space_names</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    Convert a BGR image into various color spaces.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    Converts the input BGR image to specified color spaces and returns them</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    as a dictionary. If no space names are provided, converts to all default</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    color spaces (LAB, HSV, LUV, HLS, YUV). If &#39;logical&#39; is in the space names,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    it will be removed before conversion.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    bgr_image : ndarray of uint8</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">        Input image in BGR color space.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    space_names : list of str, optional</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        List of color spaces to convert the image to. Defaults to none.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    -------</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    out : dict</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Dictionary with keys as color space names and values as the converted images.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    --------</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    &gt;&gt;&gt; bgr_image = np.zeros((5, 5, 3), dtype=np.uint8)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    &gt;&gt;&gt; c_spaces = get_color_spaces(bgr_image, [&#39;lab&#39;, &#39;hsv&#39;])</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    &gt;&gt;&gt; print(list(c_spaces.keys()))</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    [&#39;bgr&#39;, &#39;lab&#39;, &#39;hsv&#39;]</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">if</span> <span class="s1">&#39;logical&#39;</span> <span class="ow">in</span> <span class="n">space_names</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">space_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">space_names</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;logical&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="n">c_spaces</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;bgr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bgr_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">space_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;lab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2LAB</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;hsv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;luv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2LUV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;hls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HLS</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;yuv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2YUV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s1">&#39;lab&#39;</span><span class="p">,</span> <span class="n">space_names</span><span class="p">):</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;lab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2LAB</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s1">&#39;hsv&#39;</span><span class="p">,</span> <span class="n">space_names</span><span class="p">):</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;hsv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s1">&#39;luv&#39;</span><span class="p">,</span> <span class="n">space_names</span><span class="p">):</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;luv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2LUV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s1">&#39;hls&#39;</span><span class="p">,</span> <span class="n">space_names</span><span class="p">):</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;hls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HLS</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s1">&#39;yuv&#39;</span><span class="p">,</span> <span class="n">space_names</span><span class="p">):</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="n">c_spaces</span><span class="p">[</span><span class="s1">&#39;yuv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2YUV</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">return</span> <span class="n">c_spaces</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.get_otsu_threshold" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_otsu_threshold</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the optimal threshold value for an image using Otsu's method.</p>
<p>This function computes the Otsu's thresholding which automatically
performs histogram shape analysis for threshold selection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input grayscale image, represented as a NumPy array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The computed Otsu's threshold value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_otsu_threshold</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">):</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    Calculate the optimal threshold value for an image using Otsu&#39;s method.</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">    This function computes the Otsu&#39;s thresholding which automatically</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    performs histogram shape analysis for threshold selection.</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">    image : NDArray</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">        The input grayscale image, represented as a NumPy array.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">    -------</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">    int or float</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">        The computed Otsu&#39;s threshold value.</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>    <span class="c1"># Set total number of bins in the histogram</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="n">bins_num</span> <span class="o">=</span> <span class="mi">256</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="c1"># Get the image histogram</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="n">hist</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins_num</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="c1"># Calculate centers of bins</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="n">bin_mids</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mf">2.</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="c1"># Iterate over all thresholds (indices) and get the probabilities w1(t), w2(t)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="n">weight1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="n">weight2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">hist</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="c1"># Get the class means mu0(t)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="k">if</span> <span class="n">weight1</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="n">mean1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">hist</span> <span class="o">*</span> <span class="n">bin_mids</span><span class="p">)</span> <span class="o">/</span> <span class="n">weight1</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="n">mean1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">bin_mids</span><span class="p">)</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="c1"># Get the class means mu1(t)</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="k">if</span> <span class="n">weight2</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">mean2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">((</span><span class="n">hist</span> <span class="o">*</span> <span class="n">bin_mids</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">weight2</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="n">mean2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">bin_mids</span><span class="p">)</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="n">inter_class_variance</span> <span class="o">=</span> <span class="n">weight1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">weight2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean2</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">**</span> <span class="mi">2</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="c1"># Maximize the inter_class_variance function val</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="n">index_of_max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">inter_class_variance</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="n">threshold</span> <span class="o">=</span> <span class="n">bin_mids</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">index_of_max_val</span><span class="p">]</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="k">return</span> <span class="n">threshold</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.kmeans" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">kmeans</span><span class="p">(</span><span class="n">greyscale</span><span class="p">,</span> <span class="n">greyscale2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kmeans_clust_nb</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bio_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">back_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logical</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">bio_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bio_label2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">previous_binary_image</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Perform K-means clustering on a greyscale image to generate binary images.</p>


<details class="extended-description" open>
  <summary>Extended Description</summary>
  <p>This function applies the K-means algorithm to a greyscale image or pair of images to segment them into binary images. It supports optional masks and previous segmentation labels for refining the clustering.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>greyscale</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input greyscale image to segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>greyscale2</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A second greyscale image for logical operations. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kmeans_clust_nb</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of clusters for K-means. Default is <code>2</code>.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bio_mask</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mask for selecting biological objects. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>back_mask</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mask for selecting background regions. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logical</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logical operation flag to enable processing of the second image. Default is <code>'None'</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;None&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bio_label</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Label for biological objects in the first segmentation. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bio_label2</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Label for biological objects in the second segmentation. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>previous_binary_image</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.uint8">uint8</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Previous binary image for refinement. Default is <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Other Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>**greyscale2</code></td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>logical</code></td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>bio_label2</code></td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- <code>binary_image</code>: Binary image derived from the first input.
- <code>binary_image2</code>: Binary image for the second input if processed, else <code>None</code>.
- <code>new_bio_label</code>: New biological label for the first segmentation.
- <code>new_bio_label2</code>: New biological label for the second segmentation, if applicable.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>The function performs K-means clustering with random centers.</li>
<li>If <code>logical</code> is not <code>'None'</code>, both images are processed.</li>
<li>Default clustering uses 2 clusters, modify <code>kmeans_clust_nb</code> for different needs.</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="k">def</span><span class="w"> </span><span class="nf">kmeans</span><span class="p">(</span><span class="n">greyscale</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">greyscale2</span><span class="p">:</span> <span class="n">NDArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kmeans_clust_nb</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>           <span class="n">bio_mask</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">back_mask</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logical</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>           <span class="n">bio_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bio_label2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">previous_binary_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">    Perform K-means clustering on a greyscale image to generate binary images.</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">    Extended Description</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    --------------------</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">    This function applies the K-means algorithm to a greyscale image or pair of images to segment them into binary images. It supports optional masks and previous segmentation labels for refining the clustering.</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">    greyscale : NDArray</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">        The input greyscale image to segment.</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">    greyscale2 : NDArray, optional</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">        A second greyscale image for logical operations. Default is `None`.</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">    kmeans_clust_nb : int, optional</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">        Number of clusters for K-means. Default is `2`.</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">    bio_mask : NDArray[np.uint8], optional</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">        Mask for selecting biological objects. Default is `None`.</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">    back_mask : NDArray[np.uint8], optional</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">        Mask for selecting background regions. Default is `None`.</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">    logical : str, optional</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">        Logical operation flag to enable processing of the second image. Default is `&#39;None&#39;`.</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">    bio_label : int, optional</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">        Label for biological objects in the first segmentation. Default is `None`.</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">    bio_label2 : int, optional</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">        Label for biological objects in the second segmentation. Default is `None`.</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">    previous_binary_image : NDArray[np.uint8], optional</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">        Previous binary image for refinement. Default is `None`.</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">    Other Parameters</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">    ----------------</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    **greyscale2, logical, bio_label2**: Optional parameters for processing a second image with logical operations.</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    -------</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">        A tuple containing:</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        - `binary_image`: Binary image derived from the first input.</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">        - `binary_image2`: Binary image for the second input if processed, else `None`.</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">        - `new_bio_label`: New biological label for the first segmentation.</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">        - `new_bio_label2`: New biological label for the second segmentation, if applicable.</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">    -----</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    - The function performs K-means clustering with random centers.</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">    - If `logical` is not `&#39;None&#39;`, both images are processed.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">    - Default clustering uses 2 clusters, modify `kmeans_clust_nb` for different needs.</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bio_mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="n">bio_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">bio_mask</span><span class="p">)</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">back_mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>        <span class="n">back_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">back_mask</span><span class="p">)</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>    <span class="n">new_bio_label</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>    <span class="n">new_bio_label2</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="n">binary_image2</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">greyscale</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>    <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_EPS</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_MAX_ITER</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="n">compactness</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">center</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">kmeans</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">kmeans_clust_nb</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">criteria</span><span class="p">,</span> <span class="n">attempts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">KMEANS_RANDOM_CENTERS</span><span class="p">)</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="n">kmeans_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">greyscale</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>    <span class="n">sum_per_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">)</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="n">binary_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">greyscale</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="k">if</span> <span class="n">previous_binary_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="n">binary_images</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="n">image_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">):</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>            <span class="n">binary_image_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">greyscale</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>            <span class="n">binary_image_i</span><span class="p">[</span><span class="n">kmeans_image</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>            <span class="n">image_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">binary_image_i</span> <span class="o">*</span> <span class="n">previous_binary_image</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>            <span class="n">binary_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">binary_image_i</span><span class="p">)</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="n">binary_image</span><span class="p">[</span><span class="n">kmeans_image</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">image_scores</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="k">elif</span> <span class="n">bio_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span class="n">binary_image</span><span class="p">[</span><span class="n">kmeans_image</span> <span class="o">==</span> <span class="n">bio_label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="n">new_bio_label</span> <span class="o">=</span> <span class="n">bio_label</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="k">if</span> <span class="n">bio_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>            <span class="n">all_labels</span> <span class="o">=</span> <span class="n">kmeans_image</span><span class="p">[</span><span class="n">bio_mask</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bio_mask</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">):</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>                <span class="n">sum_per_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">all_labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="n">new_bio_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sum_per_label</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>        <span class="k">elif</span> <span class="n">back_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="n">all_labels</span> <span class="o">=</span> <span class="n">kmeans_image</span><span class="p">[</span><span class="n">back_mask</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">back_mask</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">):</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>                <span class="n">sum_per_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">all_labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>            <span class="n">new_bio_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sum_per_label</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">):</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>                <span class="n">sum_per_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">kmeans_image</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>            <span class="n">new_bio_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sum_per_label</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="n">binary_image</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">kmeans_image</span><span class="p">,</span> <span class="n">new_bio_label</span><span class="p">)</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>    <span class="k">if</span> <span class="n">logical</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span> <span class="ow">and</span> <span class="n">greyscale2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">greyscale2</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_EPS</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_MAX_ITER</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="n">compactness</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">center</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">kmeans</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">kmeans_clust_nb</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">criteria</span><span class="p">,</span> <span class="n">attempts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>                                                <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">KMEANS_RANDOM_CENTERS</span><span class="p">)</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="n">kmeans_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">greyscale</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="n">sum_per_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">)</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="n">binary_image2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">greyscale</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">if</span> <span class="n">previous_binary_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="n">binary_images</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="n">image_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">):</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>                <span class="n">binary_image_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">greyscale</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>                <span class="n">binary_image_i</span><span class="p">[</span><span class="n">kmeans_image</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>                <span class="n">image_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">binary_image_i</span> <span class="o">*</span> <span class="n">previous_binary_image</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>                <span class="n">binary_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">binary_image_i</span><span class="p">)</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="n">binary_image2</span><span class="p">[</span><span class="n">kmeans_image</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">image_scores</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>        <span class="k">elif</span> <span class="n">bio_label2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>            <span class="n">binary_image2</span><span class="p">[</span><span class="n">kmeans_image</span> <span class="o">==</span> <span class="n">bio_label2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>            <span class="n">new_bio_label2</span> <span class="o">=</span> <span class="n">bio_label2</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="k">if</span> <span class="n">bio_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>                <span class="n">all_labels</span> <span class="o">=</span> <span class="n">kmeans_image</span><span class="p">[</span><span class="n">bio_mask</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bio_mask</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">):</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>                    <span class="n">sum_per_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">all_labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                <span class="n">new_bio_label2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sum_per_label</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>            <span class="k">elif</span> <span class="n">back_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                <span class="n">all_labels</span> <span class="o">=</span> <span class="n">kmeans_image</span><span class="p">[</span><span class="n">back_mask</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">back_mask</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">):</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>                    <span class="n">sum_per_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">all_labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                <span class="n">new_bio_label2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sum_per_label</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmeans_clust_nb</span><span class="p">):</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>                    <span class="n">sum_per_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">kmeans_image</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>                <span class="n">new_bio_label2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sum_per_label</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="n">binary_image2</span><span class="p">[</span><span class="n">kmeans_image</span> <span class="o">==</span> <span class="n">new_bio_label2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>    <span class="k">return</span> <span class="n">binary_image</span><span class="p">,</span> <span class="n">binary_image2</span><span class="p">,</span> <span class="n">new_bio_label</span><span class="p">,</span> <span class="n">new_bio_label2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.otsu_thresholding" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">otsu_thresholding</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Apply Otsu's thresholding to a grayscale image.</p>
<p>This function calculates the optimal threshold using
Otsu's method and applies it to binarize the input image.
The output is a binary image where pixel values are either
0 or 1.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input grayscale image with any kind of value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Binarized image with pixel values 0 or 1.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">otsu_thresholding</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">[1 0 0]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="nd">@njit</span><span class="p">()</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="k">def</span><span class="w"> </span><span class="nf">otsu_thresholding</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">    Apply Otsu&#39;s thresholding to a grayscale image.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    This function calculates the optimal threshold using</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    Otsu&#39;s method and applies it to binarize the input image.</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    The output is a binary image where pixel values are either</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">    0 or 1.</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">    image : ndarray</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">        Input grayscale image with any kind of value.</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">    -------</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">    out : ndarray of uint8</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">        Binarized image with pixel values 0 or 1.</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">    --------</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">    &gt;&gt;&gt; image = np.array([10, 20, 30])</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">    &gt;&gt;&gt; result = otsu_thresholding(image)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    [1 0 0]</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="n">threshold</span> <span class="o">=</span> <span class="n">get_otsu_threshold</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="n">binary_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="k">if</span> <span class="n">binary_image</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">binary_image</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="k">return</span> <span class="n">binary_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">binary_image</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.rolling_window_segmentation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rolling_window_segmentation</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Perform rolling window segmentation on a greyscale image, using potentially filled pixels and a specified patch size.</p>
<p>The function divides the input greyscale image into overlapping patches defined by <code>patch_size</code>,
and applies Otsu's thresholding method to each patch. The thresholds can be optionally
refined using a minimization algorithm.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>greyscale_image</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input greyscale image to segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>possibly_filled_pixels</code>
            </td>
            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array indicating which pixels are possibly filled.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patch_size</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dimensions of the patches to segment. Default is (10, 10).
Must be superior to (1, 1).</p>
              </div>
            </td>
            <td>
                  <code>(10, 10)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>output</code></td>            <td>
                  <code>ndarray of uint8</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The segmented binary image where the network is marked as True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">greyscale_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">possibly_filled_pixels</span> <span class="o">=</span> <span class="n">greyscale_image</span> <span class="o">&gt;</span> <span class="mi">1</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">patch_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">rolling_window_segmentation</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">[[0 1 0 0]</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go"> [0 1 1 0]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go"> [0 1 1 0]</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go"> [0 0 1 0]]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="k">def</span><span class="w"> </span><span class="nf">rolling_window_segmentation</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">possibly_filled_pixels</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">:</span> <span class="nb">tuple</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">    Perform rolling window segmentation on a greyscale image, using potentially filled pixels and a specified patch size.</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">    The function divides the input greyscale image into overlapping patches defined by `patch_size`,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="sd">    and applies Otsu&#39;s thresholding method to each patch. The thresholds can be optionally</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">    refined using a minimization algorithm.</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">    greyscale_image : ndarray of uint8</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">        The input greyscale image to segment.</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">    possibly_filled_pixels : ndarray of uint8</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">        An array indicating which pixels are possibly filled.</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">    patch_size : tuple, optional</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">        The dimensions of the patches to segment. Default is (10, 10).</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">        Must be superior to (1, 1).</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">    -------</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">    output : ndarray of uint8</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">        The segmented binary image where the network is marked as True.</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">    --------</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a><span class="sd">    &gt;&gt;&gt; greyscale_image = np.array([[1, 2, 1, 1], [1, 3, 4, 1], [2, 4, 3, 1], [2, 1, 2, 1]])</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="sd">    &gt;&gt;&gt; possibly_filled_pixels = greyscale_image &gt; 1</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="sd">    &gt;&gt;&gt; patch_size = (2, 2)</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="sd">    &gt;&gt;&gt; result = rolling_window_segmentation(greyscale_image, possibly_filled_pixels, patch_size)</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="sd">    &gt;&gt;&gt; print(result)</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">    [[0 1 0 0]</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">     [0 1 1 0]</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">     [0 1 1 0]</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">     [0 0 1 0]]</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>    <span class="n">patch_centers</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>            <span class="n">p</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">-</span> <span class="n">p</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>        <span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">greyscale_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">)</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>    <span class="p">]</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>    <span class="n">patch_centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">patch_centers</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>    <span class="n">patch_slices</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>        <span class="nb">tuple</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">p</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="n">p</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>              <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p_c</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">))</span> <span class="k">for</span> <span class="n">p_c</span> <span class="ow">in</span> <span class="n">patch_centers</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>    <span class="p">]</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>    <span class="n">maximize_parameter</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>    <span class="n">network_patches</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>    <span class="n">patch_thresholds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>    <span class="c1"># for patch in tqdm(patch_slices):</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>    <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">patch_slices</span><span class="p">:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">greyscale_image</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span> <span class="o">*</span> <span class="n">possibly_filled_pixels</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>            <span class="n">t</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>            <span class="k">if</span> <span class="n">maximize_parameter</span><span class="p">:</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>                <span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">_network_perimeter</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">v</span><span class="p">,),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">)</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>                <span class="n">t</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>            <span class="n">network_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">)</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>            <span class="n">patch_thresholds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>            <span class="n">network_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>            <span class="n">patch_thresholds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>    <span class="n">network_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">greyscale_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>    <span class="n">count_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">greyscale_image</span><span class="p">)</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>    <span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">network_patch</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">patch_slices</span><span class="p">,</span> <span class="n">network_patches</span><span class="p">,</span> <span class="n">patch_thresholds</span><span class="p">):</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="n">network_img</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span> <span class="o">+=</span> <span class="n">network_patch</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="n">count_img</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">network_patch</span><span class="p">)</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>    <span class="c1"># Safe in-place division: zeros remain where count_img == 0</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>    <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">network_img</span><span class="p">,</span> <span class="n">count_img</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">network_img</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">count_img</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">network_img</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.segment_with_lum_value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">segment_with_lum_value</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">basic_bckgrnd_values</span><span class="p">,</span> <span class="n">l_threshold</span><span class="p">,</span> <span class="n">lighter_background</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Segment video frames based on luminance threshold.</p>
<p>This function segments the input video frames by comparing against a dynamic
luminance threshold. The segmentation can be based on either lighter or darker
background.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>converted_video</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input video frames in numpy array format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>basic_bckgrnd_values</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array containing background values for each frame.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>l_threshold</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The luminance threshold value for segmentation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lighter_background</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the segmentation is done assuming a lighter background.
Defaults to False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>segmentation</code></td>            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array containing the segmented video frames.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>l_threshold_over_time</code></td>            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Computed threshold over time for each frame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">converted_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span> <span class="p">[</span><span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">160</span><span class="p">,</span> <span class="mi">170</span><span class="p">],</span> <span class="p">[</span><span class="mi">180</span><span class="p">,</span> <span class="mi">200</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">basic_bckgrnd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">])</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">lighter_background</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">l_threshold</span> <span class="o">=</span> <span class="mi">130</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">segmentation</span><span class="p">,</span> <span class="n">threshold_over_time</span> <span class="o">=</span> <span class="n">segment_with_lum_value</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">basic_bckgrnd_values</span><span class="p">,</span> <span class="n">l_threshold</span><span class="p">,</span> <span class="n">lighter_background</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">segmentation</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="go">[[[0 1]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">  [1 1]]</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go"> [[1 1]</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="go">  [1 1]]]</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="k">def</span><span class="w"> </span><span class="nf">segment_with_lum_value</span><span class="p">(</span><span class="n">converted_video</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">basic_bckgrnd_values</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">l_threshold</span><span class="p">,</span> <span class="n">lighter_background</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">    Segment video frames based on luminance threshold.</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">    This function segments the input video frames by comparing against a dynamic</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">    luminance threshold. The segmentation can be based on either lighter or darker</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">    background.</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">    converted_video : ndarray</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">        The input video frames in numpy array format.</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    basic_bckgrnd_values : ndarray</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        Array containing background values for each frame.</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">    l_threshold : int or float</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        The luminance threshold value for segmentation.</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">    lighter_background : bool, optional</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">        If True, the segmentation is done assuming a lighter background.</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        Defaults to False.</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">    -------</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">    segmentation : ndarray</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">        Array containing the segmented video frames.</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">    l_threshold_over_time : ndarray</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">        Computed threshold over time for each frame.</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">    --------</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    &gt;&gt;&gt; converted_video = np.array([[[100, 120], [130, 140]], [[160, 170], [180, 200]]], dtype=np.uint8)</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    &gt;&gt;&gt; basic_bckgrnd_values = np.array([100, 120])</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">    &gt;&gt;&gt; lighter_background = False</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    &gt;&gt;&gt; l_threshold = 130</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    &gt;&gt;&gt; segmentation, threshold_over_time = segment_with_lum_value(converted_video, basic_bckgrnd_values, l_threshold, lighter_background)</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    &gt;&gt;&gt; print(segmentation)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    [[[0 1]</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">      [1 1]]</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">     [[1 1]</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">      [1 1]]]</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="c1"># segmentation = None</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="k">if</span> <span class="n">lighter_background</span><span class="p">:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="n">l_threshold</span> <span class="o">-</span> <span class="p">(</span><span class="n">basic_bckgrnd_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">basic_bckgrnd_values</span><span class="p">)</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">l_threshold_over_time</span><span class="p">,</span> <span class="n">l_threshold_over_time</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">)):</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="n">segmentation</span> <span class="o">=</span> <span class="n">less_along_first_axis</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">l_threshold_over_time</span><span class="p">)</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="n">segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">converted_video</span><span class="p">)</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="k">if</span> <span class="n">l_threshold</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                <span class="n">l_threshold</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="n">segmentation</span> <span class="o">+=</span> <span class="n">converted_video</span> <span class="o">&gt;</span> <span class="n">l_threshold</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="n">l_threshold_over_time</span> <span class="o">=</span> <span class="n">l_threshold</span> <span class="o">-</span> <span class="p">(</span><span class="n">basic_bckgrnd_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">basic_bckgrnd_values</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">l_threshold_over_time</span><span class="p">,</span> <span class="n">l_threshold_over_time</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">)):</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="n">segmentation</span> <span class="o">=</span> <span class="n">greater_along_first_axis</span><span class="p">(</span><span class="n">converted_video</span><span class="p">,</span> <span class="n">l_threshold_over_time</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="n">segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">converted_video</span><span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="k">if</span> <span class="n">l_threshold</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                <span class="n">l_threshold</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>            <span class="n">segmentation</span> <span class="o">+=</span> <span class="n">converted_video</span> <span class="o">&gt;</span> <span class="n">l_threshold</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>    <span class="k">return</span> <span class="n">segmentation</span><span class="p">,</span> <span class="n">l_threshold_over_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cellects.image_analysis.image_segmentation.windowed_thresholding" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">windowed_thresholding</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">lighter_background</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">side_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_int_var</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Perform grid segmentation on the image.</p>
<p>This method applies a sliding window approach to segment the image into
a grid-like pattern based on intensity variations and optionally uses a mask.
The segmented regions are stored in <code>self.binary_image</code>.</p>
<p>Args:
    lighter_background (bool): If True, areas lighter than the Otsu threshold are considered;
        otherwise, darker areas are considered.
    side_length (int, optional): The size of each grid square. Default is None.
    step (int, optional): The step size for the sliding window. Default is None.
    min_int_var (int, optional): Threshold for intensity variation within a grid.
        Default is 20.
    mask (NDArray, optional): A binary mask to restrict the segmentation area. Default is None.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/cellects/image_analysis/image_segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="k">def</span><span class="w"> </span><span class="nf">windowed_thresholding</span><span class="p">(</span><span class="n">image</span><span class="p">:</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">lighter_background</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">side_length</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_int_var</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">    Perform grid segmentation on the image.</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">    This method applies a sliding window approach to segment the image into</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">    a grid-like pattern based on intensity variations and optionally uses a mask.</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    The segmented regions are stored in `self.binary_image`.</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">        lighter_background (bool): If True, areas lighter than the Otsu threshold are considered;</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">            otherwise, darker areas are considered.</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">        side_length (int, optional): The size of each grid square. Default is None.</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">        step (int, optional): The step size for the sliding window. Default is None.</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">        min_int_var (int, optional): Threshold for intensity variation within a grid.</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">            Default is 20.</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">        mask (NDArray, optional): A binary mask to restrict the segmentation area. Default is None.</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="k">if</span> <span class="n">lighter_background</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="n">binary_image</span> <span class="o">=</span> <span class="n">otsu_thresholding</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="n">lighter_background</span> <span class="o">=</span> <span class="n">binary_image</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">binary_image</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>    <span class="k">if</span> <span class="n">min_int_var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="n">min_int_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="k">if</span> <span class="n">side_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="n">side_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="n">step</span> <span class="o">=</span> <span class="n">side_length</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>    <span class="n">grid_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>    <span class="n">homogeneities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>    <span class="k">for</span> <span class="n">to_add</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">side_length</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>        <span class="n">y_windows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">side_length</span><span class="p">)</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>        <span class="n">x_windows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">side_length</span><span class="p">)</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>        <span class="n">y_windows</span> <span class="o">+=</span> <span class="n">to_add</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>        <span class="n">x_windows</span> <span class="o">+=</span> <span class="n">to_add</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>        <span class="k">for</span> <span class="n">y_start</span> <span class="ow">in</span> <span class="n">y_windows</span><span class="p">:</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>            <span class="k">if</span> <span class="n">y_start</span> <span class="o">&lt;</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>                <span class="n">y_end</span> <span class="o">=</span> <span class="n">y_start</span> <span class="o">+</span> <span class="n">side_length</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>                <span class="k">if</span> <span class="n">y_end</span> <span class="o">&lt;</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>                    <span class="k">for</span> <span class="n">x_start</span> <span class="ow">in</span> <span class="n">x_windows</span><span class="p">:</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>                        <span class="k">if</span> <span class="n">x_start</span> <span class="o">&lt;</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>                            <span class="n">x_end</span> <span class="o">=</span> <span class="n">x_start</span> <span class="o">+</span> <span class="n">side_length</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>                            <span class="k">if</span> <span class="n">x_end</span> <span class="o">&lt;</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>                                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">[</span><span class="n">y_start</span><span class="p">:</span><span class="n">y_end</span><span class="p">,</span> <span class="n">x_start</span><span class="p">:</span><span class="n">x_end</span><span class="p">]):</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>                                    <span class="n">potential_detection</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">y_start</span><span class="p">:</span><span class="n">y_end</span><span class="p">,</span> <span class="n">x_start</span><span class="p">:</span><span class="n">x_end</span><span class="p">]</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>                                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">potential_detection</span><span class="p">):</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>                                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">potential_detection</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">potential_detection</span><span class="p">)])</span> <span class="o">&lt;</span> <span class="n">min_int_var</span><span class="p">:</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>                                            <span class="n">homogeneities</span><span class="p">[</span><span class="n">y_start</span><span class="p">:</span><span class="n">y_end</span><span class="p">,</span> <span class="n">x_start</span><span class="p">:</span><span class="n">x_end</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>                                        <span class="n">threshold</span> <span class="o">=</span> <span class="n">get_otsu_threshold</span><span class="p">(</span><span class="n">potential_detection</span><span class="p">)</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>                                        <span class="k">if</span> <span class="n">lighter_background</span><span class="p">:</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>                                            <span class="n">net_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">potential_detection</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>                                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>                                            <span class="n">net_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">potential_detection</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>                                        <span class="n">grid_image</span><span class="p">[</span><span class="n">y_start</span> <span class="o">+</span> <span class="n">net_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_start</span> <span class="o">+</span> <span class="n">net_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>    <span class="n">binary_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid_image</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">side_length</span> <span class="o">//</span> <span class="n">step</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>    <span class="n">binary_image</span><span class="p">[</span><span class="n">homogeneities</span> <span class="o">&gt;=</span> <span class="p">(((</span><span class="n">side_length</span> <span class="o">//</span> <span class="n">step</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>    <span class="k">return</span> <span class="n">binary_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.instant", "navigation.tabs", "navigation.sections", "navigation.top", "toc.integrate", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>